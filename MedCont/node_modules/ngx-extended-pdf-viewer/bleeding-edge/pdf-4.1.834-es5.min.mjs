/**
 * @licstart The following is the entire license notice for the
 * JavaScript code in this page
 *
 * Copyright 2023 Mozilla Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @licend The above is the entire license notice for the
 * JavaScript code in this page
 */var t={9306:(t,e,i)=>{var s=i(4901),a=i(6823),r=TypeError;t.exports=function(t){if(s(t))return t;throw new r(a(t)+" is not a function")}},3506:(t,e,i)=>{var s=i(3925),a=String,r=TypeError;t.exports=function(t){if(s(t))return t;throw new r("Can't set "+a(t)+" as a prototype")}},7080:(t,e,i)=>{var s=i(4402).has;t.exports=function(t){s(t);return t}},6469:(t,e,i)=>{var s=i(8227),a=i(2360),r=i(4913).f,n=s("unscopables"),o=Array.prototype;void 0===o[n]&&r(o,n,{configurable:!0,value:a(null)});t.exports=function(t){o[n][t]=!0}},679:(t,e,i)=>{var s=i(1625),a=TypeError;t.exports=function(t,e){if(s(e,t))return t;throw new a("Incorrect invocation")}},8551:(t,e,i)=>{var s=i(34),a=String,r=TypeError;t.exports=function(t){if(s(t))return t;throw new r(a(t)+" is not an object")}},7811:t=>{t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7394:(t,e,i)=>{var s=i(6706),a=i(4576),r=TypeError;t.exports=s(ArrayBuffer.prototype,"byteLength","get")||function(t){if("ArrayBuffer"!==a(t))throw new r("ArrayBuffer expected");return t.byteLength}},3238:(t,e,i)=>{var s=i(9504),a=i(7394),r=s(ArrayBuffer.prototype.slice);t.exports=function(t){if(0!==a(t))return!1;try{r(t,0,0);return!1}catch(t){return!0}}},5636:(t,e,i)=>{var s=i(4475),a=i(9504),r=i(6706),n=i(7696),o=i(3238),l=i(7394),c=i(4483),h=i(1548),d=s.structuredClone,u=s.ArrayBuffer,p=s.DataView,_=s.TypeError,f=Math.min,g=u.prototype,v=p.prototype,m=a(g.slice),P=r(g,"resizable","get"),y=r(g,"maxByteLength","get"),b=a(v.getInt8),w=a(v.setInt8);t.exports=(h||c)&&function(t,e,i){var s,a=l(t),r=void 0===e?a:n(e),g=!P||!P(t);if(o(t))throw new _("ArrayBuffer is detached");if(h){t=d(t,{transfer:[t]});if(a===r&&(i||g))return t}if(a>=r&&(!i||g))s=m(t,0,r);else{var v=i&&!g&&y?{maxByteLength:y(t)}:void 0;s=new u(r,v);for(var A=new p(t),S=new p(s),x=f(r,a),C=0;C<x;C++)w(S,C,b(A,C))}h||c(t);return s}},4644:(t,e,i)=>{var s,a,r,n=i(7811),o=i(3724),l=i(4475),c=i(4901),h=i(34),d=i(9297),u=i(6955),p=i(6823),_=i(6699),f=i(6840),g=i(2106),v=i(1625),m=i(2787),P=i(2967),y=i(8227),b=i(3392),w=i(1181),A=w.enforce,S=w.get,x=l.Int8Array,C=x&&x.prototype,k=l.Uint8ClampedArray,E=k&&k.prototype,M=x&&m(x),G=C&&m(C),I=Object.prototype,T=l.TypeError,R=y("toStringTag"),D=b("TYPED_ARRAY_TAG"),L="TypedArrayConstructor",B=n&&!!P&&"Opera"!==u(l.opera),O=!1,N={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},W={BigInt64Array:8,BigUint64Array:8},getTypedArrayConstructor=function(t){var e=m(t);if(h(e)){var i=S(e);return i&&d(i,L)?i[L]:getTypedArrayConstructor(e)}},isTypedArray=function(t){if(!h(t))return!1;var e=u(t);return d(N,e)||d(W,e)};for(s in N)(r=(a=l[s])&&a.prototype)?A(r)[L]=a:B=!1;for(s in W)(r=(a=l[s])&&a.prototype)&&(A(r)[L]=a);if(!B||!c(M)||M===Function.prototype){M=function TypedArray(){throw new T("Incorrect invocation")};if(B)for(s in N)l[s]&&P(l[s],M)}if(!B||!G||G===I){G=M.prototype;if(B)for(s in N)l[s]&&P(l[s].prototype,G)}B&&m(E)!==G&&P(E,G);if(o&&!d(G,R)){O=!0;g(G,R,{configurable:!0,get:function(){return h(this)?this[D]:void 0}});for(s in N)l[s]&&_(l[s],D,s)}t.exports={NATIVE_ARRAY_BUFFER_VIEWS:B,TYPED_ARRAY_TAG:O&&D,aTypedArray:function(t){if(isTypedArray(t))return t;throw new T("Target is not a typed array")},aTypedArrayConstructor:function(t){if(c(t)&&(!P||v(M,t)))return t;throw new T(p(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,i,s){if(o){if(i)for(var a in N){var r=l[a];if(r&&d(r.prototype,t))try{delete r.prototype[t]}catch(i){try{r.prototype[t]=e}catch(t){}}}G[t]&&!i||f(G,t,i?e:B&&C[t]||e,s)}},exportTypedArrayStaticMethod:function(t,e,i){var s,a;if(o){if(P){if(i)for(s in N)if((a=l[s])&&d(a,t))try{delete a[t]}catch(t){}if(M[t]&&!i)return;try{return f(M,t,i?e:B&&M[t]||e)}catch(t){}}for(s in N)!(a=l[s])||a[t]&&!i||f(a,t,e)}},getTypedArrayConstructor,isView:function isView(t){if(!h(t))return!1;var e=u(t);return"DataView"===e||d(N,e)||d(W,e)},isTypedArray,TypedArray:M,TypedArrayPrototype:G}},4373:(t,e,i)=>{var s=i(8981),a=i(5610),r=i(6198);t.exports=function fill(t){for(var e=s(this),i=r(e),n=arguments.length,o=a(n>1?arguments[1]:void 0,i),l=n>2?arguments[2]:void 0,c=void 0===l?i:a(l,i);c>o;)e[o++]=t;return e}},5370:(t,e,i)=>{var s=i(6198);t.exports=function(t,e,i){for(var a=0,r=arguments.length>2?i:s(e),n=new t(r);r>a;)n[a]=e[a++];return n}},9617:(t,e,i)=>{var s=i(5397),a=i(5610),r=i(6198),createMethod=function(t){return function(e,i,n){var o=s(e),l=r(o);if(0===l)return!t&&-1;var c,h=a(n,l);if(t&&i!=i){for(;l>h;)if((c=o[h++])!=c)return!0}else for(;l>h;h++)if((t||h in o)&&o[h]===i)return t||h||0;return!t&&-1}};t.exports={includes:createMethod(!0),indexOf:createMethod(!1)}},3839:(t,e,i)=>{var s=i(6080),a=i(7055),r=i(8981),n=i(6198),createMethod=function(t){var e=1===t;return function(i,o,l){for(var c,h=r(i),d=a(h),u=n(d),p=s(o,l);u-- >0;)if(p(c=d[u],u,h))switch(t){case 0:return c;case 1:return u}return e?-1:void 0}};t.exports={findLast:createMethod(0),findLastIndex:createMethod(1)}},4527:(t,e,i)=>{var s=i(3724),a=i(4376),r=TypeError,n=Object.getOwnPropertyDescriptor,o=s&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=o?function(t,e){if(a(t)&&!n(t,"length").writable)throw new r("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},7680:(t,e,i)=>{var s=i(9504);t.exports=s([].slice)},4488:(t,e,i)=>{var s=i(7680),a=Math.floor,sort=function(t,e){var i=t.length;if(i<8)for(var r,n,o=1;o<i;){n=o;r=t[o];for(;n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==o++&&(t[n]=r)}else for(var l=a(i/2),c=sort(s(t,0,l),e),h=sort(s(t,l),e),d=c.length,u=h.length,p=0,_=0;p<d||_<u;)t[p+_]=p<d&&_<u?e(c[p],h[_])<=0?c[p++]:h[_++]:p<d?c[p++]:h[_++];return t};t.exports=sort},7628:(t,e,i)=>{var s=i(6198);t.exports=function(t,e){for(var i=s(t),a=new e(i),r=0;r<i;r++)a[r]=t[i-r-1];return a}},9928:(t,e,i)=>{var s=i(6198),a=i(1291),r=RangeError;t.exports=function(t,e,i,n){var o=s(t),l=a(i),c=l<0?o+l:l;if(c>=o||c<0)throw new r("Incorrect index");for(var h=new e(o),d=0;d<o;d++)h[d]=d===c?n:t[d];return h}},6319:(t,e,i)=>{var s=i(8551),a=i(9539);t.exports=function(t,e,i,r){try{return r?e(s(i)[0],i[1]):e(i)}catch(e){a(t,"throw",e)}}},4576:(t,e,i)=>{var s=i(9504),a=s({}.toString),r=s("".slice);t.exports=function(t){return r(a(t),8,-1)}},6955:(t,e,i)=>{var s=i(2140),a=i(4901),r=i(4576),n=i(8227)("toStringTag"),o=Object,l="Arguments"===r(function(){return arguments}());t.exports=s?r:function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=o(t),n))?i:l?r(e):"Object"===(s=r(e))&&a(e.callee)?"Arguments":s}},7740:(t,e,i)=>{var s=i(9297),a=i(5031),r=i(7347),n=i(4913);t.exports=function(t,e,i){for(var o=a(e),l=n.f,c=r.f,h=0;h<o.length;h++){var d=o[h];s(t,d)||i&&s(i,d)||l(t,d,c(e,d))}}},2211:(t,e,i)=>{var s=i(9039);t.exports=!s((function(){function F(){}F.prototype.constructor=null;return Object.getPrototypeOf(new F)!==F.prototype}))},2529:t=>{t.exports=function(t,e){return{value:t,done:e}}},6699:(t,e,i)=>{var s=i(3724),a=i(4913),r=i(6980);t.exports=s?function(t,e,i){return a.f(t,e,r(1,i))}:function(t,e,i){t[e]=i;return t}},6980:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},2278:(t,e,i)=>{var s=i(3724),a=i(4913),r=i(6980);t.exports=function(t,e,i){s?a.f(t,e,r(0,i)):t[e]=i}},2106:(t,e,i)=>{var s=i(283),a=i(4913);t.exports=function(t,e,i){i.get&&s(i.get,e,{getter:!0});i.set&&s(i.set,e,{setter:!0});return a.f(t,e,i)}},6840:(t,e,i)=>{var s=i(4901),a=i(4913),r=i(283),n=i(9433);t.exports=function(t,e,i,o){o||(o={});var l=o.enumerable,c=void 0!==o.name?o.name:e;s(i)&&r(i,c,o);if(o.global)l?t[e]=i:n(e,i);else{try{o.unsafe?t[e]&&(l=!0):delete t[e]}catch(t){}l?t[e]=i:a.f(t,e,{value:i,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}return t}},6279:(t,e,i)=>{var s=i(6840);t.exports=function(t,e,i){for(var a in e)s(t,a,e[a],i);return t}},9433:(t,e,i)=>{var s=i(4475),a=Object.defineProperty;t.exports=function(t,e){try{a(s,t,{value:e,configurable:!0,writable:!0})}catch(i){s[t]=e}return e}},3724:(t,e,i)=>{var s=i(9039);t.exports=!s((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4483:(t,e,i)=>{var s,a,r,n,o=i(4475),l=i(9714),c=i(1548),h=o.structuredClone,d=o.ArrayBuffer,u=o.MessageChannel,p=!1;if(c)p=function(t){h(t,{transfer:[t]})};else if(d)try{u||(s=l("worker_threads"))&&(u=s.MessageChannel);if(u){a=new u;r=new d(2);n=function(t){a.port1.postMessage(null,[t])};if(2===r.byteLength){n(r);0===r.byteLength&&(p=n)}}}catch(t){}t.exports=p},4055:(t,e,i)=>{var s=i(4475),a=i(34),r=s.document,n=a(r)&&a(r.createElement);t.exports=function(t){return n?r.createElement(t):{}}},6837:t=>{var e=TypeError;t.exports=function(t){if(t>9007199254740991)throw e("Maximum allowed index exceeded");return t}},5002:t=>{t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},8834:(t,e,i)=>{var s=i(9392).match(/firefox\/(\d+)/i);t.exports=!!s&&+s[1]},7290:(t,e,i)=>{var s=i(516),a=i(9088);t.exports=!s&&!a&&"object"==typeof window&&"object"==typeof document},516:t=>{t.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},3202:(t,e,i)=>{var s=i(9392);t.exports=/MSIE|Trident/.test(s)},9088:(t,e,i)=>{var s=i(4475),a=i(4576);t.exports="process"===a(s.process)},9392:t=>{t.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},7388:(t,e,i)=>{var s,a,r=i(4475),n=i(9392),o=r.process,l=r.Deno,c=o&&o.versions||l&&l.version,h=c&&c.v8;h&&(a=(s=h.split("."))[0]>0&&s[0]<4?1:+(s[0]+s[1]));!a&&n&&(!(s=n.match(/Edge\/(\d+)/))||s[1]>=74)&&(s=n.match(/Chrome\/(\d+)/))&&(a=+s[1]);t.exports=a},9160:(t,e,i)=>{var s=i(9392).match(/AppleWebKit\/(\d+)\./);t.exports=!!s&&+s[1]},8727:t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},6193:(t,e,i)=>{var s=i(9504),a=Error,r=s("".replace),n=String(new a("zxcasd").stack),o=/\n\s*at [^:]*:[^\n]*/,l=o.test(n);t.exports=function(t,e){if(l&&"string"==typeof t&&!a.prepareStackTrace)for(;e--;)t=r(t,o,"");return t}},747:(t,e,i)=>{var s=i(6699),a=i(6193),r=i(4659),n=Error.captureStackTrace;t.exports=function(t,e,i,o){r&&(n?n(t,e):s(t,"stack",a(i,o)))}},4659:(t,e,i)=>{var s=i(9039),a=i(6980);t.exports=!s((function(){var t=new Error("a");if(!("stack"in t))return!0;Object.defineProperty(t,"stack",a(1,7));return 7!==t.stack}))},6518:(t,e,i)=>{var s=i(4475),a=i(7347).f,r=i(6699),n=i(6840),o=i(9433),l=i(7740),c=i(2796);t.exports=function(t,e){var i,h,d,u,p,_=t.target,f=t.global,g=t.stat;if(i=f?s:g?s[_]||o(_,{}):s[_]&&s[_].prototype)for(h in e){u=e[h];d=t.dontCallGetSet?(p=a(i,h))&&p.value:i[h];if(!c(f?h:_+(g?".":"#")+h,t.forced)&&void 0!==d){if(typeof u==typeof d)continue;l(u,d)}(t.sham||d&&d.sham)&&r(u,"sham",!0);n(i,h,u,t)}}},9039:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},8745:(t,e,i)=>{var s=i(616),a=Function.prototype,r=a.apply,n=a.call;t.exports="object"==typeof Reflect&&Reflect.apply||(s?n.bind(r):function(){return n.apply(r,arguments)})},6080:(t,e,i)=>{var s=i(7476),a=i(9306),r=i(616),n=s(s.bind);t.exports=function(t,e){a(t);return void 0===e?t:r?n(t,e):function(){return t.apply(e,arguments)}}},616:(t,e,i)=>{var s=i(9039);t.exports=!s((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},9565:(t,e,i)=>{var s=i(616),a=Function.prototype.call;t.exports=s?a.bind(a):function(){return a.apply(a,arguments)}},350:(t,e,i)=>{var s=i(3724),a=i(9297),r=Function.prototype,n=s&&Object.getOwnPropertyDescriptor,o=a(r,"name"),l=o&&"something"===function something(){}.name,c=o&&(!s||s&&n(r,"name").configurable);t.exports={EXISTS:o,PROPER:l,CONFIGURABLE:c}},6706:(t,e,i)=>{var s=i(9504),a=i(9306);t.exports=function(t,e,i){try{return s(a(Object.getOwnPropertyDescriptor(t,e)[i]))}catch(t){}}},7476:(t,e,i)=>{var s=i(4576),a=i(9504);t.exports=function(t){if("Function"===s(t))return a(t)}},9504:(t,e,i)=>{var s=i(616),a=Function.prototype,r=a.call,n=s&&a.bind.bind(r,r);t.exports=s?n:function(t){return function(){return r.apply(t,arguments)}}},7751:(t,e,i)=>{var s=i(4475),a=i(4901);t.exports=function(t,e){return arguments.length<2?(i=s[t],a(i)?i:void 0):s[t]&&s[t][e];var i}},1767:t=>{t.exports=function(t){return{iterator:t,next:t.next,done:!1}}},8646:(t,e,i)=>{var s=i(9565),a=i(8551),r=i(1767),n=i(851);t.exports=function(t,e){e&&"string"==typeof t||a(t);var i=n(t);return r(a(void 0!==i?s(i,t):t))}},851:(t,e,i)=>{var s=i(6955),a=i(5966),r=i(4117),n=i(6269),o=i(8227)("iterator");t.exports=function(t){if(!r(t))return a(t,o)||a(t,"@@iterator")||n[s(t)]}},81:(t,e,i)=>{var s=i(9565),a=i(9306),r=i(8551),n=i(6823),o=i(851),l=TypeError;t.exports=function(t,e){var i=arguments.length<2?o(t):e;if(a(i))return r(s(i,t));throw new l(n(t)+" is not iterable")}},5966:(t,e,i)=>{var s=i(9306),a=i(4117);t.exports=function(t,e){var i=t[e];return a(i)?void 0:s(i)}},3789:(t,e,i)=>{var s=i(9306),a=i(8551),r=i(9565),n=i(1291),o=i(1767),l="Invalid size",c=RangeError,h=TypeError,d=Math.max,SetRecord=function(t,e){this.set=t;this.size=d(e,0);this.has=s(t.has);this.keys=s(t.keys)};SetRecord.prototype={getIterator:function(){return o(a(r(this.keys,this.set)))},includes:function(t){return r(this.has,this.set,t)}};t.exports=function(t){a(t);var e=+t.size;if(e!=e)throw new h(l);var i=n(e);if(i<0)throw new c(l);return new SetRecord(t,i)}},4475:function(t){var check=function(t){return t&&t.Math===Math&&t};t.exports=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof global&&global)||check("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9297:(t,e,i)=>{var s=i(9504),a=i(8981),r=s({}.hasOwnProperty);t.exports=Object.hasOwn||function hasOwn(t,e){return r(a(t),e)}},421:t=>{t.exports={}},397:(t,e,i)=>{var s=i(7751);t.exports=s("document","documentElement")},5917:(t,e,i)=>{var s=i(3724),a=i(9039),r=i(4055);t.exports=!s&&!a((function(){return 7!==Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a}))},7055:(t,e,i)=>{var s=i(9504),a=i(9039),r=i(4576),n=Object,o=s("".split);t.exports=a((function(){return!n("z").propertyIsEnumerable(0)}))?function(t){return"String"===r(t)?o(t,""):n(t)}:n},3167:(t,e,i)=>{var s=i(4901),a=i(34),r=i(2967);t.exports=function(t,e,i){var n,o;r&&s(n=e.constructor)&&n!==i&&a(o=n.prototype)&&o!==i.prototype&&r(t,o);return t}},3706:(t,e,i)=>{var s=i(9504),a=i(4901),r=i(7629),n=s(Function.toString);a(r.inspectSource)||(r.inspectSource=function(t){return n(t)});t.exports=r.inspectSource},7584:(t,e,i)=>{var s=i(34),a=i(6699);t.exports=function(t,e){s(e)&&"cause"in e&&a(t,"cause",e.cause)}},1181:(t,e,i)=>{var s,a,r,n=i(8622),o=i(4475),l=i(34),c=i(6699),h=i(9297),d=i(7629),u=i(6119),p=i(421),_="Object already initialized",f=o.TypeError,g=o.WeakMap;if(n||d.state){var v=d.state||(d.state=new g);v.get=v.get;v.has=v.has;v.set=v.set;s=function(t,e){if(v.has(t))throw new f(_);e.facade=t;v.set(t,e);return e};a=function(t){return v.get(t)||{}};r=function(t){return v.has(t)}}else{var m=u("state");p[m]=!0;s=function(t,e){if(h(t,m))throw new f(_);e.facade=t;c(t,m,e);return e};a=function(t){return h(t,m)?t[m]:{}};r=function(t){return h(t,m)}}t.exports={set:s,get:a,has:r,enforce:function(t){return r(t)?a(t):s(t,{})},getterFor:function(t){return function(e){var i;if(!l(e)||(i=a(e)).type!==t)throw new f("Incompatible receiver, "+t+" required");return i}}}},4209:(t,e,i)=>{var s=i(8227),a=i(6269),r=s("iterator"),n=Array.prototype;t.exports=function(t){return void 0!==t&&(a.Array===t||n[r]===t)}},4376:(t,e,i)=>{var s=i(4576);t.exports=Array.isArray||function isArray(t){return"Array"===s(t)}},1108:(t,e,i)=>{var s=i(6955);t.exports=function(t){var e=s(t);return"BigInt64Array"===e||"BigUint64Array"===e}},4901:t=>{var e="object"==typeof document&&document.all;t.exports=void 0===e&&void 0!==e?function(t){return"function"==typeof t||t===e}:function(t){return"function"==typeof t}},2796:(t,e,i)=>{var s=i(9039),a=i(4901),r=/#|\.prototype\./,isForced=function(t,e){var i=o[n(t)];return i===c||i!==l&&(a(e)?s(e):!!e)},n=isForced.normalize=function(t){return String(t).replace(r,".").toLowerCase()},o=isForced.data={},l=isForced.NATIVE="N",c=isForced.POLYFILL="P";t.exports=isForced},4117:t=>{t.exports=function(t){return null==t}},34:(t,e,i)=>{var s=i(4901);t.exports=function(t){return"object"==typeof t?null!==t:s(t)}},3925:(t,e,i)=>{var s=i(34);t.exports=function(t){return s(t)||null===t}},6395:t=>{t.exports=!1},757:(t,e,i)=>{var s=i(7751),a=i(4901),r=i(1625),n=i(7040),o=Object;t.exports=n?function(t){return"symbol"==typeof t}:function(t){var e=s("Symbol");return a(e)&&r(e.prototype,o(t))}},507:(t,e,i)=>{var s=i(9565);t.exports=function(t,e,i){for(var a,r,n=i?t:t.iterator,o=t.next;!(a=s(o,n)).done;)if(void 0!==(r=e(a.value)))return r}},2652:(t,e,i)=>{var s=i(6080),a=i(9565),r=i(8551),n=i(6823),o=i(4209),l=i(6198),c=i(1625),h=i(81),d=i(851),u=i(9539),p=TypeError,Result=function(t,e){this.stopped=t;this.result=e},_=Result.prototype;t.exports=function(t,e,i){var f,g,v,m,P,y,b,w=i&&i.that,A=!(!i||!i.AS_ENTRIES),S=!(!i||!i.IS_RECORD),x=!(!i||!i.IS_ITERATOR),C=!(!i||!i.INTERRUPTED),k=s(e,w),stop=function(t){f&&u(f,"normal",t);return new Result(!0,t)},callFn=function(t){if(A){r(t);return C?k(t[0],t[1],stop):k(t[0],t[1])}return C?k(t,stop):k(t)};if(S)f=t.iterator;else if(x)f=t;else{if(!(g=d(t)))throw new p(n(t)+" is not iterable");if(o(g)){for(v=0,m=l(t);m>v;v++)if((P=callFn(t[v]))&&c(_,P))return P;return new Result(!1)}f=h(t,g)}y=S?t.next:f.next;for(;!(b=a(y,f)).done;){try{P=callFn(b.value)}catch(t){u(f,"throw",t)}if("object"==typeof P&&P&&c(_,P))return P}return new Result(!1)}},9539:(t,e,i)=>{var s=i(9565),a=i(8551),r=i(5966);t.exports=function(t,e,i){var n,o;a(t);try{if(!(n=r(t,"return"))){if("throw"===e)throw i;return i}n=s(n,t)}catch(t){o=!0;n=t}if("throw"===e)throw i;if(o)throw n;a(n);return i}},9462:(t,e,i)=>{var s=i(9565),a=i(2360),r=i(6699),n=i(6279),o=i(8227),l=i(1181),c=i(5966),h=i(7657).IteratorPrototype,d=i(2529),u=i(9539),p=o("toStringTag"),_="IteratorHelper",f="WrapForValidIterator",g=l.set,createIteratorProxyPrototype=function(t){var e=l.getterFor(t?f:_);return n(a(h),{next:function next(){var i=e(this);if(t)return i.nextHandler();try{var s=i.done?void 0:i.nextHandler();return d(s,i.done)}catch(t){i.done=!0;throw t}},return:function(){var i=e(this),a=i.iterator;i.done=!0;if(t){var r=c(a,"return");return r?s(r,a):d(void 0,!0)}if(i.inner)try{u(i.inner.iterator,"normal")}catch(t){return u(a,"throw",t)}u(a,"normal");return d(void 0,!0)}})},v=createIteratorProxyPrototype(!0),m=createIteratorProxyPrototype(!1);r(m,p,"Iterator Helper");t.exports=function(t,e){var i=function Iterator(i,s){if(s){s.iterator=i.iterator;s.next=i.next}else s=i;s.type=e?f:_;s.nextHandler=t;s.counter=0;s.done=!1;g(this,s)};i.prototype=e?v:m;return i}},713:(t,e,i)=>{var s=i(9565),a=i(9306),r=i(8551),n=i(1767),o=i(9462),l=i(6319),c=o((function(){var t=this.iterator,e=r(s(this.next,t));if(!(this.done=!!e.done))return l(t,this.mapper,[e.value,this.counter++],!0)}));t.exports=function map(t){r(this);a(t);return new c(n(this),{mapper:t})}},7657:(t,e,i)=>{var s,a,r,n=i(9039),o=i(4901),l=i(34),c=i(2360),h=i(2787),d=i(6840),u=i(8227),p=i(6395),_=u("iterator"),f=!1;[].keys&&("next"in(r=[].keys())?(a=h(h(r)))!==Object.prototype&&(s=a):f=!0);!l(s)||n((function(){var t={};return s[_].call(t)!==t}))?s={}:p&&(s=c(s));o(s[_])||d(s,_,(function(){return this}));t.exports={IteratorPrototype:s,BUGGY_SAFARI_ITERATORS:f}},6269:t=>{t.exports={}},6198:(t,e,i)=>{var s=i(8014);t.exports=function(t){return s(t.length)}},283:(t,e,i)=>{var s=i(9504),a=i(9039),r=i(4901),n=i(9297),o=i(3724),l=i(350).CONFIGURABLE,c=i(3706),h=i(1181),d=h.enforce,u=h.get,p=String,_=Object.defineProperty,f=s("".slice),g=s("".replace),v=s([].join),m=o&&!a((function(){return 8!==_((function(){}),"length",{value:8}).length})),P=String(String).split("String"),y=t.exports=function(t,e,i){"Symbol("===f(p(e),0,7)&&(e="["+g(p(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]");i&&i.getter&&(e="get "+e);i&&i.setter&&(e="set "+e);(!n(t,"name")||l&&t.name!==e)&&(o?_(t,"name",{value:e,configurable:!0}):t.name=e);m&&i&&n(i,"arity")&&t.length!==i.arity&&_(t,"length",{value:i.arity});try{i&&n(i,"constructor")&&i.constructor?o&&_(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=d(t);n(s,"source")||(s.source=v(P,"string"==typeof e?e:""));return t};Function.prototype.toString=y((function toString(){return r(this)&&u(this).source||c(this)}),"toString")},741:t=>{var e=Math.ceil,i=Math.floor;t.exports=Math.trunc||function trunc(t){var s=+t;return(s>0?i:e)(s)}},2603:(t,e,i)=>{var s=i(655);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:s(t)}},2360:(t,e,i)=>{var s,a=i(8551),r=i(6801),n=i(8727),o=i(421),l=i(397),c=i(4055),h=i(6119),d="prototype",u="script",p=h("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return"<"+u+">"+t+"</"+u+">"},NullProtoObjectViaActiveX=function(t){t.write(scriptTag(""));t.close();var e=t.parentWindow.Object;t=null;return e},NullProtoObject=function(){try{s=new ActiveXObject("htmlfile")}catch(t){}NullProtoObject="undefined"!=typeof document?document.domain&&s?NullProtoObjectViaActiveX(s):function(){var t,e=c("iframe"),i="java"+u+":";e.style.display="none";l.appendChild(e);e.src=String(i);(t=e.contentWindow.document).open();t.write(scriptTag("document.F=Object"));t.close();return t.F}():NullProtoObjectViaActiveX(s);for(var t=n.length;t--;)delete NullProtoObject[d][n[t]];return NullProtoObject()};o[p]=!0;t.exports=Object.create||function create(t,e){var i;if(null!==t){EmptyConstructor[d]=a(t);i=new EmptyConstructor;EmptyConstructor[d]=null;i[p]=t}else i=NullProtoObject();return void 0===e?i:r.f(i,e)}},6801:(t,e,i)=>{var s=i(3724),a=i(8686),r=i(4913),n=i(8551),o=i(5397),l=i(1072);e.f=s&&!a?Object.defineProperties:function defineProperties(t,e){n(t);for(var i,s=o(e),a=l(e),c=a.length,h=0;c>h;)r.f(t,i=a[h++],s[i]);return t}},4913:(t,e,i)=>{var s=i(3724),a=i(5917),r=i(8686),n=i(8551),o=i(6969),l=TypeError,c=Object.defineProperty,h=Object.getOwnPropertyDescriptor,d="enumerable",u="configurable",p="writable";e.f=s?r?function defineProperty(t,e,i){n(t);e=o(e);n(i);if("function"==typeof t&&"prototype"===e&&"value"in i&&p in i&&!i[p]){var s=h(t,e);if(s&&s[p]){t[e]=i.value;i={configurable:u in i?i[u]:s[u],enumerable:d in i?i[d]:s[d],writable:!1}}}return c(t,e,i)}:c:function defineProperty(t,e,i){n(t);e=o(e);n(i);if(a)try{return c(t,e,i)}catch(t){}if("get"in i||"set"in i)throw new l("Accessors not supported");"value"in i&&(t[e]=i.value);return t}},7347:(t,e,i)=>{var s=i(3724),a=i(9565),r=i(8773),n=i(6980),o=i(5397),l=i(6969),c=i(9297),h=i(5917),d=Object.getOwnPropertyDescriptor;e.f=s?d:function getOwnPropertyDescriptor(t,e){t=o(t);e=l(e);if(h)try{return d(t,e)}catch(t){}if(c(t,e))return n(!a(r.f,t,e),t[e])}},8480:(t,e,i)=>{var s=i(1828),a=i(8727).concat("length","prototype");e.f=Object.getOwnPropertyNames||function getOwnPropertyNames(t){return s(t,a)}},3717:(t,e)=>{e.f=Object.getOwnPropertySymbols},2787:(t,e,i)=>{var s=i(9297),a=i(4901),r=i(8981),n=i(6119),o=i(2211),l=n("IE_PROTO"),c=Object,h=c.prototype;t.exports=o?c.getPrototypeOf:function(t){var e=r(t);if(s(e,l))return e[l];var i=e.constructor;return a(i)&&e instanceof i?i.prototype:e instanceof c?h:null}},1625:(t,e,i)=>{var s=i(9504);t.exports=s({}.isPrototypeOf)},1828:(t,e,i)=>{var s=i(9504),a=i(9297),r=i(5397),n=i(9617).indexOf,o=i(421),l=s([].push);t.exports=function(t,e){var i,s=r(t),c=0,h=[];for(i in s)!a(o,i)&&a(s,i)&&l(h,i);for(;e.length>c;)a(s,i=e[c++])&&(~n(h,i)||l(h,i));return h}},1072:(t,e,i)=>{var s=i(1828),a=i(8727);t.exports=Object.keys||function keys(t){return s(t,a)}},8773:(t,e)=>{var i={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,a=s&&!i.call({1:2},1);e.f=a?function propertyIsEnumerable(t){var e=s(this,t);return!!e&&e.enumerable}:i},2967:(t,e,i)=>{var s=i(6706),a=i(34),r=i(7750),n=i(3506);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=s(Object.prototype,"__proto__","set"))(i,[]);e=i instanceof Array}catch(t){}return function setPrototypeOf(i,s){r(i);n(s);if(!a(i))return i;e?t(i,s):i.__proto__=s;return i}}():void 0)},4270:(t,e,i)=>{var s=i(9565),a=i(4901),r=i(34),n=TypeError;t.exports=function(t,e){var i,o;if("string"===e&&a(i=t.toString)&&!r(o=s(i,t)))return o;if(a(i=t.valueOf)&&!r(o=s(i,t)))return o;if("string"!==e&&a(i=t.toString)&&!r(o=s(i,t)))return o;throw new n("Can't convert object to primitive value")}},5031:(t,e,i)=>{var s=i(7751),a=i(9504),r=i(8480),n=i(3717),o=i(8551),l=a([].concat);t.exports=s("Reflect","ownKeys")||function ownKeys(t){var e=r.f(o(t)),i=n.f;return i?l(e,i(t)):e}},8235:(t,e,i)=>{var s=i(9504),a=i(9297),r=SyntaxError,n=parseInt,o=String.fromCharCode,l=s("".charAt),c=s("".slice),h=s(/./.exec),d={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":"\n","\\r":"\r","\\t":"\t"},u=/^[\da-f]{4}$/i,p=/^[\u0000-\u001F]$/;t.exports=function(t,e){for(var i=!0,s="";e<t.length;){var _=l(t,e);if("\\"===_){var f=c(t,e,e+2);if(a(d,f)){s+=d[f];e+=2}else{if("\\u"!==f)throw new r('Unknown escape sequence: "'+f+'"');var g=c(t,e+=2,e+4);if(!h(u,g))throw new r("Bad Unicode escape at: "+e);s+=o(n(g,16));e+=4}}else{if('"'===_){i=!1;e++;break}if(h(p,_))throw new r("Bad control character in string literal at: "+e);s+=_;e++}}if(i)throw new r("Unterminated string at: "+e);return{value:s,end:e}}},1056:(t,e,i)=>{var s=i(4913).f;t.exports=function(t,e,i){i in t||s(t,i,{configurable:!0,get:function(){return e[i]},set:function(t){e[i]=t}})}},7750:(t,e,i)=>{var s=i(4117),a=TypeError;t.exports=function(t){if(s(t))throw new a("Can't call method on "+t);return t}},9286:(t,e,i)=>{var s=i(4402),a=i(8469),r=s.Set,n=s.add;t.exports=function(t){var e=new r;a(t,(function(t){n(e,t)}));return e}},3440:(t,e,i)=>{var s=i(7080),a=i(4402),r=i(9286),n=i(5170),o=i(3789),l=i(8469),c=i(507),h=a.has,d=a.remove;t.exports=function difference(t){var e=s(this),i=o(t),a=r(e);n(e)<=i.size?l(e,(function(t){i.includes(t)&&d(a,t)})):c(i.getIterator(),(function(t){h(e,t)&&d(a,t)}));return a}},4402:(t,e,i)=>{var s=i(9504),a=Set.prototype;t.exports={Set,add:s(a.add),has:s(a.has),remove:s(a.delete),proto:a}},8750:(t,e,i)=>{var s=i(7080),a=i(4402),r=i(5170),n=i(3789),o=i(8469),l=i(507),c=a.Set,h=a.add,d=a.has;t.exports=function intersection(t){var e=s(this),i=n(t),a=new c;r(e)>i.size?l(i.getIterator(),(function(t){d(e,t)&&h(a,t)})):o(e,(function(t){i.includes(t)&&h(a,t)}));return a}},4449:(t,e,i)=>{var s=i(7080),a=i(4402).has,r=i(5170),n=i(3789),o=i(8469),l=i(507),c=i(9539);t.exports=function isDisjointFrom(t){var e=s(this),i=n(t);if(r(e)<=i.size)return!1!==o(e,(function(t){if(i.includes(t))return!1}),!0);var h=i.getIterator();return!1!==l(h,(function(t){if(a(e,t))return c(h,"normal",!1)}))}},3838:(t,e,i)=>{var s=i(7080),a=i(5170),r=i(8469),n=i(3789);t.exports=function isSubsetOf(t){var e=s(this),i=n(t);return!(a(e)>i.size)&&!1!==r(e,(function(t){if(!i.includes(t))return!1}),!0)}},8527:(t,e,i)=>{var s=i(7080),a=i(4402).has,r=i(5170),n=i(3789),o=i(507),l=i(9539);t.exports=function isSupersetOf(t){var e=s(this),i=n(t);if(r(e)<i.size)return!1;var c=i.getIterator();return!1!==o(c,(function(t){if(!a(e,t))return l(c,"normal",!1)}))}},8469:(t,e,i)=>{var s=i(9504),a=i(507),r=i(4402),n=r.Set,o=r.proto,l=s(o.forEach),c=s(o.keys),h=c(new n).next;t.exports=function(t,e,i){return i?a({iterator:c(t),next:h},e):l(t,e)}},4916:(t,e,i)=>{var s=i(7751),createSetLike=function(t){return{size:t,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};t.exports=function(t){var e=s("Set");try{(new e)[t](createSetLike(0));try{(new e)[t](createSetLike(-1));return!1}catch(t){return!0}}catch(t){return!1}}},5170:(t,e,i)=>{var s=i(6706),a=i(4402);t.exports=s(a.proto,"size","get")||function(t){return t.size}},3650:(t,e,i)=>{var s=i(7080),a=i(4402),r=i(9286),n=i(3789),o=i(507),l=a.add,c=a.has,h=a.remove;t.exports=function symmetricDifference(t){var e=s(this),i=n(t).getIterator(),a=r(e);o(i,(function(t){c(e,t)?h(a,t):l(a,t)}));return a}},4204:(t,e,i)=>{var s=i(7080),a=i(4402).add,r=i(9286),n=i(3789),o=i(507);t.exports=function union(t){var e=s(this),i=n(t).getIterator(),l=r(e);o(i,(function(t){a(l,t)}));return l}},6119:(t,e,i)=>{var s=i(5745),a=i(3392),r=s("keys");t.exports=function(t){return r[t]||(r[t]=a(t))}},7629:(t,e,i)=>{var s=i(6395),a=i(4475),r=i(9433),n="__core-js_shared__",o=t.exports=a[n]||r(n,{});(o.versions||(o.versions=[])).push({version:"3.36.1",mode:s?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.36.1/LICENSE",source:"https://github.com/zloirock/core-js"})},5745:(t,e,i)=>{var s=i(7629);t.exports=function(t,e){return s[t]||(s[t]=e||{})}},1548:(t,e,i)=>{var s=i(4475),a=i(9039),r=i(7388),n=i(7290),o=i(516),l=i(9088),c=s.structuredClone;t.exports=!!c&&!a((function(){if(o&&r>92||l&&r>94||n&&r>97)return!1;var t=new ArrayBuffer(8),e=c(t,{transfer:[t]});return 0!==t.byteLength||8!==e.byteLength}))},4495:(t,e,i)=>{var s=i(7388),a=i(9039),r=i(4475).String;t.exports=!!Object.getOwnPropertySymbols&&!a((function(){var t=Symbol("symbol detection");return!r(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&s&&s<41}))},5610:(t,e,i)=>{var s=i(1291),a=Math.max,r=Math.min;t.exports=function(t,e){var i=s(t);return i<0?a(i+e,0):r(i,e)}},5854:(t,e,i)=>{var s=i(2777),a=TypeError;t.exports=function(t){var e=s(t,"number");if("number"==typeof e)throw new a("Can't convert number to bigint");return BigInt(e)}},7696:(t,e,i)=>{var s=i(1291),a=i(8014),r=RangeError;t.exports=function(t){if(void 0===t)return 0;var e=s(t),i=a(e);if(e!==i)throw new r("Wrong length or index");return i}},5397:(t,e,i)=>{var s=i(7055),a=i(7750);t.exports=function(t){return s(a(t))}},1291:(t,e,i)=>{var s=i(741);t.exports=function(t){var e=+t;return e!=e||0===e?0:s(e)}},8014:(t,e,i)=>{var s=i(1291),a=Math.min;t.exports=function(t){var e=s(t);return e>0?a(e,9007199254740991):0}},8981:(t,e,i)=>{var s=i(7750),a=Object;t.exports=function(t){return a(s(t))}},8229:(t,e,i)=>{var s=i(9590),a=RangeError;t.exports=function(t,e){var i=s(t);if(i%e)throw new a("Wrong offset");return i}},9590:(t,e,i)=>{var s=i(1291),a=RangeError;t.exports=function(t){var e=s(t);if(e<0)throw new a("The argument can't be less than 0");return e}},2777:(t,e,i)=>{var s=i(9565),a=i(34),r=i(757),n=i(5966),o=i(4270),l=i(8227),c=TypeError,h=l("toPrimitive");t.exports=function(t,e){if(!a(t)||r(t))return t;var i,l=n(t,h);if(l){void 0===e&&(e="default");i=s(l,t,e);if(!a(i)||r(i))return i;throw new c("Can't convert object to primitive value")}void 0===e&&(e="number");return o(t,e)}},6969:(t,e,i)=>{var s=i(2777),a=i(757);t.exports=function(t){var e=s(t,"string");return a(e)?e:e+""}},2140:(t,e,i)=>{var s={};s[i(8227)("toStringTag")]="z";t.exports="[object z]"===String(s)},655:(t,e,i)=>{var s=i(6955),a=String;t.exports=function(t){if("Symbol"===s(t))throw new TypeError("Cannot convert a Symbol value to a string");return a(t)}},9714:(t,e,i)=>{var s=i(9088);t.exports=function(t){try{if(s)return Function('return require("'+t+'")')()}catch(t){}}},6823:t=>{var e=String;t.exports=function(t){try{return e(t)}catch(t){return"Object"}}},3392:(t,e,i)=>{var s=i(9504),a=0,r=Math.random(),n=s(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+n(++a+r,36)}},7040:(t,e,i)=>{var s=i(4495);t.exports=s&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8686:(t,e,i)=>{var s=i(3724),a=i(9039);t.exports=s&&a((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},2812:t=>{var e=TypeError;t.exports=function(t,i){if(t<i)throw new e("Not enough arguments");return t}},8622:(t,e,i)=>{var s=i(4475),a=i(4901),r=s.WeakMap;t.exports=a(r)&&/native code/.test(String(r))},8227:(t,e,i)=>{var s=i(4475),a=i(5745),r=i(9297),n=i(3392),o=i(4495),l=i(7040),c=s.Symbol,h=a("wks"),d=l?c.for||c:c&&c.withoutSetter||n;t.exports=function(t){r(h,t)||(h[t]=o&&r(c,t)?c[t]:d("Symbol."+t));return h[t]}},4601:(t,e,i)=>{var s=i(7751),a=i(9297),r=i(6699),n=i(1625),o=i(2967),l=i(7740),c=i(1056),h=i(3167),d=i(2603),u=i(7584),p=i(747),_=i(3724),f=i(6395);t.exports=function(t,e,i,g){var v="stackTraceLimit",m=g?2:1,P=t.split("."),y=P[P.length-1],b=s.apply(null,P);if(b){var w=b.prototype;!f&&a(w,"cause")&&delete w.cause;if(!i)return b;var A=s("Error"),S=e((function(t,e){var i=d(g?e:t,void 0),s=g?new b(t):new b;void 0!==i&&r(s,"message",i);p(s,S,s.stack,2);this&&n(w,this)&&h(s,this,S);arguments.length>m&&u(s,arguments[m]);return s}));S.prototype=w;if("Error"!==y)o?o(S,A):l(S,A,{name:!0});else if(_&&v in b){c(S,b,v);c(S,b,"prepareStackTrace")}l(S,b);if(!f)try{w.name!==y&&r(w,"name",y);w.constructor=S}catch(t){}return S}}},6573:(t,e,i)=>{var s=i(3724),a=i(2106),r=i(3238),n=ArrayBuffer.prototype;s&&!("detached"in n)&&a(n,"detached",{configurable:!0,get:function detached(){return r(this)}})},7936:(t,e,i)=>{var s=i(6518),a=i(5636);a&&s({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function transferToFixedLength(){return a(this,arguments.length?arguments[0]:void 0,!1)}})},8100:(t,e,i)=>{var s=i(6518),a=i(5636);a&&s({target:"ArrayBuffer",proto:!0},{transfer:function transfer(){return a(this,arguments.length?arguments[0]:void 0,!0)}})},8107:(t,e,i)=>{var s=i(6518),a=i(8981),r=i(6198),n=i(1291),o=i(6469);s({target:"Array",proto:!0},{at:function at(t){var e=a(this),i=r(e),s=n(t),o=s>=0?s:i+s;return o<0||o>=i?void 0:e[o]}});o("at")},4114:(t,e,i)=>{var s=i(6518),a=i(8981),r=i(6198),n=i(4527),o=i(6837);s({target:"Array",proto:!0,arity:1,forced:i(9039)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}}()},{push:function push(t){var e=a(this),i=r(e),s=arguments.length;o(i+s);for(var l=0;l<s;l++){e[i]=arguments[l];i++}n(e,i);return i}})},6280:(t,e,i)=>{var s=i(6518),a=i(4475),r=i(8745),n=i(4601),o="WebAssembly",l=a[o],c=7!==new Error("e",{cause:7}).cause,exportGlobalErrorCauseWrapper=function(t,e){var i={};i[t]=n(t,e,c);s({global:!0,constructor:!0,arity:1,forced:c},i)},exportWebAssemblyErrorCauseWrapper=function(t,e){if(l&&l[t]){var i={};i[t]=n(o+"."+t,e,c);s({target:o,stat:!0,constructor:!0,arity:1,forced:c},i)}};exportGlobalErrorCauseWrapper("Error",(function(t){return function Error(e){return r(t,this,arguments)}}));exportGlobalErrorCauseWrapper("EvalError",(function(t){return function EvalError(e){return r(t,this,arguments)}}));exportGlobalErrorCauseWrapper("RangeError",(function(t){return function RangeError(e){return r(t,this,arguments)}}));exportGlobalErrorCauseWrapper("ReferenceError",(function(t){return function ReferenceError(e){return r(t,this,arguments)}}));exportGlobalErrorCauseWrapper("SyntaxError",(function(t){return function SyntaxError(e){return r(t,this,arguments)}}));exportGlobalErrorCauseWrapper("TypeError",(function(t){return function TypeError(e){return r(t,this,arguments)}}));exportGlobalErrorCauseWrapper("URIError",(function(t){return function URIError(e){return r(t,this,arguments)}}));exportWebAssemblyErrorCauseWrapper("CompileError",(function(t){return function CompileError(e){return r(t,this,arguments)}}));exportWebAssemblyErrorCauseWrapper("LinkError",(function(t){return function LinkError(e){return r(t,this,arguments)}}));exportWebAssemblyErrorCauseWrapper("RuntimeError",(function(t){return function RuntimeError(e){return r(t,this,arguments)}}))},7357:(t,e,i)=>{var s=i(6518),a=i(9504),r=i(7750),n=i(1291),o=i(655),l=i(9039),c=a("".charAt);s({target:"String",proto:!0,forced:l((function(){return"\ud842"!=="𠮷".at(-2)}))},{at:function at(t){var e=o(r(this)),i=e.length,s=n(t),a=s>=0?s:i+s;return a<0||a>=i?void 0:c(e,a)}})},8140:(t,e,i)=>{var s=i(4644),a=i(6198),r=i(1291),n=s.aTypedArray;(0,s.exportTypedArrayMethod)("at",(function at(t){var e=n(this),i=a(e),s=r(t),o=s>=0?s:i+s;return o<0||o>=i?void 0:e[o]}))},5044:(t,e,i)=>{var s=i(4644),a=i(4373),r=i(5854),n=i(6955),o=i(9565),l=i(9504),c=i(9039),h=s.aTypedArray,d=s.exportTypedArrayMethod,u=l("".slice);d("fill",(function fill(t){var e=arguments.length;h(this);var i="Big"===u(n(this),0,3)?r(t):+t;return o(a,this,i,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),c((function(){var t=0;new Int8Array(2).fill({valueOf:function(){return t++}});return 1!==t})))},1134:(t,e,i)=>{var s=i(4644),a=i(3839).findLastIndex,r=s.aTypedArray;(0,s.exportTypedArrayMethod)("findLastIndex",(function findLastIndex(t){return a(r(this),t,arguments.length>1?arguments[1]:void 0)}))},1903:(t,e,i)=>{var s=i(4644),a=i(3839).findLast,r=s.aTypedArray;(0,s.exportTypedArrayMethod)("findLast",(function findLast(t){return a(r(this),t,arguments.length>1?arguments[1]:void 0)}))},8845:(t,e,i)=>{var s=i(4475),a=i(9565),r=i(4644),n=i(6198),o=i(8229),l=i(8981),c=i(9039),h=s.RangeError,d=s.Int8Array,u=d&&d.prototype,p=u&&u.set,_=r.aTypedArray,f=r.exportTypedArrayMethod,g=!c((function(){var t=new Uint8ClampedArray(2);a(p,t,{length:1,0:3},1);return 3!==t[1]})),v=g&&r.NATIVE_ARRAY_BUFFER_VIEWS&&c((function(){var t=new d(2);t.set(1);t.set("2",1);return 0!==t[0]||2!==t[1]}));f("set",(function set(t){_(this);var e=o(arguments.length>1?arguments[1]:void 0,1),i=l(t);if(g)return a(p,this,i,e);var s=this.length,r=n(i),c=0;if(r+e>s)throw new h("Wrong length");for(;c<r;)this[e+c]=i[c++]}),!g||v)},373:(t,e,i)=>{var s=i(4475),a=i(7476),r=i(9039),n=i(9306),o=i(4488),l=i(4644),c=i(8834),h=i(3202),d=i(7388),u=i(9160),p=l.aTypedArray,_=l.exportTypedArrayMethod,f=s.Uint16Array,g=f&&a(f.prototype.sort),v=!(!g||r((function(){g(new f(2),null)}))&&r((function(){g(new f(2),{})}))),m=!!g&&!r((function(){if(d)return d<74;if(c)return c<67;if(h)return!0;if(u)return u<602;var t,e,i=new f(516),s=Array(516);for(t=0;t<516;t++){e=t%4;i[t]=515-t;s[t]=t-2*e+3}g(i,(function(t,e){return(t/4|0)-(e/4|0)}));for(t=0;t<516;t++)if(i[t]!==s[t])return!0}));_("sort",(function sort(t){void 0!==t&&n(t);return m?g(this,t):o(p(this),function(t){return function(e,i){return void 0!==t?+t(e,i)||0:i!=i?-1:e!=e?1:0===e&&0===i?1/e>0&&1/i<0?1:-1:e>i}}(t))}),!m||v)},7467:(t,e,i)=>{var s=i(7628),a=i(4644),r=a.aTypedArray,n=a.exportTypedArrayMethod,o=a.getTypedArrayConstructor;n("toReversed",(function toReversed(){return s(r(this),o(this))}))},4732:(t,e,i)=>{var s=i(4644),a=i(9504),r=i(9306),n=i(5370),o=s.aTypedArray,l=s.getTypedArrayConstructor,c=s.exportTypedArrayMethod,h=a(s.TypedArrayPrototype.sort);c("toSorted",(function toSorted(t){void 0!==t&&r(t);var e=o(this),i=n(l(e),e);return h(i,t)}))},9577:(t,e,i)=>{var s=i(9928),a=i(4644),r=i(1108),n=i(1291),o=i(5854),l=a.aTypedArray,c=a.getTypedArrayConstructor,h=a.exportTypedArrayMethod,d=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(t){return 8===t}}();h("with",{with:function(t,e){var i=l(this),a=n(t),h=r(i)?o(e):+e;return s(i,c(i),a,h)}}.with,!d)},8992:(t,e,i)=>{var s=i(6518),a=i(4475),r=i(679),n=i(8551),o=i(4901),l=i(2787),c=i(2106),h=i(2278),d=i(9039),u=i(9297),p=i(8227),_=i(7657).IteratorPrototype,f=i(3724),g=i(6395),v="constructor",m="Iterator",P=p("toStringTag"),y=TypeError,b=a[m],w=g||!o(b)||b.prototype!==_||!d((function(){b({})})),A=function Iterator(){r(this,_);if(l(this)===_)throw new y("Abstract class Iterator not directly constructable")},defineIteratorPrototypeAccessor=function(t,e){f?c(_,t,{configurable:!0,get:function(){return e},set:function(e){n(this);if(this===_)throw new y("You can't redefine this property");u(this,t)?this[t]=e:h(this,t,e)}}):_[t]=e};u(_,P)||defineIteratorPrototypeAccessor(P,m);!w&&u(_,v)&&_[v]!==Object||defineIteratorPrototypeAccessor(v,A);A.prototype=_;s({global:!0,constructor:!0,forced:w},{Iterator:A})},3215:(t,e,i)=>{var s=i(6518),a=i(2652),r=i(9306),n=i(8551),o=i(1767);s({target:"Iterator",proto:!0,real:!0},{every:function every(t){n(this);r(t);var e=o(this),i=0;return!a(e,(function(e,s){if(!t(e,i++))return s()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},4520:(t,e,i)=>{var s=i(6518),a=i(9565),r=i(9306),n=i(8551),o=i(1767),l=i(9462),c=i(6319),h=i(6395),d=l((function(){for(var t,e,i=this.iterator,s=this.predicate,r=this.next;;){t=n(a(r,i));if(this.done=!!t.done)return;e=t.value;if(c(i,s,[e,this.counter++],!0))return e}}));s({target:"Iterator",proto:!0,real:!0,forced:h},{filter:function filter(t){n(this);r(t);return new d(o(this),{predicate:t})}})},670:(t,e,i)=>{var s=i(6518),a=i(9565),r=i(9306),n=i(8551),o=i(1767),l=i(8646),c=i(9462),h=i(9539),d=i(6395),u=c((function(){for(var t,e,i=this.iterator,s=this.mapper;;){if(e=this.inner)try{if(!(t=n(a(e.next,e.iterator))).done)return t.value;this.inner=null}catch(t){h(i,"throw",t)}t=n(a(this.next,i));if(this.done=!!t.done)return;try{this.inner=l(s(t.value,this.counter++),!1)}catch(t){h(i,"throw",t)}}}));s({target:"Iterator",proto:!0,real:!0,forced:d},{flatMap:function flatMap(t){n(this);r(t);return new u(o(this),{mapper:t,inner:null})}})},3949:(t,e,i)=>{var s=i(6518),a=i(2652),r=i(9306),n=i(8551),o=i(1767);s({target:"Iterator",proto:!0,real:!0},{forEach:function forEach(t){n(this);r(t);var e=o(this),i=0;a(e,(function(e){t(e,i++)}),{IS_RECORD:!0})}})},1454:(t,e,i)=>{var s=i(6518),a=i(713);s({target:"Iterator",proto:!0,real:!0,forced:i(6395)},{map:a})},7550:(t,e,i)=>{var s=i(6518),a=i(2652),r=i(9306),n=i(8551),o=i(1767);s({target:"Iterator",proto:!0,real:!0},{some:function some(t){n(this);r(t);var e=o(this),i=0;return a(e,(function(e,s){if(t(e,i++))return s()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},8335:(t,e,i)=>{var s=i(6518),a=i(3724),r=i(4475),n=i(7751),o=i(9504),l=i(9565),c=i(4901),h=i(34),d=i(4376),u=i(9297),p=i(655),_=i(6198),f=i(2278),g=i(9039),v=i(8235),m=i(4495),P=r.JSON,y=r.Number,b=r.SyntaxError,w=P&&P.parse,A=n("Object","keys"),S=Object.getOwnPropertyDescriptor,x=o("".charAt),C=o("".slice),k=o(/./.exec),E=o([].push),M=/^\d$/,G=/^[1-9]$/,I=/^(?:-|\d)$/,T=/^[\t\n\r ]$/,internalize=function(t,e,i,s){var a,r,n,o,c,p=t[e],f=s&&p===s.value,g=f&&"string"==typeof s.source?{source:s.source}:{};if(h(p)){var v=d(p),m=f?s.nodes:v?[]:{};if(v){a=m.length;n=_(p);for(o=0;o<n;o++)internalizeProperty(p,o,internalize(p,""+o,i,o<a?m[o]:void 0))}else{r=A(p);n=_(r);for(o=0;o<n;o++){c=r[o];internalizeProperty(p,c,internalize(p,c,i,u(m,c)?m[c]:void 0))}}}return l(i,t,e,p,g)},internalizeProperty=function(t,e,i){if(a){var s=S(t,e);if(s&&!s.configurable)return}void 0===i?delete t[e]:f(t,e,i)},Node=function(t,e,i,s){this.value=t;this.end=e;this.source=i;this.nodes=s},Context=function(t,e){this.source=t;this.index=e};Context.prototype={fork:function(t){return new Context(this.source,t)},parse:function(){var t=this.source,e=this.skip(T,this.index),i=this.fork(e),s=x(t,e);if(k(I,s))return i.number();switch(s){case"{":return i.object();case"[":return i.array();case'"':return i.string();case"t":return i.keyword(!0);case"f":return i.keyword(!1);case"n":return i.keyword(null)}throw new b('Unexpected character: "'+s+'" at: '+e)},node:function(t,e,i,s,a){return new Node(e,s,t?null:C(this.source,i,s),a)},object:function(){for(var t=this.source,e=this.index+1,i=!1,s={},a={};e<t.length;){e=this.until(['"',"}"],e);if("}"===x(t,e)&&!i){e++;break}var r=this.fork(e).string(),n=r.value;e=r.end;e=this.until([":"],e)+1;e=this.skip(T,e);r=this.fork(e).parse();f(a,n,r);f(s,n,r.value);e=this.until([",","}"],r.end);var o=x(t,e);if(","===o){i=!0;e++}else if("}"===o){e++;break}}return this.node(1,s,this.index,e,a)},array:function(){for(var t=this.source,e=this.index+1,i=!1,s=[],a=[];e<t.length;){e=this.skip(T,e);if("]"===x(t,e)&&!i){e++;break}var r=this.fork(e).parse();E(a,r);E(s,r.value);e=this.until([",","]"],r.end);if(","===x(t,e)){i=!0;e++}else if("]"===x(t,e)){e++;break}}return this.node(1,s,this.index,e,a)},string:function(){var t=this.index,e=v(this.source,this.index+1);return this.node(0,e.value,t,e.end)},number:function(){var t=this.source,e=this.index,i=e;"-"===x(t,i)&&i++;if("0"===x(t,i))i++;else{if(!k(G,x(t,i)))throw new b("Failed to parse number at: "+i);i=this.skip(M,++i)}"."===x(t,i)&&(i=this.skip(M,++i));if("e"===x(t,i)||"E"===x(t,i)){i++;"+"!==x(t,i)&&"-"!==x(t,i)||i++;if(i===(i=this.skip(M,i)))throw new b("Failed to parse number's exponent value at: "+i)}return this.node(0,y(C(t,e,i)),e,i)},keyword:function(t){var e=""+t,i=this.index,s=i+e.length;if(C(this.source,i,s)!==e)throw new b("Failed to parse value at: "+i);return this.node(0,t,i,s)},skip:function(t,e){for(var i=this.source;e<i.length&&k(t,x(i,e));e++);return e},until:function(t,e){e=this.skip(T,e);for(var i=x(this.source,e),s=0;s<t.length;s++)if(t[s]===i)return e;throw new b('Unexpected character: "'+i+'" at: '+e)}};var R=g((function(){var t,e="9007199254740993";w(e,(function(e,i,s){t=s.source}));return t!==e})),D=m&&!g((function(){return 1/w("-0 \t")!=-1/0}));s({target:"JSON",stat:!0,forced:R},{parse:function parse(t,e){return D&&!c(e)?w(t):function(t,e){t=p(t);var i=new Context(t,0,""),s=i.parse(),a=s.value,r=i.skip(T,s.end);if(r<t.length)throw new b('Unexpected extra character: "'+x(t,r)+'" after the parsed data at: '+r);return c(e)?internalize({"":a},"",e,s):a}(t,e)}})},3375:(t,e,i)=>{var s=i(6518),a=i(3440);s({target:"Set",proto:!0,real:!0,forced:!i(4916)("difference")},{difference:a})},9225:(t,e,i)=>{var s=i(6518),a=i(9039),r=i(8750);s({target:"Set",proto:!0,real:!0,forced:!i(4916)("intersection")||a((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}))},{intersection:r})},3972:(t,e,i)=>{var s=i(6518),a=i(4449);s({target:"Set",proto:!0,real:!0,forced:!i(4916)("isDisjointFrom")},{isDisjointFrom:a})},9209:(t,e,i)=>{var s=i(6518),a=i(3838);s({target:"Set",proto:!0,real:!0,forced:!i(4916)("isSubsetOf")},{isSubsetOf:a})},5714:(t,e,i)=>{var s=i(6518),a=i(8527);s({target:"Set",proto:!0,real:!0,forced:!i(4916)("isSupersetOf")},{isSupersetOf:a})},7561:(t,e,i)=>{var s=i(6518),a=i(3650);s({target:"Set",proto:!0,real:!0,forced:!i(4916)("symmetricDifference")},{symmetricDifference:a})},6197:(t,e,i)=>{var s=i(6518),a=i(4204);s({target:"Set",proto:!0,real:!0,forced:!i(4916)("union")},{union:a})},4979:(t,e,i)=>{var s=i(6518),a=i(4475),r=i(7751),n=i(6980),o=i(4913).f,l=i(9297),c=i(679),h=i(3167),d=i(2603),u=i(5002),p=i(6193),_=i(3724),f=i(6395),g="DOMException",v=r("Error"),m=r(g),P=function DOMException(){c(this,y);var t=arguments.length,e=d(t<1?void 0:arguments[0]),i=d(t<2?void 0:arguments[1],"Error"),s=new m(e,i),a=new v(e);a.name=g;o(s,"stack",n(1,p(a.stack,1)));h(s,this,P);return s},y=P.prototype=m.prototype,b="stack"in new v(g),w="stack"in new m(1,2),A=m&&_&&Object.getOwnPropertyDescriptor(a,g),S=!(!A||A.writable&&A.configurable),x=b&&!S&&!w;s({global:!0,constructor:!0,forced:f||x},{DOMException:x?P:m});var C=r(g),k=C.prototype;if(k.constructor!==C){f||o(k,"constructor",n(1,C));for(var E in u)if(l(u,E)){var M=u[E],G=M.s;l(C,G)||o(C,G,n(6,M.c))}}},3611:(t,e,i)=>{var s=i(6518),a=i(4475),r=i(2106),n=i(3724),o=TypeError,l=Object.defineProperty,c=a.self!==a;try{if(n){var h=Object.getOwnPropertyDescriptor(a,"self");!c&&h&&h.get&&h.enumerable||r(a,"self",{get:function self(){return a},set:function self(t){if(this!==a)throw new o("Illegal invocation");l(a,"self",{value:t,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})}else s({global:!0,simple:!0,forced:c},{self:a})}catch(t){}},4603:(t,e,i)=>{var s=i(6840),a=i(9504),r=i(655),n=i(2812),o=URLSearchParams,l=o.prototype,c=a(l.append),h=a(l.delete),d=a(l.forEach),u=a([].push),p=new o("a=1&a=2&b=3");p.delete("a",1);p.delete("b",void 0);p+""!="a=2"&&s(l,"delete",(function(t){var e=arguments.length,i=e<2?void 0:arguments[1];if(e&&void 0===i)return h(this,t);var s=[];d(this,(function(t,e){u(s,{key:e,value:t})}));n(e,1);for(var a,o=r(t),l=r(i),p=0,_=0,f=!1,g=s.length;p<g;){a=s[p++];if(f||a.key===o){f=!0;h(this,a.key)}else _++}for(;_<g;)(a=s[_++]).key===o&&a.value===l||c(this,a.key,a.value)}),{enumerable:!0,unsafe:!0})},7566:(t,e,i)=>{var s=i(6840),a=i(9504),r=i(655),n=i(2812),o=URLSearchParams,l=o.prototype,c=a(l.getAll),h=a(l.has),d=new o("a=1");!d.has("a",2)&&d.has("a",void 0)||s(l,"has",(function has(t){var e=arguments.length,i=e<2?void 0:arguments[1];if(e&&void 0===i)return h(this,t);var s=c(this,t);n(e,1);for(var a=r(i),o=0;o<s.length;)if(s[o++]===a)return!0;return!1}),{enumerable:!0,unsafe:!0})},8721:(t,e,i)=>{var s=i(3724),a=i(9504),r=i(2106),n=URLSearchParams.prototype,o=a(n.forEach);s&&!("size"in n)&&r(n,"size",{get:function size(){var t=0;o(this,(function(){t++}));return t},configurable:!0,enumerable:!0})}},e={};function __webpack_require__(i){var s=e[i];if(void 0!==s)return s.exports;var a=e[i]={exports:{}};t[i].call(a.exports,a,a.exports,__webpack_require__);return a.exports}__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})};__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var __webpack_exports__={};(()=>{__webpack_require__.d(__webpack_exports__,{AbortException:()=>AbortException,AnnotationEditorLayer:()=>AnnotationEditorLayer,AnnotationEditorParamsType:()=>_,AnnotationEditorType:()=>p,AnnotationEditorUIManager:()=>AnnotationEditorUIManager,AnnotationLayer:()=>AnnotationLayer,AnnotationMode:()=>u,CMapCompressionType:()=>X,ColorPicker:()=>ColorPicker,DOMSVGFactory:()=>DOMSVGFactory,DrawLayer:()=>DrawLayer,FeatureTest:()=>util_FeatureTest,GlobalWorkerOptions:()=>GlobalWorkerOptions,ImageKind:()=>w,InvalidPDFException:()=>InvalidPDFException,MissingPDFException:()=>MissingPDFException,OPS:()=>K,Outliner:()=>Outliner,PDFDataRangeTransport:()=>PDFDataRangeTransport,PDFDateString:()=>PDFDateString,PDFWorker:()=>PDFWorker,PasswordResponses:()=>Y,PermissionFlag:()=>f,PixelsPerInch:()=>PixelsPerInch,PromiseCapability:()=>PromiseCapability,RenderingCancelledException:()=>RenderingCancelledException,UnexpectedResponseException:()=>UnexpectedResponseException,Util:()=>Util,VerbosityLevel:()=>$,XfaLayer:()=>XfaLayer,build:()=>Ms,createValidAbsoluteUrl:()=>createValidAbsoluteUrl,fetchData:()=>fetchData,getDocument:()=>getDocument,getFilenameFromUrl:()=>getFilenameFromUrl,getPdfFilenameFromUrl:()=>getPdfFilenameFromUrl,getXfaPageViewport:()=>getXfaPageViewport,isDataScheme:()=>isDataScheme,isPdfFile:()=>isPdfFile,noContextMenu:()=>noContextMenu,normalizeUnicode:()=>normalizeUnicode,renderTextLayer:()=>renderTextLayer,setLayerDimensions:()=>setLayerDimensions,shadow:()=>shadow,updateTextLayer:()=>updateTextLayer,version:()=>Es});var t;__webpack_require__(6280),__webpack_require__(4114),__webpack_require__(6573),__webpack_require__(8100),__webpack_require__(7936),__webpack_require__(8140),__webpack_require__(5044),__webpack_require__(1903),__webpack_require__(1134),__webpack_require__(8845),__webpack_require__(373),__webpack_require__(7467),__webpack_require__(4732),__webpack_require__(9577),__webpack_require__(3611),__webpack_require__(4603),__webpack_require__(7566),__webpack_require__(8721);function _classPrivateFieldInitSpec(t,e,i){!function _checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e);e.set(t,i)}function _classPrivateFieldSet(t,e,i){return t.set(_assertClassBrand(t,e),i),i}function _assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}const e=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type),i=[1,0,0,1,0,0],s=[.001,0,0,.001,0,0],a=1.35,r=1,n=2,o=4,l=16,c=32,h=64,d=256,u={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},p={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},_={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},f={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},g=0,v=1,m=2,P=3,y=3,b=4,w={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},A=1,S=2,x=3,C=4,k=5,E=6,M=7,G=8,I=9,T=10,R=11,D=12,L=13,B=14,O=15,N=16,W=17,j=20,H=1,U=2,z=3,V=4,q=5,$={ERRORS:0,WARNINGS:1,INFOS:5},X={NONE:0,BINARY:1},K={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},Y={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Q=$.WARNINGS;function setVerbosityLevel(t){Number.isInteger(t)&&(Q=t)}function getVerbosityLevel(){return Q}function info(t){Q>=$.INFOS&&("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?console.log(`Info: ${t}`):Window&&globalThis.ngxConsole?globalThis.ngxConsole.log(`Info: ${t}`):console.log(`Info: ${t}`))}function warn(t){Q>=$.WARNINGS&&("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?console.log(`Warning: ${t}`):Window&&globalThis.ngxConsole?globalThis.ngxConsole.log(`Warning: ${t}`):console.log(`Warning: ${t}`))}function unreachable(t){throw new Error(t)}function assert(t,e){t||unreachable(e)}function createValidAbsoluteUrl(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return null;try{if(i&&"string"==typeof t){if(i.addDefaultProtocol&&t.startsWith("www.")){const e=t.match(/\./g);e?.length>=2&&(t=`http://${t}`)}if(i.tryConvertEncoding)try{t=function stringToUTF8String(t){return decodeURIComponent(escape(t))}(t)}catch{}}const s=e?new URL(t,e):new URL(t);if(function _isValidProtocol(t){switch(t?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":case"capacitor":return!0;default:return!1}}(s))return s}catch{}return null}function shadow(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object.defineProperty(t,e,{value:i,enumerable:!s,configurable:!0,writable:!1});return i}const J=function BaseExceptionClosure(){function BaseException(t,e){this.constructor===BaseException&&unreachable("Cannot initialize BaseException.");this.message=t;this.name=e}BaseException.prototype=new Error;BaseException.constructor=BaseException;return BaseException}();class PasswordException extends J{constructor(t,e){super(t,"PasswordException");this.code=e}}class UnknownErrorException extends J{constructor(t,e){super(t,"UnknownErrorException");this.details=e}}class InvalidPDFException extends J{constructor(t){super(t,"InvalidPDFException")}}class MissingPDFException extends J{constructor(t){super(t,"MissingPDFException")}}class UnexpectedResponseException extends J{constructor(t,e){super(t,"UnexpectedResponseException");this.status=e}}class FormatError extends J{constructor(t){super(t,"FormatError")}}class AbortException extends J{constructor(t){super(t,"AbortException")}}function bytesToString(t){"object"==typeof t&&void 0!==t?.length||unreachable("Invalid argument for bytesToString");const e=t.length,i=8192;if(e<i)return String.fromCharCode.apply(null,t);const s=[];for(let a=0;a<e;a+=i){const r=Math.min(a+i,e),n=t.subarray(a,r);s.push(String.fromCharCode.apply(null,n))}return s.join("")}function stringToBytes(t){"string"!=typeof t&&unreachable("Invalid argument for stringToBytes");const e=t.length,i=new Uint8Array(e);for(let s=0;s<e;++s)i[s]=255&t.charCodeAt(s);return i}function objectFromMap(t){const e=Object.create(null);for(const[i,s]of t)e[i]=s;return e}class util_FeatureTest{static get isLittleEndian(){return shadow(this,"isLittleEndian",function isLittleEndian(){const t=new Uint8Array(4);t[0]=1;return 1===new Uint32Array(t.buffer,0,1)[0]}())}static get isEvalSupported(){return shadow(this,"isEvalSupported",function isEvalSupported(){try{new Function("");return!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return shadow(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get platform(){return"undefined"!=typeof navigator&&"string"==typeof navigator?.platform?shadow(this,"platform",{isMac:navigator.platform.includes("Mac")}):shadow(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return shadow(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Z=Array.from(Array(256).keys(),(t=>t.toString(16).padStart(2,"0")));class Util{static makeHexColor(t,e,i){return`#${Z[t]}${Z[e]}${Z[i]}`}static scaleMinMax(t,e){let i;if(t[0]){if(t[0]<0){i=e[0];e[0]=e[2];e[2]=i}e[0]*=t[0];e[2]*=t[0];if(t[3]<0){i=e[1];e[1]=e[3];e[3]=i}e[1]*=t[3];e[3]*=t[3]}else{i=e[0];e[0]=e[1];e[1]=i;i=e[2];e[2]=e[3];e[3]=i;if(t[1]<0){i=e[1];e[1]=e[3];e[3]=i}e[1]*=t[1];e[3]*=t[1];if(t[2]<0){i=e[0];e[0]=e[2];e[2]=i}e[0]*=t[2];e[2]*=t[2]}e[0]+=t[4];e[1]+=t[5];e[2]+=t[4];e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}static applyInverseTransform(t,e){const i=e[0]*e[3]-e[1]*e[2];return[(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i]}static getAxialAlignedBoundingBox(t,e){const i=this.applyTransform(t,e),s=this.applyTransform(t.slice(2,4),e),a=this.applyTransform([t[0],t[3]],e),r=this.applyTransform([t[2],t[1]],e);return[Math.min(i[0],s[0],a[0],r[0]),Math.min(i[1],s[1],a[1],r[1]),Math.max(i[0],s[0],a[0],r[0]),Math.max(i[1],s[1],a[1],r[1])]}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){const e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],s=t[0]*e[1]+t[1]*e[3],a=t[2]*e[0]+t[3]*e[2],r=t[2]*e[1]+t[3]*e[3],n=(i+r)/2,o=Math.sqrt((i+r)**2-4*(i*r-a*s))/2,l=n+o||1,c=n-o||1;return[Math.sqrt(l),Math.sqrt(c)]}static normalizeRect(t){const e=t.slice(0);if(t[0]>t[2]){e[0]=t[2];e[2]=t[0]}if(t[1]>t[3]){e[1]=t[3];e[3]=t[1]}return e}static intersect(t,e){const i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>s)return null;const a=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return a>r?null:[i,a,s,r]}static bezierBoundingBox(t,e,i,s,a,r,n,o,l){if(l){l[0]=Math.min(l[0],t,n);l[1]=Math.min(l[1],e,o);l[2]=Math.max(l[2],t,n);l[3]=Math.max(l[3],e,o)}else l=[Math.min(t,n),Math.min(e,o),Math.max(t,n),Math.max(e,o)];_assertClassBrand(Util,this,_getExtremum).call(this,t,i,a,n,e,s,r,o,3*(3*(i-a)-t+n),6*(t-2*i+a),3*(i-t),l);_assertClassBrand(Util,this,_getExtremum).call(this,t,i,a,n,e,s,r,o,3*(3*(s-r)-e+o),6*(e-2*s+r),3*(s-e),l);return l}}t=Util;function _getExtremumOnCurve(t,e,i,s,a,r,n,o,l,c){if(l<=0||l>=1)return;const h=1-l,d=l*l,u=d*l,p=h*(h*(h*t+3*l*e)+3*d*i)+u*s,_=h*(h*(h*a+3*l*r)+3*d*n)+u*o;c[0]=Math.min(c[0],p);c[1]=Math.min(c[1],_);c[2]=Math.max(c[2],p);c[3]=Math.max(c[3],_)}function _getExtremum(e,i,s,a,r,n,o,l,c,h,d,u){if(Math.abs(c)<1e-12){Math.abs(h)>=1e-12&&_assertClassBrand(t,this,_getExtremumOnCurve).call(this,e,i,s,a,r,n,o,l,-d/h,u);return}const p=h**2-4*d*c;if(p<0)return;const _=Math.sqrt(p),f=2*c;_assertClassBrand(t,this,_getExtremumOnCurve).call(this,e,i,s,a,r,n,o,l,(-h+_)/f,u);_assertClassBrand(t,this,_getExtremumOnCurve).call(this,e,i,s,a,r,n,o,l,(-h-_)/f,u)}var tt=new WeakMap;class PromiseCapability{constructor(){_classPrivateFieldInitSpec(this,tt,!1);this.promise=new Promise(((t,e)=>{this.resolve=e=>{_classPrivateFieldSet(tt,this,!0);t(e)};this.reject=t=>{_classPrivateFieldSet(tt,this,!0);e(t)}}))}get settled(){return function _classPrivateFieldGet(t,e){return t.get(_assertClassBrand(t,e))}(tt,this)}}let et=null,it=null;function normalizeUnicode(t){if(!et){et=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu;it=new Map([["ﬅ","ſt"]])}return t.replaceAll(et,((t,e,i)=>e?e.normalize("NFKC"):it.get(i)))}const st="pdfjs_internal_id_";var rt;__webpack_require__(1454),__webpack_require__(3375),__webpack_require__(9225),__webpack_require__(3972),__webpack_require__(9209),__webpack_require__(5714),__webpack_require__(7561),__webpack_require__(6197),__webpack_require__(4979),__webpack_require__(8107),__webpack_require__(7357),__webpack_require__(8992),__webpack_require__(3215),__webpack_require__(3949),__webpack_require__(7550),__webpack_require__(8335),__webpack_require__(4520);class BaseFilterFactory{constructor(){this.constructor===BaseFilterFactory&&unreachable("Cannot initialize BaseFilterFactory.")}addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addHighlightHCMFilter(t,e,i,s,a){return"none"}destroy(){}}class BaseCanvasFactory{constructor(){this.constructor===BaseCanvasFactory&&unreachable("Cannot initialize BaseCanvasFactory.")}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(t,e),s=window.pdfDefaultOptions.activateWillReadFrequentlyFlag?{willReadFrequently:!0}:void 0,a=i.getContext("2d",s);return{canvas:i,context:a}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e;t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0;t.canvas.height=0;t.canvas=null;t.context=null}_createCanvas(t,e){unreachable("Abstract method `_createCanvas` called.")}}class BaseCMapReaderFactory{constructor(t){let{baseUrl:e=null,isCompressed:i=!0}=t;this.constructor===BaseCMapReaderFactory&&unreachable("Cannot initialize BaseCMapReaderFactory.");this.baseUrl=e;this.isCompressed=i}async fetch(t){let{name:e}=t;if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!e)throw new Error("CMap name must be specified.");const i=this.baseUrl+e+(this.isCompressed?".bcmap":""),s=this.isCompressed?X.BINARY:X.NONE;return this._fetchData(i,s).catch((t=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${i}`)}))}_fetchData(t,e){unreachable("Abstract method `_fetchData` called.")}}class BaseStandardFontDataFactory{constructor(t){let{baseUrl:e=null}=t;this.constructor===BaseStandardFontDataFactory&&unreachable("Cannot initialize BaseStandardFontDataFactory.");this.baseUrl=e}async fetch(t){let{filename:e}=t;if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!e)throw new Error("Font filename must be specified.");const i=`${this.baseUrl}${e}`;return this._fetchData(i).catch((t=>{throw new Error(`Unable to load font data at: ${i}`)}))}_fetchData(t){unreachable("Abstract method `_fetchData` called.")}}class BaseSVGFactory{constructor(){this.constructor===BaseSVGFactory&&unreachable("Cannot initialize BaseSVGFactory.")}create(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");s.setAttribute("version","1.1");if(!i){s.setAttribute("width",`${t}px`);s.setAttribute("height",`${e}px`)}s.setAttribute("preserveAspectRatio","none");s.setAttribute("viewBox",`0 0 ${t} ${e}`);return s}createElement(t){if("string"!=typeof t)throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){unreachable("Abstract method `_createSVG` called.")}}function display_utils_classPrivateFieldInitSpec(t,e,i){display_utils_checkPrivateRedeclaration(t,e);e.set(t,i)}function display_utils_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateGetter(t,e,i){return i(display_utils_assertClassBrand(t,e))}function display_utils_classPrivateFieldGet(t,e){return t.get(display_utils_assertClassBrand(t,e))}function display_utils_classPrivateFieldSet(t,e,i){return t.set(display_utils_assertClassBrand(t,e),i),i}function display_utils_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}function _defineProperty(t,e,i){(e=function _toPropertyKey(t){var e=function _toPrimitive(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i;return t}const nt="http://www.w3.org/2000/svg";class PixelsPerInch{}rt=PixelsPerInch;_defineProperty(PixelsPerInch,"CSS",96);_defineProperty(PixelsPerInch,"PDF",72);_defineProperty(PixelsPerInch,"PDF_TO_CSS_UNITS",rt.CSS/rt.PDF);var ot=new WeakMap,lt=new WeakMap,ct=new WeakMap,ht=new WeakMap,dt=new WeakMap,ut=new WeakMap,pt=new WeakSet;function _get_cache(t){return display_utils_classPrivateFieldGet(ot,t)||display_utils_classPrivateFieldSet(ot,t,new Map)}function _get_hcmCache(t){return display_utils_classPrivateFieldGet(dt,t)||display_utils_classPrivateFieldSet(dt,t,new Map)}function _get_defs(t){if(!display_utils_classPrivateFieldGet(lt,t)){const e=display_utils_classPrivateFieldGet(ht,t).createElement("div"),{style:i}=e;i.visibility="hidden";i.contain="strict";i.width=i.height=0;i.position="absolute";i.top=i.left=0;i.zIndex=-1;const s=display_utils_classPrivateFieldGet(ht,t).createElementNS(nt,"svg");s.setAttribute("width",0);s.setAttribute("height",0);display_utils_classPrivateFieldSet(lt,t,display_utils_classPrivateFieldGet(ht,t).createElementNS(nt,"defs"));e.append(s);s.append(display_utils_classPrivateFieldGet(lt,t));display_utils_classPrivateFieldGet(ht,t).body.append(e)}return display_utils_classPrivateFieldGet(lt,t)}function _addGrayConversion(t){const e=display_utils_classPrivateFieldGet(ht,this).createElementNS(nt,"feColorMatrix");e.setAttribute("type","matrix");e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0");t.append(e)}function _createFilter(t){const e=display_utils_classPrivateFieldGet(ht,this).createElementNS(nt,"filter");e.setAttribute("color-interpolation-filters","sRGB");e.setAttribute("id",t);_classPrivateGetter(pt,this,_get_defs).append(e);return e}function _appendFeFunc(t,e,i){const s=display_utils_classPrivateFieldGet(ht,this).createElementNS(nt,e);s.setAttribute("type","discrete");s.setAttribute("tableValues",i);t.append(s)}function _addTransferMapConversion(t,e,i,s){const a=display_utils_classPrivateFieldGet(ht,this).createElementNS(nt,"feComponentTransfer");s.append(a);display_utils_assertClassBrand(pt,this,_appendFeFunc).call(this,a,"feFuncR",t);display_utils_assertClassBrand(pt,this,_appendFeFunc).call(this,a,"feFuncG",e);display_utils_assertClassBrand(pt,this,_appendFeFunc).call(this,a,"feFuncB",i)}function _getRGB(t){_classPrivateGetter(pt,this,_get_defs).style.color=t;return getRGB(getComputedStyle(_classPrivateGetter(pt,this,_get_defs)).getPropertyValue("color"))}async function fetchData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(isValidFetchUrl(t,document.baseURI)){const i=await fetch(t);if(!i.ok)throw new Error(i.statusText);switch(e){case"arraybuffer":return i.arrayBuffer();case"blob":return i.blob();case"json":return i.json()}return i.text()}return new Promise(((i,s)=>{const a=new XMLHttpRequest;a.open("GET",t,!0);a.responseType=e;a.onreadystatechange=()=>{if(a.readyState===XMLHttpRequest.DONE)if(200!==a.status&&0!==a.status)s(new Error(a.statusText));else{switch(e){case"arraybuffer":case"blob":case"json":i(a.response);return}i(a.responseText)}};a.send(null)}))}class DOMCMapReaderFactory extends BaseCMapReaderFactory{_fetchData(t,e){return fetchData(t,this.isCompressed?"arraybuffer":"text").then((t=>({cMapData:t instanceof ArrayBuffer?new Uint8Array(t):stringToBytes(t),compressionType:e})))}}class DOMStandardFontDataFactory extends BaseStandardFontDataFactory{_fetchData(t){return fetchData(t,"arraybuffer").then((t=>new Uint8Array(t)))}}class DOMSVGFactory extends BaseSVGFactory{_createSVG(t){return document.createElementNS(nt,t)}}class PageViewport{constructor(t){let{viewBox:e,scale:i,rotation:s,offsetX:a=0,offsetY:r=0,dontFlip:n=!1}=t;this.viewBox=e;this.scale=i;this.rotation=s;this.offsetX=a;this.offsetY=r;const o=(e[2]+e[0])/2,l=(e[3]+e[1])/2;let c,h,d,u,p,_,f,g;s%=360;s<0&&(s+=360);switch(s){case 180:c=-1;h=0;d=0;u=1;break;case 90:c=0;h=1;d=1;u=0;break;case 270:c=0;h=-1;d=-1;u=0;break;case 0:c=1;h=0;d=0;u=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}if(n){d=-d;u=-u}if(0===c){p=Math.abs(l-e[1])*i+a;_=Math.abs(o-e[0])*i+r;f=(e[3]-e[1])*i;g=(e[2]-e[0])*i}else{p=Math.abs(o-e[0])*i+a;_=Math.abs(l-e[1])*i+r;f=(e[2]-e[0])*i;g=(e[3]-e[1])*i}this.transform=[c*i,h*i,d*i,u*i,p-c*i*o-d*i*l,_-h*i*o-u*i*l];this.width=f;this.height=g}get rawDims(){const{viewBox:t}=this;return shadow(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone(){let{scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:a=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new PageViewport({viewBox:this.viewBox.slice(),scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:a})}convertToViewportPoint(t,e){return Util.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){const e=Util.applyTransform([t[0],t[1]],this.transform),i=Util.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],i[0],i[1]]}convertToPdfPoint(t,e){return Util.applyInverseTransform([t,e],this.transform)}}class RenderingCancelledException extends J{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super(t,"RenderingCancelledException");this.extraDelay=e}}function isDataScheme(t){const e=t.length;let i=0;for(;i<e&&""===t[i].trim();)i++;return"data:"===t.substring(i,i+5).toLowerCase()}function isPdfFile(t){return"string"==typeof t&&/\.pdf$/i.test(t)}function getFilenameFromUrl(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1]||([t]=t.split(/[#?]/,1));return t.substring(t.lastIndexOf("/")+1)}function getPdfFilenameFromUrl(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if(window.PDFViewerApplication.appConfig.filenameForDownload)return window.PDFViewerApplication.appConfig.filenameForDownload;if("string"!=typeof t)return e;if(isDataScheme(t)){warn('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.');return e}const i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(t);let a=i.exec(s[1])||i.exec(s[2])||i.exec(s[3]);if(a){a=a[0];if(a.includes("%"))try{a=i.exec(decodeURIComponent(a))[0]}catch{}}return a||e}class StatTimer{constructor(){_defineProperty(this,"started",Object.create(null));_defineProperty(this,"times",[])}time(t){t in this.started&&warn(`Timer is already running for ${t}`);this.started[t]=Date.now()}timeEnd(t){t in this.started||warn(`Timer has not been started for ${t}`);this.times.push({name:t,start:this.started[t],end:Date.now()});delete this.started[t]}toString(){const t=[];let e=0;for(const{name:t}of this.times)e=Math.max(t.length,e);for(const{name:i,start:s,end:a}of this.times)t.push(`${i.padEnd(e)} ${a-s}ms\n`);return t.join("")}}function isValidFetchUrl(t,e){try{const{protocol:i}=e?new URL(t,e):new URL(t);return"http:"===i||"https:"===i||"capacitor:"===i}catch{return!1}}function noContextMenu(t){t.preventDefault()}let _t;class PDFDateString{static toDateObject(t){if(!t||"string"!=typeof t)return null;_t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=_t.exec(t);if(!e)return null;const i=parseInt(e[1],10);let s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let a=parseInt(e[3],10);a=a>=1&&a<=31?a:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let n=parseInt(e[5],10);n=n>=0&&n<=59?n:0;let o=parseInt(e[6],10);o=o>=0&&o<=59?o:0;const l=e[7]||"Z";let c=parseInt(e[8],10);c=c>=0&&c<=23?c:0;let h=parseInt(e[9],10)||0;h=h>=0&&h<=59?h:0;if("-"===l){r+=c;n+=h}else if("+"===l){r-=c;n-=h}return new Date(Date.UTC(i,s,a,r,n,o))}}function getXfaPageViewport(t,e){let{scale:i=1,rotation:s=0}=e;const{width:a,height:r}=t.attributes.style,n=[0,0,parseInt(a),parseInt(r)];return new PageViewport({viewBox:n,scale:i,rotation:s})}function getRGB(t){if(t.startsWith("#")){const e=parseInt(t.slice(1),16);return[(16711680&e)>>16,(65280&e)>>8,255&e]}if(t.startsWith("rgb("))return t.slice(4,-1).split(",").map((t=>parseInt(t)));if(t.startsWith("rgba("))return t.slice(5,-1).split(",").map((t=>parseInt(t))).slice(0,3);warn(`Not a valid color format: "${t}"`);return[0,0,0]}function getCurrentTransform(t){const{a:e,b:i,c:s,d:a,e:r,f:n}=t.getTransform();return[e,i,s,a,r,n]}function getCurrentTransformInverse(t){const{a:e,b:i,c:s,d:a,e:r,f:n}=t.getTransform().invertSelf();return[e,i,s,a,r,n]}function setLayerDimensions(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e instanceof PageViewport){const{pageWidth:s,pageHeight:a}=e.rawDims,{style:r}=t,n=util_FeatureTest.isCSSRoundSupported,o=`var(--scale-factor) * ${s}px`,l=`var(--scale-factor) * ${a}px`,c=n?`round(${o}, 1px)`:`calc(${o})`,h=n?`round(${l}, 1px)`:`calc(${l})`;if(i&&e.rotation%180!=0){r.width=h;r.height=c}else{r.width=c;r.height=h}}s&&t.setAttribute("data-main-rotation",e.rotation)}function toolbar_classPrivateMethodInitSpec(t,e){toolbar_checkPrivateRedeclaration(t,e);e.add(t)}function toolbar_classPrivateFieldInitSpec(t,e,i){toolbar_checkPrivateRedeclaration(t,e);e.set(t,i)}function toolbar_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function toolbar_classPrivateGetter(t,e,i){return i(toolbar_assertClassBrand(t,e))}function toolbar_classPrivateFieldGet(t,e){return t.get(toolbar_assertClassBrand(t,e))}function toolbar_classPrivateFieldSet(t,e,i){return t.set(toolbar_assertClassBrand(t,e),i),i}function toolbar_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var ft=new WeakMap,gt=new WeakMap,vt=new WeakMap,mt=new WeakMap,Pt=new WeakSet;class EditorToolbar{constructor(t){toolbar_classPrivateMethodInitSpec(this,Pt);toolbar_classPrivateFieldInitSpec(this,ft,null);toolbar_classPrivateFieldInitSpec(this,gt,null);toolbar_classPrivateFieldInitSpec(this,vt,void 0);toolbar_classPrivateFieldInitSpec(this,mt,null);toolbar_classPrivateFieldSet(vt,this,t)}render(){const t=toolbar_classPrivateFieldSet(ft,this,document.createElement("div"));t.className="editToolbar";t.setAttribute("role","toolbar");t.addEventListener("contextmenu",noContextMenu);t.addEventListener("pointerdown",_pointerDown);const e=toolbar_classPrivateFieldSet(mt,this,document.createElement("div"));e.className="buttons";t.append(e);const i=toolbar_classPrivateFieldGet(vt,this).toolbarPosition;if(i){const{style:e}=t,s="ltr"===toolbar_classPrivateFieldGet(vt,this)._uiManager.direction?1-i[0]:i[0];e.insetInlineEnd=100*s+"%";e.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}toolbar_assertClassBrand(Pt,this,_addDeleteButton).call(this);return t}hide(){toolbar_classPrivateFieldGet(ft,this).classList.add("hidden");toolbar_classPrivateFieldGet(gt,this)?.hideDropdown()}show(){toolbar_classPrivateFieldGet(ft,this).classList.remove("hidden")}addAltTextButton(t){toolbar_assertClassBrand(Pt,this,_addListenersToElement).call(this,t);toolbar_classPrivateFieldGet(mt,this).prepend(t,toolbar_classPrivateGetter(Pt,this,_get_divider))}addColorPicker(t){toolbar_classPrivateFieldSet(gt,this,t);const e=t.renderButton();toolbar_assertClassBrand(Pt,this,_addListenersToElement).call(this,e);toolbar_classPrivateFieldGet(mt,this).prepend(e,toolbar_classPrivateGetter(Pt,this,_get_divider))}remove(){toolbar_classPrivateFieldGet(ft,this).remove();toolbar_classPrivateFieldGet(gt,this)?.destroy();toolbar_classPrivateFieldSet(gt,this,null)}}function _pointerDown(t){t.stopPropagation()}function _focusIn(t){toolbar_classPrivateFieldGet(vt,this)._focusEventsAllowed=!1;t.preventDefault();t.stopPropagation()}function _focusOut(t){toolbar_classPrivateFieldGet(vt,this)._focusEventsAllowed=!0;t.preventDefault();t.stopPropagation()}function _addListenersToElement(t){t.addEventListener("focusin",toolbar_assertClassBrand(Pt,this,_focusIn).bind(this),{capture:!0});t.addEventListener("focusout",toolbar_assertClassBrand(Pt,this,_focusOut).bind(this),{capture:!0});t.addEventListener("contextmenu",noContextMenu)}function _addDeleteButton(){const t=document.createElement("button");t.className="delete";t.tabIndex=0;t.setAttribute("data-l10n-id",`pdfjs-editor-remove-${toolbar_classPrivateFieldGet(vt,this).editorType}-button`);toolbar_assertClassBrand(Pt,this,_addListenersToElement).call(this,t);t.addEventListener("click",(t=>{toolbar_classPrivateFieldGet(vt,this)._uiManager.delete()}));toolbar_classPrivateFieldGet(mt,this).append(t)}function _get_divider(t){const e=document.createElement("div");e.className="divider";return e}var yt,Ft=new WeakMap,bt=new WeakMap,wt=new WeakMap,At=new WeakSet;class HighlightToolbar{constructor(t){toolbar_classPrivateMethodInitSpec(this,At);toolbar_classPrivateFieldInitSpec(this,Ft,null);toolbar_classPrivateFieldInitSpec(this,bt,null);toolbar_classPrivateFieldInitSpec(this,wt,void 0);toolbar_classPrivateFieldSet(wt,this,t)}show(t,e,i){const[s,a]=toolbar_assertClassBrand(At,this,_getLastPoint).call(this,e,i),{style:r}=toolbar_classPrivateFieldGet(bt,this)||toolbar_classPrivateFieldSet(bt,this,toolbar_assertClassBrand(At,this,_render).call(this));t.append(toolbar_classPrivateFieldGet(bt,this));r.insetInlineEnd=100*s+"%";r.top=`calc(${100*a}% + var(--editor-toolbar-vert-offset))`}hide(){toolbar_classPrivateFieldGet(bt,this).remove()}}function _render(){const t=toolbar_classPrivateFieldSet(bt,this,document.createElement("div"));t.className="editToolbar";t.setAttribute("role","toolbar");t.addEventListener("contextmenu",noContextMenu);const e=toolbar_classPrivateFieldSet(Ft,this,document.createElement("div"));e.className="buttons";t.append(e);toolbar_assertClassBrand(At,this,_addHighlightButton).call(this);return t}function _getLastPoint(t,e){let i=0,s=0;for(const a of t){const t=a.y+a.height;if(t<i)continue;const r=a.x+(e?a.width:0);if(t>i){s=r;i=t}else e?r>s&&(s=r):r<s&&(s=r)}return[e?1-s:s,i]}function _addHighlightButton(){const t=document.createElement("button");t.className="highlightButton";t.tabIndex=0;t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e);e.className="visuallyHidden";e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");t.addEventListener("contextmenu",noContextMenu);t.addEventListener("click",(()=>{toolbar_classPrivateFieldGet(wt,this).highlightSelection("floating_button")}));toolbar_classPrivateFieldGet(Ft,this).append(t)}function tools_defineProperty(t,e,i){(e=function tools_toPropertyKey(t){var e=function tools_toPrimitive(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i;return t}function tools_classPrivateMethodInitSpec(t,e){tools_checkPrivateRedeclaration(t,e);e.add(t)}function tools_classPrivateFieldInitSpec(t,e,i){tools_checkPrivateRedeclaration(t,e);e.set(t,i)}function tools_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function tools_classPrivateFieldGet(t,e){return t.get(tools_assertClassBrand(t,e))}function tools_classPrivateFieldSet(t,e,i){return t.set(tools_assertClassBrand(t,e),i),i}function tools_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}function bindEvents(t,e,i){for(const s of i)e.addEventListener(s,t[s].bind(t))}var St=new WeakMap;class IdManager{constructor(){tools_classPrivateFieldInitSpec(this,St,0)}get id(){var t,e;return`pdfjs_internal_editor_${tools_classPrivateFieldSet(St,this,(t=tools_classPrivateFieldGet(St,this),e=t++,t)),e}`}}var xt=new WeakMap,Ct=new WeakMap,kt=new WeakMap,Et=new WeakSet;class ImageManager{constructor(){tools_classPrivateMethodInitSpec(this,Et);tools_classPrivateFieldInitSpec(this,xt,function getUuid(){if("undefined"!=typeof crypto&&"function"==typeof crypto?.randomUUID)return crypto.randomUUID();const t=new Uint8Array(32);if("undefined"!=typeof crypto&&"function"==typeof crypto?.getRandomValues)crypto.getRandomValues(t);else for(let e=0;e<32;e++)t[e]=Math.floor(255*Math.random());return bytesToString(t)}());tools_classPrivateFieldInitSpec(this,Ct,0);tools_classPrivateFieldInitSpec(this,kt,null)}static get _isSVGFittingCanvas(){const t=new OffscreenCanvas(1,3).getContext("2d"),e=new Image;e.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>';return shadow(this,"_isSVGFittingCanvas",e.decode().then((()=>{t.drawImage(e,0,0,1,1,0,0,1,3);return 0===new Uint32Array(t.getImageData(0,0,1,1).data.buffer)[0]})))}async getFromFile(t){const{lastModified:e,name:i,size:s,type:a}=t;return tools_assertClassBrand(Et,this,_get).call(this,`${e}_${i}_${s}_${a}`,t)}async getFromUrl(t){return tools_assertClassBrand(Et,this,_get).call(this,t,t)}async getFromId(t){tools_classPrivateFieldGet(kt,this)||tools_classPrivateFieldSet(kt,this,new Map);const e=tools_classPrivateFieldGet(kt,this).get(t);if(!e)return null;if(e.bitmap){e.refCounter+=1;return e}return e.file?this.getFromFile(e.file):this.getFromUrl(e.url)}getSvgUrl(t){const e=tools_classPrivateFieldGet(kt,this).get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){tools_classPrivateFieldGet(kt,this)||tools_classPrivateFieldSet(kt,this,new Map);const e=tools_classPrivateFieldGet(kt,this).get(t);if(e){e.refCounter-=1;0===e.refCounter&&(e.bitmap=null)}}isValidId(t){return t.startsWith(`image_${tools_classPrivateFieldGet(xt,this)}_`)}}yt=ImageManager;async function _get(t,e){tools_classPrivateFieldGet(kt,this)||tools_classPrivateFieldSet(kt,this,new Map);let i=tools_classPrivateFieldGet(kt,this).get(t);if(null===i)return null;if(i?.bitmap){i.refCounter+=1;return i}try{var s,a;i||={bitmap:null,id:`image_${tools_classPrivateFieldGet(xt,this)}_${tools_classPrivateFieldSet(Ct,this,(s=tools_classPrivateFieldGet(Ct,this),a=s++,s)),a}`,refCounter:0,isSvg:!1};let t;if("string"==typeof e){i.url=e;t=await fetchData(e,"blob")}else t=i.file=e;if("image/svg+xml"===t.type){const e=yt._isSVGFittingCanvas,s=new FileReader,a=new Image,r=new Promise(((t,r)=>{a.onload=()=>{i.bitmap=a;i.isSvg=!0;t()};s.onload=async()=>{const t=i.svgUrl=s.result;a.src=await e?`${t}#svgView(preserveAspectRatio(none))`:t};a.onerror=s.onerror=r}));s.readAsDataURL(t);await r}else i.bitmap=await createImageBitmap(t);i.refCounter=1}catch(t){console.error(t);i=null}tools_classPrivateFieldGet(kt,this).set(t,i);i&&tools_classPrivateFieldGet(kt,this).set(i.id,i);return i}var Mt=new WeakMap,Gt=new WeakMap,It=new WeakMap,Tt=new WeakMap;class CommandManager{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;tools_classPrivateFieldInitSpec(this,Mt,[]);tools_classPrivateFieldInitSpec(this,Gt,!1);tools_classPrivateFieldInitSpec(this,It,void 0);tools_classPrivateFieldInitSpec(this,Tt,-1);tools_classPrivateFieldSet(It,this,t)}add(t){let{cmd:e,undo:i,post:s,mustExec:a,type:r=NaN,overwriteIfSameType:n=!1,keepUndo:o=!1}=t;a&&e();if(tools_classPrivateFieldGet(Gt,this))return;const l={cmd:e,undo:i,post:s,type:r};if(-1===tools_classPrivateFieldGet(Tt,this)){tools_classPrivateFieldGet(Mt,this).length>0&&(tools_classPrivateFieldGet(Mt,this).length=0);tools_classPrivateFieldSet(Tt,this,0);tools_classPrivateFieldGet(Mt,this).push(l);return}if(n&&tools_classPrivateFieldGet(Mt,this)[tools_classPrivateFieldGet(Tt,this)].type===r){o&&(l.undo=tools_classPrivateFieldGet(Mt,this)[tools_classPrivateFieldGet(Tt,this)].undo);tools_classPrivateFieldGet(Mt,this)[tools_classPrivateFieldGet(Tt,this)]=l;return}const c=tools_classPrivateFieldGet(Tt,this)+1;if(c===tools_classPrivateFieldGet(It,this))tools_classPrivateFieldGet(Mt,this).splice(0,1);else{tools_classPrivateFieldSet(Tt,this,c);c<tools_classPrivateFieldGet(Mt,this).length&&tools_classPrivateFieldGet(Mt,this).splice(c)}tools_classPrivateFieldGet(Mt,this).push(l)}undo(){if(-1===tools_classPrivateFieldGet(Tt,this))return;tools_classPrivateFieldSet(Gt,this,!0);const{undo:t,post:e}=tools_classPrivateFieldGet(Mt,this)[tools_classPrivateFieldGet(Tt,this)];t();e?.();tools_classPrivateFieldSet(Gt,this,!1);tools_classPrivateFieldSet(Tt,this,tools_classPrivateFieldGet(Tt,this)-1)}redo(){if(tools_classPrivateFieldGet(Tt,this)<tools_classPrivateFieldGet(Mt,this).length-1){tools_classPrivateFieldSet(Tt,this,tools_classPrivateFieldGet(Tt,this)+1);tools_classPrivateFieldSet(Gt,this,!0);const{cmd:t,post:e}=tools_classPrivateFieldGet(Mt,this)[tools_classPrivateFieldGet(Tt,this)];t();e?.();tools_classPrivateFieldSet(Gt,this,!1)}}hasSomethingToUndo(){return-1!==tools_classPrivateFieldGet(Tt,this)}hasSomethingToRedo(){return tools_classPrivateFieldGet(Tt,this)<tools_classPrivateFieldGet(Mt,this).length-1}destroy(){tools_classPrivateFieldSet(Mt,this,null)}reset(){tools_classPrivateFieldSet(Mt,this,[]);tools_classPrivateFieldSet(Tt,this,-1);tools_classPrivateFieldSet(Gt,this,!1)}}var Rt=new WeakSet;class KeyboardManager{constructor(t){tools_classPrivateMethodInitSpec(this,Rt);this.buffer=[];this.callbacks=new Map;this.allKeys=new Set;const{isMac:e}=util_FeatureTest.platform;for(const[i,s,a={}]of t)for(const t of i){const i=t.startsWith("mac+");if(e&&i){this.callbacks.set(t.slice(4),{callback:s,options:a});this.allKeys.add(t.split("+").at(-1))}else if(!e&&!i){this.callbacks.set(t,{callback:s,options:a});this.allKeys.add(t.split("+").at(-1))}}}exec(t,e){if(!this.allKeys.has(e.key))return;const i=this.callbacks.get(tools_assertClassBrand(Rt,this,_serialize).call(this,e));if(!i)return;const{callback:s,options:{bubbles:a=!1,args:r=[],checker:n=null}}=i;if(!n||n(t,e)){s.bind(t,...r,e)();if(!a){e.stopPropagation();e.preventDefault()}}}}function _serialize(t){t.altKey&&this.buffer.push("alt");t.ctrlKey&&this.buffer.push("ctrl");t.metaKey&&this.buffer.push("meta");t.shiftKey&&this.buffer.push("shift");this.buffer.push(t.key);const e=this.buffer.join("+");this.buffer.length=0;return e}class ColorManager{get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);!function getColorValues(t){const e=document.createElement("span");e.style.visibility="hidden";document.body.append(e);for(const i of t.keys()){e.style.color=i;const s=window.getComputedStyle(e).color;t.set(i,getRGB(s))}e.remove()}(t);return shadow(this,"_colors",t)}convert(t){const e=getRGB(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[t,i]of this._colors)if(i.every(((t,i)=>t===e[i])))return ColorManager._colorsMapping.get(t);return e}getHexCode(t){const e=this._colors.get(t);return e?Util.makeHexColor(...e):t}}tools_defineProperty(ColorManager,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var Dt,Lt=new WeakMap,Bt=new WeakMap,Ot=new WeakMap,Nt=new WeakMap,Wt=new WeakMap,jt=new WeakMap,Ht=new WeakMap,Ut=new WeakMap,zt=new WeakMap,Vt=new WeakMap,qt=new WeakMap,$t=new WeakMap,Xt=new WeakMap,Kt=new WeakMap,Yt=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,Zt=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap,se=new WeakMap,ae=new WeakMap,re=new WeakMap,ne=new WeakMap,oe=new WeakMap,le=new WeakMap,ce=new WeakMap,he=new WeakMap,de=new WeakMap,ue=new WeakMap,pe=new WeakMap,_e=new WeakMap,fe=new WeakMap,ge=new WeakMap,ve=new WeakMap,me=new WeakMap,Pe=new WeakMap,ye=new WeakMap,Fe=new WeakMap,be=new WeakMap,we=new WeakMap,Ae=new WeakMap,Se=new WeakMap,xe=new WeakMap,Ce=new WeakSet;class AnnotationEditorUIManager{static get _keyboardManager(){const t=AnnotationEditorUIManager.prototype,arrowChecker=t=>tools_classPrivateFieldGet(Se,t).contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&t.hasSomethingToControl(),textInputChecker=(t,e)=>{let{target:i}=e;if(i instanceof HTMLInputElement){const{type:t}=i;return"text"!==t&&"number"!==t}return!0},e=this.TRANSLATE_SMALL,i=this.TRANSLATE_BIG;return shadow(this,"_keyboardManager",new KeyboardManager([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:textInputChecker}],[["ctrl+z","mac+meta+z"],t.undo,{checker:textInputChecker}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:textInputChecker}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:textInputChecker}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(t,e)=>{let{target:i}=e;return!(i instanceof HTMLButtonElement)&&tools_classPrivateFieldGet(Se,t).contains(i)&&!t.isEnterHandled}}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(t,e)=>{let{target:i}=e;return!(i instanceof HTMLButtonElement)&&tools_classPrivateFieldGet(Se,t).contains(document.activeElement)}}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-e,0],checker:arrowChecker}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:arrowChecker}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[e,0],checker:arrowChecker}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:arrowChecker}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-e],checker:arrowChecker}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:arrowChecker}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,e],checker:arrowChecker}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:arrowChecker}]]))}constructor(t,e,i,s,a,r,n,o,l){tools_classPrivateMethodInitSpec(this,Ce);tools_classPrivateFieldInitSpec(this,Lt,null);tools_classPrivateFieldInitSpec(this,Bt,new Map);tools_classPrivateFieldInitSpec(this,Ot,new Map);tools_classPrivateFieldInitSpec(this,Nt,null);tools_classPrivateFieldInitSpec(this,Wt,null);tools_classPrivateFieldInitSpec(this,jt,new CommandManager);tools_classPrivateFieldInitSpec(this,Ht,0);tools_classPrivateFieldInitSpec(this,Ut,new Set);tools_classPrivateFieldInitSpec(this,zt,null);tools_classPrivateFieldInitSpec(this,Vt,null);tools_classPrivateFieldInitSpec(this,qt,new Set);tools_classPrivateFieldInitSpec(this,$t,!1);tools_classPrivateFieldInitSpec(this,Xt,null);tools_classPrivateFieldInitSpec(this,Kt,null);tools_classPrivateFieldInitSpec(this,Yt,null);tools_classPrivateFieldInitSpec(this,Qt,!1);tools_classPrivateFieldInitSpec(this,Jt,null);tools_classPrivateFieldInitSpec(this,Zt,new IdManager);tools_classPrivateFieldInitSpec(this,te,!1);tools_classPrivateFieldInitSpec(this,ee,!1);tools_classPrivateFieldInitSpec(this,ie,null);tools_classPrivateFieldInitSpec(this,se,null);tools_classPrivateFieldInitSpec(this,ae,null);tools_classPrivateFieldInitSpec(this,re,p.NONE);tools_classPrivateFieldInitSpec(this,ne,new Set);tools_classPrivateFieldInitSpec(this,oe,null);tools_classPrivateFieldInitSpec(this,le,null);tools_classPrivateFieldInitSpec(this,ce,null);tools_classPrivateFieldInitSpec(this,he,this.blur.bind(this));tools_classPrivateFieldInitSpec(this,de,this.focus.bind(this));tools_classPrivateFieldInitSpec(this,ue,this.copy.bind(this));tools_classPrivateFieldInitSpec(this,pe,this.cut.bind(this));tools_classPrivateFieldInitSpec(this,_e,this.paste.bind(this));tools_classPrivateFieldInitSpec(this,fe,this.keydown.bind(this));tools_classPrivateFieldInitSpec(this,ge,this.keyup.bind(this));tools_classPrivateFieldInitSpec(this,ve,this.onEditingAction.bind(this));tools_classPrivateFieldInitSpec(this,me,this.onPageChanging.bind(this));tools_classPrivateFieldInitSpec(this,Pe,this.onScaleChanging.bind(this));tools_classPrivateFieldInitSpec(this,ye,tools_assertClassBrand(Ce,this,_selectionChange).bind(this));tools_classPrivateFieldInitSpec(this,Fe,this.onRotationChanging.bind(this));tools_classPrivateFieldInitSpec(this,be,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});tools_classPrivateFieldInitSpec(this,we,[0,0]);tools_classPrivateFieldInitSpec(this,Ae,null);tools_classPrivateFieldInitSpec(this,Se,null);tools_classPrivateFieldInitSpec(this,xe,null);tools_classPrivateFieldSet(Se,this,t);tools_classPrivateFieldSet(xe,this,e);tools_classPrivateFieldSet(Nt,this,i);this._eventBus=s;this._eventBus._on("editingaction",tools_classPrivateFieldGet(ve,this));this._eventBus._on("pagechanging",tools_classPrivateFieldGet(me,this));this._eventBus._on("scalechanging",tools_classPrivateFieldGet(Pe,this));this._eventBus._on("rotationchanging",tools_classPrivateFieldGet(Fe,this));tools_assertClassBrand(Ce,this,_addSelectionListener).call(this);tools_assertClassBrand(Ce,this,_addKeyboardManager).call(this);tools_classPrivateFieldSet(Wt,this,a.annotationStorage);tools_classPrivateFieldSet(Xt,this,a.filterFactory);tools_classPrivateFieldSet(le,this,r);tools_classPrivateFieldSet(Yt,this,n||null);tools_classPrivateFieldSet($t,this,o);tools_classPrivateFieldSet(ae,this,l||null);this.viewParameters={realScale:PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0};this.isShiftKeyDown=!1}destroy(){tools_assertClassBrand(Ce,this,_removeKeyboardManager).call(this);tools_assertClassBrand(Ce,this,_removeFocusManager).call(this);this._eventBus._off("editingaction",tools_classPrivateFieldGet(ve,this));this._eventBus._off("pagechanging",tools_classPrivateFieldGet(me,this));this._eventBus._off("scalechanging",tools_classPrivateFieldGet(Pe,this));this._eventBus._off("rotationchanging",tools_classPrivateFieldGet(Fe,this));for(const t of tools_classPrivateFieldGet(Ot,this).values())t.destroy();tools_classPrivateFieldGet(Ot,this).clear();tools_classPrivateFieldGet(Bt,this).clear();tools_classPrivateFieldGet(qt,this).clear();tools_classPrivateFieldSet(Lt,this,null);tools_classPrivateFieldGet(ne,this).clear();tools_classPrivateFieldGet(jt,this).destroy();tools_classPrivateFieldGet(Nt,this)?.destroy();tools_classPrivateFieldGet(Jt,this)?.hide();tools_classPrivateFieldSet(Jt,this,null);if(tools_classPrivateFieldGet(Kt,this)){clearTimeout(tools_classPrivateFieldGet(Kt,this));tools_classPrivateFieldSet(Kt,this,null)}if(tools_classPrivateFieldGet(Ae,this)){clearTimeout(tools_classPrivateFieldGet(Ae,this));tools_classPrivateFieldSet(Ae,this,null)}tools_assertClassBrand(Ce,this,_removeSelectionListener).call(this)}async mlGuess(t){return tools_classPrivateFieldGet(ae,this)?.guess(t)||null}get hasMLManager(){return!!tools_classPrivateFieldGet(ae,this)}get hcmFilter(){return shadow(this,"hcmFilter",tools_classPrivateFieldGet(le,this)?tools_classPrivateFieldGet(Xt,this).addHCMFilter(tools_classPrivateFieldGet(le,this).foreground,tools_classPrivateFieldGet(le,this).background):"none")}get direction(){return shadow(this,"direction",getComputedStyle(tools_classPrivateFieldGet(Se,this)).direction)}get highlightColors(){return shadow(this,"highlightColors",tools_classPrivateFieldGet(Yt,this)?new Map(tools_classPrivateFieldGet(Yt,this).split(",").map((t=>t.split("=").map((t=>t.trim()))))):null)}get highlightColorNames(){return shadow(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,(t=>t.reverse()))):null)}setMainHighlightColorPicker(t){tools_classPrivateFieldSet(se,this,t)}editAltText(t){tools_classPrivateFieldGet(Nt,this)?.editAltText(this,t)}onPageChanging(t){let{pageNumber:e}=t;tools_classPrivateFieldSet(Ht,this,e-1)}focusMainContainer(){tools_classPrivateFieldGet(Se,this).focus()}findParent(t,e){for(const i of tools_classPrivateFieldGet(Ot,this).values()){const{x:s,y:a,width:r,height:n}=i.div.getBoundingClientRect();if(t>=s&&t<=s+r&&e>=a&&e<=a+n)return i}return null}disableUserSelect(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];tools_classPrivateFieldGet(xe,this).classList.toggle("noUserSelect",t)}addShouldRescale(t){tools_classPrivateFieldGet(qt,this).add(t)}removeShouldRescale(t){tools_classPrivateFieldGet(qt,this).delete(t)}onScaleChanging(t){let{scale:e}=t;this.commitOrRemove();this.viewParameters.realScale=e*PixelsPerInch.PDF_TO_CSS_UNITS;for(const t of tools_classPrivateFieldGet(qt,this))t.onScaleChanging()}onRotationChanging(t){let{pagesRotation:e}=t;this.commitOrRemove();this.viewParameters.rotation=e}highlightSelection(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:i,anchorOffset:s,focusNode:a,focusOffset:r}=e,n=e.toString(),o=tools_assertClassBrand(Ce,this,_getAnchorElementForSelection).call(this,e).closest(".textLayer"),l=this.getSelectionBoxes(o);if(l){e.empty();if(tools_classPrivateFieldGet(re,this)===p.NONE){this._eventBus.dispatch("showannotationeditorui",{source:this,mode:p.HIGHLIGHT});this.showAllEditors("highlight",!0,!0)}for(const e of tools_classPrivateFieldGet(Ot,this).values())if(e.hasTextLayer(o)){e.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:l,anchorNode:i,anchorOffset:s,focusNode:a,focusOffset:r,text:n});break}}}addToAnnotationStorage(t){t.isEmpty()||!tools_classPrivateFieldGet(Wt,this)||tools_classPrivateFieldGet(Wt,this).has(t.id)||tools_classPrivateFieldGet(Wt,this).setValue(t.id,t)}blur(){this.isShiftKeyDown=!1;if(tools_classPrivateFieldGet(Qt,this)){tools_classPrivateFieldSet(Qt,this,!1);tools_assertClassBrand(Ce,this,_onSelectEnd).call(this,"main_toolbar")}if(!this.hasSelection)return;const{activeElement:t}=document;for(const e of tools_classPrivateFieldGet(ne,this))if(e.div.contains(t)){tools_classPrivateFieldSet(ie,this,[e,t]);e._focusEventsAllowed=!1;break}}focus(){if(!tools_classPrivateFieldGet(ie,this))return;const[t,e]=tools_classPrivateFieldGet(ie,this);tools_classPrivateFieldSet(ie,this,null);e.addEventListener("focusin",(()=>{t._focusEventsAllowed=!0}),{once:!0});e.focus()}addEditListeners(){tools_assertClassBrand(Ce,this,_addKeyboardManager).call(this);tools_assertClassBrand(Ce,this,_addCopyPasteListeners).call(this)}removeEditListeners(){tools_assertClassBrand(Ce,this,_removeKeyboardManager).call(this);tools_assertClassBrand(Ce,this,_removeCopyPasteListeners).call(this)}copy(t){t.preventDefault();tools_classPrivateFieldGet(Lt,this)?.commitOrRemove();if(!this.hasSelection)return;const e=[];for(const t of tools_classPrivateFieldGet(ne,this)){const i=t.serialize(!0);i&&e.push(i)}0!==e.length&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t);this.delete()}paste(t){t.preventDefault();const{clipboardData:e}=t;for(const t of e.items)for(const e of tools_classPrivateFieldGet(Vt,this))if(e.isHandlingMimeForPasting(t.type)){e.paste(t,this.currentLayer);return}const i=e.getData("application/pdfjs");this.addSerializedEditor(i)}addSerializedEditor(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!t)return;try{"string"==typeof t&&(t=JSON.parse(t))}catch(t){warn(`paste: "${t.message}".`);return}if(!Array.isArray(t))return;const a=tools_classPrivateFieldGet(re,this);e&&a===p.NONE&&this.updateMode(p.FREETEXT);this.unselectAll();try{const e=[];for(const a of t){const t=void 0===a.pageIndex,r=(s||t?this.currentLayer:this.getLayer(a.pageIndex)).deserialize(a);if(!r)return;r.doNotMove=i;e.push(r)}const cmd=()=>{for(const t of e)tools_assertClassBrand(Ce,this,_addEditorToLayer).call(this,t);tools_assertClassBrand(Ce,this,_selectEditors).call(this,e)},undo=()=>{for(const t of e)t.remove()};this.addCommands({cmd,undo,mustExec:!0});console.log("paste: added new editors")}catch(t){warn(`paste: "${t.message}".`)}e&&a!==tools_classPrivateFieldGet(re,this)&&this.updateMode(a)}keydown(t){this.isShiftKeyDown||"Shift"!==t.key||(this.isShiftKeyDown=!0);tools_classPrivateFieldGet(re,this)===p.NONE||this.isEditorHandlingKeyboard||AnnotationEditorUIManager._keyboardManager.exec(this,t)}keyup(t){if(this.isShiftKeyDown&&"Shift"===t.key){this.isShiftKeyDown=!1;if(tools_classPrivateFieldGet(Qt,this)){tools_classPrivateFieldSet(Qt,this,!1);tools_assertClassBrand(Ce,this,_onSelectEnd).call(this,"main_toolbar")}}}onEditingAction(t){let{name:e}=t;switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu")}}setEditingState(t){if(t){tools_assertClassBrand(Ce,this,_addFocusManager).call(this);tools_assertClassBrand(Ce,this,_addCopyPasteListeners).call(this);tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{isEditing:tools_classPrivateFieldGet(re,this)!==p.NONE,isEmpty:tools_assertClassBrand(Ce,this,_isEmpty).call(this),hasSomethingToUndo:tools_classPrivateFieldGet(jt,this).hasSomethingToUndo(),hasSomethingToRedo:tools_classPrivateFieldGet(jt,this).hasSomethingToRedo(),hasSelectedEditor:!1})}else{tools_assertClassBrand(Ce,this,_removeFocusManager).call(this);tools_assertClassBrand(Ce,this,_removeCopyPasteListeners).call(this);tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{isEditing:!1});this.disableUserSelect(!1)}}registerEditorTypes(t){if(!tools_classPrivateFieldGet(Vt,this)){tools_classPrivateFieldSet(Vt,this,t);for(const t of tools_classPrivateFieldGet(Vt,this))tools_assertClassBrand(Ce,this,_dispatchUpdateUI).call(this,t.defaultPropertiesToUpdate)}}getId(){return tools_classPrivateFieldGet(Zt,this).id}get currentLayer(){return tools_classPrivateFieldGet(Ot,this).get(tools_classPrivateFieldGet(Ht,this))}getLayer(t){return tools_classPrivateFieldGet(Ot,this).get(t)}get currentPageIndex(){return tools_classPrivateFieldGet(Ht,this)}addLayer(t){tools_classPrivateFieldGet(Ot,this).set(t.pageIndex,t);tools_classPrivateFieldGet(te,this)?t.enable():t.disable()}removeLayer(t){tools_classPrivateFieldGet(Ot,this).delete(t.pageIndex)}updateMode(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(tools_classPrivateFieldGet(re,this)!==t){tools_classPrivateFieldSet(re,this,t);if(t!==p.NONE){this.setEditingState(!0);tools_assertClassBrand(Ce,this,_enableAll).call(this);this.unselectAll();for(const e of tools_classPrivateFieldGet(Ot,this).values())e.updateMode(t);if(e||!i){if(e)for(const t of tools_classPrivateFieldGet(Bt,this).values())if(t.annotationElementId===e){this.setSelected(t);t.enterInEditMode();break}}else this.addNewEditorFromKeyboard()}else{this.setEditingState(!1);tools_assertClassBrand(Ce,this,_disableAll).call(this)}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==tools_classPrivateFieldGet(re,this)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){if(tools_classPrivateFieldGet(Vt,this)){switch(t){case _.CREATE:this.currentLayer.addNewEditor();return;case _.HIGHLIGHT_DEFAULT_COLOR:tools_classPrivateFieldGet(se,this)?.updateColor(e);break;case _.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}});(tools_classPrivateFieldGet(ce,this)||tools_classPrivateFieldSet(ce,this,new Map)).set(t,e);this.showAllEditors("highlight",e)}for(const i of tools_classPrivateFieldGet(ne,this))i.updateParams(t,e);for(const i of tools_classPrivateFieldGet(Vt,this))i.updateDefaultParams(t,e)}}showAllEditors(t,e){for(const i of tools_classPrivateFieldGet(Bt,this).values())i.editorType===t&&i.show(e);(tools_classPrivateFieldGet(ce,this)?.get(_.HIGHLIGHT_SHOW_ALL)??!0)!==e&&tools_assertClassBrand(Ce,this,_dispatchUpdateUI).call(this,[[_.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(tools_classPrivateFieldGet(ee,this)!==t){tools_classPrivateFieldSet(ee,this,t);for(const e of tools_classPrivateFieldGet(Ot,this).values()){t?e.disableClick():e.enableClick();e.div.classList.toggle("waiting",t)}}}getEditors(t){const e=[];for(const i of tools_classPrivateFieldGet(Bt,this).values())i.pageIndex===t&&e.push(i);return e}getEditor(t){return tools_classPrivateFieldGet(Bt,this).get(t)}addEditor(t){tools_classPrivateFieldGet(Bt,this).set(t.id,t)}removeEditor(t){if(t.div.contains(document.activeElement)){tools_classPrivateFieldGet(Kt,this)&&clearTimeout(tools_classPrivateFieldGet(Kt,this));tools_classPrivateFieldSet(Kt,this,setTimeout((()=>{this.focusMainContainer();tools_classPrivateFieldSet(Kt,this,null)}),0))}tools_classPrivateFieldGet(Bt,this).delete(t.id);this.unselect(t);t.annotationElementId&&tools_classPrivateFieldGet(Ut,this).has(t.annotationElementId)||tools_classPrivateFieldGet(Wt,this)?.remove(t.id)}addDeletedAnnotationElement(t){tools_classPrivateFieldGet(Ut,this).add(t.annotationElementId);t.deleted=!0}isDeletedAnnotationElement(t){return tools_classPrivateFieldGet(Ut,this).has(t)}removeDeletedAnnotationElement(t){tools_classPrivateFieldGet(Ut,this).delete(t.annotationElementId);t.deleted=!1}setActiveEditor(t){if(tools_classPrivateFieldGet(Lt,this)!==t){tools_classPrivateFieldSet(Lt,this,t);t&&tools_assertClassBrand(Ce,this,_dispatchUpdateUI).call(this,t.propertiesToUpdate)}}updateUI(t){(function tools_classPrivateGetter(t,e,i){return i(tools_assertClassBrand(t,e))})(Ce,this,_get_lastSelectedEditor)===t&&tools_assertClassBrand(Ce,this,_dispatchUpdateUI).call(this,t.propertiesToUpdate)}toggleSelected(t){if(tools_classPrivateFieldGet(ne,this).has(t)){tools_classPrivateFieldGet(ne,this).delete(t);t.unselect();tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:this.hasSelection})}else{tools_classPrivateFieldGet(ne,this).add(t);t.select();tools_assertClassBrand(Ce,this,_dispatchUpdateUI).call(this,t.propertiesToUpdate);tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:!0})}}setSelected(t){for(const e of tools_classPrivateFieldGet(ne,this))e!==t&&e.unselect();tools_classPrivateFieldGet(ne,this).clear();tools_classPrivateFieldGet(ne,this).add(t);t.select();tools_assertClassBrand(Ce,this,_dispatchUpdateUI).call(this,t.propertiesToUpdate);tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:!0})}isSelected(t){return tools_classPrivateFieldGet(ne,this).has(t)}get firstSelectedEditor(){return tools_classPrivateFieldGet(ne,this).values().next().value}unselect(t){t.unselect();tools_classPrivateFieldGet(ne,this).delete(t);tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==tools_classPrivateFieldGet(ne,this).size}get isEnterHandled(){return 1===tools_classPrivateFieldGet(ne,this).size&&this.firstSelectedEditor.isEnterHandled}undo(){tools_classPrivateFieldGet(jt,this).undo();tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSomethingToUndo:tools_classPrivateFieldGet(jt,this).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:tools_assertClassBrand(Ce,this,_isEmpty).call(this)})}redo(){tools_classPrivateFieldGet(jt,this).redo();tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:tools_classPrivateFieldGet(jt,this).hasSomethingToRedo(),isEmpty:tools_assertClassBrand(Ce,this,_isEmpty).call(this)})}addCommands(t){tools_classPrivateFieldGet(jt,this).add(t);tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:tools_assertClassBrand(Ce,this,_isEmpty).call(this)})}delete(){this.commitOrRemove();if(!this.hasSelection)return;const t=[...tools_classPrivateFieldGet(ne,this)];this.addCommands({cmd:()=>{for(const e of t)e.remove()},undo:()=>{for(const e of t)tools_assertClassBrand(Ce,this,_addEditorToLayer).call(this,e)},mustExec:!0})}commitOrRemove(){tools_classPrivateFieldGet(Lt,this)?.commitOrRemove()}hasSomethingToControl(){return tools_classPrivateFieldGet(Lt,this)||this.hasSelection}selectAll(){for(const t of tools_classPrivateFieldGet(ne,this))t.commit();tools_assertClassBrand(Ce,this,_selectEditors).call(this,tools_classPrivateFieldGet(Bt,this).values())}unselectAll(){if(tools_classPrivateFieldGet(Lt,this)){tools_classPrivateFieldGet(Lt,this).commitOrRemove();if(tools_classPrivateFieldGet(re,this)!==p.NONE)return}if(this.hasSelection){for(const t of tools_classPrivateFieldGet(ne,this))t.unselect();tools_classPrivateFieldGet(ne,this).clear();tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2]||this.commitOrRemove();if(!this.hasSelection)return;tools_classPrivateFieldGet(we,this)[0]+=t;tools_classPrivateFieldGet(we,this)[1]+=e;const[i,s]=tools_classPrivateFieldGet(we,this),a=[...tools_classPrivateFieldGet(ne,this)];tools_classPrivateFieldGet(Ae,this)&&clearTimeout(tools_classPrivateFieldGet(Ae,this));tools_classPrivateFieldSet(Ae,this,setTimeout((()=>{tools_classPrivateFieldSet(Ae,this,null);tools_classPrivateFieldGet(we,this)[0]=tools_classPrivateFieldGet(we,this)[1]=0;this.addCommands({cmd:()=>{for(const t of a)if(tools_classPrivateFieldGet(Bt,this).has(t.id)){t.translateInPage(i,s);console.log("translateSelectedEditors: translated editor",t.id,i,s)}},undo:()=>{for(const t of a)tools_classPrivateFieldGet(Bt,this).has(t.id)&&t.translateInPage(-i,-s)},mustExec:!1})}),1e3));for(const i of a)i.translateInPage(t,e)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0);tools_classPrivateFieldSet(zt,this,new Map);for(const t of tools_classPrivateFieldGet(ne,this))tools_classPrivateFieldGet(zt,this).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!tools_classPrivateFieldGet(zt,this))return!1;this.disableUserSelect(!1);const t=tools_classPrivateFieldGet(zt,this);tools_classPrivateFieldSet(zt,this,null);let e=!1;for(const[{x:i,y:s,pageIndex:a},r]of t){r.newX=i;r.newY=s;r.newPageIndex=a;e||=i!==r.savedX||s!==r.savedY||a!==r.savedPageIndex}if(!e)return!1;const move=(t,e,i,s)=>{if(tools_classPrivateFieldGet(Bt,this).has(t.id)){const a=tools_classPrivateFieldGet(Ot,this).get(s);if(a)t._setParentAndPosition(a,e,i);else{t.pageIndex=s;t.x=e;t.y=i}}};this.addCommands({cmd:()=>{for(const[e,{newX:i,newY:s,newPageIndex:a,savedX:r,savedY:n,savedPageIndex:o}]of t){move(e,i,s,a);this._eventBus?.dispatch("annotation-editor-event",{source:e,type:"moved",page:a+1,editorType:e.constructor.name,previousValue:{x:r,y:n,page:o+1},value:{x:i,y:s,page:a+1}})}},undo:()=>{for(const[e,{savedX:i,savedY:s,savedPageIndex:a}]of t)move(e,i,s,a)},mustExec:!0});return!0}dragSelectedEditors(t,e){if(tools_classPrivateFieldGet(zt,this))for(const i of tools_classPrivateFieldGet(zt,this).keys())i.drag(t,e)}rebuild(t){if(null===t.parent){const e=this.getLayer(t.pageIndex);if(e){e.changeParent(t);e.addOrRebuild(t)}else{this.addEditor(t);this.addToAnnotationStorage(t);t.rebuild()}}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===tools_classPrivateFieldGet(ne,this).size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return tools_classPrivateFieldGet(Lt,this)===t}getActive(){return tools_classPrivateFieldGet(Lt,this)}getMode(){return tools_classPrivateFieldGet(re,this)}get imageManager(){return shadow(this,"imageManager",new ImageManager)}removeEditors(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>!0,e=!1;tools_classPrivateFieldGet(Ot,this).forEach((t=>t.setCleaningUp(!0)));tools_classPrivateFieldGet(Bt,this).forEach((i=>{if(t(i.serialize())){i.remove();e=!0}}));tools_classPrivateFieldGet(Ot,this).forEach((t=>t.setCleaningUp(!1)));if(e){tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSomethingToUndo:!1,hasSomethingToRedo:!1,isEmpty:tools_assertClassBrand(Ce,this,_isEmpty).call(this)});tools_classPrivateFieldGet(jt,this).reset()}}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let i=0,s=e.rangeCount;i<s;i++)if(!t.contains(e.getRangeAt(i).commonAncestorContainer))return null;const{x:i,y:s,width:a,height:r}=t.getBoundingClientRect();let n;switch(t.getAttribute("data-main-rotation")){case"90":n=(t,e,n,o)=>({x:(e-s)/r,y:1-(t+n-i)/a,width:o/r,height:n/a});break;case"180":n=(t,e,n,o)=>({x:1-(t+n-i)/a,y:1-(e+o-s)/r,width:n/a,height:o/r});break;case"270":n=(t,e,n,o)=>({x:1-(e+o-s)/r,y:(t-i)/a,width:o/r,height:n/a});break;default:n=(t,e,n,o)=>({x:(t-i)/a,y:(e-s)/r,width:n/a,height:o/r})}const o=[];for(let t=0,i=e.rangeCount;t<i;t++){const i=e.getRangeAt(t);if(!i.collapsed)for(const{x:t,y:e,width:s,height:a}of i.getClientRects())0!==s&&0!==a&&o.push(n(t,e,s,a))}return 0===o.length?null:o}}function _getAnchorElementForSelection(t){let{anchorNode:e}=t;return e.nodeType===Node.TEXT_NODE?e.parentElement:e}function _displayHighlightToolbar(){const t=document.getSelection();if(!t||t.isCollapsed)return;const e=tools_assertClassBrand(Ce,this,_getAnchorElementForSelection).call(this,t).closest(".textLayer"),i=this.getSelectionBoxes(e);if(i){tools_classPrivateFieldGet(Jt,this)||tools_classPrivateFieldSet(Jt,this,new HighlightToolbar(this));tools_classPrivateFieldGet(Jt,this).show(e,i,"ltr"===this.direction)}}function _selectionChange(){const t=document.getSelection();if(!t||t.isCollapsed){if(tools_classPrivateFieldGet(oe,this)){tools_classPrivateFieldGet(Jt,this)?.hide();tools_classPrivateFieldSet(oe,this,null);tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSelectedText:!1})}return}const{anchorNode:e}=t;if(e===tools_classPrivateFieldGet(oe,this))return;if(tools_assertClassBrand(Ce,this,_getAnchorElementForSelection).call(this,t).closest(".textLayer")){tools_classPrivateFieldGet(Jt,this)?.hide();tools_classPrivateFieldSet(oe,this,e);tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSelectedText:!0});if(tools_classPrivateFieldGet(re,this)===p.HIGHLIGHT||tools_classPrivateFieldGet(re,this)===p.NONE){tools_classPrivateFieldGet(re,this)===p.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0);tools_classPrivateFieldSet(Qt,this,this.isShiftKeyDown);if(!this.isShiftKeyDown){const pointerup=t=>{if("pointerup"!==t.type||0===t.button){window.removeEventListener("pointerup",pointerup);window.removeEventListener("blur",pointerup);"pointerup"===t.type&&tools_assertClassBrand(Ce,this,_onSelectEnd).call(this,"main_toolbar")}};window.addEventListener("pointerup",pointerup);window.addEventListener("blur",pointerup)}}}else if(tools_classPrivateFieldGet(oe,this)){tools_classPrivateFieldGet(Jt,this)?.hide();tools_classPrivateFieldSet(oe,this,null);tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSelectedText:!1})}}function _onSelectEnd(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";tools_classPrivateFieldGet(re,this)===p.HIGHLIGHT?this.highlightSelection(t):tools_classPrivateFieldGet($t,this)&&tools_assertClassBrand(Ce,this,_displayHighlightToolbar).call(this)}function _addSelectionListener(){document.addEventListener("selectionchange",tools_classPrivateFieldGet(ye,this))}function _removeSelectionListener(){document.removeEventListener("selectionchange",tools_classPrivateFieldGet(ye,this))}function _addFocusManager(){window.addEventListener("focus",tools_classPrivateFieldGet(de,this));window.addEventListener("blur",tools_classPrivateFieldGet(he,this))}function _removeFocusManager(){window.removeEventListener("focus",tools_classPrivateFieldGet(de,this));window.removeEventListener("blur",tools_classPrivateFieldGet(he,this))}function _addKeyboardManager(){window.addEventListener("keydown",tools_classPrivateFieldGet(fe,this));window.addEventListener("keyup",tools_classPrivateFieldGet(ge,this))}function _removeKeyboardManager(){window.removeEventListener("keydown",tools_classPrivateFieldGet(fe,this));window.removeEventListener("keyup",tools_classPrivateFieldGet(ge,this))}function _addCopyPasteListeners(){document.addEventListener("copy",tools_classPrivateFieldGet(ue,this));document.addEventListener("cut",tools_classPrivateFieldGet(pe,this));document.addEventListener("paste",tools_classPrivateFieldGet(_e,this))}function _removeCopyPasteListeners(){document.removeEventListener("copy",tools_classPrivateFieldGet(ue,this));document.removeEventListener("cut",tools_classPrivateFieldGet(pe,this));document.removeEventListener("paste",tools_classPrivateFieldGet(_e,this))}function _dispatchUpdateStates(t){if(Object.entries(t).some((t=>{let[e,i]=t;return tools_classPrivateFieldGet(be,this)[e]!==i}))){this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(tools_classPrivateFieldGet(be,this),t)});tools_classPrivateFieldGet(re,this)===p.HIGHLIGHT&&!1===t.hasSelectedEditor&&tools_assertClassBrand(Ce,this,_dispatchUpdateUI).call(this,[[_.HIGHLIGHT_FREE,!0]])}}function _dispatchUpdateUI(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}function _enableAll(){if(!tools_classPrivateFieldGet(te,this)){tools_classPrivateFieldSet(te,this,!0);for(const t of tools_classPrivateFieldGet(Ot,this).values())t.enable();for(const t of tools_classPrivateFieldGet(Bt,this).values())t.enable()}}function _disableAll(){this.unselectAll();if(tools_classPrivateFieldGet(te,this)){tools_classPrivateFieldSet(te,this,!1);for(const t of tools_classPrivateFieldGet(Ot,this).values())t.disable();for(const t of tools_classPrivateFieldGet(Bt,this).values())t.disable()}}function _addEditorToLayer(t){const e=tools_classPrivateFieldGet(Ot,this).get(t.pageIndex);if(e)e.addOrRebuild(t);else{this.addEditor(t);this.addToAnnotationStorage(t)}}function _get_lastSelectedEditor(t){let e=null;for(e of tools_classPrivateFieldGet(ne,t));return e}function _isEmpty(){if(0===tools_classPrivateFieldGet(Bt,this).size)return!0;if(1===tools_classPrivateFieldGet(Bt,this).size)for(const t of tools_classPrivateFieldGet(Bt,this).values())return t.isEmpty();return!1}function _selectEditors(t){for(const t of tools_classPrivateFieldGet(ne,this))t.unselect();tools_classPrivateFieldGet(ne,this).clear();for(const e of t)if(!e.isEmpty()){tools_classPrivateFieldGet(ne,this).add(e);e.select()}tools_assertClassBrand(Ce,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:this.hasSelection})}tools_defineProperty(AnnotationEditorUIManager,"TRANSLATE_SMALL",1);tools_defineProperty(AnnotationEditorUIManager,"TRANSLATE_BIG",10);function alt_text_classPrivateFieldInitSpec(t,e,i){alt_text_checkPrivateRedeclaration(t,e);e.set(t,i)}function alt_text_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function alt_text_classPrivateFieldGet(t,e){return t.get(alt_text_assertClassBrand(t,e))}function alt_text_classPrivateFieldSet(t,e,i){return t.set(alt_text_assertClassBrand(t,e),i),i}function alt_text_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var ke,Ee=new WeakMap,Me=new WeakMap,Ge=new WeakMap,Ie=new WeakMap,Te=new WeakMap,Re=new WeakMap,De=new WeakMap,Le=new WeakSet;class AltText{constructor(t){!function alt_text_classPrivateMethodInitSpec(t,e){alt_text_checkPrivateRedeclaration(t,e);e.add(t)}(this,Le);alt_text_classPrivateFieldInitSpec(this,Ee,"");alt_text_classPrivateFieldInitSpec(this,Me,!1);alt_text_classPrivateFieldInitSpec(this,Ge,null);alt_text_classPrivateFieldInitSpec(this,Ie,null);alt_text_classPrivateFieldInitSpec(this,Te,null);alt_text_classPrivateFieldInitSpec(this,Re,!1);alt_text_classPrivateFieldInitSpec(this,De,null);alt_text_classPrivateFieldSet(De,this,t)}static initialize(t){AltText._l10nPromise||=t}async render(){const t=alt_text_classPrivateFieldSet(Ge,this,document.createElement("button"));t.className="altText";const e=await AltText._l10nPromise.get("pdfjs-editor-alt-text-button-label");t.textContent=e;t.setAttribute("aria-label",e);t.tabIndex="0";t.addEventListener("contextmenu",noContextMenu);t.addEventListener("pointerdown",(t=>t.stopPropagation()));const onClick=t=>{t.preventDefault();alt_text_classPrivateFieldGet(De,this)._uiManager.editAltText(alt_text_classPrivateFieldGet(De,this))};t.addEventListener("click",onClick,{capture:!0});t.addEventListener("keydown",(e=>{if(e.target===t&&"Enter"===e.key){alt_text_classPrivateFieldSet(Re,this,!0);onClick(e)}}));await alt_text_assertClassBrand(Le,this,_setState).call(this);return t}finish(){if(alt_text_classPrivateFieldGet(Ge,this)){alt_text_classPrivateFieldGet(Ge,this).focus({focusVisible:alt_text_classPrivateFieldGet(Re,this)});alt_text_classPrivateFieldSet(Re,this,!1)}}isEmpty(){return!alt_text_classPrivateFieldGet(Ee,this)&&!alt_text_classPrivateFieldGet(Me,this)}get data(){return{altText:alt_text_classPrivateFieldGet(Ee,this),decorative:alt_text_classPrivateFieldGet(Me,this)}}set data(t){let{altText:e,decorative:i}=t;if(alt_text_classPrivateFieldGet(Ee,this)!==e||alt_text_classPrivateFieldGet(Me,this)!==i){alt_text_classPrivateFieldSet(Ee,this,e);alt_text_classPrivateFieldSet(Me,this,i);alt_text_assertClassBrand(Le,this,_setState).call(this)}}toggle(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(alt_text_classPrivateFieldGet(Ge,this)){if(!t&&alt_text_classPrivateFieldGet(Te,this)){clearTimeout(alt_text_classPrivateFieldGet(Te,this));alt_text_classPrivateFieldSet(Te,this,null)}alt_text_classPrivateFieldGet(Ge,this).disabled=!t}}destroy(){alt_text_classPrivateFieldGet(Ge,this)?.remove();alt_text_classPrivateFieldSet(Ge,this,null);alt_text_classPrivateFieldSet(Ie,this,null)}}Dt=AltText;async function _setState(){const t=alt_text_classPrivateFieldGet(Ge,this);if(!t)return;if(!alt_text_classPrivateFieldGet(Ee,this)&&!alt_text_classPrivateFieldGet(Me,this)){t.classList.remove("done");alt_text_classPrivateFieldGet(Ie,this)?.remove();return}t.classList.add("done");Dt._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then((e=>{t.setAttribute("aria-label",e)}));let e=alt_text_classPrivateFieldGet(Ie,this);if(!e){alt_text_classPrivateFieldSet(Ie,this,e=document.createElement("span"));e.className="tooltip";e.setAttribute("role","tooltip");const i=e.id=`alt-text-tooltip-${alt_text_classPrivateFieldGet(De,this).id}`;t.setAttribute("aria-describedby",i);const s=100;t.addEventListener("mouseenter",(()=>{alt_text_classPrivateFieldSet(Te,this,setTimeout((()=>{alt_text_classPrivateFieldSet(Te,this,null);alt_text_classPrivateFieldGet(Ie,this).classList.add("show");alt_text_classPrivateFieldGet(De,this)._reportTelemetry({action:"alt_text_tooltip"})}),s))}));t.addEventListener("mouseleave",(()=>{if(alt_text_classPrivateFieldGet(Te,this)){clearTimeout(alt_text_classPrivateFieldGet(Te,this));alt_text_classPrivateFieldSet(Te,this,null)}alt_text_classPrivateFieldGet(Ie,this)?.classList.remove("show")}))}e.innerText=alt_text_classPrivateFieldGet(Me,this)?await Dt._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):alt_text_classPrivateFieldGet(Ee,this);e.parentNode||t.append(e);const i=alt_text_classPrivateFieldGet(De,this).getImageForAltText();i?.setAttribute("aria-describedby",e.id)}!function alt_text_defineProperty(t,e,i){(e=function alt_text_toPropertyKey(t){var e=function alt_text_toPrimitive(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i;return t}(AltText,"_l10nPromise",null);function editor_defineProperty(t,e,i){(e=function editor_toPropertyKey(t){var e=function editor_toPrimitive(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i;return t}function editor_classPrivateFieldInitSpec(t,e,i){editor_checkPrivateRedeclaration(t,e);e.set(t,i)}function editor_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function editor_classPrivateFieldSet(t,e,i){return t.set(editor_assertClassBrand(t,e),i),i}function editor_classPrivateFieldGet(t,e){return t.get(editor_assertClassBrand(t,e))}function editor_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var Be=new WeakMap,Oe=new WeakMap,Ne=new WeakMap,We=new WeakMap,je=new WeakMap,He=new WeakMap,Ue=new WeakMap,ze=new WeakMap,Ve=new WeakMap,qe=new WeakMap,$e=new WeakMap,Xe=new WeakMap,Ke=new WeakMap,Ye=new WeakMap,Qe=new WeakMap,Je=new WeakMap,Ze=new WeakMap,ti=new WeakMap,ei=new WeakMap,ii=new WeakMap,si=new WeakSet;class AnnotationEditor{static get _resizerKeyboardManager(){const t=AnnotationEditor.prototype._resizeWithKeyboard,e=AnnotationEditorUIManager.TRANSLATE_SMALL,i=AnnotationEditorUIManager.TRANSLATE_BIG;return shadow(this,"_resizerKeyboardManager",new KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],AnnotationEditor.prototype._stopResizingWithKeyboard]]))}constructor(t){!function editor_classPrivateMethodInitSpec(t,e){editor_checkPrivateRedeclaration(t,e);e.add(t)}(this,si);editor_classPrivateFieldInitSpec(this,Be,null);editor_classPrivateFieldInitSpec(this,Oe,null);editor_classPrivateFieldInitSpec(this,Ne,!1);editor_classPrivateFieldInitSpec(this,We,!1);editor_classPrivateFieldInitSpec(this,je,null);editor_classPrivateFieldInitSpec(this,He,null);editor_classPrivateFieldInitSpec(this,Ue,this.focusin.bind(this));editor_classPrivateFieldInitSpec(this,ze,this.focusout.bind(this));editor_classPrivateFieldInitSpec(this,Ve,null);editor_classPrivateFieldInitSpec(this,qe,"");editor_classPrivateFieldInitSpec(this,$e,!1);editor_classPrivateFieldInitSpec(this,Xe,!1);editor_classPrivateFieldInitSpec(this,Ke,!1);editor_classPrivateFieldInitSpec(this,Ye,!1);editor_classPrivateFieldInitSpec(this,Qe,null);editor_classPrivateFieldInitSpec(this,Je,0);editor_classPrivateFieldInitSpec(this,Ze,0);editor_classPrivateFieldInitSpec(this,ti,null);editor_defineProperty(this,"_initialOptions",Object.create(null));editor_defineProperty(this,"_isVisible",!0);editor_defineProperty(this,"_uiManager",null);editor_defineProperty(this,"_focusEventsAllowed",!0);editor_defineProperty(this,"_l10nPromise",null);editor_classPrivateFieldInitSpec(this,ei,!1);editor_classPrivateFieldInitSpec(this,ii,AnnotationEditor._zIndex++);editor_defineProperty(this,"doNotMove",!1);this.constructor===AnnotationEditor&&unreachable("Cannot initialize AnnotationEditor.");this.parent=t.parent;this.id=t.id;this.width=this.height=null;this.pageIndex=t.parent.pageIndex;this.name=t.name;this.div=null;this._uiManager=t.uiManager;this.annotationElementId=null;this._willKeepAspectRatio=!1;this._initialOptions.isCentered=t.isCentered;this._structTreeParentId=null;const{rotation:e,rawDims:{pageWidth:i,pageHeight:s,pageX:a,pageY:r}}=this.parent.viewport;this.rotation=e;this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360;this.pageDimensions=[i,s];this.pageTranslation=[a,r];const[n,o]=this.parentDimensions;this.x=t.x/n;this.y=t.y/o;this.isAttachedToDOM=!1;this.deleted=!1;this.eventBus=t.eventBus}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return shadow(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new FakeEditor({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId;e.deleted=!0;e._uiManager.addToAnnotationStorage(e)}static initialize(t,e,i){AnnotationEditor._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map((e=>[e,t.get(e.replaceAll(/([A-Z])/g,(t=>`-${t.toLowerCase()}`)))])));if(i?.strings)for(const e of i.strings)AnnotationEditor._l10nPromise.set(e,t.get(e));if(-1!==AnnotationEditor._borderLineWidth)return;const s=getComputedStyle(document.documentElement);AnnotationEditor._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){unreachable("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return editor_classPrivateFieldGet(ei,this)}set _isDraggable(t){editor_classPrivateFieldSet(ei,this,t);this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(2*t);this.y+=this.width*t/(2*e);break;case 180:this.x+=this.width/2;this.y+=this.height/2;break;case 270:this.x+=this.height*e/(2*t);this.y-=this.width*t/(2*e);break;default:this.x-=this.width/2;this.y-=this.height/2}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=editor_classPrivateFieldGet(ii,this)}setParent(t){if(null!==t){this.pageIndex=t.pageIndex;this.pageDimensions=t.pageDimensions}else editor_assertClassBrand(si,this,_stopResizing).call(this);this.parent=t}focusin(t){this._focusEventsAllowed&&(editor_classPrivateFieldGet($e,this)?editor_classPrivateFieldSet($e,this,!1):this.parent.setSelected(this))}focusout(t){if(!this._focusEventsAllowed)return;if(!this.isAttachedToDOM)return;const e=t.relatedTarget;if(!e?.closest(`#${this.id}`)){t.preventDefault();this.parent?.isMultipleSelection||this.commitOrRemove()}}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage();this._eventBus?.dispatch("annotation-editor-event",{source:this,type:"commit",page:this.pageIndex+1,editorType:this.constructor.name,value:this})}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,s){const[a,r]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s);this.doNotMove&&([i,s]=[0,0]);this.x=(t+i)/a;this.y=(e+s)/r;this.fixAndSetPosition()}translate(t,e){editor_assertClassBrand(si,this,_translate).call(this,this.parentDimensions,t,e)}translateInPage(t,e){editor_assertClassBrand(si,this,_translate).call(this,this.pageDimensions,t,e);this.div.scrollIntoView({block:"nearest"})}drag(t,e){const[i,s]=this.parentDimensions;this.x+=t/i;this.y+=e/s;if(this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:t,y:e}=this.div.getBoundingClientRect();if(this.parent.findNewParent(this,t,e)){this.x-=Math.floor(this.x);this.y-=Math.floor(this.y)}}let{x:a,y:r}=this;const[n,o]=this.getBaseTranslation();a+=n;r+=o;this.div.style.left=`${(100*a).toFixed(2)}%`;this.div.style.top=`${(100*r).toFixed(2)}%`;this.div.scrollIntoView({block:"nearest"})}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:i}=AnnotationEditor,s=i/t,a=i/e;switch(this.rotation){case 90:return[-s,a];case 180:return[s,a];case 270:return[s,-a];default:return[-s,-a]}}get _mustFixPosition(){return!0}fixAndSetPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rotation;const[e,i]=this.pageDimensions;let{x:s,y:a,width:r,height:n}=this;r*=e;n*=i;s*=e;a*=i;if(this._mustFixPosition)switch(t){case 0:s=Math.max(0,Math.min(e-r,s));a=Math.max(0,Math.min(i-n,a));break;case 90:s=Math.max(0,Math.min(e-n,s));a=Math.min(i,Math.max(r,a));break;case 180:s=Math.min(e,Math.max(r,s));a=Math.min(i,Math.max(n,a));break;case 270:s=Math.min(e,Math.max(n,s));a=Math.max(0,Math.min(i-r,a))}this.x=s/=e;this.y=a/=i;const[o,l]=this.getBaseTranslation();s+=o;a+=l;const{style:c}=this.div;c.left=`${(100*s).toFixed(2)}%`;c.top=`${(100*a).toFixed(2)}%`;this.moveInDOM()}screenToPageTranslation(t,e){return _rotatePoint.call(AnnotationEditor,t,e,this.parentRotation)}pageTranslationToScreen(t,e){return _rotatePoint.call(AnnotationEditor,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,i]}=this,s=e*t,a=i*t;return util_FeatureTest.isCSSRoundSupported?[Math.round(s),Math.round(a)]:[s,a]}setDims(t,e){const[i,s]=this.parentDimensions;this.div.style.width=`${(100*t/i).toFixed(2)}%`;editor_classPrivateFieldGet(We,this)||(this.div.style.height=`${(100*e/s).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:i}=t,s=i.endsWith("%"),a=!editor_classPrivateFieldGet(We,this)&&e.endsWith("%");if(s&&a)return;const[r,n]=this.parentDimensions;s||(t.width=`${(100*parseFloat(i)/r).toFixed(2)}%`);editor_classPrivateFieldGet(We,this)||a||(t.height=`${(100*parseFloat(e)/n).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}altTextFinish(){editor_classPrivateFieldGet(Oe,this)?.finish();this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"altTextChanged",page:this.pageIndex+1,editorType:this.constructor.name,value:editor_classPrivateFieldGet(Oe,this)})}async addEditToolbar(){if(editor_classPrivateFieldGet(Ve,this)||editor_classPrivateFieldGet(Ke,this))return editor_classPrivateFieldGet(Ve,this);editor_classPrivateFieldSet(Ve,this,new EditorToolbar(this));this.div.append(editor_classPrivateFieldGet(Ve,this).render());editor_classPrivateFieldGet(Oe,this)&&editor_classPrivateFieldGet(Ve,this).addAltTextButton(await editor_classPrivateFieldGet(Oe,this).render());return editor_classPrivateFieldGet(Ve,this)}removeEditToolbar(){if(editor_classPrivateFieldGet(Ve,this)){editor_classPrivateFieldGet(Ve,this).remove();editor_classPrivateFieldSet(Ve,this,null);editor_classPrivateFieldGet(Oe,this)?.destroy()}}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){if(!editor_classPrivateFieldGet(Oe,this)){AltText.initialize(AnnotationEditor._l10nPromise);editor_classPrivateFieldSet(Oe,this,new AltText(this));await this.addEditToolbar()}}get altTextData(){return editor_classPrivateFieldGet(Oe,this)?.data}set altTextData(t){editor_classPrivateFieldGet(Oe,this)&&(editor_classPrivateFieldGet(Oe,this).data=t)}hasAltText(){return!editor_classPrivateFieldGet(Oe,this)?.isEmpty()}render(){this.div=document.createElement("div");this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360);this.div.className=this.name;this.div.setAttribute("id",this.id);this.div.tabIndex=editor_classPrivateFieldGet(Ne,this)?-1:0;this._isVisible||this.div.classList.add("hidden");this.setInForeground();this.div.addEventListener("focusin",editor_classPrivateFieldGet(Ue,this));this.div.addEventListener("focusout",editor_classPrivateFieldGet(ze,this));const[t,e]=this.parentDimensions;if(this.parentRotation%180!=0){this.div.style.maxWidth=`${(100*e/t).toFixed(2)}%`;this.div.style.maxHeight=`${(100*t/e).toFixed(2)}%`}const[i,s]=this.getInitialTranslation();this.translate(i,s);bindEvents(this,this.div,["pointerdown"]);return this.div}pointerdown(t){const{isMac:e}=util_FeatureTest.platform;if(0!==t.button||t.ctrlKey&&e)t.preventDefault();else{editor_classPrivateFieldSet($e,this,!0);this._isDraggable?editor_assertClassBrand(si,this,_setUpDragSession).call(this,t):editor_assertClassBrand(si,this,_selectOnPointerEvent).call(this,t)}}moveInDOM(){editor_classPrivateFieldGet(Qe,this)&&clearTimeout(editor_classPrivateFieldGet(Qe,this));editor_classPrivateFieldSet(Qe,this,setTimeout((()=>{editor_classPrivateFieldSet(Qe,this,null);this.parent?.moveEditorInDOM(this)}),0))}_setParentAndPosition(t,e,i){t.changeParent(this);this.x=e;this.y=i;this.fixAndSetPosition()}getRect(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.rotation;const s=this.parentScale,[a,r]=this.pageDimensions,[n,o]=this.pageTranslation,l=t/s,c=e/s,h=this.x*a,d=this.y*r,u=this.width*a,p=this.height*r;switch(i){case 0:return[h+l+n,r-d-c-p+o,h+l+u+n,r-d-c+o];case 90:return[h+c+n,r-d+l+o,h+c+p+n,r-d+l+u+o];case 180:return[h-l-u+n,r-d+c+o,h-l+n,r-d+c+p+o];case 270:return[h-c-p+n,r-d-l-u+o,h-c+n,r-d-l+o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[i,s,a,r]=t,n=a-i,o=r-s;switch(this.rotation){case 0:return[i,e-r,n,o];case 90:return[i,e-s,o,n];case 180:return[a,e-s,n,o];case 270:return[a,e-r,o,n];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){editor_classPrivateFieldSet(Ke,this,!0)}disableEditMode(){editor_classPrivateFieldSet(Ke,this,!1)}isInEditMode(){return editor_classPrivateFieldGet(Ke,this)}shouldGetKeyboardEvents(){return editor_classPrivateFieldGet(Ye,this)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",editor_classPrivateFieldGet(Ue,this));this.div?.addEventListener("focusout",editor_classPrivateFieldGet(ze,this))}rotate(t){}serialize(){unreachable("An editor must be serializable")}static deserialize(t,e,i){const s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i});s.rotation=t.rotation;const[a,r]=s.pageDimensions,[n,o,l,c]=s.getRectInCurrentCoords(t.rect,r);s.x=n/a;s.y=o/r;s.width=l/a;s.height=c/r;return s}remove(){this.div.removeEventListener("focusin",editor_classPrivateFieldGet(Ue,this));this.div.removeEventListener("focusout",editor_classPrivateFieldGet(ze,this));this.isEmpty()||this.commit();this.parent?this.parent.remove(this):this._uiManager.removeEditor(this);if(editor_classPrivateFieldGet(Qe,this)){clearTimeout(editor_classPrivateFieldGet(Qe,this));editor_classPrivateFieldSet(Qe,this,null)}editor_assertClassBrand(si,this,_stopResizing).call(this);this.removeEditToolbar();if(editor_classPrivateFieldGet(ti,this)){for(const t of editor_classPrivateFieldGet(ti,this).values())clearTimeout(t);editor_classPrivateFieldSet(ti,this,null)}this.parent=null;this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"removed",page:this.pageIndex+1,editorType:this.constructor.name,value:this})}get isResizable(){return!1}makeResizable(){if(this.isResizable){editor_assertClassBrand(si,this,_createResizers).call(this);editor_classPrivateFieldGet(je,this).classList.remove("hidden");bindEvents(this,this.div,["keydown"])}}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||"Enter"!==t.key)return;this._uiManager.setSelected(this);editor_classPrivateFieldSet(He,this,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const e=editor_classPrivateFieldGet(je,this).children;if(!editor_classPrivateFieldGet(Be,this)){editor_classPrivateFieldSet(Be,this,Array.from(e));const t=editor_assertClassBrand(si,this,_resizerKeydown).bind(this),i=editor_assertClassBrand(si,this,_resizerBlur).bind(this);for(const e of editor_classPrivateFieldGet(Be,this)){const s=e.getAttribute("data-resizer-name");e.setAttribute("role","spinbutton");e.addEventListener("keydown",t);e.addEventListener("blur",i);e.addEventListener("focus",editor_assertClassBrand(si,this,_resizerFocus).bind(this,s));AnnotationEditor._l10nPromise.get(`pdfjs-editor-resizer-label-${s}`).then((t=>e.setAttribute("aria-label",t)))}}const i=editor_classPrivateFieldGet(Be,this)[0];let s=0;for(const t of e){if(t===i)break;s++}const a=(360-this.rotation+this.parentRotation)%360/90*(editor_classPrivateFieldGet(Be,this).length/4);if(a!==s){if(a<s)for(let t=0;t<s-a;t++)editor_classPrivateFieldGet(je,this).append(editor_classPrivateFieldGet(je,this).firstChild);else if(a>s)for(let t=0;t<a-s;t++)editor_classPrivateFieldGet(je,this).firstChild.before(editor_classPrivateFieldGet(je,this).lastChild);let t=0;for(const i of e){const e=editor_classPrivateFieldGet(Be,this)[t++].getAttribute("data-resizer-name");AnnotationEditor._l10nPromise.get(`pdfjs-editor-resizer-label-${e}`).then((t=>i.setAttribute("aria-label",t)))}}editor_assertClassBrand(si,this,_setResizerTabIndex).call(this,0);editor_classPrivateFieldSet(Ye,this,!0);editor_classPrivateFieldGet(je,this).firstChild.focus({focusVisible:!0});t.preventDefault();t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){editor_classPrivateFieldGet(Ye,this)&&editor_assertClassBrand(si,this,_resizerPointermove).call(this,editor_classPrivateFieldGet(qe,this),{movementX:t,movementY:e})}_stopResizingWithKeyboard(){editor_assertClassBrand(si,this,_stopResizing).call(this);this.div.focus()}select(){this.makeResizable();this.div?.classList.add("selectedEditor");editor_classPrivateFieldGet(Ve,this)?editor_classPrivateFieldGet(Ve,this)?.show():this.addEditToolbar().then((()=>{this.div?.classList.contains("selectedEditor")&&editor_classPrivateFieldGet(Ve,this)?.show()}))}unselect(){editor_classPrivateFieldGet(je,this)?.classList.add("hidden");this.div?.classList.remove("selectedEditor");this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0});editor_classPrivateFieldGet(Ve,this)?.hide()}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return editor_classPrivateFieldGet(Xe,this)}set isEditing(t){editor_classPrivateFieldSet(Xe,this,t);if(this.parent)if(t){this.parent.setSelected(this);this.parent.setActiveEditor(this)}else this.parent.setActiveEditor(null)}setAspectRatio(t,e){editor_classPrivateFieldSet(We,this,!0);const i=t/e,{style:s}=this.div;s.aspectRatio=i;s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){editor_classPrivateFieldGet(ti,this)||editor_classPrivateFieldSet(ti,this,new Map);const{action:e}=t;let i=editor_classPrivateFieldGet(ti,this).get(e);i&&clearTimeout(i);i=setTimeout((()=>{this._reportTelemetry(t);editor_classPrivateFieldGet(ti,this).delete(e);0===editor_classPrivateFieldGet(ti,this).size&&editor_classPrivateFieldSet(ti,this,null)}),AnnotationEditor._telemetryTimeout);editor_classPrivateFieldGet(ti,this).set(e,i)}else{t.type||=this.editorType;this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}}show(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;this.div.classList.toggle("hidden",!t);this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0);editor_classPrivateFieldSet(Ne,this,!1)}disable(){this.div&&(this.div.tabIndex=-1);editor_classPrivateFieldSet(Ne,this,!0)}}ke=AnnotationEditor;function _translate(t,e,i){let[s,a]=t;[e,i]=this.screenToPageTranslation(e,i);this.x+=e/s;this.y+=i/a;this.fixAndSetPosition()}function _rotatePoint(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}function _getRotationMatrix(t){switch(t){case 90:{const[t,e]=this.pageDimensions;return[0,-t/e,e/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,e]=this.pageDimensions;return[0,t/e,-e/t,0]}default:return[1,0,0,1]}}function _createResizers(){if(editor_classPrivateFieldGet(je,this))return;editor_classPrivateFieldSet(je,this,document.createElement("div"));editor_classPrivateFieldGet(je,this).classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];for(const e of t){const t=document.createElement("div");editor_classPrivateFieldGet(je,this).append(t);t.classList.add("resizer",e);t.setAttribute("data-resizer-name",e);t.addEventListener("pointerdown",editor_assertClassBrand(si,this,_resizerPointerdown).bind(this,e));t.addEventListener("contextmenu",noContextMenu);t.tabIndex=-1}this.div.prepend(editor_classPrivateFieldGet(je,this))}function _resizerPointerdown(t,e){e.preventDefault();const{isMac:i}=util_FeatureTest.platform;if(0!==e.button||e.ctrlKey&&i)return;editor_classPrivateFieldGet(Oe,this)?.toggle(!1);const s=editor_assertClassBrand(si,this,_resizerPointermove).bind(this,t),a=this._isDraggable;this._isDraggable=!1;const r={passive:!0,capture:!0};this.parent.togglePointerEvents(!1);window.addEventListener("pointermove",s,r);const n=this.x,o=this.y,l=this.width,c=this.height,h=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const pointerUpCallback=()=>{this.parent.togglePointerEvents(!0);editor_classPrivateFieldGet(Oe,this)?.toggle(!0);this._isDraggable=a;window.removeEventListener("pointerup",pointerUpCallback);window.removeEventListener("blur",pointerUpCallback);window.removeEventListener("pointermove",s,r);this.parent.div.style.cursor=h;this.div.style.cursor=d;editor_assertClassBrand(si,this,_addResizeToUndoStack).call(this,n,o,l,c)};window.addEventListener("pointerup",pointerUpCallback);window.addEventListener("blur",pointerUpCallback)}function _addResizeToUndoStack(t,e,i,s){const a=this.x,r=this.y,n=this.width,o=this.height;if(a!==t||r!==e||n!==i||o!==s){this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"sizeChanged",editorType:this.constructor.name,page:this.pageIndex+1,value:{x:t,y:e,width:i,height:s}});this.addCommands({cmd:()=>{this.width=n;this.height=o;this.x=a;this.y=r;const[t,e]=this.parentDimensions;this.setDims(t*n,e*o);this.fixAndSetPosition()},undo:()=>{this.width=i;this.height=s;this.x=t;this.y=e;const[a,r]=this.parentDimensions;this.setDims(a*i,r*s);this.fixAndSetPosition()},mustExec:!0})}}function _resizerPointermove(t,e){const[i,s]=this.parentDimensions,a=this.x,r=this.y,n=this.width,o=this.height,l=ke.MIN_SIZE/i,c=ke.MIN_SIZE/s,round=t=>Math.round(1e4*t)/1e4,h=editor_assertClassBrand(si,this,_getRotationMatrix).call(this,this.rotation),transf=(t,e)=>[h[0]*t+h[2]*e,h[1]*t+h[3]*e],d=editor_assertClassBrand(si,this,_getRotationMatrix).call(this,360-this.rotation);let u,p,_=!1,f=!1;switch(t){case"topLeft":_=!0;u=(t,e)=>[0,0];p=(t,e)=>[t,e];break;case"topMiddle":u=(t,e)=>[t/2,0];p=(t,e)=>[t/2,e];break;case"topRight":_=!0;u=(t,e)=>[t,0];p=(t,e)=>[0,e];break;case"middleRight":f=!0;u=(t,e)=>[t,e/2];p=(t,e)=>[0,e/2];break;case"bottomRight":_=!0;u=(t,e)=>[t,e];p=(t,e)=>[0,0];break;case"bottomMiddle":u=(t,e)=>[t/2,e];p=(t,e)=>[t/2,0];break;case"bottomLeft":_=!0;u=(t,e)=>[0,e];p=(t,e)=>[t,0];break;case"middleLeft":f=!0;u=(t,e)=>[0,e/2];p=(t,e)=>[t,e/2]}const g=u(n,o),v=p(n,o);let m=transf(...v);const P=round(a+m[0]),y=round(r+m[1]);let b=1,w=1,[A,S]=this.screenToPageTranslation(e.movementX,e.movementY);[A,S]=(x=A/i,C=S/s,[d[0]*x+d[2]*C,d[1]*x+d[3]*C]);var x,C;if(_){const t=Math.hypot(n,o);b=w=Math.max(Math.min(Math.hypot(v[0]-g[0]-A,v[1]-g[1]-S)/t,1/n,1/o),l/n,c/o)}else f?b=Math.max(l,Math.min(1,Math.abs(v[0]-g[0]-A)))/n:w=Math.max(c,Math.min(1,Math.abs(v[1]-g[1]-S)))/o;const k=round(n*b),E=round(o*w);m=transf(...p(k,E));const M=P-m[0],G=y-m[1];this.width=k;this.height=E;this.x=M;this.y=G;this.setDims(i*k,s*E);this.fixAndSetPosition()}function _selectOnPointerEvent(t){const{isMac:e}=util_FeatureTest.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}function _setUpDragSession(t){const e=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let i,s;if(e){this.div.classList.add("moving");i={passive:!0,capture:!0};editor_classPrivateFieldSet(Je,this,t.clientX);editor_classPrivateFieldSet(Ze,this,t.clientY);s=t=>{const{clientX:e,clientY:i}=t,[s,a]=this.screenToPageTranslation(e-editor_classPrivateFieldGet(Je,this),i-editor_classPrivateFieldGet(Ze,this));editor_classPrivateFieldSet(Je,this,e);editor_classPrivateFieldSet(Ze,this,i);this._uiManager.dragSelectedEditors(s,a)};window.addEventListener("pointermove",s,i)}const pointerUpCallback=()=>{window.removeEventListener("pointerup",pointerUpCallback);window.removeEventListener("blur",pointerUpCallback);if(e){this.div.classList.remove("moving");window.removeEventListener("pointermove",s,i)}editor_classPrivateFieldSet($e,this,!1);this._uiManager.endDragSession()||editor_assertClassBrand(si,this,_selectOnPointerEvent).call(this,t)};window.addEventListener("pointerup",pointerUpCallback);window.addEventListener("blur",pointerUpCallback)}function _resizerKeydown(t){ke._resizerKeyboardManager.exec(this,t)}function _resizerBlur(t){editor_classPrivateFieldGet(Ye,this)&&t.relatedTarget?.parentNode!==editor_classPrivateFieldGet(je,this)&&editor_assertClassBrand(si,this,_stopResizing).call(this)}function _resizerFocus(t){editor_classPrivateFieldSet(qe,this,editor_classPrivateFieldGet(Ye,this)?t:"")}function _setResizerTabIndex(t){if(editor_classPrivateFieldGet(Be,this))for(const e of editor_classPrivateFieldGet(Be,this))e.tabIndex=t}function _stopResizing(){editor_classPrivateFieldSet(Ye,this,!1);editor_assertClassBrand(si,this,_setResizerTabIndex).call(this,-1);if(editor_classPrivateFieldGet(He,this)){const{savedX:t,savedY:e,savedWidth:i,savedHeight:s}=editor_classPrivateFieldGet(He,this);editor_assertClassBrand(si,this,_addResizeToUndoStack).call(this,t,e,i,s);editor_classPrivateFieldSet(He,this,null)}}editor_defineProperty(AnnotationEditor,"_borderLineWidth",-1);editor_defineProperty(AnnotationEditor,"_colorManager",new ColorManager);editor_defineProperty(AnnotationEditor,"_zIndex",1);editor_defineProperty(AnnotationEditor,"_telemetryTimeout",1e3);class FakeEditor extends AnnotationEditor{constructor(t){super(t);this.annotationElementId=t.annotationElementId;this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}const ai=3285377520,ri=4294901760,ni=65535;class MurmurHash3_64{constructor(t){this.h1=t?4294967295&t:ai;this.h2=t?4294967295&t:ai}update(t){let e,i;if("string"==typeof t){e=new Uint8Array(2*t.length);i=0;for(let s=0,a=t.length;s<a;s++){const a=t.charCodeAt(s);if(a<=255)e[i++]=a;else{e[i++]=a>>>8;e[i++]=255&a}}}else{if(!ArrayBuffer.isView(t))throw new Error("Invalid data format, must be a string or TypedArray.");e=t.slice();i=e.byteLength}const s=i>>2,a=i-4*s,r=new Uint32Array(e.buffer,0,s);let n=0,o=0,l=this.h1,c=this.h2;const h=3432918353,d=461845907,u=11601,p=13715;for(let t=0;t<s;t++)if(1&t){n=r[t];n=n*h&ri|n*u&ni;n=n<<15|n>>>17;n=n*d&ri|n*p&ni;l^=n;l=l<<13|l>>>19;l=5*l+3864292196}else{o=r[t];o=o*h&ri|o*u&ni;o=o<<15|o>>>17;o=o*d&ri|o*p&ni;c^=o;c=c<<13|c>>>19;c=5*c+3864292196}n=0;switch(a){case 3:n^=e[4*s+2]<<16;case 2:n^=e[4*s+1]<<8;case 1:n^=e[4*s];n=n*h&ri|n*u&ni;n=n<<15|n>>>17;n=n*d&ri|n*p&ni;1&s?l^=n:c^=n}this.h1=l;this.h2=c}hexdigest(){let t=this.h1,e=this.h2;t^=e>>>1;t=3981806797*t&ri|36045*t&ni;e=4283543511*e&ri|(2950163797*(e<<16|t>>>16)&ri)>>>16;t^=e>>>1;t=444984403*t&ri|60499*t&ni;e=3301882366*e&ri|(3120437893*(e<<16|t>>>16)&ri)>>>16;t^=e>>>1;return(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}function annotation_storage_classPrivateFieldInitSpec(t,e,i){annotation_storage_checkPrivateRedeclaration(t,e);e.set(t,i)}function annotation_storage_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function annotation_storage_classPrivateFieldSet(t,e,i){return t.set(annotation_storage_assertClassBrand(t,e),i),i}function annotation_storage_classPrivateFieldGet(t,e){return t.get(annotation_storage_assertClassBrand(t,e))}function annotation_storage_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}const oi=Object.freeze({map:null,hash:"",transfer:void 0});var li=new WeakMap,ci=new WeakMap,hi=new WeakSet;class AnnotationStorage{constructor(){!function annotation_storage_classPrivateMethodInitSpec(t,e){annotation_storage_checkPrivateRedeclaration(t,e);e.add(t)}(this,hi);annotation_storage_classPrivateFieldInitSpec(this,li,!1);annotation_storage_classPrivateFieldInitSpec(this,ci,new Map);this.onSetModified=null;this.onResetModified=null;this.onAnnotationEditor=null}getValue(t,e){const i=annotation_storage_classPrivateFieldGet(ci,this).get(t);return void 0===i?e:Object.assign(e,i)}getRawValue(t){return annotation_storage_classPrivateFieldGet(ci,this).get(t)}remove(t){annotation_storage_classPrivateFieldGet(ci,this).delete(t);0===annotation_storage_classPrivateFieldGet(ci,this).size&&this.resetModified();if("function"==typeof this.onAnnotationEditor){for(const t of annotation_storage_classPrivateFieldGet(ci,this).values())if(t instanceof AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(t,e){const i=annotation_storage_classPrivateFieldGet(ci,this).get(t);let s=!1;if(void 0!==i){for(const[t,a]of Object.entries(e))if(i[t]!==a){s=!0;i[t]=a}}else{s=!0;annotation_storage_classPrivateFieldGet(ci,this).set(t,e)}s&&annotation_storage_assertClassBrand(hi,this,_setModified).call(this);e instanceof AnnotationEditor&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(e.constructor._type)}has(t){return annotation_storage_classPrivateFieldGet(ci,this).has(t)}getAll(){return annotation_storage_classPrivateFieldGet(ci,this).size>0?objectFromMap(annotation_storage_classPrivateFieldGet(ci,this)):null}setAll(t){for(const[e,i]of Object.entries(t))this.setValue(e,i)}get size(){return annotation_storage_classPrivateFieldGet(ci,this).size}resetModified(){if(annotation_storage_classPrivateFieldGet(li,this)){annotation_storage_classPrivateFieldSet(li,this,!1);"function"==typeof this.onResetModified&&this.onResetModified()}}get print(){return new PrintAnnotationStorage(this)}get serializable(){if(0===annotation_storage_classPrivateFieldGet(ci,this).size)return oi;const t=new Map,e=new MurmurHash3_64,i=[],s=Object.create(null);let a=!1;for(const[i,r]of annotation_storage_classPrivateFieldGet(ci,this)){const n=r instanceof AnnotationEditor?r.serialize(!1,s):r;if(n){t.set(i,n);e.update(`${i}:${JSON.stringify(n)}`);a||=!!n.bitmap}}if(a)for(const e of t.values())e.bitmap&&i.push(e.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:i}:oi}get editorStats(){let t=null;const e=new Map;for(const i of annotation_storage_classPrivateFieldGet(ci,this).values()){if(!(i instanceof AnnotationEditor))continue;const s=i.telemetryFinalData;if(!s)continue;const{type:a}=s;e.has(a)||e.set(a,Object.getPrototypeOf(i).constructor);t||=Object.create(null);const r=t[a]||=new Map;for(const[t,e]of Object.entries(s)){if("type"===t)continue;let i=r.get(t);if(!i){i=new Map;r.set(t,i)}const s=i.get(e)??0;i.set(e,s+1)}}for(const[i,s]of e)t[i]=s.computeTelemetryFinalData(t[i]);return t}}function _setModified(){if(!annotation_storage_classPrivateFieldGet(li,this)){annotation_storage_classPrivateFieldSet(li,this,!0);"function"==typeof this.onSetModified&&this.onSetModified()}}var di=new WeakMap;class PrintAnnotationStorage extends AnnotationStorage{constructor(t){super();annotation_storage_classPrivateFieldInitSpec(this,di,void 0);const{map:e,hash:i,transfer:s}=t.serializable,a=structuredClone(e,s?{transfer:s}:null);annotation_storage_classPrivateFieldSet(di,this,{map:a,hash:i,transfer:s})}get print(){unreachable("Should not call PrintAnnotationStorage.print")}get serializable(){return annotation_storage_classPrivateFieldGet(di,this)}}function font_loader_classPrivateFieldInitSpec(t,e,i){!function font_loader_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e);e.set(t,i)}function font_loader_classPrivateFieldGet(t,e){return t.get(function font_loader_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}(t,e))}var ui=new WeakMap;class FontLoader{constructor(t){let{ownerDocument:e=globalThis.document,styleElement:i=null}=t;font_loader_classPrivateFieldInitSpec(this,ui,new Set);this._document=e;this.nativeFontFaces=new Set;this.styleElement=null;this.loadingRequests=[];this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t);this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t);this._document.fonts.delete(t)}insertRule(t){if(!this.styleElement){this.styleElement=this._document.createElement("style");this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement)}const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear();font_loader_classPrivateFieldGet(ui,this).clear();if(this.styleElement){this.styleElement.remove();this.styleElement=null}}async loadSystemFont(t){let{systemFontInfo:e,_inspectFont:i}=t;if(e&&!font_loader_classPrivateFieldGet(ui,this).has(e.loadedName)){assert(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set.");if(this.isFontLoadingAPISupported){const{loadedName:t,src:s,style:a}=e,r=new FontFace(t,s,a);this.addNativeFontFace(r);try{await r.load();font_loader_classPrivateFieldGet(ui,this).add(t);i?.(e)}catch{warn(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`);this.removeNativeFontFace(r)}}else unreachable("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;t.attached=!0;if(t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const e=t.createNativeFontFace();if(e){this.addNativeFontFace(e);try{await e.loaded}catch(i){warn(`Failed to load font '${e.family}': '${i}'.`);t.disableFontFace=!0;throw i}}return}const e=t.createFontFaceRule();if(e){this.insertRule(e);if(this.isSyncFontLoadingSupported)return;await new Promise((e=>{const i=this._queueLoadingCallback(e);this._prepareFontLoadEvent(t,i)}))}}get isFontLoadingAPISupported(){return shadow(this,"isFontLoadingAPISupported",!!this._document?.fonts)}get isSyncFontLoadingSupported(){let t=!1;(e||"undefined"!=typeof navigator&&"string"==typeof navigator?.userAgent&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0);return shadow(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){const{loadingRequests:e}=this,i={done:!1,complete:function completeRequest(){assert(!i.done,"completeRequest() cannot be called twice.");i.done=!0;for(;e.length>0&&e[0].done;){const t=e.shift();setTimeout(t.callback,0)}},callback:t};e.push(i);return i}get _loadTestFont(){return shadow(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(t,e){function int32(t,e){return t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|255&t.charCodeAt(e+3)}function spliceString(t,e,i,s){return t.substring(0,e)+s+t.substring(e+i)}let i,s;const a=this._document.createElement("canvas");a.width=1;a.height=1;const r=window.pdfDefaultOptions.activateWillReadFrequentlyFlag?{willReadFrequently:!0}:void 0,n=a.getContext("2d",r);let o=0;const l=`lt${Date.now()}${this.loadTestFontId++}`;let c=this._loadTestFont;c=spliceString(c,976,l.length,l);const h=1482184792;let d=int32(c,16);for(i=0,s=l.length-3;i<s;i+=4)d=d-h+int32(l,i)|0;i<l.length&&(d=d-h+int32(l+"XXX",i)|0);c=spliceString(c,16,4,function string32(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t)}(d));const u=`@font-face {font-family:"${l}";src:${`url(data:font/opentype;base64,${btoa(c)});`}}`;this.insertRule(u);const p=this._document.createElement("div");p.style.visibility="hidden";p.style.width=p.style.height="10px";p.style.position="absolute";p.style.top=p.style.left="0px";for(const e of[t.loadedName,l]){const t=this._document.createElement("span");t.textContent="Hi";t.style.fontFamily=e;p.append(t)}this._document.body.append(p);!function isFontReady(t,e){if(++o>30){warn("Load test font never loaded.");e();return}n.font="30px "+t;n.fillText(".",0,20);n.getImageData(0,0,1,1).data[3]>0?e():setTimeout(isFontReady.bind(null,t,e))}(l,(()=>{p.remove();e.complete()}))}}class FontFaceObject{constructor(t,e){let{isEvalSupported:i=!0,disableFontFace:s=!1,ignoreErrors:a=!1,inspectFont:r=null}=e;this.compiledGlyphs=Object.create(null);for(const e in t)this[e]=t[e];this.isEvalSupported=!1!==i;this.disableFontFace=!0===s;this.ignoreErrors=!0===a;this._inspectFont=r}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(this.cssFontInfo){const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`);t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}else t=new FontFace(this.loadedName,this.data,{});this._inspectFont?.(this);return t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=bytesToString(this.data),e=`url(data:${this.mimetype};base64,${btoa(t)});`;let i;if(this.cssFontInfo){let t=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(t+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`);i=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${t}src:${e}}`}else i=`@font-face {font-family:"${this.loadedName}";src:${e}}`;this._inspectFont?.(this,e);return i}getPathGenerator(t,e){if(void 0!==this.compiledGlyphs[e])return this.compiledGlyphs[e];let i;try{i=t.get(this.loadedName+"_path_"+e)}catch(t){if(!this.ignoreErrors)throw t;warn(`getPathGenerator - ignoring character: "${t}".`);return this.compiledGlyphs[e]=function(t,e){}}if(this.isEvalSupported&&util_FeatureTest.isEvalSupported){const t=[];for(const e of i){const i=void 0!==e.args?e.args.join(","):"";t.push("c.",e.cmd,"(",i,");\n")}return this.compiledGlyphs[e]=new Function("c","size",t.join(""))}return this.compiledGlyphs[e]=function(t,e){for(const s of i){"scale"===s.cmd&&(s.args=[e,-e]);t[s.cmd].apply(t,s.args)}}}}let pi;!function checkDOMMatrix(){if(globalThis.DOMMatrix||!e)return;warn("Cannot polyfill `DOMMatrix`, rendering may be broken.")}();!function checkPath2D(){if(globalThis.Path2D||!e)return;warn("Cannot polyfill `Path2D`, rendering may be broken.")}();const node_utils_fetchData=function(t){return undefined.promises.readFile(t).then((t=>new Uint8Array(t)))};const _i="Fill",fi="Stroke",gi="Shading";function applyBoundingBox(t,e){if(!e)return;const i=e[2]-e[0],s=e[3]-e[1],a=new Path2D;a.rect(e[0],e[1],i,s);t.clip(a)}class BaseShadingPattern{constructor(){this.constructor===BaseShadingPattern&&unreachable("Cannot initialize BaseShadingPattern.")}getPattern(){unreachable("Abstract method `getPattern` called.")}}class RadialAxialShadingPattern extends BaseShadingPattern{constructor(t){super();this._type=t[1];this._bbox=t[2];this._colorStops=t[3];this._p0=t[4];this._p1=t[5];this._r0=t[6];this._r1=t[7];this.matrix=null}_createGradient(t){let e;"axial"===this._type?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const t of this._colorStops)e.addColorStop(t[0],t[1]);return e}getPattern(t,e,i,s){let a;if(s===fi||s===_i){const r=e.current.getClippedPathBoundingBox(s,getCurrentTransform(t))||[0,0,0,0],n=Math.ceil(r[2]-r[0])||1,o=Math.ceil(r[3]-r[1])||1,l=e.cachedCanvases.getCanvas("pattern",n,o,!0),c=l.context;c.clearRect(0,0,c.canvas.width,c.canvas.height);c.beginPath();c.rect(0,0,c.canvas.width,c.canvas.height);c.translate(-r[0],-r[1]);i=Util.transform(i,[1,0,0,1,r[0],r[1]]);c.transform(...e.baseTransform);this.matrix&&c.transform(...this.matrix);applyBoundingBox(c,this._bbox);c.fillStyle=this._createGradient(c);c.fill();a=t.createPattern(l.canvas,"no-repeat");const h=new DOMMatrix(i);a.setTransform(h)}else{applyBoundingBox(t,this._bbox);a=this._createGradient(t)}return a}}function drawTriangle(t,e,i,s,a,r,n,o){const l=e.coords,c=e.colors,h=t.data,d=4*t.width;let u;if(l[i+1]>l[s+1]){u=i;i=s;s=u;u=r;r=n;n=u}if(l[s+1]>l[a+1]){u=s;s=a;a=u;u=n;n=o;o=u}if(l[i+1]>l[s+1]){u=i;i=s;s=u;u=r;r=n;n=u}const p=(l[i]+e.offsetX)*e.scaleX,_=(l[i+1]+e.offsetY)*e.scaleY,f=(l[s]+e.offsetX)*e.scaleX,g=(l[s+1]+e.offsetY)*e.scaleY,v=(l[a]+e.offsetX)*e.scaleX,m=(l[a+1]+e.offsetY)*e.scaleY;if(_>=m)return;const P=c[r],y=c[r+1],b=c[r+2],w=c[n],A=c[n+1],S=c[n+2],x=c[o],C=c[o+1],k=c[o+2],E=Math.round(_),M=Math.round(m);let G,I,T,R,D,L,B,O;for(let t=E;t<=M;t++){if(t<g){const e=t<_?0:(_-t)/(_-g);G=p-(p-f)*e;I=P-(P-w)*e;T=y-(y-A)*e;R=b-(b-S)*e}else{let e;e=t>m?1:g===m?0:(g-t)/(g-m);G=f-(f-v)*e;I=w-(w-x)*e;T=A-(A-C)*e;R=S-(S-k)*e}let e;e=t<_?0:t>m?1:(_-t)/(_-m);D=p-(p-v)*e;L=P-(P-x)*e;B=y-(y-C)*e;O=b-(b-k)*e;const i=Math.round(Math.min(G,D)),s=Math.round(Math.max(G,D));let a=d*t+4*i;for(let t=i;t<=s;t++){e=(G-t)/(G-D);e<0?e=0:e>1&&(e=1);h[a++]=I-(I-L)*e|0;h[a++]=T-(T-B)*e|0;h[a++]=R-(R-O)*e|0;h[a++]=255}}}function drawFigure(t,e,i){const s=e.coords,a=e.colors;let r,n;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(s.length/o)-1,c=o-1;for(r=0;r<l;r++){let e=r*o;for(let r=0;r<c;r++,e++){drawTriangle(t,i,s[e],s[e+1],s[e+o],a[e],a[e+1],a[e+o]);drawTriangle(t,i,s[e+o+1],s[e+1],s[e+o],a[e+o+1],a[e+1],a[e+o])}}break;case"triangles":for(r=0,n=s.length;r<n;r+=3)drawTriangle(t,i,s[r],s[r+1],s[r+2],a[r],a[r+1],a[r+2]);break;default:throw new Error("illegal figure")}}class MeshShadingPattern extends BaseShadingPattern{constructor(t){super();this._coords=t[2];this._colors=t[3];this._figures=t[4];this._bounds=t[5];this._bbox=t[7];this._background=t[8];this.matrix=null}_createMeshCanvas(t,e,i){const s=Math.floor(this._bounds[0]),a=Math.floor(this._bounds[1]),r=Math.ceil(this._bounds[2])-s,n=Math.ceil(this._bounds[3])-a,o=Math.min(Math.ceil(Math.abs(r*t[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(n*t[1]*1.1)),3e3),c=r/o,h=n/l,d={coords:this._coords,colors:this._colors,offsetX:-s,offsetY:-a,scaleX:1/c,scaleY:1/h},u=o+4,p=l+4,_=i.getCanvas("mesh",u,p,!1),f=_.context,g=f.createImageData(o,l);if(e){const t=g.data;for(let i=0,s=t.length;i<s;i+=4){t[i]=e[0];t[i+1]=e[1];t[i+2]=e[2];t[i+3]=255}}for(const t of this._figures)drawFigure(g,t,d);f.putImageData(g,2,2);return{canvas:_.canvas,offsetX:s-2*c,offsetY:a-2*h,scaleX:c,scaleY:h}}getPattern(t,e,i,s){applyBoundingBox(t,this._bbox);let a;if(s===gi)a=Util.singularValueDecompose2dScale(getCurrentTransform(t));else{a=Util.singularValueDecompose2dScale(e.baseTransform);if(this.matrix){const t=Util.singularValueDecompose2dScale(this.matrix);a=[a[0]*t[0],a[1]*t[1]]}}const r=this._createMeshCanvas(a,s===gi?null:this._background,e.cachedCanvases);if(s!==gi){t.setTransform(...e.baseTransform);this.matrix&&t.transform(...this.matrix)}t.translate(r.offsetX,r.offsetY);t.scale(r.scaleX,r.scaleY);return t.createPattern(r.canvas,"no-repeat")}}class DummyShadingPattern extends BaseShadingPattern{getPattern(){return"hotpink"}}const vi=1,mi=2;class TilingPattern{constructor(t,e,i,s,a){this.operatorList=t[2];this.matrix=t[3]||[1,0,0,1,0,0];this.bbox=t[4];this.xstep=t[5];this.ystep=t[6];this.paintType=t[7];this.tilingType=t[8];this.color=e;this.ctx=i;this.canvasGraphicsFactory=s;this.baseTransform=a}createPatternCanvas(t){const e=this.operatorList,i=this.bbox,s=this.xstep,a=this.ystep,r=this.paintType,n=this.tilingType,o=this.color,l=this.canvasGraphicsFactory;info("TilingType: "+n);const c=i[0],h=i[1],d=i[2],u=i[3],p=Util.singularValueDecompose2dScale(this.matrix),_=Util.singularValueDecompose2dScale(this.baseTransform),f=[p[0]*_[0],p[1]*_[1]],g=this.getSizeAndScale(s,this.ctx.canvas.width,f[0]),v=this.getSizeAndScale(a,this.ctx.canvas.height,f[1]),m=t.cachedCanvases.getCanvas("pattern",g.size,v.size,!0),P=m.context,y=l.createCanvasGraphics(P);y.groupLevel=t.groupLevel;this.setFillAndStrokeStyleToContext(y,r,o);let b=c,w=h,A=d,S=u;if(c<0){b=0;A+=Math.abs(c)}if(h<0){w=0;S+=Math.abs(h)}P.translate(-g.scale*b,-v.scale*w);y.transform(g.scale,0,0,v.scale,0,0);P.save();this.clipBbox(y,b,w,A,S);y.baseTransform=getCurrentTransform(y.ctx);y.executeOperatorList(e);y.endDrawing();return{canvas:m.canvas,scaleX:g.scale,scaleY:v.scale,offsetX:b,offsetY:w}}getSizeAndScale(t,e,i){t=Math.abs(t);const s=Math.max(TilingPattern.MAX_PATTERN_SIZE,e);let a=Math.ceil(t*i);a>=s?a=s:i=a/t;return{scale:i,size:a}}clipBbox(t,e,i,s,a){const r=s-e,n=a-i;t.ctx.rect(e,i,r,n);t.current.updateRectMinMax(getCurrentTransform(t.ctx),[e,i,s,a]);t.clip();t.endPath()}setFillAndStrokeStyleToContext(t,e,i){const s=t.ctx,a=t.current;switch(e){case vi:const t=this.ctx;s.fillStyle=t.fillStyle;s.strokeStyle=t.strokeStyle;a.fillColor=t.fillStyle;a.strokeColor=t.strokeStyle;break;case mi:const r=Util.makeHexColor(i[0],i[1],i[2]);s.fillStyle=r;s.strokeStyle=r;a.fillColor=r;a.strokeColor=r;break;default:throw new FormatError(`Unsupported paint type: ${e}`)}}getPattern(t,e,i,s){let a=i;if(s!==gi){a=Util.transform(a,e.baseTransform);this.matrix&&(a=Util.transform(a,this.matrix))}const r=this.createPatternCanvas(e);let n=new DOMMatrix(a);n=n.translate(r.offsetX,r.offsetY);n=n.scale(1/r.scaleX,1/r.scaleY);const o=t.createPattern(r.canvas,"repeat");o.setTransform(n);return o}}!function pattern_helper_defineProperty(t,e,i){(e=function pattern_helper_toPropertyKey(t){var e=function pattern_helper_toPrimitive(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i;return t}(TilingPattern,"MAX_PATTERN_SIZE",3e3);function convertBlackAndWhiteToRGBA(t){let{src:e,srcPos:i=0,dest:s,width:a,height:r,nonBlackColor:n=4294967295,inverseDecode:o=!1}=t;const l=util_FeatureTest.isLittleEndian?4278190080:255,[c,h]=o?[n,l]:[l,n],d=a>>3,u=7&a,p=e.length;s=new Uint32Array(s.buffer);let _=0;for(let t=0;t<r;t++){for(const t=i+d;i<t;i++){const t=i<p?e[i]:255;s[_++]=128&t?h:c;s[_++]=64&t?h:c;s[_++]=32&t?h:c;s[_++]=16&t?h:c;s[_++]=8&t?h:c;s[_++]=4&t?h:c;s[_++]=2&t?h:c;s[_++]=1&t?h:c}if(0===u)continue;const t=i<p?e[i++]:255;for(let e=0;e<u;e++)s[_++]=t&1<<7-e?h:c}return{srcPos:i,destPos:_}}function canvas_classPrivateMethodInitSpec(t,e){!function canvas_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e);e.add(t)}function canvas_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}const Pi=4096,yi=16;class CachedCanvases{constructor(t){this.canvasFactory=t;this.cache=Object.create(null)}getCanvas(t,e,i){let s;if(void 0!==this.cache[t]){s=this.cache[t];this.canvasFactory.reset(s,e,i)}else{s=this.canvasFactory.create(e,i);this.cache[t]=s}return s}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e);delete this.cache[t]}}}function drawImageAtIntegerCoords(t,e,i,s,a,r,n,o,l,c){const[h,d,u,p,_,f]=getCurrentTransform(t);if(0===d&&0===u){const g=n*h+_,v=Math.round(g),m=o*p+f,P=Math.round(m),y=(n+l)*h+_,b=Math.abs(Math.round(y)-v)||1,w=(o+c)*p+f,A=Math.abs(Math.round(w)-P)||1;t.setTransform(Math.sign(h),0,0,Math.sign(p),v,P);t.drawImage(e,i,s,a,r,0,0,b,A);t.setTransform(h,d,u,p,_,f);return[b,A]}if(0===h&&0===p){const g=o*u+_,v=Math.round(g),m=n*d+f,P=Math.round(m),y=(o+c)*u+_,b=Math.abs(Math.round(y)-v)||1,w=(n+l)*d+f,A=Math.abs(Math.round(w)-P)||1;t.setTransform(0,Math.sign(d),Math.sign(u),0,v,P);t.drawImage(e,i,s,a,r,0,0,A,b);t.setTransform(h,d,u,p,_,f);return[A,b]}t.drawImage(e,i,s,a,r,n,o,l,c);return[Math.hypot(h,d)*l,Math.hypot(u,p)*c]}class CanvasExtraState{constructor(t,e){this.alphaIsShape=!1;this.fontSize=0;this.fontSizeScale=1;this.textMatrix=i;this.textMatrixScale=1;this.fontMatrix=s;this.leading=0;this.x=0;this.y=0;this.lineX=0;this.lineY=0;this.charSpacing=0;this.wordSpacing=0;this.textHScale=1;this.textRenderingMode=g;this.textRise=0;this.fillColor="#000000";this.strokeColor="#000000";this.patternFill=!1;this.fillAlpha=1;this.strokeAlpha=1;this.lineWidth=1;this.activeSMask=null;this.transferMaps="none";this.startNewPathAndClipBox([0,0,t,e])}clone(){const t=Object.create(this);t.clipBox=this.clipBox.slice();return t}setCurrentPoint(t,e){this.x=t;this.y=e}updatePathMinMax(t,e,i){[e,i]=Util.applyTransform([e,i],t);this.minX=Math.min(this.minX,e);this.minY=Math.min(this.minY,i);this.maxX=Math.max(this.maxX,e);this.maxY=Math.max(this.maxY,i)}updateRectMinMax(t,e){const i=Util.applyTransform(e,t),s=Util.applyTransform(e.slice(2),t),a=Util.applyTransform([e[0],e[3]],t),r=Util.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,i[0],s[0],a[0],r[0]);this.minY=Math.min(this.minY,i[1],s[1],a[1],r[1]);this.maxX=Math.max(this.maxX,i[0],s[0],a[0],r[0]);this.maxY=Math.max(this.maxY,i[1],s[1],a[1],r[1])}updateScalingPathMinMax(t,e){Util.scaleMinMax(t,e);this.minX=Math.min(this.minX,e[0]);this.minY=Math.min(this.minY,e[1]);this.maxX=Math.max(this.maxX,e[2]);this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,i,s,a,r,n,o,l,c){const h=Util.bezierBoundingBox(e,i,s,a,r,n,o,l,c);c||this.updateRectMinMax(t,h)}getPathBoundingBox(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_i,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=[this.minX,this.minY,this.maxX,this.maxY];if(t===fi){e||unreachable("Stroke bounding box must include transform.");const t=Util.singularValueDecompose2dScale(e),s=t[0]*this.lineWidth/2,a=t[1]*this.lineWidth/2;i[0]-=s;i[1]-=a;i[2]+=s;i[3]+=a}return i}updateClipFromPath(){const t=Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t;this.minX=1/0;this.minY=1/0;this.maxX=0;this.maxY=0}getClippedPathBoundingBox(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_i,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Util.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function putBinaryImageData(t,e){if("undefined"!=typeof ImageData&&e instanceof ImageData){t.putImageData(e,0,0);return}const i=e.height,s=e.width,a=i%yi,r=(i-a)/yi,n=0===a?r:r+1,o=t.createImageData(s,yi);let l,c=0;const h=e.data,d=o.data;let u,p,_,f;if(e.kind===w.GRAYSCALE_1BPP){const e=h.byteLength,i=new Uint32Array(d.buffer,0,d.byteLength>>2),f=i.length,g=s+7>>3,v=4294967295,m=util_FeatureTest.isLittleEndian?4278190080:255;for(u=0;u<n;u++){_=u<r?yi:a;l=0;for(p=0;p<_;p++){const t=e-c;let a=0;const r=t>g?s:8*t-7,n=-8&r;let o=0,d=0;for(;a<n;a+=8){d=h[c++];i[l++]=128&d?v:m;i[l++]=64&d?v:m;i[l++]=32&d?v:m;i[l++]=16&d?v:m;i[l++]=8&d?v:m;i[l++]=4&d?v:m;i[l++]=2&d?v:m;i[l++]=1&d?v:m}for(;a<r;a++){if(0===o){d=h[c++];o=128}i[l++]=d&o?v:m;o>>=1}}for(;l<f;)i[l++]=0;t.putImageData(o,0,u*yi)}}else if(e.kind===w.RGBA_32BPP){p=0;f=s*yi*4;for(u=0;u<r;u++){d.set(h.subarray(c,c+f));c+=f;t.putImageData(o,0,p);p+=yi}if(u<n){f=s*a*4;d.set(h.subarray(c,c+f));t.putImageData(o,0,p)}}else{if(e.kind!==w.RGB_24BPP)throw new Error(`bad image kind: ${e.kind}`);_=yi;f=s*_;for(u=0;u<n;u++){if(u>=r){_=a;f=s*_}l=0;for(p=f;p--;){d[l++]=h[c++];d[l++]=h[c++];d[l++]=h[c++];d[l++]=255}t.putImageData(o,0,u*yi)}}}function putBinaryImageMask(t,e){if(e.bitmap){t.drawImage(e.bitmap,0,0);return}const i=e.height,s=e.width,a=i%yi,r=(i-a)/yi,n=0===a?r:r+1,o=t.createImageData(s,yi);let l=0;const c=e.data,h=o.data;for(let e=0;e<n;e++){const i=e<r?yi:a;({srcPos:l}=convertBlackAndWhiteToRGBA({src:c,srcPos:l,dest:h,width:s,height:i,nonBlackColor:0}));t.putImageData(o,0,e*yi)}}function copyCtxState(t,e){const i=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of i)void 0!==t[s]&&(e[s]=t[s]);if(void 0!==t.setLineDash){e.setLineDash(t.getLineDash());e.lineDashOffset=t.lineDashOffset}}function resetCtxToDefault(t){t.strokeStyle=t.fillStyle="#000000";t.fillRule="nonzero";t.globalAlpha=1;t.lineWidth=1;t.lineCap="butt";t.lineJoin="miter";t.miterLimit=10;t.globalCompositeOperation="source-over";t.font="10px sans-serif";if(void 0!==t.setLineDash){t.setLineDash([]);t.lineDashOffset=0}if(!e){const{filter:e}=t;"none"!==e&&""!==e&&(t.filter="none")}}function composeSMaskBackdrop(t,e,i,s){const a=t.length;for(let r=3;r<a;r+=4){const a=t[r];if(0===a){t[r-3]=e;t[r-2]=i;t[r-1]=s}else if(a<255){const n=255-a;t[r-3]=t[r-3]*a+e*n>>8;t[r-2]=t[r-2]*a+i*n>>8;t[r-1]=t[r-1]*a+s*n>>8}}}function composeSMaskAlpha(t,e,i){const s=t.length;for(let a=3;a<s;a+=4){const s=i?i[t[a]]:t[a];e[a]=e[a]*s*.00392156862745098|0}}function composeSMaskLuminosity(t,e,i){const s=t.length;for(let a=3;a<s;a+=4){const s=77*t[a-3]+152*t[a-2]+28*t[a-1];e[a]=i?e[a]*i[s>>8]>>8:e[a]*s>>16}}function composeSMask(t,e,i,s){const a=s[0],r=s[1],n=s[2]-a,o=s[3]-r;if(0!==n&&0!==o){!function genericComposeSMask(t,e,i,s,a,r,n,o,l,c,h){const d=!!r,u=d?r[0]:0,p=d?r[1]:0,_=d?r[2]:0,f="Luminosity"===a?composeSMaskLuminosity:composeSMaskAlpha,g=Math.min(s,Math.ceil(1048576/i));for(let a=0;a<s;a+=g){const r=Math.min(g,s-a),v=t.getImageData(o-c,a+(l-h),i,r),m=e.getImageData(o,a+l,i,r);d&&composeSMaskBackdrop(v.data,u,p,_);f(v.data,m.data,n);e.putImageData(m,o,a+l)}}(e.context,i,n,o,e.subtype,e.backdrop,e.transferMap,a,r,e.offsetX,e.offsetY);t.save();t.globalAlpha=1;t.globalCompositeOperation="source-over";t.setTransform(1,0,0,1,0,0);t.drawImage(i.canvas,0,0);t.restore()}}function getImageSmoothingEnabled(t,e){const i=Util.singularValueDecompose2dScale(t);i[0]=Math.fround(i[0]);i[1]=Math.fround(i[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*PixelsPerInch.PDF_TO_CSS_UNITS);return void 0!==e?e:i[0]<=s||i[1]<=s}const Fi=["butt","round","square"],bi=["miter","round","bevel"],wi={},Ai={};var Si=new WeakSet;class CanvasGraphics{constructor(t,e,i,s,a,r,n,o){let{optionalContentConfig:l,markedContentStack:c=null}=r;canvas_classPrivateMethodInitSpec(this,Si);this.ctx=t;this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height);this.stateStack=[];this.pendingClip=null;this.pendingEOFill=!1;this.res=null;this.xobjs=null;this.commonObjs=e;this.objs=i;this.canvasFactory=s;this.filterFactory=a;this.groupStack=[];this.processingType3=null;this.baseTransform=null;this.baseTransformStack=[];this.groupLevel=0;this.smaskStack=[];this.smaskCounter=0;this.tempSMask=null;this.suspendedCtx=null;this.contentVisible=!0;this.markedContentStack=c||[];this.optionalContentConfig=l;this.cachedCanvases=new CachedCanvases(this.canvasFactory);this.cachedPatterns=new Map;this.annotationCanvasMap=n;this.viewportScale=1;this.outputScaleX=1;this.outputScaleY=1;this.pageColors=o;this._cachedScaleForStroking=[-1,0];this._cachedGetSinglePixelWidth=null;this._cachedBitmapsMap=new Map}getObject(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"==typeof t?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing(t){let{transform:e,viewport:i,transparency:s=!1,background:a=null}=t;const r=this.ctx.canvas.width,n=this.ctx.canvas.height,o=this.ctx.fillStyle;this.ctx.fillStyle=a||"#ffffff";this.ctx.fillRect(0,0,r,n);this.ctx.fillStyle=o;if(s){const t=this.cachedCanvases.getCanvas("transparent",r,n);this.compositeCtx=this.ctx;this.transparentCanvas=t.canvas;this.ctx=t.context;this.ctx.save();this.ctx.transform(...getCurrentTransform(this.compositeCtx))}this.ctx.save();resetCtxToDefault(this.ctx);if(e){this.ctx.transform(...e);this.outputScaleX=e[0];this.outputScaleY=e[0]}this.ctx.transform(...i.transform);this.viewportScale=i.scale;this.baseTransform=getCurrentTransform(this.ctx)}executeOperatorList(t,e,i,s){const a=t.argsArray,r=t.fnArray;let n=e||0;const o=a.length;if(o===n)return n;const l=o-n>10&&"function"==typeof i,c=l?Date.now()+15:0;let h=0;const d=this.commonObjs,u=this.objs;let p;for(;;){if(void 0!==s&&n===s.nextBreakPoint){s.breakIt(n,i);return n}p=r[n];if(p!==K.dependency)this[p].apply(this,a[n]);else for(const t of a[n]){const e=t.startsWith("g_")?d:u;if(!e.has(t)){e.get(t,i);return n}}n++;if(n===o)return n;if(l&&++h>10){if(Date.now()>c){i();return n}h=0}}}endDrawing(){canvas_assertClassBrand(Si,this,_restoreInitialState).call(this);this.cachedCanvases.clear();this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear();canvas_assertClassBrand(Si,this,_drawFilter).call(this)}_scaleImage(t,e){const i=t.width,s=t.height;let a,r,n=Math.max(Math.hypot(e[0],e[1]),1),o=Math.max(Math.hypot(e[2],e[3]),1),l=i,c=s,h="prescale1";for(;n>2&&l>1||o>2&&c>1;){let e=l,i=c;if(n>2&&l>1){e=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2);n/=l/e}if(o>2&&c>1){i=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2;o/=c/i}a=this.cachedCanvases.getCanvas(h,e,i);r=a.context;r.clearRect(0,0,e,i);r.drawImage(t,0,0,l,c,0,0,e,i);t=a.canvas;l=e;c=i;h="prescale1"===h?"prescale2":"prescale1"}return{img:t,paintWidth:l,paintHeight:c}}_createMaskCanvas(t){const e=this.ctx,{width:i,height:s}=t,a=this.current.fillColor,r=this.current.patternFill,n=getCurrentTransform(e);let o,l,c,h;if((t.bitmap||t.data)&&t.count>1){const e=t.bitmap||t.data.buffer;l=JSON.stringify(r?n:[n.slice(0,4),a]);o=this._cachedBitmapsMap.get(e);if(!o){o=new Map;this._cachedBitmapsMap.set(e,o)}const i=o.get(l);if(i&&!r){return{canvas:i,offsetX:Math.round(Math.min(n[0],n[2])+n[4]),offsetY:Math.round(Math.min(n[1],n[3])+n[5])}}c=i}if(!c){h=this.cachedCanvases.getCanvas("maskCanvas",i,s);putBinaryImageMask(h.context,t)}let d=Util.transform(n,[1/i,0,0,-1/s,0,0]);d=Util.transform(d,[1,0,0,1,0,-s]);const[u,p,_,f]=Util.getAxialAlignedBoundingBox([0,0,i,s],d),g=Math.round(_-u)||1,v=Math.round(f-p)||1,m=this.cachedCanvases.getCanvas("fillCanvas",g,v),P=m.context,y=u,b=p;P.translate(-y,-b);P.transform(...d);if(!c){c=this._scaleImage(h.canvas,getCurrentTransformInverse(P));c=c.img;o&&r&&o.set(l,c)}P.imageSmoothingEnabled=getImageSmoothingEnabled(getCurrentTransform(P),t.interpolate);drawImageAtIntegerCoords(P,c,0,0,c.width,c.height,0,0,i,s);P.globalCompositeOperation="source-in";const w=Util.transform(getCurrentTransformInverse(P),[1,0,0,1,-y,-b]);P.fillStyle=r?a.getPattern(e,this,w,_i):a;P.fillRect(0,0,i,s);if(o&&!r){this.cachedCanvases.delete("fillCanvas");o.set(l,m.canvas)}return{canvas:m.canvas,offsetX:Math.round(y),offsetY:Math.round(b)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1);this.current.lineWidth=t;this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=Fi[t]}setLineJoin(t){this.ctx.lineJoin=bi[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const i=this.ctx;if(void 0!==i.setLineDash){i.setLineDash(t);i.lineDashOffset=e}}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,i]of t)switch(e){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i;this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null;this.tempSMask=null;this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,t,e);this.suspendedCtx=this.ctx;this.ctx=s.context;const a=this.ctx;a.setTransform(...getCurrentTransform(this.suspendedCtx));copyCtxState(this.suspendedCtx,a);!function mirrorContextOperations(t,e){if(t._removeMirroring)throw new Error("Context is already forwarding operations.");t.__originalSave=t.save;t.__originalRestore=t.restore;t.__originalRotate=t.rotate;t.__originalScale=t.scale;t.__originalTranslate=t.translate;t.__originalTransform=t.transform;t.__originalSetTransform=t.setTransform;t.__originalResetTransform=t.resetTransform;t.__originalClip=t.clip;t.__originalMoveTo=t.moveTo;t.__originalLineTo=t.lineTo;t.__originalBezierCurveTo=t.bezierCurveTo;t.__originalRect=t.rect;t.__originalClosePath=t.closePath;t.__originalBeginPath=t.beginPath;t._removeMirroring=()=>{t.save=t.__originalSave;t.restore=t.__originalRestore;t.rotate=t.__originalRotate;t.scale=t.__originalScale;t.translate=t.__originalTranslate;t.transform=t.__originalTransform;t.setTransform=t.__originalSetTransform;t.resetTransform=t.__originalResetTransform;t.clip=t.__originalClip;t.moveTo=t.__originalMoveTo;t.lineTo=t.__originalLineTo;t.bezierCurveTo=t.__originalBezierCurveTo;t.rect=t.__originalRect;t.closePath=t.__originalClosePath;t.beginPath=t.__originalBeginPath;delete t._removeMirroring};t.save=function ctxSave(){e.save();this.__originalSave()};t.restore=function ctxRestore(){e.restore();this.__originalRestore()};t.translate=function ctxTranslate(t,i){e.translate(t,i);this.__originalTranslate(t,i)};t.scale=function ctxScale(t,i){e.scale(t,i);this.__originalScale(t,i)};t.transform=function ctxTransform(t,i,s,a,r,n){e.transform(t,i,s,a,r,n);this.__originalTransform(t,i,s,a,r,n)};t.setTransform=function ctxSetTransform(t,i,s,a,r,n){e.setTransform(t,i,s,a,r,n);this.__originalSetTransform(t,i,s,a,r,n)};t.resetTransform=function ctxResetTransform(){e.resetTransform();this.__originalResetTransform()};t.rotate=function ctxRotate(t){e.rotate(t);this.__originalRotate(t)};t.clip=function ctxRotate(t){e.clip(t);this.__originalClip(t)};t.moveTo=function(t,i){e.moveTo(t,i);this.__originalMoveTo(t,i)};t.lineTo=function(t,i){e.lineTo(t,i);this.__originalLineTo(t,i)};t.bezierCurveTo=function(t,i,s,a,r,n){e.bezierCurveTo(t,i,s,a,r,n);this.__originalBezierCurveTo(t,i,s,a,r,n)};t.rect=function(t,i,s,a){e.rect(t,i,s,a);this.__originalRect(t,i,s,a)};t.closePath=function(){e.closePath();this.__originalClosePath()};t.beginPath=function(){e.beginPath();this.__originalBeginPath()}}(a,this.suspendedCtx);this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring();copyCtxState(this.ctx,this.suspendedCtx);this.ctx=this.suspendedCtx;this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;if(t){t[0]=Math.floor(t[0]);t[1]=Math.floor(t[1]);t[2]=Math.ceil(t[2]);t[3]=Math.ceil(t[3])}else t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask;composeSMask(this.suspendedCtx,e,this.ctx,t);this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);this.ctx.restore()}save(){if(this.inSMaskMode){copyCtxState(this.ctx,this.suspendedCtx);this.suspendedCtx.save()}else this.ctx.save();const t=this.current;this.stateStack.push(t);this.current=t.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode();if(0!==this.stateStack.length){this.current=this.stateStack.pop();if(this.inSMaskMode){this.suspendedCtx.restore();copyCtxState(this.suspendedCtx,this.ctx)}else this.ctx.restore();this.checkSMaskState();this.pendingClip=null;this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null}}transform(t,e,i,s,a,r){this.ctx.transform(t,e,i,s,a,r);this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null}constructPath(t,e,i){const s=this.ctx,a=this.current;let r,n,o=a.x,l=a.y;const c=getCurrentTransform(s),h=0===c[0]&&0===c[3]||0===c[1]&&0===c[2],d=h?i.slice(0):null;for(let i=0,u=0,p=t.length;i<p;i++)switch(0|t[i]){case K.rectangle:o=e[u++];l=e[u++];const t=e[u++],i=e[u++],p=o+t,_=l+i;s.moveTo(o,l);if(0===t||0===i)s.lineTo(p,_);else{s.lineTo(p,l);s.lineTo(p,_);s.lineTo(o,_)}h||a.updateRectMinMax(c,[o,l,p,_]);s.closePath();break;case K.moveTo:o=e[u++];l=e[u++];s.moveTo(o,l);h||a.updatePathMinMax(c,o,l);break;case K.lineTo:o=e[u++];l=e[u++];s.lineTo(o,l);h||a.updatePathMinMax(c,o,l);break;case K.curveTo:r=o;n=l;o=e[u+4];l=e[u+5];s.bezierCurveTo(e[u],e[u+1],e[u+2],e[u+3],o,l);a.updateCurvePathMinMax(c,r,n,e[u],e[u+1],e[u+2],e[u+3],o,l,d);u+=6;break;case K.curveTo2:r=o;n=l;s.bezierCurveTo(o,l,e[u],e[u+1],e[u+2],e[u+3]);a.updateCurvePathMinMax(c,r,n,o,l,e[u],e[u+1],e[u+2],e[u+3],d);o=e[u+2];l=e[u+3];u+=4;break;case K.curveTo3:r=o;n=l;o=e[u+2];l=e[u+3];s.bezierCurveTo(e[u],e[u+1],o,l,o,l);a.updateCurvePathMinMax(c,r,n,e[u],e[u+1],o,l,o,l,d);u+=4;break;case K.closePath:s.closePath()}h&&a.updateScalingPathMinMax(c,d);a.setCurrentPoint(o,l)}closePath(){this.ctx.closePath()}stroke(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=this.ctx,i=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha;if(this.contentVisible)if("object"==typeof i&&i?.getPattern){e.save();e.strokeStyle=i.getPattern(e,this,getCurrentTransformInverse(e),fi);this.rescaleAndStroke(!1);e.restore()}else this.rescaleAndStroke(!0);t&&this.consumePath(this.current.getClippedPathBoundingBox());e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath();this.stroke()}fill(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=this.ctx,i=this.current.fillColor;let s=!1;if(this.current.patternFill){e.save();e.fillStyle=i.getPattern(e,this,getCurrentTransformInverse(e),_i);s=!0}const a=this.current.getClippedPathBoundingBox();if(this.contentVisible&&null!==a)if(this.pendingEOFill){e.fill("evenodd");this.pendingEOFill=!1}else e.fill();s&&e.restore();t&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0;this.fill()}fillStroke(){this.fill(!1);this.stroke(!1);this.consumePath()}eoFillStroke(){this.pendingEOFill=!0;this.fillStroke()}closeFillStroke(){this.closePath();this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0;this.closePath();this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=wi}eoClip(){this.pendingClip=Ai}beginText(){this.current.textMatrix=i;this.current.textMatrixScale=1;this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(void 0!==t){e.save();e.beginPath();for(const i of t){e.setTransform(...i.transform);e.translate(i.x,i.y);i.addToPath(e,i.fontSize)}e.restore();e.clip();e.beginPath();delete this.pendingTextPaths}else e.beginPath()}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){const i=this.commonObjs.get(t),a=this.current;if(!i)throw new Error(`Can't find font for ${t}`);a.fontMatrix=i.fontMatrix||s;0!==a.fontMatrix[0]&&0!==a.fontMatrix[3]||warn("Invalid font matrix for font "+t);if(e<0){e=-e;a.fontDirection=-1}else a.fontDirection=1;this.current.font=i;this.current.fontSize=e;if(i.isType3Font)return;const r=i.loadedName||"sans-serif",n=i.systemFontInfo?.css||`"${r}", ${i.fallbackName}`;let o="normal";i.black?o="900":i.bold&&(o="bold");const l=i.italic?"italic":"normal";let c=e;e<16?c=16:e>100&&(c=100);this.current.fontSizeScale=e/c;this.ctx.font=`${l} ${o} ${c}px ${n}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t;this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e);this.moveText(t,e)}setTextMatrix(t,e,i,s,a,r){this.current.textMatrix=[t,e,i,s,a,r];this.current.textMatrixScale=Math.hypot(t,e);this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,i,s){const a=this.ctx,r=this.current,n=r.font,o=r.textRenderingMode,l=r.fontSize/r.fontSizeScale,c=o&y,h=!!(o&b),d=r.patternFill&&!n.missingFile;let u;(n.disableFontFace||h||d)&&(u=n.getPathGenerator(this.commonObjs,t));if(n.disableFontFace||d){a.save();a.translate(e,i);a.beginPath();u(a,l);s&&a.setTransform(...s);c!==g&&c!==m||a.fill();c!==v&&c!==m||a.stroke();a.restore()}else{c!==g&&c!==m||a.fillText(t,e,i);c!==v&&c!==m||a.strokeText(t,e,i)}if(h){(this.pendingTextPaths||=[]).push({transform:getCurrentTransform(a),x:e,y:i,fontSize:l,addToPath:u})}}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1);t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let i=!1;for(let t=3;t<e.length;t+=4)if(e[t]>0&&e[t]<255){i=!0;break}return shadow(this,"isFontSubpixelAAEnabled",i)}showText(t){const e=this.current,i=e.font;if(i.isType3Font)return this.showType3Text(t);const s=e.fontSize;if(0===s)return;const a=this.ctx,r=e.fontSizeScale,n=e.charSpacing,o=e.wordSpacing,l=e.fontDirection,c=e.textHScale*l,h=t.length,d=i.vertical,u=d?1:-1,p=i.defaultVMetrics,_=s*e.fontMatrix[0],f=e.textRenderingMode===g&&!i.disableFontFace&&!e.patternFill;a.save();a.transform(...e.textMatrix);a.translate(e.x,e.y+e.textRise);l>0?a.scale(c,-1):a.scale(c,1);let P;if(e.patternFill){a.save();const t=e.fillColor.getPattern(a,this,getCurrentTransformInverse(a),_i);P=getCurrentTransform(a);a.restore();a.fillStyle=t}let b=e.lineWidth;const w=e.textMatrixScale;if(0===w||0===b){const t=e.textRenderingMode&y;t!==v&&t!==m||(b=this.getSinglePixelWidth())}else b/=w;if(1!==r){a.scale(r,r);b/=r}a.lineWidth=b;if(i.isInvalidPDFjsFont){const i=[];let s=0;for(const e of t){i.push(e.unicode);s+=e.width}a.fillText(i.join(""),0,0);e.x+=s*_*c;a.restore();this.compose();return}let A,S=0;for(A=0;A<h;++A){const e=t[A];if("number"==typeof e){S+=u*e*s/1e3;continue}let c=!1;const h=(e.isSpace?o:0)+n,g=e.fontChar,v=e.accent;let m,y,b=e.width;if(d){const t=e.vmetric||p,i=-(e.vmetric?t[1]:.5*b)*_,s=t[2]*_;b=t?-t[0]:b;m=i/r;y=(S+s)/r}else{m=S/r;y=0}if(i.remeasure&&b>0){const t=1e3*a.measureText(g).width/s*r;if(b<t&&this.isFontSubpixelAAEnabled){const e=b/t;c=!0;a.save();a.scale(e,1);m/=e}else b!==t&&(m+=(b-t)/2e3*s/r)}if(this.contentVisible&&(e.isInFont||i.missingFile))if(f&&!v)a.fillText(g,m,y);else{this.paintChar(g,m,y,P);if(v){const t=m+s*v.offset.x/r,e=y-s*v.offset.y/r;this.paintChar(v.fontChar,t,e,P)}}S+=d?b*_-h*l:b*_+h*l;c&&a.restore()}d?e.y-=S:e.x+=S*c;a.restore();this.compose()}showType3Text(t){const e=this.ctx,i=this.current,a=i.font,r=i.fontSize,n=i.fontDirection,o=a.vertical?1:-1,l=i.charSpacing,c=i.wordSpacing,h=i.textHScale*n,d=i.fontMatrix||s,u=t.length;let p,_,f,g;if(!(i.textRenderingMode===P)&&0!==r){this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null;e.save();e.transform(...i.textMatrix);e.translate(i.x,i.y);e.scale(h,n);for(p=0;p<u;++p){_=t[p];if("number"==typeof _){g=o*_*r/1e3;this.ctx.translate(g,0);i.x+=g*h;continue}const s=(_.isSpace?c:0)+l,n=a.charProcOperatorList[_.operatorListId];if(!n){warn(`Type3 character "${_.operatorListId}" is not available.`);continue}if(this.contentVisible){this.processingType3=_;this.save();e.scale(r,r);e.transform(...d);this.executeOperatorList(n);this.restore()}f=Util.applyTransform([_.width,0],d)[0]*r+s;e.translate(f,0);i.x+=f*h}e.restore();this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,i,s,a,r){this.ctx.rect(i,s,a-i,r-s);this.ctx.clip();this.endPath()}getColorN_Pattern(t){let e;if("TilingPattern"===t[0]){const i=t[1],s=this.baseTransform||getCurrentTransform(this.ctx),a={createCanvasGraphics:t=>new CanvasGraphics(t,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new TilingPattern(t,i,this.ctx,a,s)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments);this.current.patternFill=!0}setStrokeRGBColor(t,e,i){const s=Util.makeHexColor(t,e,i);this.ctx.strokeStyle=s;this.current.strokeColor=s}setFillRGBColor(t,e,i){const s=Util.makeHexColor(t,e,i);this.ctx.fillStyle=s;this.current.fillColor=s;this.current.patternFill=!1}_getPattern(t){let e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.cachedPatterns.has(t))e=this.cachedPatterns.get(t);else{e=function getShadingPattern(t){switch(t[0]){case"RadialAxial":return new RadialAxialShadingPattern(t);case"Mesh":return new MeshShadingPattern(t);case"Dummy":return new DummyShadingPattern}throw new Error(`Unknown IR type: ${t[0]}`)}(this.getObject(t));this.cachedPatterns.set(t,e)}i&&(e.matrix=i);return e}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const i=this._getPattern(t);e.fillStyle=i.getPattern(e,this,getCurrentTransformInverse(e),gi);const s=getCurrentTransformInverse(e);if(s){const{width:t,height:i}=e.canvas,[a,r,n,o]=Util.getAxialAlignedBoundingBox([0,0,t,i],s);this.ctx.fillRect(a,r,n-a,o-r)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox());this.restore()}beginInlineImage(){unreachable("Should not call beginInlineImage")}beginImageData(){unreachable("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible){this.save();this.baseTransformStack.push(this.baseTransform);Array.isArray(t)&&6===t.length&&this.transform(...t);this.baseTransform=getCurrentTransform(this.ctx);if(e){const t=e[2]-e[0],i=e[3]-e[1];this.ctx.rect(e[0],e[1],t,i);this.current.updateRectMinMax(getCurrentTransform(this.ctx),e);this.clip();this.endPath()}}}paintFormXObjectEnd(){if(this.contentVisible){this.restore();this.baseTransform=this.baseTransformStack.pop()}}beginGroup(t){if(!this.contentVisible)return;this.save();if(this.inSMaskMode){this.endSMaskMode();this.current.activeSMask=null}const e=this.ctx;t.isolated||info("TODO: Support non-isolated groups.");t.knockout&&warn("Knockout groups not supported.");const i=getCurrentTransform(e);t.matrix&&e.transform(...t.matrix);if(!t.bbox)throw new Error("Bounding box is required.");let s=Util.getAxialAlignedBoundingBox(t.bbox,getCurrentTransform(e));const a=[0,0,e.canvas.width,e.canvas.height];s=Util.intersect(s,a)||[0,0,0,0];const r=Math.floor(s[0]),n=Math.floor(s[1]);let o=Math.max(Math.ceil(s[2])-r,1),l=Math.max(Math.ceil(s[3])-n,1),c=1,h=1;if(o>Pi){c=o/Pi;o=Pi}if(l>Pi){h=l/Pi;l=Pi}this.current.startNewPathAndClipBox([0,0,o,l]);let d="groupAt"+this.groupLevel;t.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,o,l),p=u.context;p.scale(1/c,1/h);p.translate(-r,-n);p.transform(...i);if(t.smask)this.smaskStack.push({canvas:u.canvas,context:p,offsetX:r,offsetY:n,scaleX:c,scaleY:h,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null});else{e.setTransform(1,0,0,1,0,0);e.translate(r,n);e.scale(c,h);e.save()}copyCtxState(e,p);this.ctx=p;this.setGState([["BM","source-over"],["ca",1],["CA",1]]);this.groupStack.push(e);this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,i=this.groupStack.pop();this.ctx=i;this.ctx.imageSmoothingEnabled=!1;if(t.smask){this.tempSMask=this.smaskStack.pop();this.restore()}else{this.ctx.restore();const t=getCurrentTransform(this.ctx);this.restore();this.ctx.save();this.ctx.setTransform(...t);const i=Util.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],t);this.ctx.drawImage(e.canvas,0,0);this.ctx.restore();this.compose(i)}}beginAnnotation(t,e,i,s,a){canvas_assertClassBrand(Si,this,_restoreInitialState).call(this);resetCtxToDefault(this.ctx);this.ctx.save();this.save();this.baseTransform&&this.ctx.setTransform(...this.baseTransform);if(Array.isArray(e)&&4===e.length){const s=e[2]-e[0],r=e[3]-e[1];if(a&&this.annotationCanvasMap){(i=i.slice())[4]-=e[0];i[5]-=e[1];(e=e.slice())[0]=e[1]=0;e[2]=s;e[3]=r;const[a,n]=Util.singularValueDecompose2dScale(getCurrentTransform(this.ctx)),{viewportScale:o}=this,l=Math.ceil(s*this.outputScaleX*o),c=Math.ceil(r*this.outputScaleY*o);this.annotationCanvas=this.canvasFactory.create(l,c);const{canvas:h,context:d}=this.annotationCanvas;this.annotationCanvasMap.set(t,h);this.annotationCanvas.savedCtx=this.ctx;this.ctx=d;this.ctx.save();this.ctx.setTransform(a,0,0,-n,0,r*n);resetCtxToDefault(this.ctx)}else{resetCtxToDefault(this.ctx);this.ctx.rect(e[0],e[1],s,r);this.ctx.clip();this.endPath()}}this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height);this.transform(...i);this.transform(...s)}endAnnotation(){if(this.annotationCanvas){this.ctx.restore();canvas_assertClassBrand(Si,this,_drawFilter).call(this);this.ctx=this.annotationCanvas.savedCtx;delete this.annotationCanvas.savedCtx;delete this.annotationCanvas}}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;(t=this.getObject(t.data,t)).count=e;const i=this.ctx,s=this.processingType3;if(s){void 0===s.compiled&&(s.compiled=function compileType3Glyph(t){const{width:e,height:i}=t;if(e>1e3||i>1e3)return null;const s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),a=e+1;let r,n,o,l=new Uint8Array(a*(i+1));const c=e+7&-8;let h=new Uint8Array(c*i),d=0;for(const e of t.data){let t=128;for(;t>0;){h[d++]=e&t?0:255;t>>=1}}let u=0;d=0;if(0!==h[d]){l[0]=1;++u}for(n=1;n<e;n++){if(h[d]!==h[d+1]){l[n]=h[d]?2:1;++u}d++}if(0!==h[d]){l[n]=2;++u}for(r=1;r<i;r++){d=r*c;o=r*a;if(h[d-c]!==h[d]){l[o]=h[d]?1:8;++u}let t=(h[d]?4:0)+(h[d-c]?8:0);for(n=1;n<e;n++){t=(t>>2)+(h[d+1]?4:0)+(h[d-c+1]?8:0);if(s[t]){l[o+n]=s[t];++u}d++}if(h[d-c]!==h[d]){l[o+n]=h[d]?2:4;++u}if(u>1e3)return null}d=c*(i-1);o=r*a;if(0!==h[d]){l[o]=8;++u}for(n=1;n<e;n++){if(h[d]!==h[d+1]){l[o+n]=h[d]?4:8;++u}d++}if(0!==h[d]){l[o+n]=4;++u}if(u>1e3)return null;const p=new Int32Array([0,a,-1,0,-a,0,0,0,1]),_=new Path2D;for(r=0;u&&r<=i;r++){let t=r*a;const i=t+e;for(;t<i&&!l[t];)t++;if(t===i)continue;_.moveTo(t%a,r);const s=t;let n=l[t];do{const e=p[n];do{t+=e}while(!l[t]);const i=l[t];if(5!==i&&10!==i){n=i;l[t]=0}else{n=i&51*n>>4;l[t]&=n>>2|n<<2}_.lineTo(t%a,t/a|0);l[t]||--u}while(s!==t);--r}h=null;l=null;return function(t){t.save();t.scale(1/e,-1/i);t.translate(0,-i);t.fill(_);t.beginPath();t.restore()}}(t));if(s.compiled){s.compiled(i);return}}const a=this._createMaskCanvas(t),r=a.canvas;i.save();i.setTransform(1,0,0,1,0,0);i.drawImage(r,a.offsetX,a.offsetY);i.restore();this.compose()}paintImageMaskXObjectRepeat(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;if(!this.contentVisible)return;t=this.getObject(t.data,t);const n=this.ctx;n.save();const o=getCurrentTransform(n);n.transform(e,i,s,a,0,0);const l=this._createMaskCanvas(t);n.setTransform(1,0,0,1,l.offsetX-o[4],l.offsetY-o[5]);for(let t=0,c=r.length;t<c;t+=2){const c=Util.transform(o,[e,i,s,a,r[t],r[t+1]]),[h,d]=Util.applyTransform([0,0],c);n.drawImage(l.canvas,h,d)}n.restore();this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(const a of t){const{data:t,width:r,height:n,transform:o}=a,l=this.cachedCanvases.getCanvas("maskCanvas",r,n),c=l.context;c.save();putBinaryImageMask(c,this.getObject(t,a));c.globalCompositeOperation="source-in";c.fillStyle=s?i.getPattern(c,this,getCurrentTransformInverse(e),_i):i;c.fillRect(0,0,r,n);c.restore();e.save();e.transform(...o);e.scale(1,-1);drawImageAtIntegerCoords(e,l.canvas,0,0,r,n,0,-1,1,1);e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);e?this.paintInlineImageXObject(e):warn("Dependent image isn't ready yet")}paintImageXObjectRepeat(t,e,i,s){if(!this.contentVisible)return;const a=this.getObject(t);if(!a){warn("Dependent image isn't ready yet");return}const r=a.width,n=a.height,o=[];for(let t=0,a=s.length;t<a;t+=2)o.push({transform:[e,0,0,i,s[t],s[t+1]],x:0,y:0,w:r,h:n});this.paintInlineImageXObjectGroup(a,o)}applyTransferMapsToCanvas(t){if("none"!==this.current.transferMaps){t.filter=this.current.transferMaps;t.drawImage(t.canvas,0,0);t.filter="none"}return t.canvas}applyTransferMapsToBitmap(t){if("none"===this.current.transferMaps)return t.bitmap;const{bitmap:e,width:i,height:s}=t,a=this.cachedCanvases.getCanvas("inlineImage",i,s),r=a.context;r.filter=this.current.transferMaps;r.drawImage(e,0,0);r.filter="none";return a.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const i=t.width,s=t.height,a=this.ctx;this.save();if(!e){const{filter:t}=a;"none"!==t&&""!==t&&(a.filter="none")}a.scale(1/i,-1/s);let r;if(t.bitmap)r=this.applyTransferMapsToBitmap(t);else if("function"==typeof HTMLElement&&t instanceof HTMLElement||!t.data)r=t;else{const e=this.cachedCanvases.getCanvas("inlineImage",i,s).context;putBinaryImageData(e,t);r=this.applyTransferMapsToCanvas(e)}const n=this._scaleImage(r,getCurrentTransformInverse(a));a.imageSmoothingEnabled=getImageSmoothingEnabled(getCurrentTransform(a),t.interpolate);drawImageAtIntegerCoords(a,n.img,0,0,n.paintWidth,n.paintHeight,0,-s,i,s);this.compose();this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const i=this.ctx;let s;if(t.bitmap)s=t.bitmap;else{const e=t.width,i=t.height,a=this.cachedCanvases.getCanvas("inlineImage",e,i).context;putBinaryImageData(a,t);s=this.applyTransferMapsToCanvas(a)}for(const t of e){i.save();i.transform(...t.transform);i.scale(1,-1);drawImageAtIntegerCoords(i,s,t.x,t.y,t.w,t.h,0,-1,1,1);i.restore()}this.compose()}paintSolidColorImageMask(){if(this.contentVisible){this.ctx.fillRect(0,0,1,1);this.compose()}}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){"OC"===t?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0});this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop();this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){const e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath();this.pendingClip||this.compose(t);const i=this.ctx;if(this.pendingClip){e||(this.pendingClip===Ai?i.clip("evenodd"):i.clip());this.pendingClip=null}this.current.startNewPathAndClipBox(this.current.clipBox);i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=getCurrentTransform(this.ctx);if(0===t[1]&&0===t[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){const{lineWidth:t}=this.current,{a:e,b:i,c:s,d:a}=this.ctx.getTransform();let r,n;if(0===i&&0===s){const i=Math.abs(e),s=Math.abs(a);if(i===s)if(0===t)r=n=1/i;else{const e=i*t;r=n=e<1?1/e:1}else if(0===t){r=1/i;n=1/s}else{const e=i*t,a=s*t;r=e<1?1/e:1;n=a<1?1/a:1}}else{const o=Math.abs(e*a-i*s),l=Math.hypot(e,i),c=Math.hypot(s,a);if(0===t){r=c/o;n=l/o}else{const e=t*o;r=c>e?c/e:1;n=l>e?l/e:1}}this._cachedScaleForStroking[0]=r;this._cachedScaleForStroking[1]=n}return this._cachedScaleForStroking}rescaleAndStroke(t){const{ctx:e}=this,{lineWidth:i}=this.current,[s,a]=this.getScaleForStroking();e.lineWidth=i||1;if(1===s&&1===a){e.stroke();return}const r=e.getLineDash();t&&e.save();e.scale(s,a);if(r.length>0){const t=Math.max(s,a);e.setLineDash(r.map((e=>e/t)));e.lineDashOffset/=t}e.stroke();t&&e.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}function _restoreInitialState(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore();if(this.transparentCanvas){this.ctx=this.compositeCtx;this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.drawImage(this.transparentCanvas,0,0);this.ctx.restore();this.transparentCanvas=null}}function _drawFilter(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==t){const e=this.ctx.filter;this.ctx.filter=t;this.ctx.drawImage(this.ctx.canvas,0,0);this.ctx.filter=e}}}for(const t in K)void 0!==CanvasGraphics.prototype[t]&&(CanvasGraphics.prototype[K[t]]=CanvasGraphics.prototype[t]);const xi=30,Ci=.8,ki=new Map;let Ei=null;function getCtx(){if(!Ei){const t=window.pdfDefaultOptions.activateWillReadFrequentlyFlag?{willReadFrequently:!0,alpha:!1}:{alpha:!1},e=document.createElement("canvas");e.className="hiddenCanvasElement";document.body.append(e);Ei=e.getContext("2d",t)}return Ei}function cleanupTextLayer(){Ei?.canvas.remove();Ei=null}function appendText(t,e,i){const s=document.createElement("span"),a={angle:0,canvasWidth:0,hasText:""!==e.str,hasEOL:e.hasEOL,fontSize:0};t._textDivs.push(s);const r=Util.transform(t._transform,e.transform);let n=Math.atan2(r[1],r[0]);const o=i[e.fontName];o.vertical&&(n+=Math.PI/2);const l=t._fontInspectorEnabled&&o.fontSubstitution||o.fontFamily,c=Math.hypot(r[2],r[3]),h=c*function getAscent(t){const e=ki.get(t);if(e)return e;const i=getCtx(),s=i.font;i.canvas.width=i.canvas.height=xi;i.font=`${xi}px ${t}`;const a=i.measureText("");let r=a?.fontBoundingBoxAscent,n=Math.abs(a?.fontBoundingBoxDescent);if(r){const e=r/(r+n);ki.set(t,e);i.canvas.width=i.canvas.height=0;i.font=s;return e}i.strokeStyle="red";i.clearRect(0,0,xi,xi);i.strokeText("g",0,0);let o=i.getImageData(0,0,xi,xi).data;n=0;for(let t=o.length-1-3;t>=0;t-=4)if(o[t]>0){n=Math.ceil(t/4/xi);break}i.clearRect(0,0,xi,xi);i.strokeText("A",0,xi);o=i.getImageData(0,0,xi,xi).data;r=0;for(let t=0,e=o.length;t<e;t+=4)if(o[t]>0){r=xi-Math.floor(t/4/xi);break}i.canvas.width=i.canvas.height=0;i.font=s;if(r){const e=r/(r+n);ki.set(t,e);return e}ki.set(t,Ci);return Ci}(l);let d,u;if(0===n){d=r[4];u=r[5]-h}else{d=r[4]+h*Math.sin(n);u=r[5]-h*Math.cos(n)}const p="calc(var(--scale-factor)*",_=s.style;if(t._container===t._rootContainer){_.left=`${(100*d/t._pageWidth).toFixed(2)}%`;_.top=`${(100*u/t._pageHeight).toFixed(2)}%`}else{_.left=`${p}${d.toFixed(2)}px)`;_.top=`${p}${u.toFixed(2)}px)`}_.fontSize=`${p}${c.toFixed(2)}px)`;_.fontFamily=l;a.fontSize=c;s.setAttribute("role","presentation");s.textContent=e.str;s.dir=e.dir;t._fontInspectorEnabled&&(s.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName);0!==n&&(a.angle=n*(180/Math.PI));let f=!1;if(e.str.length>1)f=!0;else if(" "!==e.str&&e.transform[0]!==e.transform[3]){const t=Math.abs(e.transform[0]),i=Math.abs(e.transform[3]);t!==i&&Math.max(t,i)/Math.min(t,i)>1.5&&(f=!0)}f&&(a.canvasWidth=o.vertical?e.height:e.width);t._textDivProperties.set(s,a);t._isReadableStream&&t._layoutText(s)}function layout(t){const{div:e,scale:i,properties:s,ctx:a,prevFontSize:r,prevFontFamily:n}=t,{style:o}=e;let l="";if(0!==s.canvasWidth&&s.hasText){const{fontFamily:c}=o,{canvasWidth:h,fontSize:d}=s;if(r!==d||n!==c){a.font=`${d*i}px ${c}`;t.prevFontSize=d;t.prevFontFamily=c}try{const{width:t}=a.measureText(e.textContent);t>0&&(l=`scaleX(${h*i/t})`)}catch(t){}}0!==s.angle&&(l=`rotate(${s.angle}deg) ${l}`);l.length>0&&(o.transform=l)}class TextLayerRenderTask{constructor(t){let{textContentSource:e,container:i,viewport:s,textDivs:a,textDivProperties:r,textContentItemsStr:n}=t;this._textContentSource=e;this._isReadableStream=e instanceof ReadableStream;this._container=this._rootContainer=i;this._textDivs=a||[];this._textContentItemsStr=n||[];this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled;this._reader=null;this._textDivProperties=r||new WeakMap;this._canceled=!1;this._capability=new PromiseCapability;this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:s.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:getCtx()};const{pageWidth:o,pageHeight:l,pageX:c,pageY:h}=s.rawDims;this._transform=[1,0,0,-1,-c,h+l];this._pageWidth=o;this._pageHeight=l;setLayerDimensions(i,s);this._capability.promise.finally((()=>{this._layoutTextParams=null})).catch((()=>{}))}get promise(){return this._capability.promise}cancel(){this._canceled=!0;if(this._reader){this._reader.cancel(new AbortException("TextLayer task cancelled.")).catch((()=>{}));this._reader=null}this._capability.reject(new AbortException("TextLayer task cancelled."))}_processItems(t,e){for(const i of t)if(void 0!==i.str){this._textContentItemsStr.push(i.str);appendText(this,i,e)}else if("beginMarkedContentProps"===i.type||"beginMarkedContent"===i.type){const t=this._container;this._container=document.createElement("span");this._container.classList.add("markedContent");null!==i.id&&this._container.setAttribute("id",`${i.id}`);t.append(this._container)}else"endMarkedContent"===i.type&&(this._container=this._container.parentNode)}_layoutText(t){const e=this._layoutTextParams.properties=this._textDivProperties.get(t);this._layoutTextParams.div=t;layout(this._layoutTextParams);e.hasText&&this._container.append(t);if(e.hasEOL){const t=document.createElement("br");t.setAttribute("role","presentation");this._container.append(t)}}_render(){const t=new PromiseCapability;let e=Object.create(null);if(this._isReadableStream){const pump=()=>{this._reader.read().then((i=>{let{value:s,done:a}=i;if(a)t.resolve();else{Object.assign(e,s.styles);this._processItems(s.items,e);pump()}}),t.reject)};this._reader=this._textContentSource.getReader();pump()}else{if(!this._textContentSource)throw new Error('No "textContentSource" parameter specified.');{const{items:e,styles:i}=this._textContentSource;this._processItems(e,i);t.resolve()}}t.promise.then((()=>{e=null;!function render(t){if(t._canceled)return;const e=t._textDivs,i=t._capability;if(e.length>1e5)i.resolve();else{if(!t._isReadableStream)for(const i of e)t._layoutText(i);i.resolve()}}(this)}),this._capability.reject)}}function renderTextLayer(t){const e=new TextLayerRenderTask(t);e._render();return e}function updateTextLayer(t){let{container:e,viewport:i,textDivs:s,textDivProperties:a,mustRotate:r=!0,mustRescale:n=!0}=t;r&&setLayerDimensions(e,{rotation:i.rotation});if(n){const t=getCtx(),e={prevFontSize:null,prevFontFamily:null,div:null,scale:i.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:t};for(const t of s){e.properties=a.get(t);e.div=t;layout(e)}}}function worker_options_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}class GlobalWorkerOptions{static get workerPort(){return worker_options_assertClassBrand(GlobalWorkerOptions,this,Mi)._}static set workerPort(t){if(!("undefined"!=typeof Worker&&t instanceof Worker)&&null!==t)throw new Error("Invalid `workerPort` type.");Mi._=worker_options_assertClassBrand(GlobalWorkerOptions,this,t)}static get workerSrc(){return worker_options_assertClassBrand(GlobalWorkerOptions,this,Gi)._}static set workerSrc(t){if("string"!=typeof t)throw new Error("Invalid `workerSrc` type.");Gi._=worker_options_assertClassBrand(GlobalWorkerOptions,this,t)}}var Mi={_:null},Gi={_:""};function message_handler_classPrivateMethodInitSpec(t,e){!function message_handler_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e);e.add(t)}function message_handler_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}const Ii=1,Ti=2,Ri=1,Di=2,Li=3,Bi=4,Oi=5,Ni=6,Wi=7,ji=8;function wrapReason(t){t instanceof Error||"object"==typeof t&&null!==t||unreachable('wrapReason: Expected "reason" to be a (possibly cloned) Error.');switch(t.name){case"AbortException":return new AbortException(t.message);case"MissingPDFException":return new MissingPDFException(t.message);case"PasswordException":return new PasswordException(t.message,t.code);case"UnexpectedResponseException":return new UnexpectedResponseException(t.message,t.status);case"UnknownErrorException":return new UnknownErrorException(t.message,t.details);default:return new UnknownErrorException(t.message,t.toString())}}var Hi=new WeakSet;class MessageHandler{constructor(t,e,i){message_handler_classPrivateMethodInitSpec(this,Hi);this.sourceName=t;this.targetName=e;this.comObj=i;this.callbackId=1;this.streamId=1;this.streamSinks=Object.create(null);this.streamControllers=Object.create(null);this.callbackCapabilities=Object.create(null);this.actionHandler=Object.create(null);this._onComObjOnMessage=t=>{const e=t.data;if(e.targetName!==this.sourceName)return;if(e.stream){message_handler_assertClassBrand(Hi,this,_processStreamMessage).call(this,e);return}if(e.callback){const t=e.callbackId,i=this.callbackCapabilities[t];if(!i)throw new Error(`Cannot resolve callback ${t}`);delete this.callbackCapabilities[t];if(e.callback===Ii)i.resolve(e.data);else{if(e.callback!==Ti)throw new Error("Unexpected callback case");i.reject(wrapReason(e.reason))}return}const s=this.actionHandler[e.action];if(!s)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const t=this.sourceName,a=e.sourceName;new Promise((function(t){t(s(e.data))})).then((function(s){i.postMessage({sourceName:t,targetName:a,callback:Ii,callbackId:e.callbackId,data:s})}),(function(s){i.postMessage({sourceName:t,targetName:a,callback:Ti,callbackId:e.callbackId,reason:wrapReason(s)})}))}else e.streamId?message_handler_assertClassBrand(Hi,this,_createStreamSink).call(this,e):s(e.data)};i.addEventListener("message",this._onComObjOnMessage)}on(t,e){const i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){const s=this.callbackId++,a=new PromiseCapability;this.callbackCapabilities[s]=a;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},i)}catch(t){a.reject(t)}return a.promise}sendWithStream(t,e,i,s){const a=this.streamId++,r=this.sourceName,n=this.targetName,o=this.comObj;return new ReadableStream({start:i=>{const l=new PromiseCapability;this.streamControllers[a]={controller:i,startCall:l,pullCall:null,cancelCall:null,isClosed:!1};o.postMessage({sourceName:r,targetName:n,action:t,streamId:a,data:e,desiredSize:i.desiredSize},s);return l.promise},pull:t=>{const e=new PromiseCapability;this.streamControllers[a].pullCall=e;o.postMessage({sourceName:r,targetName:n,stream:Ni,streamId:a,desiredSize:t.desiredSize});return e.promise},cancel:t=>{assert(t instanceof Error,"cancel must have a valid reason");const e=new PromiseCapability;this.streamControllers[a].cancelCall=e;this.streamControllers[a].isClosed=!0;o.postMessage({sourceName:r,targetName:n,stream:Ri,streamId:a,reason:wrapReason(t)});return e.promise}},i)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}function _createStreamSink(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,a=this.comObj,r=this,n=this.actionHandler[t.action],o={enqueue(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const o=this.desiredSize;this.desiredSize-=r;if(o>0&&this.desiredSize<=0){this.sinkCapability=new PromiseCapability;this.ready=this.sinkCapability.promise}a.postMessage({sourceName:i,targetName:s,stream:Bi,streamId:e,chunk:t},n)},close(){if(!this.isCancelled){this.isCancelled=!0;a.postMessage({sourceName:i,targetName:s,stream:Li,streamId:e});delete r.streamSinks[e]}},error(t){assert(t instanceof Error,"error must have a valid reason");if(!this.isCancelled){this.isCancelled=!0;a.postMessage({sourceName:i,targetName:s,stream:Oi,streamId:e,reason:wrapReason(t)})}},sinkCapability:new PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};o.sinkCapability.resolve();o.ready=o.sinkCapability.promise;this.streamSinks[e]=o;new Promise((function(e){e(n(t.data,o))})).then((function(){a.postMessage({sourceName:i,targetName:s,stream:ji,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:i,targetName:s,stream:ji,streamId:e,reason:wrapReason(t)})}))}function _processStreamMessage(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,a=this.comObj,r=this.streamControllers[e],n=this.streamSinks[e];switch(t.stream){case ji:t.success?r.startCall.resolve():r.startCall.reject(wrapReason(t.reason));break;case Wi:t.success?r.pullCall.resolve():r.pullCall.reject(wrapReason(t.reason));break;case Ni:if(!n){a.postMessage({sourceName:i,targetName:s,stream:Wi,streamId:e,success:!0});break}n.desiredSize<=0&&t.desiredSize>0&&n.sinkCapability.resolve();n.desiredSize=t.desiredSize;new Promise((function(t){t(n.onPull?.())})).then((function(){a.postMessage({sourceName:i,targetName:s,stream:Wi,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:i,targetName:s,stream:Wi,streamId:e,reason:wrapReason(t)})}));break;case Bi:assert(r,"enqueue should have stream controller");if(r.isClosed)break;r.controller.enqueue(t.chunk);break;case Li:assert(r,"close should have stream controller");if(r.isClosed)break;r.isClosed=!0;r.controller.close();message_handler_assertClassBrand(Hi,this,_deleteStreamController).call(this,r,e);break;case Oi:assert(r,"error should have stream controller");r.controller.error(wrapReason(t.reason));message_handler_assertClassBrand(Hi,this,_deleteStreamController).call(this,r,e);break;case Di:t.success?r.cancelCall.resolve():r.cancelCall.reject(wrapReason(t.reason));message_handler_assertClassBrand(Hi,this,_deleteStreamController).call(this,r,e);break;case Ri:if(!n)break;new Promise((function(e){e(n.onCancel?.(wrapReason(t.reason)))})).then((function(){a.postMessage({sourceName:i,targetName:s,stream:Di,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:i,targetName:s,stream:Di,streamId:e,reason:wrapReason(t)})}));n.sinkCapability.reject(wrapReason(t.reason));n.isCancelled=!0;delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async function _deleteStreamController(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]);delete this.streamControllers[e]}function metadata_classPrivateFieldInitSpec(t,e,i){!function metadata_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e);e.set(t,i)}function metadata_classPrivateFieldGet(t,e){return t.get(metadata_assertClassBrand(t,e))}function metadata_classPrivateFieldSet(t,e,i){return t.set(metadata_assertClassBrand(t,e),i),i}function metadata_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var Ui=new WeakMap,zi=new WeakMap;class Metadata{constructor(t){let{parsedData:e,rawData:i}=t;metadata_classPrivateFieldInitSpec(this,Ui,void 0);metadata_classPrivateFieldInitSpec(this,zi,void 0);metadata_classPrivateFieldSet(Ui,this,e);metadata_classPrivateFieldSet(zi,this,i)}getRaw(){return metadata_classPrivateFieldGet(zi,this)}get(t){return metadata_classPrivateFieldGet(Ui,this).get(t)??null}getAll(){return objectFromMap(metadata_classPrivateFieldGet(Ui,this))}has(t){return metadata_classPrivateFieldGet(Ui,this).has(t)}}function optional_content_config_classPrivateFieldInitSpec(t,e,i){optional_content_config_checkPrivateRedeclaration(t,e);e.set(t,i)}function optional_content_config_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function optional_content_config_classPrivateFieldGet(t,e){return t.get(optional_content_config_assertClassBrand(t,e))}function optional_content_config_classPrivateFieldSet(t,e,i){return t.set(optional_content_config_assertClassBrand(t,e),i),i}function optional_content_config_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}const Vi=Symbol("INTERNAL");var qi=new WeakMap,$i=new WeakMap,Xi=new WeakMap,Ki=new WeakMap;class OptionalContentGroup{constructor(t,e){let{name:i,intent:s,usage:a}=e;optional_content_config_classPrivateFieldInitSpec(this,qi,!1);optional_content_config_classPrivateFieldInitSpec(this,$i,!1);optional_content_config_classPrivateFieldInitSpec(this,Xi,!1);optional_content_config_classPrivateFieldInitSpec(this,Ki,!0);optional_content_config_classPrivateFieldSet(qi,this,!!(t&n));optional_content_config_classPrivateFieldSet($i,this,!!(t&o));this.name=i;this.intent=s;this.usage=a}get visible(){if(optional_content_config_classPrivateFieldGet(Xi,this))return optional_content_config_classPrivateFieldGet(Ki,this);if(!optional_content_config_classPrivateFieldGet(Ki,this))return!1;const{print:t,view:e}=this.usage;return optional_content_config_classPrivateFieldGet(qi,this)?"OFF"!==e?.viewState:!optional_content_config_classPrivateFieldGet($i,this)||"OFF"!==t?.printState}_setVisible(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t!==Vi&&unreachable("Internal method `_setVisible` called.");optional_content_config_classPrivateFieldSet(Xi,this,i);optional_content_config_classPrivateFieldSet(Ki,this,e)}}var Yi=new WeakMap,Qi=new WeakMap,Ji=new WeakMap,Zi=new WeakMap,ts=new WeakSet;class OptionalContentConfig{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;!function optional_content_config_classPrivateMethodInitSpec(t,e){optional_content_config_checkPrivateRedeclaration(t,e);e.add(t)}(this,ts);optional_content_config_classPrivateFieldInitSpec(this,Yi,null);optional_content_config_classPrivateFieldInitSpec(this,Qi,new Map);optional_content_config_classPrivateFieldInitSpec(this,Ji,null);optional_content_config_classPrivateFieldInitSpec(this,Zi,null);this.renderingIntent=e;this.name=null;this.creator=null;if(null!==t){this.name=t.name;this.creator=t.creator;optional_content_config_classPrivateFieldSet(Zi,this,t.order);for(const i of t.groups)optional_content_config_classPrivateFieldGet(Qi,this).set(i.id,new OptionalContentGroup(e,i));if("OFF"===t.baseState)for(const t of optional_content_config_classPrivateFieldGet(Qi,this).values())t._setVisible(Vi,!1);for(const e of t.on)optional_content_config_classPrivateFieldGet(Qi,this).get(e)._setVisible(Vi,!0);for(const e of t.off)optional_content_config_classPrivateFieldGet(Qi,this).get(e)._setVisible(Vi,!1);optional_content_config_classPrivateFieldSet(Ji,this,this.getHash())}}isVisible(t){if(0===optional_content_config_classPrivateFieldGet(Qi,this).size)return!0;if(!t){info("Optional content group not defined.");return!0}if("OCG"===t.type){if(!optional_content_config_classPrivateFieldGet(Qi,this).has(t.id)){warn(`Optional content group not found: ${t.id}`);return!0}return optional_content_config_classPrivateFieldGet(Qi,this).get(t.id).visible}if("OCMD"===t.type){if(t.expression)return optional_content_config_assertClassBrand(ts,this,_evaluateVisibilityExpression).call(this,t.expression);if(!t.policy||"AnyOn"===t.policy){for(const e of t.ids){if(!optional_content_config_classPrivateFieldGet(Qi,this).has(e)){warn(`Optional content group not found: ${e}`);return!0}if(optional_content_config_classPrivateFieldGet(Qi,this).get(e).visible)return!0}return!1}if("AllOn"===t.policy){for(const e of t.ids){if(!optional_content_config_classPrivateFieldGet(Qi,this).has(e)){warn(`Optional content group not found: ${e}`);return!0}if(!optional_content_config_classPrivateFieldGet(Qi,this).get(e).visible)return!1}return!0}if("AnyOff"===t.policy){for(const e of t.ids){if(!optional_content_config_classPrivateFieldGet(Qi,this).has(e)){warn(`Optional content group not found: ${e}`);return!0}if(!optional_content_config_classPrivateFieldGet(Qi,this).get(e).visible)return!0}return!1}if("AllOff"===t.policy){for(const e of t.ids){if(!optional_content_config_classPrivateFieldGet(Qi,this).has(e)){warn(`Optional content group not found: ${e}`);return!0}if(optional_content_config_classPrivateFieldGet(Qi,this).get(e).visible)return!1}return!0}warn(`Unknown optional content policy ${t.policy}.`);return!0}warn(`Unknown group type ${t.type}.`);return!0}setVisibility(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=optional_content_config_classPrivateFieldGet(Qi,this).get(t);if(i){i._setVisible(Vi,!!e,!0);optional_content_config_classPrivateFieldSet(Yi,this,null)}else warn(`Optional content group not found: ${t}`)}setOCGState(t){let e,{state:i,preserveRB:s}=t;for(const t of i){switch(t){case"ON":case"OFF":case"Toggle":e=t;continue}const i=optional_content_config_classPrivateFieldGet(Qi,this).get(t);if(i)switch(e){case"ON":i._setVisible(Vi,!0);break;case"OFF":i._setVisible(Vi,!1);break;case"Toggle":i._setVisible(Vi,!i.visible)}}optional_content_config_classPrivateFieldSet(Yi,this,null)}get hasInitialVisibility(){return null===optional_content_config_classPrivateFieldGet(Ji,this)||this.getHash()===optional_content_config_classPrivateFieldGet(Ji,this)}getOrder(){return optional_content_config_classPrivateFieldGet(Qi,this).size?optional_content_config_classPrivateFieldGet(Zi,this)?optional_content_config_classPrivateFieldGet(Zi,this).slice():[...optional_content_config_classPrivateFieldGet(Qi,this).keys()]:null}getGroups(){return optional_content_config_classPrivateFieldGet(Qi,this).size>0?objectFromMap(optional_content_config_classPrivateFieldGet(Qi,this)):null}getGroup(t){return optional_content_config_classPrivateFieldGet(Qi,this).get(t)||null}getHash(){if(null!==optional_content_config_classPrivateFieldGet(Yi,this))return optional_content_config_classPrivateFieldGet(Yi,this);const t=new MurmurHash3_64;for(const[e,i]of optional_content_config_classPrivateFieldGet(Qi,this))t.update(`${e}:${i.visible}`);return optional_content_config_classPrivateFieldSet(Yi,this,t.hexdigest())}}function _evaluateVisibilityExpression(t){const e=t.length;if(e<2)return!0;const i=t[0];for(let s=1;s<e;s++){const e=t[s];let a;if(Array.isArray(e))a=optional_content_config_assertClassBrand(ts,this,_evaluateVisibilityExpression).call(this,e);else{if(!optional_content_config_classPrivateFieldGet(Qi,this).has(e)){warn(`Optional content group not found: ${e}`);return!0}a=optional_content_config_classPrivateFieldGet(Qi,this).get(e).visible}switch(i){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return"And"===i}class PDFDataTransportStream{constructor(t,e){let{disableRange:i=!1,disableStream:s=!1}=e;assert(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:a,initialData:r,progressiveDone:n,contentDispositionFilename:o}=t;this._queuedChunks=[];this._progressiveDone=n;this._contentDispositionFilename=o;if(r?.length>0){const t=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(t)}this._pdfDataRangeTransport=t;this._isStreamingSupported=!s;this._isRangeSupported=!i;this._contentLength=a;this._fullRequestReader=null;this._rangeReaders=[];t.addRangeListener(((t,e)=>{this._onReceiveData({begin:t,chunk:e})}));t.addProgressListener(((t,e)=>{this._onProgress({loaded:t,total:e})}));t.addProgressiveReadListener((t=>{this._onReceiveData({chunk:t})}));t.addProgressiveDoneListener((()=>{this._onProgressiveDone()}));t.transportReady()}_onReceiveData(t){let{begin:e,chunk:i}=t;const s=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;if(void 0===e)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{assert(this._rangeReaders.some((function(t){if(t._begin!==e)return!1;t._enqueue(s);return!0})),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){void 0===t.total?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone();this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){assert(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;this._queuedChunks=null;return new PDFDataTransportStreamReader(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new PDFDataTransportStreamRangeReader(this,t,e);this._pdfDataRangeTransport.requestDataRange(t,e);this._rangeReaders.push(i);return i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class PDFDataTransportStreamReader{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._stream=t;this._done=i||!1;this._filename=isPdfFile(s)?s:null;this._queuedChunks=e||[];this._loaded=0;for(const t of this._queuedChunks)this._loaded+=t.byteLength;this._requests=[];this._headersReady=Promise.resolve();t._fullRequestReader=this;this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length>0){this._requests.shift().resolve({value:t,done:!1})}else this._queuedChunks.push(t);this._loaded+=t.byteLength}}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0){return{value:this._queuedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const t=new PromiseCapability;this._requests.push(t);return t.promise}cancel(t){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class PDFDataTransportStreamRangeReader{constructor(t,e,i){this._stream=t;this._begin=e;this._end=i;this._queuedChunk=null;this._requests=[];this._done=!1;this.onProgress=null}_enqueue(t){if(!this._done){if(0===this._requests.length)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0;this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;this._queuedChunk=null;return{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const t=new PromiseCapability;this._requests.push(t);return t.promise}cancel(t){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0;this._stream._removeRangeReader(this)}}function validateRangeRequestCapabilities(t){let{getResponseHeader:e,isHttp:i,rangeChunkSize:s,disableRange:a}=t;const r={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(e("Content-Length"),10);if(!Number.isInteger(n))return r;r.suggestedLength=n;if(n<=2*s)return r;if(a||!i)return r;if("bytes"!==e("Accept-Ranges"))return r;if("identity"!==(e("Content-Encoding")||"identity"))return r;r.allowRangeRequests=!0;return r}function extractFilenameFromHeader(t){const e=t("Content-Disposition");if(e){let t=function getFilenameFromContentDispositionHeader(t){let e=!0,i=toParamRegExp("filename\\*","i").exec(t);if(i){i=i[1];let t=rfc2616unquote(i);t=unescape(t);t=rfc5987decode(t);t=rfc2047decode(t);return fixupEncoding(t)}i=function rfc2231getparam(t){const e=[];let i;const s=toParamRegExp("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(i=s.exec(t));){let[,t,s,a]=i;t=parseInt(t,10);if(t in e){if(0===t)break}else e[t]=[s,a]}const a=[];for(let t=0;t<e.length&&t in e;++t){let[i,s]=e[t];s=rfc2616unquote(s);if(i){s=unescape(s);0===t&&(s=rfc5987decode(s))}a.push(s)}return a.join("")}(t);if(i)return fixupEncoding(rfc2047decode(i));i=toParamRegExp("filename","i").exec(t);if(i){i=i[1];let t=rfc2616unquote(i);t=rfc2047decode(t);return fixupEncoding(t)}function toParamRegExp(t,e){return new RegExp("(?:^|;)\\s*"+t+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',e)}function textdecode(t,i){if(t){if(!/^[\x00-\xFF]+$/.test(i))return i;try{const s=new TextDecoder(t,{fatal:!0}),a=stringToBytes(i);i=s.decode(a);e=!1}catch{}}return i}function fixupEncoding(t){if(e&&/[\x80-\xff]/.test(t)){t=textdecode("utf-8",t);e&&(t=textdecode("iso-8859-1",t))}return t}function rfc2616unquote(t){if(t.startsWith('"')){const e=t.slice(1).split('\\"');for(let t=0;t<e.length;++t){const i=e[t].indexOf('"');if(-1!==i){e[t]=e[t].slice(0,i);e.length=t+1}e[t]=e[t].replaceAll(/\\(.)/g,"$1")}t=e.join('"')}return t}function rfc5987decode(t){const e=t.indexOf("'");return-1===e?t:textdecode(t.slice(0,e),t.slice(e+1).replace(/^[^']*'/,""))}function rfc2047decode(t){return!t.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(t)?t:t.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(t,e,i,s){if("q"===i||"Q"===i)return textdecode(e,s=(s=s.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,(function(t,e){return String.fromCharCode(parseInt(e,16))})));try{s=atob(s)}catch{}return textdecode(e,s)}))}return""}(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(isPdfFile(t))return t}return null}function createResponseStatusError(t,e){return 404===t||0===t&&e.startsWith("file:")?new MissingPDFException('Missing PDF "'+e+'".'):new UnexpectedResponseException(`Unexpected server response (${t}) while retrieving PDF "${e}".`,t)}function validateResponseStatus(t){return 200===t||206===t}function createFetchOptions(t,e,i){return{method:"GET",headers:t,signal:i.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function createHeaders(t){const e=new Headers;for(const i in t){const s=t[i];void 0!==s&&e.append(i,s)}return e}function getArrayBuffer(t){if(t instanceof Uint8Array)return t.buffer;if(t instanceof ArrayBuffer)return t;warn(`getArrayBuffer - unexpected data format: ${t}`);return new Uint8Array(t).buffer}class PDFFetchStream{constructor(t){this.source=t;this.isHttp=/^https?:/i.test(t.url);this.httpHeaders=this.isHttp&&t.httpHeaders||{};this._fullRequestReader=null;this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){assert(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once.");this._fullRequestReader=new PDFFetchStreamReader(this);return this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new PDFFetchStreamRangeReader(this,t,e);this._rangeRequestReaders.push(i);return i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class PDFFetchStreamReader{constructor(t){this._stream=t;this._reader=null;this._loaded=0;this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1;this._contentLength=e.length;this._headersCapability=new PromiseCapability;this._disableRange=e.disableRange||!1;this._rangeChunkSize=e.rangeChunkSize;this._rangeChunkSize||this._disableRange||(this._disableRange=!0);this._abortController=new AbortController;this._isStreamingSupported=!e.disableStream;this._isRangeSupported=!e.disableRange;this._headers=createHeaders(this._stream.httpHeaders);const i=e.url;fetch(i,createFetchOptions(this._headers,this._withCredentials,this._abortController)).then((t=>{if(!validateResponseStatus(t.status))throw createResponseStatusError(t.status,i);this._reader=t.body.getReader();this._headersCapability.resolve();const getResponseHeader=e=>t.headers.get(e),{allowRangeRequests:e,suggestedLength:s}=validateRangeRequestCapabilities({getResponseHeader,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=e;this._contentLength=s||this._contentLength;this._filename=extractFilenameFromHeader(getResponseHeader);!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new AbortException("Streaming is disabled."))})).catch(this._headersCapability.reject);this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();if(e)return{value:t,done:e};this._loaded+=t.byteLength;this.onProgress?.({loaded:this._loaded,total:this._contentLength});return{value:getArrayBuffer(t),done:!1}}cancel(t){this._reader?.cancel(t);this._abortController.abort()}}class PDFFetchStreamRangeReader{constructor(t,e,i){this._stream=t;this._reader=null;this._loaded=0;const s=t.source;this._withCredentials=s.withCredentials||!1;this._readCapability=new PromiseCapability;this._isStreamingSupported=!s.disableStream;this._abortController=new AbortController;this._headers=createHeaders(this._stream.httpHeaders);this._headers.append("Range",`bytes=${e}-${i-1}`);const a=s.url;fetch(a,createFetchOptions(this._headers,this._withCredentials,this._abortController)).then((t=>{if(!validateResponseStatus(t.status))throw createResponseStatusError(t.status,a);this._readCapability.resolve();this._reader=t.body.getReader()})).catch(this._readCapability.reject);this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();if(e)return{value:t,done:e};this._loaded+=t.byteLength;this.onProgress?.({loaded:this._loaded});return{value:getArrayBuffer(t),done:!1}}cancel(t){this._reader?.cancel(t);this._abortController.abort()}}class NetworkManager{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=t;this.isHttp=/^https?:/i.test(t);this.httpHeaders=this.isHttp&&e.httpHeaders||Object.create(null);this.withCredentials=e.withCredentials||!1;this.currXhrId=0;this.pendingRequests=Object.create(null)}requestRange(t,e,i){const s={begin:t,end:e};for(const t in i)s[t]=i[t];return this.request(s)}requestFull(t){return this.request(t)}request(t){const e=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:e};e.open("GET",this.url);e.withCredentials=this.withCredentials;for(const t in this.httpHeaders){const i=this.httpHeaders[t];void 0!==i&&e.setRequestHeader(t,i)}if(this.isHttp&&"begin"in t&&"end"in t){e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`);s.expectedStatus=206}else s.expectedStatus=200;e.responseType="arraybuffer";t.onError&&(e.onerror=function(i){t.onError(e.status)});e.onreadystatechange=this.onStateChange.bind(this,i);e.onprogress=this.onProgress.bind(this,i);s.onHeadersReceived=t.onHeadersReceived;s.onDone=t.onDone;s.onError=t.onError;s.onProgress=t.onProgress;e.send(null);return i}onProgress(t,e){const i=this.pendingRequests[t];i&&i.onProgress?.(e)}onStateChange(t,e){const i=this.pendingRequests[t];if(!i)return;const s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived){i.onHeadersReceived();delete i.onHeadersReceived}if(4!==s.readyState)return;if(!(t in this.pendingRequests))return;delete this.pendingRequests[t];if(0===s.status&&this.isHttp){i.onError?.(s.status);return}const a=s.status||200;if(!(200===a&&206===i.expectedStatus)&&a!==i.expectedStatus){i.onError?.(s.status);return}const r=function network_getArrayBuffer(t){const e=t.response;return"string"!=typeof e?e:stringToBytes(e).buffer}(s);if(206===a){const t=s.getResponseHeader("Content-Range"),e=/bytes (\d+)-(\d+)\/(\d+)/.exec(t);i.onDone({begin:parseInt(e[1],10),chunk:r})}else r?i.onDone({begin:0,chunk:r}):i.onError?.(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t];e.abort()}}class PDFNetworkStream{constructor(t){this._source=t;this._manager=new NetworkManager(t.url,{httpHeaders:t.httpHeaders,withCredentials:t.withCredentials});this._rangeChunkSize=t.rangeChunkSize;this._fullRequestReader=null;this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){assert(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once.");this._fullRequestReader=new PDFNetworkStreamFullRequestReader(this._manager,this._source);return this._fullRequestReader}getRangeReader(t,e){const i=new PDFNetworkStreamRangeRequestReader(this._manager,t,e);i.onClosed=this._onRangeRequestReaderClosed.bind(this);this._rangeRequestReaders.push(i);return i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class PDFNetworkStreamFullRequestReader{constructor(t,e){this._manager=t;const i={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url;this._fullRequestId=t.requestFull(i);this._headersReceivedCapability=new PromiseCapability;this._disableRange=e.disableRange||!1;this._contentLength=e.length;this._rangeChunkSize=e.rangeChunkSize;this._rangeChunkSize||this._disableRange||(this._disableRange=!0);this._isStreamingSupported=!1;this._isRangeSupported=!1;this._cachedChunks=[];this._requests=[];this._done=!1;this._storedError=void 0;this._filename=null;this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t),getResponseHeader=t=>e.getResponseHeader(t),{allowRangeRequests:i,suggestedLength:s}=validateRangeRequestCapabilities({getResponseHeader,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0);this._contentLength=s||this._contentLength;this._filename=extractFilenameFromHeader(getResponseHeader);this._isRangeSupported&&this._manager.abortRequest(t);this._headersReceivedCapability.resolve()}_onDone(t){if(t)if(this._requests.length>0){this._requests.shift().resolve({value:t.chunk,done:!1})}else this._cachedChunks.push(t.chunk);this._done=!0;if(!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=createResponseStatusError(t,this._url);this._headersReceivedCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0;this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0){return{value:this._cachedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const t=new PromiseCapability;this._requests.push(t);return t.promise}cancel(t){this._done=!0;this._headersReceivedCapability.reject(t);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0;this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId);this._fullRequestReader=null}}class PDFNetworkStreamRangeRequestReader{constructor(t,e,i){this._manager=t;const s={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url;this._requestId=t.requestRange(e,i,s);this._requests=[];this._queuedChunk=null;this._done=!1;this._storedError=void 0;this.onProgress=null;this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;if(this._requests.length>0){this._requests.shift().resolve({value:e,done:!1})}else this._queuedChunk=e;this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0;this._close()}_onError(t){this._storedError=createResponseStatusError(t,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0;this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){const t=this._queuedChunk;this._queuedChunk=null;return{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const t=new PromiseCapability;this._requests.push(t);return t.promise}cancel(t){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0;this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId);this._close()}}let es,is,ss,as;const rs=/^file:\/\/\/[a-zA-Z]:\//;class PDFNodeStream{constructor(t){this.source=t;this.url=function parseUrl(t){const e=as.parse(t);if("file:"===e.protocol||e.host)return e;if(/^[a-z]:[/\\]/i.test(t))return as.parse(`file:///${t}`);e.host||(e.protocol="file:");return e}(t.url);this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol||"capacitor:"===this.url.protocol;this.isFsUrl="file:"===this.url.protocol;this.httpHeaders=this.isHttp&&t.httpHeaders||{};this._fullRequestReader=null;this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){assert(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once.");this._fullRequestReader=this.isFsUrl?new PDFNodeStreamFsFullReader(this):new PDFNodeStreamFullReader(this);return this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=this.isFsUrl?new PDFNodeStreamFsRangeReader(this,t,e):new PDFNodeStreamRangeReader(this,t,e);this._rangeRequestReaders.push(i);return i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class BaseFullReader{constructor(t){this._url=t.url;this._done=!1;this._storedError=null;this.onProgress=null;const e=t.source;this._contentLength=e.length;this._loaded=0;this._filename=null;this._disableRange=e.disableRange||!1;this._rangeChunkSize=e.rangeChunkSize;this._rangeChunkSize||this._disableRange||(this._disableRange=!0);this._isStreamingSupported=!e.disableStream;this._isRangeSupported=!e.disableRange;this._readableStream=null;this._readCapability=new PromiseCapability;this._headersCapability=new PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;if(this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();if(null===t){this._readCapability=new PromiseCapability;return this.read()}this._loaded+=t.length;this.onProgress?.({loaded:this._loaded,total:this._contentLength});return{value:new Uint8Array(t).buffer,done:!1}}cancel(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}_error(t){this._storedError=t;this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t;t.on("readable",(()=>{this._readCapability.resolve()}));t.on("end",(()=>{t.destroy();this._done=!0;this._readCapability.resolve()}));t.on("error",(t=>{this._error(t)}));!this._isStreamingSupported&&this._isRangeSupported&&this._error(new AbortException("streaming is disabled"));this._storedError&&this._readableStream.destroy(this._storedError)}}class BaseRangeReader{constructor(t){this._url=t.url;this._done=!1;this._storedError=null;this.onProgress=null;this._loaded=0;this._readableStream=null;this._readCapability=new PromiseCapability;const e=t.source;this._isStreamingSupported=!e.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;if(this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();if(null===t){this._readCapability=new PromiseCapability;return this.read()}this._loaded+=t.length;this.onProgress?.({loaded:this._loaded});return{value:new Uint8Array(t).buffer,done:!1}}cancel(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}_error(t){this._storedError=t;this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t;t.on("readable",(()=>{this._readCapability.resolve()}));t.on("end",(()=>{t.destroy();this._done=!0;this._readCapability.resolve()}));t.on("error",(t=>{this._error(t)}));this._storedError&&this._readableStream.destroy(this._storedError)}}function createRequestOptions(t,e){return{protocol:t.protocol,auth:t.auth,host:t.hostname,port:t.port,path:t.path,method:"GET",headers:e}}class PDFNodeStreamFullReader extends BaseFullReader{constructor(t){super(t);const handleResponse=e=>{if(404===e.statusCode){const t=new MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=t;this._headersCapability.reject(t);return}this._headersCapability.resolve();this._setReadableStream(e);const getResponseHeader=t=>this._readableStream.headers[t.toLowerCase()],{allowRangeRequests:i,suggestedLength:s}=validateRangeRequestCapabilities({getResponseHeader,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=i;this._contentLength=s||this._contentLength;this._filename=extractFilenameFromHeader(getResponseHeader)};this._request=null;"http:"===this._url.protocol?this._request=is.request(createRequestOptions(this._url,t.httpHeaders),handleResponse):this._request=ss.request(createRequestOptions(this._url,t.httpHeaders),handleResponse);this._request.on("error",(t=>{this._storedError=t;this._headersCapability.reject(t)}));this._request.end()}}class PDFNodeStreamRangeReader extends BaseRangeReader{constructor(t,e,i){super(t);this._httpHeaders={};for(const e in t.httpHeaders){const i=t.httpHeaders[e];void 0!==i&&(this._httpHeaders[e]=i)}this._httpHeaders.Range=`bytes=${e}-${i-1}`;const handleResponse=t=>{if(404!==t.statusCode)this._setReadableStream(t);else{const t=new MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=t}};this._request=null;"http:"===this._url.protocol?this._request=is.request(createRequestOptions(this._url,this._httpHeaders),handleResponse):this._request=ss.request(createRequestOptions(this._url,this._httpHeaders),handleResponse);this._request.on("error",(t=>{this._storedError=t}));this._request.end()}}class PDFNodeStreamFsFullReader extends BaseFullReader{constructor(t){super(t);let e=decodeURIComponent(this._url.path);rs.test(this._url.href)&&(e=e.replace(/^\//,""));es.promises.lstat(e).then((t=>{this._contentLength=t.size;this._setReadableStream(es.createReadStream(e));this._headersCapability.resolve()}),(t=>{"ENOENT"===t.code&&(t=new MissingPDFException(`Missing PDF "${e}".`));this._storedError=t;this._headersCapability.reject(t)}))}}class PDFNodeStreamFsRangeReader extends BaseRangeReader{constructor(t,e,i){super(t);let s=decodeURIComponent(this._url.path);rs.test(this._url.href)&&(s=s.replace(/^\//,""));this._setReadableStream(es.createReadStream(s,{start:e,end:i-1}))}}class XfaText{static textContent(t){const e=[],i={items:e,styles:Object.create(null)};!function walk(t){if(!t)return;let i=null;const s=t.name;if("#text"===s)i=t.value;else{if(!XfaText.shouldBuildText(s))return;t?.attributes?.textContent?i=t.attributes.textContent:t.value&&(i=t.value)}null!==i&&e.push({str:i});if(t.children)for(const e of t.children)walk(e)}(t);return i}static shouldBuildText(t){return!("textarea"===t||"input"===t||"option"===t||"select"===t)}}function api_classPrivateGetter(t,e,i){return i(api_assertClassBrand(t,e))}function api_classPrivateMethodInitSpec(t,e){api_checkPrivateRedeclaration(t,e);e.add(t)}function api_classPrivateFieldInitSpec(t,e,i){api_checkPrivateRedeclaration(t,e);e.set(t,i)}function api_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function api_classPrivateFieldGet(t,e){return t.get(api_assertClassBrand(t,e))}function api_classPrivateFieldSet(t,e,i){return t.set(api_assertClassBrand(t,e),i),i}function api_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}const ns=65536;window.ServiceWorkerOptions={showUnverifiedSignatures:!1};const os=e?class NodeCanvasFactory extends BaseCanvasFactory{_createCanvas(t,e){return pi.createCanvas(t,e)}}:class DOMCanvasFactory extends BaseCanvasFactory{constructor(){let{ownerDocument:t=globalThis.document}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();this._document=t}_createCanvas(t,e){const i=this._document.createElement("canvas");i.width=t;i.height=e;return i}},ls=e?class NodeCMapReaderFactory extends BaseCMapReaderFactory{_fetchData(t,e){return node_utils_fetchData(t).then((t=>({cMapData:t,compressionType:e})))}}:DOMCMapReaderFactory,cs=e?class NodeFilterFactory extends BaseFilterFactory{}:class DOMFilterFactory extends BaseFilterFactory{constructor(){let{docId:t,ownerDocument:e=globalThis.document}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();!function _classPrivateMethodInitSpec(t,e){display_utils_checkPrivateRedeclaration(t,e);e.add(t)}(this,pt);display_utils_classPrivateFieldInitSpec(this,ot,void 0);display_utils_classPrivateFieldInitSpec(this,lt,void 0);display_utils_classPrivateFieldInitSpec(this,ct,void 0);display_utils_classPrivateFieldInitSpec(this,ht,void 0);display_utils_classPrivateFieldInitSpec(this,dt,void 0);display_utils_classPrivateFieldInitSpec(this,ut,0);display_utils_classPrivateFieldSet(ct,this,t);display_utils_classPrivateFieldSet(ht,this,e)}addFilter(t){var e,i;if(!t)return"none";let s,a,r,n,o=_classPrivateGetter(pt,this,_get_cache).get(t);if(o)return o;if(1===t.length){const e=t[0],i=new Array(256);for(let t=0;t<256;t++)i[t]=e[t]/255;n=s=a=r=i.join(",")}else{const[e,i,o]=t,l=new Array(256),c=new Array(256),h=new Array(256);for(let t=0;t<256;t++){l[t]=e[t]/255;c[t]=i[t]/255;h[t]=o[t]/255}s=l.join(",");a=c.join(",");r=h.join(",");n=`${s}${a}${r}`}o=_classPrivateGetter(pt,this,_get_cache).get(n);if(o){_classPrivateGetter(pt,this,_get_cache).set(t,o);return o}const l=`g_${display_utils_classPrivateFieldGet(ct,this)}_transfer_map_${display_utils_classPrivateFieldSet(ut,this,(e=display_utils_classPrivateFieldGet(ut,this),i=e++,e)),i}`,c=`url(#${l})`;_classPrivateGetter(pt,this,_get_cache).set(t,c);_classPrivateGetter(pt,this,_get_cache).set(n,c);const h=display_utils_assertClassBrand(pt,this,_createFilter).call(this,l);display_utils_assertClassBrand(pt,this,_addTransferMapConversion).call(this,s,a,r,h);return c}addHCMFilter(t,e){const i=`${t}-${e}`,s="base";let a=_classPrivateGetter(pt,this,_get_hcmCache).get(s);if(a?.key===i)return a.url;if(a){a.filter?.remove();a.key=i;a.url="none";a.filter=null}else{a={key:i,url:"none",filter:null};_classPrivateGetter(pt,this,_get_hcmCache).set(s,a)}if(!t||!e)return a.url;const r=display_utils_assertClassBrand(pt,this,_getRGB).call(this,t);t=Util.makeHexColor(...r);const n=display_utils_assertClassBrand(pt,this,_getRGB).call(this,e);e=Util.makeHexColor(...n);_classPrivateGetter(pt,this,_get_defs).style.color="";if("#000000"===t&&"#ffffff"===e||t===e)return a.url;const o=new Array(256);for(let t=0;t<=255;t++){const e=t/255;o[t]=e<=.03928?e/12.92:((e+.055)/1.055)**2.4}const l=o.join(","),c=`g_${display_utils_classPrivateFieldGet(ct,this)}_hcm_filter`,h=a.filter=display_utils_assertClassBrand(pt,this,_createFilter).call(this,c);display_utils_assertClassBrand(pt,this,_addTransferMapConversion).call(this,l,l,l,h);display_utils_assertClassBrand(pt,this,_addGrayConversion).call(this,h);const getSteps=(t,e)=>{const i=r[t]/255,s=n[t]/255,a=new Array(e+1);for(let t=0;t<=e;t++)a[t]=i+t/e*(s-i);return a.join(",")};display_utils_assertClassBrand(pt,this,_addTransferMapConversion).call(this,getSteps(0,5),getSteps(1,5),getSteps(2,5),h);a.url=`url(#${c})`;return a.url}addHighlightHCMFilter(t,e,i,s,a){const r=`${e}-${i}-${s}-${a}`;let n=_classPrivateGetter(pt,this,_get_hcmCache).get(t);if(n?.key===r)return n.url;if(n){n.filter?.remove();n.key=r;n.url="none";n.filter=null}else{n={key:r,url:"none",filter:null};_classPrivateGetter(pt,this,_get_hcmCache).set(t,n)}if(!e||!i)return n.url;const[o,l]=[e,i].map(display_utils_assertClassBrand(pt,this,_getRGB).bind(this));let c=Math.round(.2126*o[0]+.7152*o[1]+.0722*o[2]),h=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),[d,u]=[s,a].map(display_utils_assertClassBrand(pt,this,_getRGB).bind(this));h<c&&([c,h,d,u]=[h,c,u,d]);_classPrivateGetter(pt,this,_get_defs).style.color="";const getSteps=(t,e,i)=>{const s=new Array(256),a=(h-c)/i,r=t/255,n=(e-t)/(255*i);let o=0;for(let t=0;t<=i;t++){const e=Math.round(c+t*a),i=r+t*n;for(let t=o;t<=e;t++)s[t]=i;o=e+1}for(let t=o;t<256;t++)s[t]=s[o-1];return s.join(",")},p=`g_${display_utils_classPrivateFieldGet(ct,this)}_hcm_${t}_filter`,_=n.filter=display_utils_assertClassBrand(pt,this,_createFilter).call(this,p);display_utils_assertClassBrand(pt,this,_addGrayConversion).call(this,_);display_utils_assertClassBrand(pt,this,_addTransferMapConversion).call(this,getSteps(d[0],u[0],5),getSteps(d[1],u[1],5),getSteps(d[2],u[2],5),_);n.url=`url(#${p})`;return n.url}destroy(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])||0===_classPrivateGetter(pt,this,_get_hcmCache).size){if(display_utils_classPrivateFieldGet(lt,this)){display_utils_classPrivateFieldGet(lt,this).parentNode.parentNode.remove();display_utils_classPrivateFieldSet(lt,this,null)}if(display_utils_classPrivateFieldGet(ot,this)){display_utils_classPrivateFieldGet(ot,this).clear();display_utils_classPrivateFieldSet(ot,this,null)}display_utils_classPrivateFieldSet(ut,this,0)}}},hs=e?class NodeStandardFontDataFactory extends BaseStandardFontDataFactory{_fetchData(t){return node_utils_fetchData(t)}}:DOMStandardFontDataFactory;function getDocument(t){"string"==typeof t||t instanceof URL?t={url:t}:(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});if("object"!=typeof t)throw new Error("Invalid parameter in getDocument, need parameter object.");if(!t.url&&!t.data&&!t.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const i=new PDFDocumentLoadingTask,{docId:s}=i,a=t.url?function getUrlProp(t,i){if(t instanceof URL)return t.href;try{return i?new URL(t,window.location.origin+i).href:new URL(t,window.location).href}catch(i){if(e&&"string"==typeof t)return t}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(t.url,t.baseHref):null,r=t.data?function getDataProp(t){if(e&&"undefined"!=typeof Buffer&&t instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength)return t;if("string"==typeof t)return stringToBytes(t);if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)||"object"==typeof t&&!isNaN(t?.length))return new Uint8Array(t);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(t.data):null,n=t.httpHeaders||null,o=!0===t.withCredentials,l=t.password??null,c=t.range instanceof PDFDataRangeTransport?t.range:null,h=Number.isInteger(t.rangeChunkSize)&&t.rangeChunkSize>0?t.rangeChunkSize:ns;let d=t.worker instanceof PDFWorker?t.worker:null;const u=t.verbosity,p="string"!=typeof t.docBaseUrl||isDataScheme(t.docBaseUrl)?null:t.docBaseUrl,_="function"==typeof t.cMapUrl?t.cMapUrl():"string"==typeof t.cMapUrl?t.cMapUrl:null,f=!1!==t.cMapPacked,g=t.CMapReaderFactory||ls,v="function"==typeof t.standardFontDataUrl?t.standardFontDataUrl():"string"==typeof t.standardFontDataUrl?t.standardFontDataUrl:null,m=t.StandardFontDataFactory||hs,P=!0!==t.stopAtErrors,y=Number.isInteger(t.maxImageSize)&&t.maxImageSize>-1?t.maxImageSize:-1,b=!1!==t.isEvalSupported,w="boolean"==typeof t.isOffscreenCanvasSupported?t.isOffscreenCanvasSupported:!e,A=Number.isInteger(t.canvasMaxAreaInBytes)?t.canvasMaxAreaInBytes:-1,S="boolean"==typeof t.disableFontFace?t.disableFontFace:e,x=!0===t.fontExtraProperties,C=!0===t.enableXfa,k=t.ownerDocument||globalThis.document,E=!0===t.disableRange,M=!0===t.disableStream,G=!0===t.disableAutoFetch,I=!0===t.pdfBug,T=c?c.length:t.length??NaN,R="boolean"==typeof t.useSystemFonts?t.useSystemFonts:!e&&!S,D="boolean"==typeof t.useWorkerFetch?t.useWorkerFetch:g===DOMCMapReaderFactory&&m===DOMStandardFontDataFactory&&_&&v&&isValidFetchUrl(_,document.baseURI)&&isValidFetchUrl(v,document.baseURI),L=t.canvasFactory||new os({ownerDocument:k}),B=t.filterFactory||new cs({docId:s,ownerDocument:k});setVerbosityLevel(u);const O={canvasFactory:L,filterFactory:B};if(!D){O.cMapReaderFactory=new g({baseUrl:_,isCompressed:f});O.standardFontDataFactory=new m({baseUrl:v})}if(!d){const t={verbosity:u,port:GlobalWorkerOptions.workerPort};d=t.port?PDFWorker.fromPort(t):new PDFWorker(t);i._worker=d}const N={docId:s,apiVersion:"4.1.834",data:r,password:l,disableAutoFetch:G,rangeChunkSize:h,length:T,docBaseUrl:p,enableXfa:C,evaluatorOptions:{maxImageSize:y,disableFontFace:S,ignoreErrors:P,isEvalSupported:b,isOffscreenCanvasSupported:w,canvasMaxAreaInBytes:A,fontExtraProperties:x,useSystemFonts:R,cMapUrl:D?_:null,standardFontDataUrl:D?v:null}},W={ignoreErrors:P,isEvalSupported:b,disableFontFace:S,fontExtraProperties:x,enableXfa:C,ownerDocument:k,disableAutoFetch:G,pdfBug:I,styleElement:null};d.promise.then((function(){if(i.destroyed)throw new Error("Loading aborted");const t=async function _fetchDocument(t,e){if(t.destroyed)throw new Error("Worker was destroyed");const i=await t.messageHandler.sendWithPromise("GetDocRequest",e,e.data?[e.data.buffer]:null);if(t.destroyed)throw new Error("Worker was destroyed");return i}(d,N),l=new Promise((function(t){let i;if(c)i=new PDFDataTransportStream(c,{disableRange:E,disableStream:M});else if(!r){i=(t=>{if(e){return function(){return"undefined"!=typeof fetch&&"undefined"!=typeof Response&&"body"in Response.prototype}()&&isValidFetchUrl(t.url)?new PDFFetchStream(t):new PDFNodeStream(t)}return isValidFetchUrl(t.url)?new PDFFetchStream(t):new PDFNetworkStream(t)})({url:a,length:T,httpHeaders:n,withCredentials:o,rangeChunkSize:h,disableRange:E,disableStream:M})}t(i)}));return Promise.all([t,l]).then((function(t){let[e,a]=t;if(i.destroyed)throw new Error("Loading aborted");const r=new MessageHandler(s,e,d.port),n=new WorkerTransport(r,i,a,W,O);i._transport=n;r.send("showUnverifiedSignatures",window.ServiceWorkerOptions.showUnverifiedSignatures);r.send("Ready",null)}))})).catch(i._capability.reject);return i}class PDFDocumentLoadingTask{constructor(){var t,e;this._capability=new PromiseCapability;this._transport=null;this._worker=null;this.docId=`d${ds._=(t=ds._,e=t++,t),e}`;this.destroyed=!1;this.onPassword=null;this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0);await(this._transport?.destroy())}catch(t){this._worker?.port&&delete this._worker._pendingDestroy;throw t}this._transport=null;if(this._worker){this._worker.destroy();this._worker=null}}}var ds={_:0};class PDFDataRangeTransport{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.length=t;this.initialData=e;this.progressiveDone=i;this.contentDispositionFilename=s;this._rangeListeners=[];this._progressListeners=[];this._progressiveReadListeners=[];this._progressiveDoneListeners=[];this._readyCapability=new PromiseCapability}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const i of this._rangeListeners)i(t,e)}onDataProgress(t,e){this._readyCapability.promise.then((()=>{for(const i of this._progressListeners)i(t,e)}))}onDataProgressiveRead(t){this._readyCapability.promise.then((()=>{for(const e of this._progressiveReadListeners)e(t)}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(const t of this._progressiveDoneListeners)t()}))}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){unreachable("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class PDFDocumentProxy{constructor(t,e){this._pdfInfo=t;this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return shadow(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){let{intent:t="display"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var us=new WeakMap,ps=new WeakMap,_s=new WeakSet;class PDFPageProxy{constructor(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];api_classPrivateMethodInitSpec(this,_s);api_classPrivateFieldInitSpec(this,us,null);api_classPrivateFieldInitSpec(this,ps,!1);this._pageIndex=t;this._pageInfo=e;this._transport=i;this._stats=s?new StatTimer:null;this._pdfBug=s;this.commonObjs=i.commonObjs;this.objs=new PDFObjects;this._maybeCleanupAfterRender=!1;this._intentStates=new Map;this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:a=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new PageViewport({viewBox:this.view,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:a})}getAnnotations(){let{intent:t="display"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return shadow(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render(t){let{canvasContext:e,viewport:i,intent:s="display",annotationMode:a=u.ENABLE,transform:r=null,background:n=null,optionalContentConfigPromise:l=null,annotationCanvasMap:c=null,pageColors:h=null,printAnnotationStorage:d=null}=t;this._stats?.time("Overall");const p=this._transport.getRenderingIntent(s,a,d),{renderingIntent:_,cacheKey:f}=p;api_classPrivateFieldSet(ps,this,!1);api_assertClassBrand(_s,this,_abortDelayedCleanup).call(this);l||=this._transport.getOptionalContentConfig(_);let g=this._intentStates.get(f);if(!g){g=Object.create(null);this._intentStates.set(f,g)}if(g.streamReaderCancelTimeout){clearTimeout(g.streamReaderCancelTimeout);g.streamReaderCancelTimeout=null}const v=!!(_&o);if(!g.displayReadyCapability){g.displayReadyCapability=new PromiseCapability;g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null};this._stats?.time("Page Request");this._pumpOperatorList(p)}const complete=t=>{g.renderTasks.delete(m);(this._maybeCleanupAfterRender||v)&&api_classPrivateFieldSet(ps,this,!0);api_assertClassBrand(_s,this,_tryCleanup).call(this,!v);if(t){m.capability.reject(t);this._abortOperatorList({intentState:g,reason:t instanceof Error?t:new Error(t)})}else m.capability.resolve();this._stats?.timeEnd("Rendering");this._stats?.timeEnd("Overall")},m=new InternalRenderTask({callback:complete,params:{canvasContext:e,viewport:i,transform:r,background:n},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:h});(g.renderTasks||=new Set).add(m);const P=m.task;Promise.all([g.displayReadyCapability.promise,l]).then((t=>{let[e,i]=t;if(this.destroyed)complete();else{this._stats?.time("Rendering");if(!(i.renderingIntent&_))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");m.initializeGraphics({transparency:e,optionalContentConfig:i});m.operatorListChanged()}})).catch(complete);return P}getOperatorList(){let{intent:t="display",annotationMode:e=u.ENABLE,printAnnotationStorage:i=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=this._transport.getRenderingIntent(t,e,i,!0);let a,r=this._intentStates.get(s.cacheKey);if(!r){r=Object.create(null);this._intentStates.set(s.cacheKey,r)}if(!r.opListReadCapability){a=Object.create(null);a.operatorListChanged=function operatorListChanged(){if(r.operatorList.lastChunk){r.opListReadCapability.resolve(r.operatorList);r.renderTasks.delete(a)}};r.opListReadCapability=new PromiseCapability;(r.renderTasks||=new Set).add(a);r.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null};this._stats?.time("Page Request");this._pumpOperatorList(s)}return r.opListReadCapability.promise}streamTextContent(){let{includeMarkedContent:t=!1,disableNormalization:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===t,disableNormalization:!0===e},{highWaterMark:100,size:t=>t.items.length})}getTextContent(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then((t=>XfaText.textContent(t)));const e=this.streamTextContent(t);return new Promise((function(t,i){const s=e.getReader(),a={items:[],styles:Object.create(null)};!function pump(){s.read().then((function(e){let{value:i,done:s}=e;if(s)t(a);else{Object.assign(a.styles,i.styles);a.items.push(...i.items);pump()}}),i)}()}))}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values()){this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0});if(!e.opListReadCapability)for(const i of e.renderTasks){t.push(i.completed);i.cancel()}}this.objs.clear();api_classPrivateFieldSet(ps,this,!1);api_assertClassBrand(_s,this,_abortDelayedCleanup).call(this);return Promise.all(t)}cleanup(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];api_classPrivateFieldSet(ps,this,!0);const e=api_assertClassBrand(_s,this,_tryCleanup).call(this,!1);t&&e&&(this._stats&&=new StatTimer);return e}_startRenderPage(t,e){const i=this._intentStates.get(e);if(i){this._stats?.timeEnd("Page Request");i.displayReadyCapability?.resolve(t)}}_renderPageChunk(t,e){for(let i=0,s=t.length;i<s;i++){e.operatorList.fnArray.push(t.fnArray[i]);e.operatorList.argsArray.push(t.argsArray[i])}e.operatorList.lastChunk=t.lastChunk;e.operatorList.separateAnnots=t.separateAnnots;for(const t of e.renderTasks)t.operatorListChanged();t.lastChunk&&api_assertClassBrand(_s,this,_tryCleanup).call(this,!0)}_pumpOperatorList(t){let{renderingIntent:e,cacheKey:i,annotationStorageSerializable:s}=t;const{map:a,transfer:r}=s,n=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:i,annotationStorage:a},r).getReader(),o=this._intentStates.get(i);o.streamReader=n;const pump=()=>{n.read().then((t=>{let{value:e,done:i}=t;if(i)o.streamReader=null;else if(!this._transport.destroyed){this._renderPageChunk(e,o);pump()}}),(t=>{o.streamReader=null;if(!this._transport.destroyed){if(o.operatorList){o.operatorList.lastChunk=!0;for(const t of o.renderTasks)t.operatorListChanged();api_assertClassBrand(_s,this,_tryCleanup).call(this,!0)}if(o.displayReadyCapability)o.displayReadyCapability.reject(t);else{if(!o.opListReadCapability)throw t;o.opListReadCapability.reject(t)}}}))};pump()}_abortOperatorList(t){let{intentState:e,reason:i,force:s=!1}=t;if(e.streamReader){if(e.streamReaderCancelTimeout){clearTimeout(e.streamReaderCancelTimeout);e.streamReaderCancelTimeout=null}if(!s){if(e.renderTasks.size>0)return;if(i instanceof RenderingCancelledException){let t=100;i.extraDelay>0&&i.extraDelay<1e3&&(t+=i.extraDelay);e.streamReaderCancelTimeout=setTimeout((()=>{e.streamReaderCancelTimeout=null;this._abortOperatorList({intentState:e,reason:i,force:!0})}),t);return}}e.streamReader.cancel(new AbortException(i.message)).catch((()=>{}));e.streamReader=null;if(!this._transport.destroyed){for(const[t,i]of this._intentStates)if(i===e){this._intentStates.delete(t);break}this.cleanup()}}}get stats(){return this._stats}}function _tryCleanup(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];api_assertClassBrand(_s,this,_abortDelayedCleanup).call(this);if(!api_classPrivateFieldGet(ps,this)||this.destroyed)return!1;if(t){api_classPrivateFieldSet(us,this,setTimeout((()=>{api_classPrivateFieldSet(us,this,null);api_assertClassBrand(_s,this,_tryCleanup).call(this,!1)}),5e3));return!1}for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;this._intentStates.clear();this.objs.clear();api_classPrivateFieldSet(ps,this,!1);return!0}function _abortDelayedCleanup(){if(api_classPrivateFieldGet(us,this)){clearTimeout(api_classPrivateFieldGet(us,this));api_classPrivateFieldSet(us,this,null)}}var fs=new WeakMap,gs=new WeakMap;class LoopbackPort{constructor(){api_classPrivateFieldInitSpec(this,fs,new Set);api_classPrivateFieldInitSpec(this,gs,Promise.resolve())}postMessage(t,e){const i={data:structuredClone(t,e?{transfer:e}:null)};api_classPrivateFieldGet(gs,this).then((()=>{for(const t of api_classPrivateFieldGet(fs,this))t.call(this,i)}))}addEventListener(t,e){api_classPrivateFieldGet(fs,this).add(e)}removeEventListener(t,e){api_classPrivateFieldGet(fs,this).delete(e)}terminate(){api_classPrivateFieldGet(fs,this).clear()}}const vs={isWorkerDisabled:!1,fakeWorkerId:0};if(e){vs.isWorkerDisabled=!0;GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"}vs.isSameOrigin=function(t,e){let i;try{i=new URL(t);if(!i.origin||"null"===i.origin)return!1}catch{return!1}const s=new URL(e,i);return i.origin===s.origin};vs.createCDNWrapper=function(t){const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};var ms=new WeakSet;class PDFWorker{constructor(){let{name:t=null,port:e=null,verbosity:i=getVerbosityLevel()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};api_classPrivateMethodInitSpec(this,ms);this.name=t;this.destroyed=!1;this.verbosity=i;this._readyCapability=new PromiseCapability;this._port=null;this._webWorker=null;this._messageHandler=null;if(e){if(Ps._?.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(Ps._||(Ps._=new WeakMap)).set(e,this);this._initializeFromPort(e)}else this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t;this._messageHandler=new MessageHandler("main","worker",t);this._messageHandler.on("ready",(function(){}));this._readyCapability.resolve();this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!vs.isWorkerDisabled&&!_get_mainThreadWorkerMessageHandler(PDFWorker)){let{workerSrc:t}=PDFWorker;try{vs.isSameOrigin(window.location.href,t)||(t=vs.createCDNWrapper(new URL(t,window.location).href));const e=new Worker(api_assertClassBrand(ms,this,_generateTrustedURL).call(this,t),{type:"module"}),i=new MessageHandler("main","worker",e),terminateEarly=()=>{e.removeEventListener("error",onWorkerError);i.destroy();e.terminate();this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},onWorkerError=()=>{this._webWorker||terminateEarly()};e.addEventListener("error",onWorkerError);i.on("test",(t=>{e.removeEventListener("error",onWorkerError);if(this.destroyed)terminateEarly();else if(t){this._messageHandler=i;this._port=e;this._webWorker=e;this._readyCapability.resolve();i.send("configure",{verbosity:this.verbosity})}else{this._setupFakeWorker();i.destroy();e.terminate()}}));i.on("ready",(t=>{e.removeEventListener("error",onWorkerError);if(this.destroyed)terminateEarly();else try{sendTest()}catch{this._setupFakeWorker()}}));const sendTest=()=>{const t=new Uint8Array;i.send("test",t,[t.buffer])};sendTest();return}catch{info("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){if(!vs.isWorkerDisabled){warn("Setting up fake worker.");vs.isWorkerDisabled=!0}PDFWorker._setupFakeWorkerGlobal.then((t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new LoopbackPort;this._port=e;const i="fake"+vs.fakeWorkerId++,s=new MessageHandler(i+"_worker",i,e);t.setup(s,e);const a=new MessageHandler(i,i+"_worker",e);this._messageHandler=a;this._readyCapability.resolve();a.send("configure",{verbosity:this.verbosity})})).catch((t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))}))}destroy(){this.destroyed=!0;if(this._webWorker){this._webWorker.terminate();this._webWorker=null}Ps._?.delete(this._port);this._port=null;if(this._messageHandler){this._messageHandler.destroy();this._messageHandler=null}}static fromPort(t){if(!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const e=api_assertClassBrand(PDFWorker,this,Ps)._?.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new PDFWorker(t)}static get workerSrc(){if(GlobalWorkerOptions.workerSrc)return"Function"===GlobalWorkerOptions.workerSrc.constructor.name?GlobalWorkerOptions.workerSrc():GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return shadow(this,"_setupFakeWorkerGlobal",(async()=>{if(api_classPrivateGetter(PDFWorker,this,_get_mainThreadWorkerMessageHandler))return api_classPrivateGetter(PDFWorker,this,_get_mainThreadWorkerMessageHandler);return(await import(this.workerSrc)).WorkerMessageHandler})())}}function _generateTrustedURL(t){return window.trustedTypes?window.pdfViewerSanitizer.createScriptURL(t):t}function _get_mainThreadWorkerMessageHandler(t){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}var Ps={_:void 0},ys=new WeakMap,Fs=new WeakMap,bs=new WeakMap,ws=new WeakMap,As=new WeakSet;class WorkerTransport{constructor(t,e,i,s,a){api_classPrivateMethodInitSpec(this,As);api_classPrivateFieldInitSpec(this,ys,new Map);api_classPrivateFieldInitSpec(this,Fs,new Map);api_classPrivateFieldInitSpec(this,bs,new Map);api_classPrivateFieldInitSpec(this,ws,null);this.messageHandler=t;this.loadingTask=e;this.commonObjs=new PDFObjects;this.fontLoader=new FontLoader({ownerDocument:s.ownerDocument,styleElement:s.styleElement});this._params=s;this.canvasFactory=a.canvasFactory;this.filterFactory=a.filterFactory;this.cMapReaderFactory=a.cMapReaderFactory;this.standardFontDataFactory=a.standardFontDataFactory;this.destroyed=!1;this.destroyCapability=null;this._networkStream=i;this._fullReader=null;this._lastProgress=null;this.downloadInfoCapability=new PromiseCapability;this.setupMessageHandler()}get annotationStorage(){return shadow(this,"annotationStorage",new AnnotationStorage)}getRenderingIntent(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.ENABLE,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=n,p=oi;switch(t){case"any":a=r;break;case"display":break;case"print":a=o;break;default:warn(`getRenderingIntent - invalid intent: ${t}`)}switch(e){case u.DISABLE:a+=h;break;case u.ENABLE:break;case u.ENABLE_FORMS:a+=l;break;case u.ENABLE_STORAGE:a+=c;p=(a&o&&i instanceof PrintAnnotationStorage?i:this.annotationStorage).serializable;break;default:warn(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(a+=d);return{renderingIntent:a,cacheKey:`${a}_${p.hash}`,annotationStorageSerializable:p}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0;this.destroyCapability=new PromiseCapability;api_classPrivateFieldGet(ws,this)?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const e of api_classPrivateFieldGet(Fs,this).values())t.push(e._destroy());api_classPrivateFieldGet(Fs,this).clear();api_classPrivateFieldGet(bs,this).clear();this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);t.push(e);Promise.all(t).then((()=>{this.commonObjs.clear();this.fontLoader.clear();api_classPrivateFieldGet(ys,this).clear();this.filterFactory.destroy();cleanupTextLayer();this._networkStream?.cancelAllRequests(new AbortException("Worker was terminated."));if(this.messageHandler){this.messageHandler.destroy();this.messageHandler=null}this.destroyCapability.resolve()}),this.destroyCapability.reject);return this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",((t,e)=>{assert(this._networkStream,"GetReader - no `IPDFStream` instance available.");this._fullReader=this._networkStream.getFullReader();this._fullReader.onProgress=t=>{this._lastProgress={loaded:t.loaded,total:t.total}};e.onPull=()=>{this._fullReader.read().then((function(t){let{value:i,done:s}=t;if(s)e.close();else{assert(i instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer.");e.enqueue(new Uint8Array(i),1,[i])}})).catch((t=>{e.error(t)}))};e.onCancel=t=>{this._fullReader.cancel(t);e.ready.catch((t=>{if(!this.destroyed)throw t}))}}));t.on("ReaderHeadersReady",(t=>{const i=new PromiseCapability,s=this._fullReader;s.headersReady.then((()=>{if(!s.isStreamingSupported||!s.isRangeSupported){this._lastProgress&&e.onProgress?.(this._lastProgress);s.onProgress=t=>{e.onProgress?.({loaded:t.loaded,total:t.total})}}i.resolve({isStreamingSupported:s.isStreamingSupported,isRangeSupported:s.isRangeSupported,contentLength:s.contentLength})}),i.reject);return i.promise}));t.on("GetRangeReader",((t,e)=>{assert(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const i=this._networkStream.getRangeReader(t.begin,t.end);if(i){e.onPull=()=>{i.read().then((function(t){let{value:i,done:s}=t;if(s)e.close();else{assert(i instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer.");e.enqueue(new Uint8Array(i),1,[i])}})).catch((t=>{e.error(t)}))};e.onCancel=t=>{i.cancel(t);e.ready.catch((t=>{if(!this.destroyed)throw t}))}}else e.close()}));t.on("GetDoc",(t=>{let{pdfInfo:i}=t;this._numPages=i.numPages;this._htmlForXfa=i.htmlForXfa;delete i.htmlForXfa;e._capability.resolve(new PDFDocumentProxy(i,this))}));t.on("DocException",(function(t){let i;switch(t.name){case"PasswordException":i=new PasswordException(t.message,t.code);break;case"InvalidPDFException":i=new InvalidPDFException(t.message);break;case"MissingPDFException":i=new MissingPDFException(t.message);break;case"UnexpectedResponseException":i=new UnexpectedResponseException(t.message,t.status);break;case"UnknownErrorException":i=new UnknownErrorException(t.message,t.details);break;default:unreachable("DocException - expected a valid Error.")}e._capability.reject(i)}));t.on("PasswordRequest",(t=>{api_classPrivateFieldSet(ws,this,new PromiseCapability);if(e.onPassword){const updatePassword=t=>{t instanceof Error?api_classPrivateFieldGet(ws,this).reject(t):api_classPrivateFieldGet(ws,this).resolve({password:t})};try{e.onPassword(updatePassword,t.code)}catch(t){api_classPrivateFieldGet(ws,this).reject(t)}}else api_classPrivateFieldGet(ws,this).reject(new PasswordException(t.message,t.code));return api_classPrivateFieldGet(ws,this).promise}));t.on("DataLoaded",(t=>{e.onProgress?.({loaded:t.length,total:t.length});this.downloadInfoCapability.resolve(t)}));t.on("StartRenderPage",(t=>{if(this.destroyed)return;api_classPrivateFieldGet(Fs,this).get(t.pageIndex)._startRenderPage(t.transparency,t.cacheKey)}));t.on("commonobj",(e=>{let[i,s,a]=e;if(this.destroyed)return null;if(this.commonObjs.has(i))return null;switch(s){case"Font":const e=this._params;if("error"in a){const t=a.error;warn(`Error during font loading: ${t}`);this.commonObjs.resolve(i,t);break}const r=e.pdfBug&&globalThis.FontInspector?.enabled?(t,e)=>globalThis.FontInspector.fontAdded(t,e):null,n=new FontFaceObject(a,{isEvalSupported:e.isEvalSupported,disableFontFace:e.disableFontFace,ignoreErrors:e.ignoreErrors,inspectFont:r});this.fontLoader.bind(n).catch((()=>t.sendWithPromise("FontFallback",{id:i}))).finally((()=>{!e.fontExtraProperties&&n.data&&(n.data=null);this.commonObjs.resolve(i,n)}));break;case"CopyLocalImage":const{imageRef:o}=a;assert(o,"The imageRef must be defined.");for(const t of api_classPrivateFieldGet(Fs,this).values())for(const[,e]of t.objs)if(e.ref===o){if(!e.dataLen)return null;this.commonObjs.resolve(i,structuredClone(e));return e.dataLen}break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,a);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}));t.on("obj",(t=>{let[e,i,s,a]=t;if(this.destroyed)return;const r=api_classPrivateFieldGet(Fs,this).get(i);if(!r.objs.has(e))if(0!==r._intentStates.size)switch(s){case"Image":r.objs.resolve(e,a);a?.dataLen>1e7&&(r._maybeCleanupAfterRender=!0);break;case"Pattern":r.objs.resolve(e,a);break;default:throw new Error(`Got unknown object type ${s}`)}else a?.bitmap?.close()}));t.on("DocProgress",(t=>{this.destroyed||e.onProgress?.({loaded:t.loaded,total:t.total})}));t.on("FetchBuiltInCMap",(t=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(t):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))));t.on("FetchStandardFontData",(t=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(t):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&warn("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally((()=>{this.annotationStorage.resetModified()}))}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,i=api_classPrivateFieldGet(bs,this).get(e);if(i)return i;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then((t=>{if(this.destroyed)throw new Error("Transport destroyed");const i=new PDFPageProxy(e,t,this,this._params.pdfBug);api_classPrivateFieldGet(Fs,this).set(e,i);return i}));api_classPrivateFieldGet(bs,this).set(e,s);return s}getPageIndex(t){return"object"!=typeof t||null===t||!Number.isInteger(t.num)||t.num<0||!Number.isInteger(t.gen)||t.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen})}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return api_assertClassBrand(As,this,_cacheSimpleMethod).call(this,"GetFieldObjects")}hasJSActions(){return api_assertClassBrand(As,this,_cacheSimpleMethod).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return"string"!=typeof t?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return api_assertClassBrand(As,this,_cacheSimpleMethod).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return api_assertClassBrand(As,this,_cacheSimpleMethod).call(this,"GetOptionalContentConfig").then((e=>new OptionalContentConfig(e,t)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=api_classPrivateFieldGet(ys,this).get(t);if(e)return e;const i=this.messageHandler.sendWithPromise(t,null).then((t=>({info:t[0],metadata:t[1]?new Metadata(t[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null})));api_classPrivateFieldGet(ys,this).set(t,i);return i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of api_classPrivateFieldGet(Fs,this).values()){if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`)}this.commonObjs.clear();t||this.fontLoader.clear();api_classPrivateFieldGet(ys,this).clear();this.filterFactory.destroy(!0);cleanupTextLayer()}}get loadingParams(){const{disableAutoFetch:t,enableXfa:e}=this._params;return shadow(this,"loadingParams",{disableAutoFetch:t,enableXfa:e})}}function _cacheSimpleMethod(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=api_classPrivateFieldGet(ys,this).get(t);if(i)return i;const s=this.messageHandler.sendWithPromise(t,e);api_classPrivateFieldGet(ys,this).set(t,s);return s}var Ss=new WeakMap,xs=new WeakSet;class PDFObjects{constructor(){api_classPrivateMethodInitSpec(this,xs);api_classPrivateFieldInitSpec(this,Ss,Object.create(null))}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){const i=api_assertClassBrand(xs,this,_ensureObj).call(this,t);i.capability.promise.then((()=>e(i.data)));return null}const i=api_classPrivateFieldGet(Ss,this)[t];if(!i?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return i.data}has(t){const e=api_classPrivateFieldGet(Ss,this)[t];return e?.capability.settled??!1}resolve(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=api_assertClassBrand(xs,this,_ensureObj).call(this,t);i.data=e;i.capability.resolve()}clear(){for(const t in api_classPrivateFieldGet(Ss,this)){const{data:e}=api_classPrivateFieldGet(Ss,this)[t];e?.bitmap?.close()}api_classPrivateFieldSet(Ss,this,Object.create(null))}*[Symbol.iterator](){for(const t in api_classPrivateFieldGet(Ss,this)){const{capability:e,data:i}=api_classPrivateFieldGet(Ss,this)[t];e.settled&&(yield[t,i])}}}function _ensureObj(t){return api_classPrivateFieldGet(Ss,this)[t]||={capability:new PromiseCapability,data:null}}var Cs=new WeakMap;class RenderTask{constructor(t){api_classPrivateFieldInitSpec(this,Cs,null);api_classPrivateFieldSet(Cs,this,t);this.onContinue=null}get promise(){return api_classPrivateFieldGet(Cs,this).capability.promise}cancel(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;api_classPrivateFieldGet(Cs,this).cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=api_classPrivateFieldGet(Cs,this).operatorList;if(!t)return!1;const{annotationCanvasMap:e}=api_classPrivateFieldGet(Cs,this);return t.form||t.canvas&&e?.size>0}}class InternalRenderTask{constructor(t){let{callback:e,params:i,objs:s,commonObjs:a,annotationCanvasMap:r,operatorList:n,pageIndex:o,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:h=!1,pdfBug:d=!1,pageColors:u=null}=t;this.callback=e;this.params=i;this.objs=s;this.commonObjs=a;this.annotationCanvasMap=r;this.operatorListIdx=null;this.operatorList=n;this._pageIndex=o;this.canvasFactory=l;this.filterFactory=c;this._pdfBug=d;this.pageColors=u;this.running=!1;this.graphicsReadyCallback=null;this.graphicsReady=!1;this._useRequestAnimationFrame=!0===h&&"undefined"!=typeof window;this.cancelled=!1;this.capability=new PromiseCapability;this.task=new RenderTask(this);this._cancelBound=this.cancel.bind(this);this._continueBound=this._continue.bind(this);this._scheduleNextBound=this._scheduleNext.bind(this);this._nextBound=this._next.bind(this);this._canvas=i.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics(t){let{transparency:e=!1,optionalContentConfig:i}=t;if(this.cancelled)return;if(this._canvas){if(ks._.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");ks._.add(this._canvas)}if(this._pdfBug&&globalThis.StepperManager?.enabled){this.stepper=globalThis.StepperManager.create(this._pageIndex);this.stepper.init(this.operatorList);this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint()}const{canvasContext:s,viewport:a,transform:r,background:n}=this.params;this.gfx=new CanvasGraphics(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:i},this.annotationCanvasMap,this.pageColors);this.gfx.beginDrawing({transform:r,viewport:a,transparency:e,background:n});this.operatorListIdx=0;this.graphicsReady=!0;this.graphicsReadyCallback?.()}cancel(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.running=!1;this.cancelled=!0;this.gfx?.endDrawing();ks._.delete(this._canvas);this.callback(t||new RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,e))}operatorListChanged(){if(this.graphicsReady){this.stepper?.updateOperatorList(this.operatorList);this.running||this._continue()}else this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0;this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){window.ngxZone.runOutsideAngular((()=>{this._useRequestAnimationFrame?window.requestAnimationFrame((()=>{this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}))}async _next(){if(!this.cancelled){this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper);if(this.operatorListIdx===this.operatorList.argsArray.length){this.running=!1;if(this.operatorList.lastChunk){this.gfx.endDrawing();ks._.delete(this._canvas);this.callback()}}}}}var ks={_:new WeakSet};const Es="4.1.834",Ms="087190941";__webpack_require__(670);function makeColorComp(t){return Math.floor(255*Math.max(0,Math.min(1,t))).toString(16).padStart(2,"0")}function scaleAndClamp(t){return Math.max(0,Math.min(255,255*t))}class ColorConverters{static CMYK_G(t){let[e,i,s,a]=t;return["G",1-Math.min(1,.3*e+.59*s+.11*i+a)]}static G_CMYK(t){let[e]=t;return["CMYK",0,0,0,1-e]}static G_RGB(t){let[e]=t;return["RGB",e,e,e]}static G_rgb(t){let[e]=t;e=scaleAndClamp(e);return[e,e,e]}static G_HTML(t){let[e]=t;const i=makeColorComp(e);return`#${i}${i}${i}`}static RGB_G(t){let[e,i,s]=t;return["G",.3*e+.59*i+.11*s]}static RGB_rgb(t){return t.map(scaleAndClamp)}static RGB_HTML(t){return`#${t.map(makeColorComp).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB(t){let[e,i,s,a]=t;return["RGB",1-Math.min(1,e+a),1-Math.min(1,s+a),1-Math.min(1,i+a)]}static CMYK_rgb(t){let[e,i,s,a]=t;return[scaleAndClamp(1-Math.min(1,e+a)),scaleAndClamp(1-Math.min(1,s+a)),scaleAndClamp(1-Math.min(1,i+a))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK(t){let[e,i,s]=t;const a=1-e,r=1-i,n=1-s;return["CMYK",a,r,n,Math.min(a,r,n)]}}class XfaLayer{static setupStorage(t,e,i,s,a){const r=window.getFormValueFromAngular(t);r.value&&s.setValue(e,r);const n=r.value?r:s.getValue(e,{value:null});window.registerXFAField(t,n);t.addEventListener("updateFromAngular",(t=>s.setValue(e,{value:t.detail})));switch(i.name){case"textarea":null!==n.value&&(t.textContent=n.value);if("print"===a)break;t.addEventListener("input",(i=>{window.updateAngularFormValue(t,{value:i.target.value});s.setValue(e,{value:i.target.value})}));break;case"input":if("radio"===i.attributes.type||"checkbox"===i.attributes.type){n.value===i.attributes.xfaOn?t.setAttribute("checked",!0):t.removeAttribute("checked");if("print"===a)break;t.addEventListener("change",(i=>{window.updateAngularFormValue(t,{value:i.target.checked?i.target.getAttribute("xfaOn"):i.target.getAttribute("xfaOff")});s.setValue(e,{value:i.target.checked?i.target.getAttribute("xfaOn"):i.target.getAttribute("xfaOff")})}))}else{null!==n.value&&t.setAttribute("value",n.value);if("print"===a)break;t.addEventListener("input",(i=>{window.updateAngularFormValue(t,{value:i.target.value});s.setValue(e,{value:i.target.value})}))}break;case"select":if(null!==n.value){t.setAttribute("value",n.value);for(const t of i.children)t.attributes.value===n.value?t.attributes.selected=!0:t.attributes.hasOwnProperty("selected")&&delete t.attributes.selected}t.addEventListener("input",(i=>{const a=i.target.options,r=-1===a.selectedIndex?"":a[a.selectedIndex].value;window.updateAngularFormValue(t,{value:r});s.setValue(e,{value:r})}))}}static setAttributes(t){let{html:e,element:i,storage:s=null,intent:a,linkService:r}=t;const{attributes:n}=i,o=e instanceof HTMLAnchorElement;"radio"===n.type&&(n.name=`${n.name}-${a}`);for(const[t,i]of Object.entries(n))if(null!=i)switch(t){case"class":i.length&&e.setAttribute(t,i.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",i);break;case"style":Object.assign(e.style,i);break;case"textContent":e.textContent=i;break;default:(!o||"href"!==t&&"newWindow"!==t)&&e.setAttribute(t,i)}o&&r.addLinkAttributes(e,n.href,n.newWindow);s&&n.dataId&&this.setupStorage(e,n.dataId,i,s)}static render(t){const e=t.annotationStorage,i=t.linkService,s=t.xfaHtml,a=t.intent||"display",r=document.createElement(s.name);s.attributes&&this.setAttributes({html:r,element:s,intent:a,linkService:i});const n="richText"!==a,o=t.div;o.append(r);if(t.viewport){const e=`matrix(${t.viewport.transform.join(",")})`;o.style.transform=e}n&&o.setAttribute("class","xfaLayer xfaFont");const l=[];if(0===s.children.length){if(s.value){const t=document.createTextNode(s.value);r.append(t);n&&XfaText.shouldBuildText(s.name)&&l.push(t)}return{textDivs:l}}const c=[[s,-1,r]];for(;c.length>0;){const[t,s,r]=c.at(-1);if(s+1===t.children.length){c.pop();continue}const o=t.children[++c.at(-1)[1]];if(null===o)continue;const{name:h}=o;if("#text"===h){const t=document.createTextNode(o.value);l.push(t);r.append(t);continue}const d=o?.attributes?.xmlns?document.createElementNS(o.attributes.xmlns,h):document.createElement(h);r.append(d);o.attributes&&this.setAttributes({html:d,element:o,storage:e,intent:a,linkService:i});if(o.children?.length>0)c.push([o,-1,d]);else if(o.value){const t=document.createTextNode(o.value);n&&XfaText.shouldBuildText(h)&&l.push(t);d.append(t)}}for(const t of o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))t.setAttribute("readOnly",!0);return{textDivs:l}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e;t.div.hidden=!1}}function annotation_layer_classPrivateMethodInitSpec(t,e){annotation_layer_checkPrivateRedeclaration(t,e);e.add(t)}function annotation_layer_classPrivateFieldInitSpec(t,e,i){annotation_layer_checkPrivateRedeclaration(t,e);e.set(t,i)}function annotation_layer_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function annotation_layer_classPrivateFieldGet(t,e){return t.get(annotation_layer_assertClassBrand(t,e))}function annotation_layer_classPrivateFieldSet(t,e,i){return t.set(annotation_layer_assertClassBrand(t,e),i),i}function annotation_layer_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}const Gs=1e3,Is=new WeakSet;function getRectDims(t){return{width:t[2]-t[0],height:t[3]-t[1]}}class AnnotationElementFactory{static create(t){switch(t.data.annotationType){case S:return new LinkAnnotationElement(t);case A:return new TextAnnotationElement(t);case j:switch(t.data.fieldType){case"Tx":return new TextWidgetAnnotationElement(t);case"Btn":return t.data.radioButton?new RadioButtonWidgetAnnotationElement(t):t.data.checkBox?new CheckboxWidgetAnnotationElement(t):new PushButtonWidgetAnnotationElement(t);case"Ch":return new ChoiceWidgetAnnotationElement(t);case"Sig":return new SignatureWidgetAnnotationElement(t)}return new WidgetAnnotationElement(t);case N:return new PopupAnnotationElement(t);case x:return new FreeTextAnnotationElement(t);case C:return new LineAnnotationElement(t);case k:return new SquareAnnotationElement(t);case E:return new CircleAnnotationElement(t);case G:return new PolylineAnnotationElement(t);case B:return new CaretAnnotationElement(t);case O:return new InkAnnotationElement(t);case M:return new PolygonAnnotationElement(t);case I:return new HighlightAnnotationElement(t);case T:return new UnderlineAnnotationElement(t);case R:return new SquigglyAnnotationElement(t);case D:return new StrikeOutAnnotationElement(t);case L:return new StampAnnotationElement(t);case W:return new FileAttachmentAnnotationElement(t);default:return new AnnotationElement(t)}}}var Ts=new WeakMap;class AnnotationElement{constructor(t){let{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};annotation_layer_classPrivateFieldInitSpec(this,Ts,!1);this.isRenderable=e;this.data=t.data;this.layer=t.layer;this.linkService=t.linkService;this.downloadManager=t.downloadManager;this.imageResourcesPath=t.imageResourcesPath;this.renderForms=t.renderForms;this.svgFactory=t.svgFactory;this.annotationStorage=t.annotationStorage;this.enableScripting=t.enableScripting;this.hasJSActions=t.hasJSActions;this._fieldObjects=t.fieldObjects;this.parent=t.parent;e&&(this.container=this._createContainer(i));s&&this._createQuadrilaterals()}static _hasPopupData(t){let{titleObj:e,contentsObj:i,richText:s}=t;return!!(e?.str||i?.str||s?.str)}get hasPopupData(){return AnnotationElement._hasPopupData(this.data)}_createContainer(t){const{data:e,parent:{page:i,viewport:s}}=this,a=document.createElement("section");a.setAttribute("data-annotation-id",e.id);this instanceof WidgetAnnotationElement||(a.tabIndex=Gs);a.style.zIndex=this.parent.zIndex++;e.popupRef&&a.setAttribute("aria-haspopup","dialog");e.alternativeText&&(a.title=e.alternativeText);e.noRotate&&a.classList.add("norotate");const{pageWidth:r,pageHeight:n,pageX:o,pageY:l}=s.rawDims;if(!e.rect||this instanceof PopupAnnotationElement){const{rotation:t}=e;e.hasOwnCanvas||0===t||this.setRotation(t,a);return a}const{width:c,height:h}=getRectDims(e.rect),d=Util.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]);if(!t&&e.borderStyle.width>0){a.style.borderWidth=`${e.borderStyle.width}px`;const t=e.borderStyle.horizontalCornerRadius,i=e.borderStyle.verticalCornerRadius;if(t>0||i>0){const e=`calc(${t}px * var(--scale-factor)) / calc(${i}px * var(--scale-factor))`;a.style.borderRadius=e}else if(this instanceof RadioButtonWidgetAnnotationElement){const t=`calc(${c}px * var(--scale-factor)) / calc(${h}px * var(--scale-factor))`;a.style.borderRadius=t}switch(e.borderStyle.style){case H:a.style.borderStyle="solid";break;case U:a.style.borderStyle="dashed";break;case z:warn("Unimplemented border style: beveled");break;case V:warn("Unimplemented border style: inset");break;case q:a.style.borderBottomStyle="solid"}const s=e.borderColor||null;if(s){annotation_layer_classPrivateFieldSet(Ts,this,!0);a.style.borderColor=Util.makeHexColor(0|s[0],0|s[1],0|s[2])}else a.style.borderWidth=0}a.style.left=100*(d[0]-o)/r+"%";a.style.top=100*(d[1]-l)/n+"%";const{rotation:u}=e;if(e.hasOwnCanvas||0===u){a.style.width=100*c/r+"%";a.style.height=100*h/n+"%"}else this.setRotation(u,a);return a}setRotation(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.container;if(!this.data.rect)return;const{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims,{width:a,height:r}=getRectDims(this.data.rect);let n,o;if(t%180==0){n=100*a/i;o=100*r/s}else{n=100*r/i;o=100*a/s}e.style.width=`${n}%`;e.style.height=`${o}%`;e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const setColor=(t,e,i)=>{const s=i.detail[t],a=s[0],r=s.slice(1);i.target.style[e]=ColorConverters[`${a}_HTML`](r);this.annotationStorage.setValue(this.data.id,{[e]:ColorConverters[`${a}_rgb`](r)})};return shadow(this,"_commonActions",{display:t=>{const{display:e}=t.detail,i=e%2==1;this.container.style.visibility=i?"hidden":"visible";this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:1===e||2===e})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:e}=t.detail;this.container.style.visibility=e?"hidden":"visible";this.annotationStorage.setValue(this.data.id,{noPrint:e,noView:e})},focus:t=>{setTimeout((()=>t.target.focus({preventScroll:!1})),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{setColor("bgColor","backgroundColor",t)},fillColor:t=>{setColor("fillColor","backgroundColor",t)},fgColor:t=>{setColor("fgColor","color",t)},textColor:t=>{setColor("textColor","color",t)},borderColor:t=>{setColor("borderColor","borderColor",t)},strokeColor:t=>{setColor("strokeColor","borderColor",t)},rotation:t=>{const e=t.detail.rotation;this.setRotation(e);this.annotationStorage.setValue(this.data.id,{rotation:e})}})}_dispatchEventFromSandbox(t,e){const i=this._commonActions;for(const s of Object.keys(e.detail)){const a=t[s]||i[s];a?.(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const i=this._commonActions;for(const[s,a]of Object.entries(e)){const r=i[s];if(r){r({detail:{[s]:a},target:t});delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,i,s,a]=this.data.rect;if(1===t.length){const[,{x:r,y:n},{x:o,y:l}]=t[0];if(s===r&&a===n&&e===o&&i===l)return}const{style:r}=this.container;let n;if(annotation_layer_classPrivateFieldGet(Ts,this)){const{borderColor:t,borderWidth:e}=r;r.borderWidth=0;n=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${t}" stroke-width="${e}">`];this.container.classList.add("hasBorder")}const o=s-e,l=a-i,{svgFactory:c}=this,h=c.createElement("svg");h.classList.add("quadrilateralsContainer");h.setAttribute("width",0);h.setAttribute("height",0);const d=c.createElement("defs");h.append(d);const u=c.createElement("clipPath"),p=`clippath_${this.data.id}`;u.setAttribute("id",p);u.setAttribute("clipPathUnits","objectBoundingBox");d.append(u);for(const[,{x:i,y:s},{x:r,y:h}]of t){const t=c.createElement("rect"),d=(r-e)/o,p=(a-s)/l,_=(i-r)/o,f=(s-h)/l;t.setAttribute("x",d);t.setAttribute("y",p);t.setAttribute("width",_);t.setAttribute("height",f);u.append(t);n?.push(`<rect vector-effect="non-scaling-stroke" x="${d}" y="${p}" width="${_}" height="${f}"/>`)}if(annotation_layer_classPrivateFieldGet(Ts,this)){n.push("</g></svg>')");r.backgroundImage=n.join("")}this.container.append(h);this.container.style.clipPath=`url(#${p})`}_createPopup(){const{container:t,data:e}=this;t.setAttribute("aria-haspopup","dialog");const i=new PopupAnnotationElement({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(i.render())}render(){unreachable("Abstract method `AnnotationElement.render` called")}_getElementsByName(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=[];if(this._fieldObjects){const s=this._fieldObjects[t];if(s)for(const{page:t,id:a,exportValues:r}of s){if(-1===t)continue;if(a===e)continue;const s="string"==typeof r?r:null,n=document.querySelector(`[data-element-id="${a}"]`);!n||Is.has(n)?i.push({id:a,exportValue:s,domElement:n}):warn(`_getElementsByName - element not allowed: ${a}`)}return i}for(const s of document.getElementsByName(t)){const{exportValue:t}=s,a=s.getAttribute("data-element-id");a!==e&&(Is.has(s)&&i.push({id:a,exportValue:t,domElement:s}))}return i}show(){this.container&&(this.container.hidden=!1);this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0);this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",(()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})}))}}var Rs=new WeakSet;class LinkAnnotationElement extends AnnotationElement{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0});annotation_layer_classPrivateMethodInitSpec(this,Rs);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let s=!1;if(t.url){e.addLinkAttributes(i,t.url,t.newWindow);s=!0}else if(t.action){this._bindNamedAction(i,t.action);s=!0}else if(t.attachment){annotation_layer_assertClassBrand(Rs,this,_bindAttachment).call(this,i,t.attachment,t.attachmentDest);s=!0}else if(t.setOCGState){annotation_layer_assertClassBrand(Rs,this,_bindSetOCGState).call(this,i,t.setOCGState);s=!0}else if(t.dest){this._bindLink(i,t.dest);s=!0}else{if(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions){this._bindJSAction(i,t);s=!0}if(t.resetForm){this._bindResetFormAction(i,t.resetForm);s=!0}else if(this.isTooltipOnly&&!s){this._bindLink(i,"");s=!0}}this.container.classList.add("linkAnnotation");s&&this.container.append(i);return this.container}_bindLink(t,e){t.href=this.linkService.getDestinationHash(e);t.onclick=()=>{e&&this.linkService.goToDestination(e);return!1};(e||""===e)&&annotation_layer_assertClassBrand(Rs,this,_setInternalLink).call(this)}_bindNamedAction(t,e){t.href=this.linkService.getAnchorUrl("");t.onclick=()=>{this.linkService.executeNamedAction(e);return!1};annotation_layer_assertClassBrand(Rs,this,_setInternalLink).call(this)}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(e.actions)){const a=i.get(s);a&&(t[a]=()=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:s}});return!1})}t.onclick||(t.onclick=()=>!1);annotation_layer_assertClassBrand(Rs,this,_setInternalLink).call(this)}_bindResetFormAction(t,e){const i=t.onclick;i||(t.href=this.linkService.getAnchorUrl(""));annotation_layer_assertClassBrand(Rs,this,_setInternalLink).call(this);if(this._fieldObjects)t.onclick=()=>{i?.();const{fields:t,refs:s,include:a}=e,r=[];if(0!==t.length||0!==s.length){const e=new Set(s);for(const i of t){const t=this._fieldObjects[i]||[];for(const{id:i}of t)e.add(i)}for(const t of Object.values(this._fieldObjects))for(const i of t)e.has(i.id)===a&&r.push(i)}else for(const t of Object.values(this._fieldObjects))r.push(...t);const n=this.annotationStorage,o=[];for(const t of r){const{id:e}=t;o.push(e);switch(t.type){case"text":{const i=t.defaultValue||"";n.setValue(e,{value:i});window.updateAngularFormValue(e,{value:i});break}case"checkbox":case"radiobutton":{const i=t.defaultValue===t.exportValues;n.setValue(e,{value:i});window.updateAngularFormValue(e,{value:i});break}case"combobox":case"listbox":{const i=t.defaultValue||"";n.setValue(e,{value:i});window.updateAngularFormValue(e,{value:i});break}default:continue}const i=document.querySelector(`[data-element-id="${e}"]`);i&&(Is.has(i)?i.dispatchEvent(new Event("resetform")):warn(`_bindResetFormAction - element not allowed: ${e}`))}this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:o,name:"ResetForm"}});return!1};else{warn('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.');i||(t.onclick=()=>!1)}}}function _setInternalLink(){this.container.setAttribute("data-internal-link","")}function _bindAttachment(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.href=this.linkService.getAnchorUrl("");t.onclick=()=>{this.downloadManager?.openOrDownloadData(e.content,e.filename,i);return!1};annotation_layer_assertClassBrand(Rs,this,_setInternalLink).call(this)}function _bindSetOCGState(t,e){t.href=this.linkService.getAnchorUrl("");t.onclick=()=>{this.linkService.executeSetOCGState(e);return!1};annotation_layer_assertClassBrand(Rs,this,_setInternalLink).call(this)}class TextAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg";t.setAttribute("data-l10n-id","pdfjs-text-annotation-type");t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name}));!this.data.popupRef&&this.hasPopupData&&this._createPopup();this.container.append(t);return this.container}}class WidgetAnnotationElement extends AnnotationElement{render(){return this.container}showElementAndHideCanvas(t){if(this.data.hasOwnCanvas){"CANVAS"===t.previousSibling?.nodeName&&(t.previousSibling.hidden=!0);t.hidden=!1}}_getKeyModifier(t){return util_FeatureTest.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,s,a){i.includes("mouse")?t.addEventListener(i,(t=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:a(t),shift:t.shiftKey,modifier:this._getKeyModifier(t)}})})):t.addEventListener(i,(t=>{if("blur"===i){if(!e.focused||!t.relatedTarget)return;e.focused=!1}else if("focus"===i){if(e.focused)return;e.focused=!0}a&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:a(t)}})}))}_setEventListeners(t,e,i,s){for(const[a,r]of i)if("Action"===r||this.data.actions?.[r]){"Focus"!==r&&"Blur"!==r||(e||={focused:!1});this._setEventListener(t,e,a,r,s);"Focus"!==r||this.data.actions?.Blur?"Blur"!==r||this.data.actions?.Focus||this._setEventListener(t,e,"focus","Focus",null):this._setEventListener(t,e,"blur","Blur",null)}}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=null===e?"transparent":Util.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||9,r=t.style;let n;const roundToOneDecimal=t=>Math.round(10*t)/10;if(this.data.multiLine){const t=Math.abs(this.data.rect[3]-this.data.rect[1]-2),e=t/(Math.round(t/(a*s))||1);n=Math.min(s,roundToOneDecimal(e/a))}else{const t=Math.abs(this.data.rect[3]-this.data.rect[1]-2);n=Math.min(s,roundToOneDecimal(t/a))}r.fontSize=`calc(${n}px * var(--scale-factor))`;r.color=Util.makeHexColor(i[0],i[1],i[2]);null!==this.data.textAlignment&&(r.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required");t.setAttribute("aria-required",e)}}class TextWidgetAnnotationElement extends WidgetAnnotationElement{constructor(t){super(t,{isRenderable:t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue})}setPropertyOnSiblings(t,e,i,s){const a=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id)){r.domElement&&(r.domElement[e]=i);a.setValue(r.id,{[s]:i})}}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const s=window.getFormValueFromAngular(this.data.fieldName),a=t.getValue(e,{value:this.data.fieldValue}),r=s.value?s:a;s!==a&&t.setValue(e,{value:s.value});let n=r.value||"";const o=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;o&&n.length>o&&(n=n.slice(0,o));let l=r.formattedValue||this.data.textContent?.join("\n")||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));const c={userValue:n,formattedValue:l,lastCommittedValue:null,commitKey:1,focused:!1};if(this.data.multiLine){i=document.createElement("textarea");i.textContent=l??n;this.data.doNotScroll&&(i.style.overflowY="hidden")}else{i=document.createElement("input");i.type="text";i.setAttribute("value",l??n);this.data.doNotScroll&&(i.style.overflowX="hidden")}this.data.hasOwnCanvas&&(i.hidden=!0);Is.add(i);i.setAttribute("data-element-id",e);i.disabled=this.data.readOnly;i.name=this.data.fieldName;i.tabIndex=Gs;this._setRequired(i,this.data.required);o&&(i.maxLength=o);i.addEventListener("input",(s=>{t.setValue(e,{value:s.target.value});window.updateAngularFormValue(e,{value:s.target.value});this.setPropertyOnSiblings(i,"value",s.target.value,"value");c.formattedValue=null}));i.addEventListener("resetform",(t=>{const e=this.data.defaultFieldValue??"";i.value=c.userValue=e;c.formattedValue=null}));let blurListener=t=>{const{formattedValue:e}=c;null!=e&&(t.target.value=e);t.target.scrollLeft=0};window.registerAcroformField(e,i,r.value);i.addEventListener("updateFromAngular",(i=>t.setValue(e,{value:i.detail})));if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",(t=>{if(c.focused)return;const{target:e}=t;c.userValue&&(e.value=c.userValue);c.lastCommittedValue=e.value;c.commitKey=1;this.data.actions?.Focus||(c.focused=!0)}));i.addEventListener("updatefromsandbox",(i=>{this.showElementAndHideCanvas(i.target);const s={value(i){c.userValue=i.detail.value??"";t.setValue(e,{value:c.userValue.toString()});window.updateAngularFormValue(e,{value:c.userValue.toString()});i.target.value=c.userValue},formattedValue(i){const{formattedValue:s}=i.detail;c.formattedValue=s;null!=s&&i.target!==document.activeElement&&(i.target.value=s);t.setValue(e,{formattedValue:s});window.updateAngularFormValue(e,{formattedValue:s})},selRange(t){t.target.setSelectionRange(...t.detail.selRange)},charLimit:i=>{const{charLimit:s}=i.detail,{target:a}=i;if(0===s){a.removeAttribute("maxLength");return}a.setAttribute("maxLength",s);let r=c.userValue;if(r&&!(r.length<=s)){r=r.slice(0,s);a.value=c.userValue=r;t.setValue(e,{value:r});window.updateAngularFormValue(e,{value:r});this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:r,willCommit:!0,commitKey:1,selStart:a.selectionStart,selEnd:a.selectionEnd}})}}};this._dispatchEventFromSandbox(s,i)}));i.addEventListener("keydown",(t=>{c.commitKey=1;let i=-1;"Escape"===t.key?i=0:"Enter"!==t.key||this.data.multiLine?"Tab"===t.key&&(c.commitKey=3):i=2;if(-1===i)return;const{value:s}=t.target;if(c.lastCommittedValue!==s){c.lastCommittedValue=s;c.userValue=s;this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:s,willCommit:!0,commitKey:i,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}})}}));const s=blurListener;blurListener=null;i.addEventListener("blur",(t=>{if(!c.focused||!t.relatedTarget)return;this.data.actions?.Blur||(c.focused=!1);const{value:i}=t.target;c.userValue=i;c.lastCommittedValue!==i&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:i,willCommit:!0,commitKey:c.commitKey,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}});s(t)}));this.data.actions?.Keystroke&&i.addEventListener("beforeinput",(t=>{c.lastCommittedValue=null;const{data:i,target:s}=t,{value:a,selectionStart:r,selectionEnd:n}=s;let o=r,l=n;switch(t.inputType){case"deleteWordBackward":{const t=a.substring(0,r).match(/\w*[^\w]*$/);t&&(o-=t[0].length);break}case"deleteWordForward":{const t=a.substring(r).match(/^[^\w]*\w*/);t&&(l+=t[0].length);break}case"deleteContentBackward":r===n&&(o-=1);break;case"deleteContentForward":r===n&&(l+=1)}t.preventDefault();this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:a,change:i||"",willCommit:!1,selStart:o,selEnd:l}})}));this._setEventListeners(i,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(t=>t.target.value))}blurListener&&i.addEventListener("blur",blurListener);if(this.data.comb){const t=(this.data.rect[2]-this.data.rect[0])/o;i.classList.add("comb");i.style.letterSpacing=`calc(${t}px * var(--scale-factor) - 1ch)`}}else{i=document.createElement("div");i.textContent=this.data.fieldValue;i.style.verticalAlign="middle";i.style.display="table-cell";this.data.hasOwnCanvas&&(i.hidden=!0)}this._setTextStyle(i);this._setBackgroundColor(i);this._setDefaultPropertiesFromJS(i);this.container.append(i);return this.container}}class SignatureWidgetAnnotationElement extends WidgetAnnotationElement{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class CheckboxWidgetAnnotationElement extends WidgetAnnotationElement{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,i=e.id,s=window.getFormValueFromAngular(this.data.fieldName),a=t.getValue(i,{value:e.exportValue===e.fieldValue}).value;let r;s.value&&(r=!0===s.value||s.value===e.exportValue);let n=void 0!==r?r:a,o=!1;if("string"==typeof n){n=n===e.exportValue;t.setValue(i,{value:n});o=!0}else if(void 0!==s?.value&&s.value!==a){n=s.value===e.exportValue;t.setValue(i,{value:n})}this.container.classList.add("buttonWidgetAnnotation","checkBox");const l=document.createElement("input");Is.add(l);l.setAttribute("data-element-id",i);l.disabled=e.readOnly;this._setRequired(l,this.data.required);l.type="checkbox";l.name=e.fieldName;n&&l.setAttribute("checked",!0);l.setAttribute("exportValue",e.exportValue);l.tabIndex=Gs;l.addEventListener("change",(s=>{const{name:a,checked:r}=s.target;for(const s of this._getElementsByName(a,i)){const a=r&&s.exportValue===e.exportValue;s.domElement&&(s.domElement.checked=a);t.setValue(s.id,{value:a});window.updateAngularFormValue(i,{value:a})}t.setValue(i,{value:r});window.updateAngularFormValue(i,{value:r})}));l.addEventListener("resetform",(t=>{const i=e.defaultFieldValue||"Off";t.target.checked=i===e.exportValue}));window.registerAcroformField(i,l,!!n&&e.exportValue);l.addEventListener("updateFromAngular",(e=>t.setValue(i,{value:e.detail})));o&&window.updateAngularFormValue(i,{value:n});if(this.enableScripting&&this.hasJSActions){l.addEventListener("updatefromsandbox",(e=>{const s={value(e){e.target.checked="Off"!==e.detail.value;t.setValue(i,{value:e.target.checked});window.updateAngularFormValue(i,{value:e.target.value})}};this._dispatchEventFromSandbox(s,e)}));this._setEventListeners(l,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(t=>t.target.checked))}this._setBackgroundColor(l);this._setDefaultPropertiesFromJS(l);this.container.append(l);return this.container}}class RadioButtonWidgetAnnotationElement extends WidgetAnnotationElement{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,i=e.id,s=window.getFormValueFromAngular(this.data.fieldName),a=t.getValue(i,{value:e.fieldValue===e.buttonValue}).value;let r=s.value??a;if("string"==typeof r||s!==a){r=r===e.buttonValue;t.setValue(i,{value:r})}else r&&window.updateAngularFormValue(i,{value:e.buttonValue});if(r)for(const s of this._getElementsByName(e.fieldName,i))t.setValue(s.id,{value:!1});const n=document.createElement("input");Is.add(n);n.setAttribute("data-element-id",i);n.disabled=e.readOnly;this._setRequired(n,this.data.required);n.type="radio";n.name=e.fieldName;r&&n.setAttribute("checked",!0);n.tabIndex=Gs;n.addEventListener("change",(e=>{const{name:s,checked:a}=e.target;for(const e of this._getElementsByName(s,i)){t.setValue(e.id,{value:!1});window.updateAngularFormValue(e.id,{value:!1})}t.setValue(i,{value:a});window.updateAngularFormValue(i,{value:a})}));n.addEventListener("resetform",(t=>{const i=e.defaultFieldValue;t.target.checked=null!=i&&i===e.buttonValue}));window.registerAcroformField(i,n,r?e.buttonValue:void 0,e.buttonValue);n.addEventListener("updateFromAngular",(e=>t.setValue(i,{value:e.detail})));if(this.enableScripting&&this.hasJSActions){const s=e.buttonValue;n.addEventListener("updatefromsandbox",(e=>{const a={value:e=>{const a=s===e.detail.value;for(const s of this._getElementsByName(e.target.name)){const e=a&&s.id===i;s.domElement&&(s.domElement.checked=e);t.setValue(s.id,{value:e});window.updateAngularFormValue(i,{value:e})}}};this._dispatchEventFromSandbox(a,e)}));this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(t=>t.target.checked))}this._setBackgroundColor(n);this._setDefaultPropertiesFromJS(n);this.container.append(n);return this.container}}class PushButtonWidgetAnnotationElement extends LinkAnnotationElement{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;if(this.enableScripting&&this.hasJSActions&&e){this._setDefaultPropertiesFromJS(e);e.addEventListener("updatefromsandbox",(t=>{this._dispatchEventFromSandbox({},t)}))}return t}}class ChoiceWidgetAnnotationElement extends WidgetAnnotationElement{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,i=window.getFormValueFromAngular(this.data.fieldName),s=t.getValue(e,{value:this.data.fieldValue}),a=i.value?i:s;i!==s&&t.setValue(e,{value:i.value});const r=document.createElement("select");Is.add(r);r.setAttribute("data-element-id",e);r.disabled=this.data.readOnly;this._setRequired(r,this.data.required);r.name=this.data.fieldName;r.tabIndex=Gs;let n=this.data.combo&&this.data.options.length>0;if(!this.data.combo){r.size=this.data.options.length;this.data.multiSelect&&(r.multiple=!0)}r.addEventListener("resetform",(t=>{const e=this.data.defaultFieldValue;for(const t of r.options)t.selected=t.value===e}));for(const t of this.data.options){const e=document.createElement("option");e.textContent=t.displayValue;e.value=t.exportValue;if(a.value.includes(t.exportValue)){e.setAttribute("selected",!0);n=!1}r.append(e)}let o=null;if(n){const t=document.createElement("option");t.value=" ";t.setAttribute("hidden",!0);t.setAttribute("selected",!0);r.prepend(t);o=()=>{t.remove();r.removeEventListener("input",o);o=null};r.addEventListener("input",o)}const getValue=t=>{const e=t?"value":"textContent",{options:i,multiple:s}=r;return s?Array.prototype.filter.call(i,(t=>t.selected)).map((t=>t[e])):-1===i.selectedIndex?null:i[i.selectedIndex][e]};let l=getValue(!1);const getItems=t=>{const e=t.target.options;return Array.prototype.map.call(e,(t=>({displayValue:t.textContent,exportValue:t.value})))};window.registerAcroformField(e,r,l);r.addEventListener("updateFromAngular",(i=>t.setValue(e,{value:i.detail})));if(this.enableScripting&&this.hasJSActions){r.addEventListener("updatefromsandbox",(i=>{const s={value(i){o?.();const s=i.detail.value,a=new Set(Array.isArray(s)?s:[s]);for(const t of r.options)t.selected=a.has(t.value);t.setValue(e,{value:getValue(!0)});l=getValue(!1);window.updateAngularFormValue(e,{value:l})},multipleSelection(t){r.multiple=!0},remove(i){const s=r.options,a=i.detail.remove;s[a].selected=!1;r.remove(a);if(s.length>0){-1===Array.prototype.findIndex.call(s,(t=>t.selected))&&(s[0].selected=!0)}t.setValue(e,{value:getValue(!0),items:getItems(i)});l=getValue(!1)},clear(i){for(;0!==r.length;)r.remove(0);t.setValue(e,{value:null,items:[]});l=getValue(!1);window.updateAngularFormValue(e,{value:l})},insert(i){const{index:s,displayValue:a,exportValue:n}=i.detail.insert,o=r.children[s],c=document.createElement("option");c.textContent=a;c.value=n;o?o.before(c):r.append(c);t.setValue(e,{value:getValue(!0),items:getItems(i)});l=getValue(!1);window.updateAngularFormValue(e,{value:l})},items(i){const{items:s}=i.detail;for(;0!==r.length;)r.remove(0);for(const t of s){const{displayValue:e,exportValue:i}=t,s=document.createElement("option");s.textContent=e;s.value=i;r.append(s)}r.options.length>0&&(r.options[0].selected=!0);t.setValue(e,{value:getValue(!0),items:getItems(i)});l=getValue(!1);window.updateAngularFormValue(e,{value:l})},indices(i){const s=new Set(i.detail.indices);for(const t of i.target.options)t.selected=s.has(t.index);t.setValue(e,{value:getValue(!0)});l=getValue(!1);window.updateAngularFormValue(e,{value:l})},editable(t){t.target.disabled=!t.detail.editable}};this._dispatchEventFromSandbox(s,i)}));r.addEventListener("input",(i=>{const s=getValue(!0);t.setValue(e,{value:s});window.updateAngularFormValue(e,{value:s});i.preventDefault();this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,changeEx:s,willCommit:!1,commitKey:1,keyDown:!1}})}));this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(t=>t.target.value))}else r.addEventListener("input",(function(i){t.setValue(e,{value:getValue(!0)});window.updateAngularFormValue(e,{value:getValue(!0)})}));this.data.combo&&this._setTextStyle(r);this._setBackgroundColor(r);this._setDefaultPropertiesFromJS(r);this.container.append(r);return this.container}}class PopupAnnotationElement extends AnnotationElement{constructor(t){const{data:e,elements:i}=t;super(t,{isRenderable:AnnotationElement._hasPopupData(e)});this.elements=i}render(){this.container.classList.add("popupAnnotation");const t=new PopupElement({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const i of this.elements){i.popup=t;e.push(i.data.id);i.addHighlightArea()}this.container.setAttribute("aria-controls",e.map((t=>`${st}${t}`)).join(","));return this.container}}var Ds=new WeakMap,Ls=new WeakMap,Bs=new WeakMap,Os=new WeakMap,Ns=new WeakMap,Ws=new WeakMap,js=new WeakMap,Hs=new WeakMap,Us=new WeakMap,zs=new WeakMap,Vs=new WeakMap,qs=new WeakMap,$s=new WeakMap,Xs=new WeakMap,Ks=new WeakMap,Ys=new WeakMap,Qs=new WeakMap,Js=new WeakSet;class PopupElement{constructor(t){let{container:e,color:i,elements:s,titleObj:a,modificationDate:r,contentsObj:n,richText:o,parent:l,rect:c,parentRect:h,open:d}=t;annotation_layer_classPrivateMethodInitSpec(this,Js);annotation_layer_classPrivateFieldInitSpec(this,Ds,annotation_layer_assertClassBrand(Js,this,_keyDown).bind(this));annotation_layer_classPrivateFieldInitSpec(this,Ls,annotation_layer_assertClassBrand(Js,this,_hide).bind(this));annotation_layer_classPrivateFieldInitSpec(this,Bs,annotation_layer_assertClassBrand(Js,this,_show).bind(this));annotation_layer_classPrivateFieldInitSpec(this,Os,annotation_layer_assertClassBrand(Js,this,_toggle).bind(this));annotation_layer_classPrivateFieldInitSpec(this,Ns,null);annotation_layer_classPrivateFieldInitSpec(this,Ws,null);annotation_layer_classPrivateFieldInitSpec(this,js,null);annotation_layer_classPrivateFieldInitSpec(this,Hs,null);annotation_layer_classPrivateFieldInitSpec(this,Us,null);annotation_layer_classPrivateFieldInitSpec(this,zs,null);annotation_layer_classPrivateFieldInitSpec(this,Vs,null);annotation_layer_classPrivateFieldInitSpec(this,qs,!1);annotation_layer_classPrivateFieldInitSpec(this,$s,null);annotation_layer_classPrivateFieldInitSpec(this,Xs,null);annotation_layer_classPrivateFieldInitSpec(this,Ks,null);annotation_layer_classPrivateFieldInitSpec(this,Ys,null);annotation_layer_classPrivateFieldInitSpec(this,Qs,!1);annotation_layer_classPrivateFieldSet(Ws,this,e);annotation_layer_classPrivateFieldSet(Ys,this,a);annotation_layer_classPrivateFieldSet(js,this,n);annotation_layer_classPrivateFieldSet(Ks,this,o);annotation_layer_classPrivateFieldSet(zs,this,l);annotation_layer_classPrivateFieldSet(Ns,this,i);annotation_layer_classPrivateFieldSet(Xs,this,c);annotation_layer_classPrivateFieldSet(Vs,this,h);annotation_layer_classPrivateFieldSet(Us,this,s);annotation_layer_classPrivateFieldSet(Hs,this,PDFDateString.toDateObject(r));this.trigger=s.flatMap((t=>t.getElementsToTriggerPopup()));for(const t of this.trigger){t.addEventListener("click",annotation_layer_classPrivateFieldGet(Os,this));t.addEventListener("mouseenter",annotation_layer_classPrivateFieldGet(Bs,this));t.addEventListener("mouseleave",annotation_layer_classPrivateFieldGet(Ls,this));t.classList.add("popupTriggerArea")}for(const t of s)t.container?.addEventListener("keydown",annotation_layer_classPrivateFieldGet(Ds,this));annotation_layer_classPrivateFieldGet(Ws,this).hidden=!0;d&&annotation_layer_assertClassBrand(Js,this,_toggle).call(this)}render(){if(annotation_layer_classPrivateFieldGet($s,this))return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:i,pageX:s,pageY:a}}}=annotation_layer_classPrivateFieldGet(zs,this),r=annotation_layer_classPrivateFieldSet($s,this,document.createElement("div"));r.className="popup";if(annotation_layer_classPrivateFieldGet(Ns,this)){const t=r.style.outlineColor=Util.makeHexColor(...annotation_layer_classPrivateFieldGet(Ns,this));if(CSS.supports("background-color","color-mix(in srgb, red 30%, white)"))r.style.backgroundColor=`color-mix(in srgb, ${t} 30%, white)`;else{const t=.7;r.style.backgroundColor=Util.makeHexColor(...annotation_layer_classPrivateFieldGet(Ns,this).map((e=>Math.floor(t*(255-e)+e))))}}const n=document.createElement("span");n.className="header";const o=document.createElement("h1");n.append(o);({dir:o.dir,str:o.textContent}=annotation_layer_classPrivateFieldGet(Ys,this));r.append(n);if(annotation_layer_classPrivateFieldGet(Hs,this)){const t=document.createElement("span");t.classList.add("popupDate");t.setAttribute("data-l10n-id","pdfjs-annotation-date-string");t.setAttribute("data-l10n-args",JSON.stringify({date:annotation_layer_classPrivateFieldGet(Hs,this).toLocaleDateString(),time:annotation_layer_classPrivateFieldGet(Hs,this).toLocaleTimeString()}));n.append(t)}const l=annotation_layer_classPrivateFieldGet(js,this),c=annotation_layer_classPrivateFieldGet(Ks,this);if(!c?.str||l?.str&&l.str!==c.str){const t=this._formatContents(l);r.append(t)}else{XfaLayer.render({xfaHtml:c.html,intent:"richText",div:r});r.lastChild.classList.add("richText","popupContent")}let h=!!annotation_layer_classPrivateFieldGet(Vs,this),d=annotation_layer_classPrivateFieldGet(h?Vs:Xs,this);for(const t of annotation_layer_classPrivateFieldGet(Us,this))if(!d||null!==Util.intersect(t.data.rect,d)){d=t.data.rect;h=!0;break}const u=Util.normalizeRect([d[0],t[3]-d[1]+t[1],d[2],t[3]-d[3]+t[1]]),p=h?d[2]-d[0]+5:0,_=u[0]+p,f=u[1],{style:g}=annotation_layer_classPrivateFieldGet(Ws,this);g.left=100*(_-s)/e+"%";g.top=100*(f-a)/i+"%";annotation_layer_classPrivateFieldGet(Ws,this).append(r)}_formatContents(t){let{str:e,dir:i}=t;const s=document.createElement("p");s.classList.add("popupContent");s.dir=i;const a=e.split(/(?:\r\n?|\n)/);for(let t=0,e=a.length;t<e;++t){const i=a[t];s.append(document.createTextNode(i));t<e-1&&s.append(document.createElement("br"))}return s}forceHide(){annotation_layer_classPrivateFieldSet(Qs,this,this.isVisible);annotation_layer_classPrivateFieldGet(Qs,this)&&(annotation_layer_classPrivateFieldGet(Ws,this).hidden=!0)}maybeShow(){if(annotation_layer_classPrivateFieldGet(Qs,this)){annotation_layer_classPrivateFieldSet(Qs,this,!1);annotation_layer_classPrivateFieldGet(Ws,this).hidden=!1}}get isVisible(){return!1===annotation_layer_classPrivateFieldGet(Ws,this).hidden}}function _keyDown(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||("Enter"===t.key||"Escape"===t.key&&annotation_layer_classPrivateFieldGet(qs,this))&&annotation_layer_assertClassBrand(Js,this,_toggle).call(this)}function _toggle(){annotation_layer_classPrivateFieldSet(qs,this,!annotation_layer_classPrivateFieldGet(qs,this));if(annotation_layer_classPrivateFieldGet(qs,this)){annotation_layer_assertClassBrand(Js,this,_show).call(this);annotation_layer_classPrivateFieldGet(Ws,this).addEventListener("click",annotation_layer_classPrivateFieldGet(Os,this));annotation_layer_classPrivateFieldGet(Ws,this).addEventListener("keydown",annotation_layer_classPrivateFieldGet(Ds,this))}else{annotation_layer_assertClassBrand(Js,this,_hide).call(this);annotation_layer_classPrivateFieldGet(Ws,this).removeEventListener("click",annotation_layer_classPrivateFieldGet(Os,this));annotation_layer_classPrivateFieldGet(Ws,this).removeEventListener("keydown",annotation_layer_classPrivateFieldGet(Ds,this))}}function _show(){annotation_layer_classPrivateFieldGet($s,this)||this.render();if(this.isVisible)annotation_layer_classPrivateFieldGet(qs,this)&&annotation_layer_classPrivateFieldGet(Ws,this).classList.add("focused");else{annotation_layer_classPrivateFieldGet(Ws,this).hidden=!1;annotation_layer_classPrivateFieldGet(Ws,this).style.zIndex=parseInt(annotation_layer_classPrivateFieldGet(Ws,this).style.zIndex)+1e3}}function _hide(){annotation_layer_classPrivateFieldGet(Ws,this).classList.remove("focused");if(!annotation_layer_classPrivateFieldGet(qs,this)&&this.isVisible){annotation_layer_classPrivateFieldGet(Ws,this).hidden=!0;annotation_layer_classPrivateFieldGet(Ws,this).style.zIndex=parseInt(annotation_layer_classPrivateFieldGet(Ws,this).style.zIndex)-1e3}}class FreeTextAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});this.textContent=t.data.textContent;this.textPosition=t.data.textPosition;this.annotationEditorType=p.FREETEXT}render(){this.container.classList.add("freeTextAnnotation");if(this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent");t.setAttribute("role","comment");for(const e of this.textContent){const i=document.createElement("span");i.textContent=e;t.append(i)}this.container.append(t)}!this.data.popupRef&&this.hasPopupData&&this._createPopup();this._editOnDoubleClick();return this.container}get _isEditable(){return this.data.hasOwnCanvas}}var Zs=new WeakMap;class LineAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});annotation_layer_classPrivateFieldInitSpec(this,Zs,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:e,height:i}=getRectDims(t.rect),s=this.svgFactory.create(e,i,!0),a=annotation_layer_classPrivateFieldSet(Zs,this,this.svgFactory.createElement("svg:line"));a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]);a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]);a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]);a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]);a.setAttribute("stroke-width",t.borderStyle.width||1);a.setAttribute("stroke","transparent");a.setAttribute("fill","transparent");s.append(a);this.container.append(s);!t.popupRef&&this.hasPopupData&&this._createPopup();return this.container}getElementsToTriggerPopup(){return annotation_layer_classPrivateFieldGet(Zs,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}var ta=new WeakMap;class SquareAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});annotation_layer_classPrivateFieldInitSpec(this,ta,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:e,height:i}=getRectDims(t.rect),s=this.svgFactory.create(e,i,!0),a=t.borderStyle.width,r=annotation_layer_classPrivateFieldSet(ta,this,this.svgFactory.createElement("svg:rect"));r.setAttribute("x",a/2);r.setAttribute("y",a/2);r.setAttribute("width",e-a);r.setAttribute("height",i-a);r.setAttribute("stroke-width",a||1);r.setAttribute("stroke","transparent");r.setAttribute("fill","transparent");s.append(r);this.container.append(s);!t.popupRef&&this.hasPopupData&&this._createPopup();return this.container}getElementsToTriggerPopup(){return annotation_layer_classPrivateFieldGet(ta,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}var ea=new WeakMap;class CircleAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});annotation_layer_classPrivateFieldInitSpec(this,ea,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:e,height:i}=getRectDims(t.rect),s=this.svgFactory.create(e,i,!0),a=t.borderStyle.width,r=annotation_layer_classPrivateFieldSet(ea,this,this.svgFactory.createElement("svg:ellipse"));r.setAttribute("cx",e/2);r.setAttribute("cy",i/2);r.setAttribute("rx",e/2-a/2);r.setAttribute("ry",i/2-a/2);r.setAttribute("stroke-width",a||1);r.setAttribute("stroke","transparent");r.setAttribute("fill","transparent");s.append(r);this.container.append(s);!t.popupRef&&this.hasPopupData&&this._createPopup();return this.container}getElementsToTriggerPopup(){return annotation_layer_classPrivateFieldGet(ea,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}var ia=new WeakMap;class PolylineAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});annotation_layer_classPrivateFieldInitSpec(this,ia,null);this.containerClassName="polylineAnnotation";this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const t=this.data,{width:e,height:i}=getRectDims(t.rect),s=this.svgFactory.create(e,i,!0);let a=[];for(const e of t.vertices){const i=e.x-t.rect[0],s=t.rect[3]-e.y;a.push(i+","+s)}a=a.join(" ");const r=annotation_layer_classPrivateFieldSet(ia,this,this.svgFactory.createElement(this.svgElementName));r.setAttribute("points",a);r.setAttribute("stroke-width",t.borderStyle.width||1);r.setAttribute("stroke","transparent");r.setAttribute("fill","transparent");s.append(r);this.container.append(s);!t.popupRef&&this.hasPopupData&&this._createPopup();return this.container}getElementsToTriggerPopup(){return annotation_layer_classPrivateFieldGet(ia,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}class PolygonAnnotationElement extends PolylineAnnotationElement{constructor(t){super(t);this.containerClassName="polygonAnnotation";this.svgElementName="svg:polygon"}}class CaretAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("caretAnnotation");!this.data.popupRef&&this.hasPopupData&&this._createPopup();return this.container}}var sa=new WeakMap;class InkAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});annotation_layer_classPrivateFieldInitSpec(this,sa,[]);this.containerClassName="inkAnnotation";this.svgElementName="svg:polyline";this.annotationEditorType=p.INK}render(){this.container.classList.add(this.containerClassName);const t=this.data,{width:e,height:i}=getRectDims(t.rect),s=this.svgFactory.create(e,i,!0);for(const e of t.inkLists){let i=[];for(const s of e){const e=s.x-t.rect[0],a=t.rect[3]-s.y;i.push(`${e},${a}`)}i=i.join(" ");const a=this.svgFactory.createElement(this.svgElementName);annotation_layer_classPrivateFieldGet(sa,this).push(a);a.setAttribute("points",i);a.setAttribute("stroke-width",t.borderStyle.width||1);a.setAttribute("stroke","transparent");a.setAttribute("fill","transparent");!t.popupRef&&this.hasPopupData&&this._createPopup();s.append(a)}this.container.append(s);return this.container}getElementsToTriggerPopup(){return annotation_layer_classPrivateFieldGet(sa,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}class HighlightAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){!this.data.popupRef&&this.hasPopupData&&this._createPopup();this.container.classList.add("highlightAnnotation");return this.container}}class UnderlineAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){!this.data.popupRef&&this.hasPopupData&&this._createPopup();this.container.classList.add("underlineAnnotation");return this.container}}class SquigglyAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){!this.data.popupRef&&this.hasPopupData&&this._createPopup();this.container.classList.add("squigglyAnnotation");return this.container}}class StrikeOutAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){!this.data.popupRef&&this.hasPopupData&&this._createPopup();this.container.classList.add("strikeoutAnnotation");return this.container}}class StampAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("stampAnnotation");!this.data.popupRef&&this.hasPopupData&&this._createPopup();return this.container}}var aa=new WeakMap,ra=new WeakSet;class FileAttachmentAnnotationElement extends AnnotationElement{constructor(t){super(t,{isRenderable:!0});annotation_layer_classPrivateMethodInitSpec(this,ra);annotation_layer_classPrivateFieldInitSpec(this,aa,null);const{filename:e,content:i}=this.data.file;this.filename=getFilenameFromUrl(e,!0);this.content=i;this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:e,content:i})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let i;if(e.hasAppearance||0===e.fillAlpha)i=document.createElement("div");else{i=document.createElement("img");i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`;e.fillAlpha&&e.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(100*e.fillAlpha)}%);`)}i.addEventListener("dblclick",annotation_layer_assertClassBrand(ra,this,_download).bind(this));annotation_layer_classPrivateFieldSet(aa,this,i);const{isMac:s}=util_FeatureTest.platform;t.addEventListener("keydown",(t=>{"Enter"===t.key&&(s?t.metaKey:t.ctrlKey)&&annotation_layer_assertClassBrand(ra,this,_download).call(this)}));!e.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea");t.append(i);return t}getElementsToTriggerPopup(){return annotation_layer_classPrivateFieldGet(aa,this)}addHighlightArea(){this.container.classList.add("highlightArea")}}function _download(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}var na,oa=new WeakMap,la=new WeakMap,ca=new WeakMap,ha=new WeakSet;class AnnotationLayer{constructor(t){let{div:e,accessibilityManager:i,annotationCanvasMap:s,page:a,viewport:r}=t;annotation_layer_classPrivateMethodInitSpec(this,ha);annotation_layer_classPrivateFieldInitSpec(this,oa,null);annotation_layer_classPrivateFieldInitSpec(this,la,null);annotation_layer_classPrivateFieldInitSpec(this,ca,new Map);this.div=e;annotation_layer_classPrivateFieldSet(oa,this,i);annotation_layer_classPrivateFieldSet(la,this,s);this.page=a;this.viewport=r;this.zIndex=0}async render(t){const{annotations:e}=t,i=this.div;setLayerDimensions(i,this.viewport);const s=new Map,a={data:null,layer:i,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:!1!==t.renderForms,svgFactory:new DOMSVGFactory,annotationStorage:t.annotationStorage||new AnnotationStorage,enableScripting:!0===t.enableScripting,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const t of e){if(t.noHTML)continue;const e=t.annotationType===N;if(e){const e=s.get(t.id);if(!e)continue;a.elements=e}else{const{width:e,height:i}=getRectDims(t.rect);if(e<=0||i<=0)continue}a.data=t;const i=AnnotationElementFactory.create(a);if(!i.isRenderable)continue;if(!e&&t.popupRef){const e=s.get(t.popupRef);e?e.push(i):s.set(t.popupRef,[i])}i.annotationEditorType>0&&annotation_layer_classPrivateFieldGet(ca,this).set(i.data.id,i);const r=i.render();t.hidden&&(r.style.visibility="hidden");annotation_layer_assertClassBrand(ha,this,_appendElement).call(this,r,t.id)}annotation_layer_assertClassBrand(ha,this,_setAnnotationCanvasMap).call(this)}update(t){let{viewport:e}=t;const i=this.div;this.viewport=e;setLayerDimensions(i,{rotation:e.rotation});annotation_layer_assertClassBrand(ha,this,_setAnnotationCanvasMap).call(this);i.hidden=!1}getEditableAnnotations(){return Array.from(annotation_layer_classPrivateFieldGet(ca,this).values())}getEditableAnnotation(t){return annotation_layer_classPrivateFieldGet(ca,this).get(t)}}function _appendElement(t,e){const i=t.firstChild||t;i.id=`${st}${e}`;this.div.append(t);annotation_layer_classPrivateFieldGet(oa,this)?.moveElementInDOM(this.div,t,i,!1)}function _setAnnotationCanvasMap(){if(!annotation_layer_classPrivateFieldGet(la,this))return;const t=this.div;for(const[e,i]of annotation_layer_classPrivateFieldGet(la,this)){const s=t.querySelector(`[data-annotation-id="${e}"]`);if(!s)continue;const{firstChild:a}=s;a?"CANVAS"===a.nodeName?a.replaceWith(i):a.before(i):s.append(i)}annotation_layer_classPrivateFieldGet(la,this).clear()}function freetext_defineProperty(t,e,i){(e=function freetext_toPropertyKey(t){var e=function freetext_toPrimitive(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i;return t}function freetext_classPrivateFieldInitSpec(t,e,i){freetext_checkPrivateRedeclaration(t,e);e.set(t,i)}function freetext_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function freetext_classPrivateFieldGet(t,e){return t.get(freetext_assertClassBrand(t,e))}function freetext_classPrivateFieldSet(t,e,i){return t.set(freetext_assertClassBrand(t,e),i),i}function freetext_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}const da=/\r\n?|\n/g;var ua=new WeakMap,pa=new WeakMap,_a=new WeakMap,fa=new WeakMap,ga=new WeakMap,va=new WeakMap,ma=new WeakMap,Pa=new WeakMap,ya=new WeakMap,Fa=new WeakMap,ba=new WeakSet;class FreeTextEditor extends AnnotationEditor{static get _keyboardManager(){const t=FreeTextEditor.prototype,arrowChecker=t=>t.isEmpty(),e=AnnotationEditorUIManager.TRANSLATE_SMALL,i=AnnotationEditorUIManager.TRANSLATE_BIG;return shadow(this,"_keyboardManager",new KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-e,0],checker:arrowChecker}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:arrowChecker}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[e,0],checker:arrowChecker}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:arrowChecker}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-e],checker:arrowChecker}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:arrowChecker}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,e],checker:arrowChecker}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:arrowChecker}]]))}constructor(t){super({...t,name:"freeTextEditor"});!function freetext_classPrivateMethodInitSpec(t,e){freetext_checkPrivateRedeclaration(t,e);e.add(t)}(this,ba);freetext_classPrivateFieldInitSpec(this,ua,this.editorDivBlur.bind(this));freetext_classPrivateFieldInitSpec(this,pa,this.editorDivFocus.bind(this));freetext_classPrivateFieldInitSpec(this,_a,this.editorDivInput.bind(this));freetext_classPrivateFieldInitSpec(this,fa,this.editorDivKeydown.bind(this));freetext_classPrivateFieldInitSpec(this,ga,this.editorDivPaste.bind(this));freetext_classPrivateFieldInitSpec(this,va,void 0);freetext_classPrivateFieldInitSpec(this,ma,"");freetext_classPrivateFieldInitSpec(this,Pa,`${this.id}-editor`);freetext_classPrivateFieldInitSpec(this,ya,void 0);freetext_classPrivateFieldInitSpec(this,Fa,null);freetext_classPrivateFieldSet(va,this,t.color||FreeTextEditor._defaultColor||AnnotationEditor._defaultLineColor);freetext_classPrivateFieldSet(ya,this,t.fontSize||FreeTextEditor._defaultFontSize)}static initialize(t,e){AnnotationEditor.initialize(t,e,{strings:["pdfjs-free-text-default-content"]});const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case _.FREETEXT_SIZE:FreeTextEditor._defaultFontSize=e;break;case _.FREETEXT_COLOR:FreeTextEditor._defaultColor=e}}updateParams(t,e){switch(t){case _.FREETEXT_SIZE:freetext_assertClassBrand(ba,this,_updateFontSize).call(this,e);break;case _.FREETEXT_COLOR:freetext_assertClassBrand(ba,this,_updateColor).call(this,e)}}static get defaultPropertiesToUpdate(){return[[_.FREETEXT_SIZE,FreeTextEditor._defaultFontSize],[_.FREETEXT_COLOR,FreeTextEditor._defaultColor||AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[_.FREETEXT_SIZE,freetext_classPrivateFieldGet(ya,this)],[_.FREETEXT_COLOR,freetext_classPrivateFieldGet(va,this)]]}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-FreeTextEditor._internalPadding*t,-(FreeTextEditor._internalPadding+freetext_classPrivateFieldGet(ya,this))*t]}rebuild(){if(this.parent){super.rebuild();null!==this.div&&(this.isAttachedToDOM||this.parent.add(this))}}enableEditMode(){if(!this.isInEditMode()){this.parent.setEditingState(!1);this.parent.updateToolbar(p.FREETEXT);super.enableEditMode();this.overlayDiv.classList.remove("enabled");this.editorDiv.contentEditable=!0;this._isDraggable=!1;this.div.removeAttribute("aria-activedescendant");this.editorDiv.addEventListener("keydown",freetext_classPrivateFieldGet(fa,this));this.editorDiv.addEventListener("focus",freetext_classPrivateFieldGet(pa,this));this.editorDiv.addEventListener("blur",freetext_classPrivateFieldGet(ua,this));this.editorDiv.addEventListener("input",freetext_classPrivateFieldGet(_a,this));this.editorDiv.addEventListener("paste",freetext_classPrivateFieldGet(ga,this))}}disableEditMode(){if(this.isInEditMode()){this.parent.setEditingState(!0);super.disableEditMode();this.overlayDiv.classList.add("enabled");this.editorDiv.contentEditable=!1;this.div.setAttribute("aria-activedescendant",freetext_classPrivateFieldGet(Pa,this));this._isDraggable=!0;this.editorDiv.removeEventListener("keydown",freetext_classPrivateFieldGet(fa,this));this.editorDiv.removeEventListener("focus",freetext_classPrivateFieldGet(pa,this));this.editorDiv.removeEventListener("blur",freetext_classPrivateFieldGet(ua,this));this.editorDiv.removeEventListener("input",freetext_classPrivateFieldGet(_a,this));this.editorDiv.removeEventListener("paste",freetext_classPrivateFieldGet(ga,this));this.div.focus({preventScroll:!0});this.isEditing=!1;this.parent.div.classList.add("freetextEditing")}}focusin(t){if(this._focusEventsAllowed){super.focusin(t);t.target!==this.editorDiv&&this.editorDiv.focus()}}onceAdded(){if(this.width)freetext_assertClassBrand(ba,this,_cheatInitialRect).call(this);else{this.enableEditMode();this.editorDiv.focus();this._initialOptions?.isCentered&&this.center();this._initialOptions=null}}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1;if(this.parent){this.parent.setEditingState(!0);this.parent.div.classList.add("freetextEditing")}super.remove()}commit(){if(!this.isInEditMode())return;super.commit();this.disableEditMode();const t=freetext_classPrivateFieldGet(ma,this),e=freetext_classPrivateFieldSet(ma,this,freetext_assertClassBrand(ba,this,_extractText).call(this).trimEnd());if(t===e)return;const setText=t=>{freetext_classPrivateFieldSet(ma,this,t);if(t){freetext_assertClassBrand(ba,this,_setContent).call(this);this._uiManager.rebuild(this);freetext_assertClassBrand(ba,this,_setEditorDimensions).call(this)}else this.remove()};this.addCommands({cmd:()=>{setText(e)},undo:()=>{setText(t)},mustExec:!1});freetext_assertClassBrand(ba,this,_setEditorDimensions).call(this);this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"commit",page:this.pageIndex+1,value:e,previousValue:t})}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode();this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){if(t.target===this.div&&"Enter"===t.key){this.enterInEditMode();t.preventDefault()}}editorDivKeydown(t){FreeTextEditor._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment");this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox");this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,e;if(this.width){t=this.x;e=this.y}super.render();this.editorDiv=document.createElement("div");this.editorDiv.className="internal";this.editorDiv.setAttribute("id",freetext_classPrivateFieldGet(Pa,this));this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text");this.enableEditing();AnnotationEditor._l10nPromise.get("pdfjs-free-text-default-content").then((t=>this.editorDiv?.setAttribute("default-content",t)));this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;i.fontSize=`calc(${freetext_classPrivateFieldGet(ya,this)}px * var(--scale-factor))`;i.color=freetext_classPrivateFieldGet(va,this);this.div.append(this.editorDiv);this.overlayDiv=document.createElement("div");this.overlayDiv.classList.add("overlay","enabled");this.div.append(this.overlayDiv);bindEvents(this,this.div,["dblclick","keydown"]);if(this.width){const[i,s]=this.parentDimensions;if(this.annotationElementId){const{position:a}=freetext_classPrivateFieldGet(Fa,this);let[r,n]=this.getInitialTranslation();[r,n]=this.pageTranslationToScreen(r,n);const[o,l]=this.pageDimensions,[c,h]=this.pageTranslation;let d,u;switch(this.rotation){case 0:d=t+(a[0]-c)/o;u=e+this.height-(a[1]-h)/l;break;case 90:d=t+(a[0]-c)/o;u=e-(a[1]-h)/l;[r,n]=[n,-r];break;case 180:d=t-this.width+(a[0]-c)/o;u=e-(a[1]-h)/l;[r,n]=[-r,-n];break;case 270:d=t+(a[0]-c-this.height*l)/o;u=e+(a[1]-h-this.width*o)/l;[r,n]=[-n,r]}this.setAt(d*i,u*s,r,n)}else this.setAt(t*i,e*s,this.width*i,this.height*s);freetext_assertClassBrand(ba,this,_setContent).call(this);this._isDraggable=!0;this.editorDiv.contentEditable=!1}else{this._isDraggable=!1;this.editorDiv.contentEditable=!0}return this.div}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:i}=e;if(1===i.length&&"text/plain"===i[0])return;t.preventDefault();const s=_deserializeContent.call(FreeTextEditor,e.getData("text")||"").replaceAll(da,"\n");if(!s)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize();a.deleteFromDocument();const r=a.getRangeAt(0);if(!s.includes("\n")){r.insertNode(document.createTextNode(s));this.editorDiv.normalize();a.collapseToStart();return}const{startContainer:n,startOffset:o}=r,l=[],c=[];if(n.nodeType===Node.TEXT_NODE){const t=n.parentElement;c.push(n.nodeValue.slice(o).replaceAll(da,""));if(t!==this.editorDiv){let e=l;for(const i of this.editorDiv.childNodes)i!==t?e.push(_getNodeContent.call(FreeTextEditor,i)):e=c}l.push(n.nodeValue.slice(0,o).replaceAll(da,""))}else if(n===this.editorDiv){let t=l,e=0;for(const i of this.editorDiv.childNodes){e++===o&&(t=c);t.push(_getNodeContent.call(FreeTextEditor,i))}}freetext_classPrivateFieldSet(ma,this,`${l.join("\n")}${s}${c.join("\n")}`);freetext_assertClassBrand(ba,this,_setContent).call(this);const h=new Range;let d=l.reduce(((t,e)=>t+e.length),0);for(const{firstChild:t}of this.editorDiv.childNodes)if(t.nodeType===Node.TEXT_NODE){const e=t.nodeValue.length;if(d<=e){h.setStart(t,d);h.setEnd(t,d);break}d-=e}a.removeAllRanges();a.addRange(h)}get contentDiv(){return this.editorDiv}static deserialize(t,e,i){let s=null;if(t instanceof FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:e,fontColor:i},rect:a,rotation:r,id:n},textContent:o,textPosition:l,parent:{page:{pageNumber:c}}}=t;if(!o||0===o.length)return null;s=t={annotationType:p.FREETEXT,color:Array.from(i),fontSize:e,value:o.join("\n"),position:l,pageIndex:c-1,rect:a,rotation:r,id:n,deleted:!1}}const a=super.deserialize(t,e,i);freetext_classPrivateFieldSet(ya,a,t.fontSize);freetext_classPrivateFieldSet(va,a,Util.makeHexColor(...t.color));freetext_classPrivateFieldSet(ma,a,_deserializeContent.call(FreeTextEditor,t.value));a.annotationElementId=t.id||null;freetext_classPrivateFieldSet(Fa,a,s);return a}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const e=FreeTextEditor._internalPadding*this.parentScale,i=this.getRect(e,e),s=AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:freetext_classPrivateFieldGet(va,this)),a={annotationType:p.FREETEXT,color:s,fontSize:freetext_classPrivateFieldGet(ya,this),value:freetext_assertClassBrand(ba,this,_serializeContent).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(t)return a;if(this.annotationElementId&&!freetext_assertClassBrand(ba,this,_hasElementChanged).call(this,a))return null;a.id=this.annotationElementId;return a}}na=FreeTextEditor;function _updateFontSize(t){const setFontsize=t=>{this.editorDiv.style.fontSize=`calc(${t}px * var(--scale-factor))`;this.translate(0,-(t-freetext_classPrivateFieldGet(ya,this))*this.parentScale);freetext_classPrivateFieldSet(ya,this,t);freetext_assertClassBrand(ba,this,_setEditorDimensions).call(this)},e=freetext_classPrivateFieldGet(ya,this);this.addCommands({cmd:setFontsize.bind(this,t),undo:setFontsize.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0});this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"fontSizeChanged",page:this.pageIndex+1,editorType:this.constructor.name,value:t,previousValue:freetext_classPrivateFieldGet(ya,this)})}function _updateColor(t){const setColor=t=>{freetext_classPrivateFieldSet(va,this,this.editorDiv.style.color=t)},e=freetext_classPrivateFieldGet(va,this);this.addCommands({cmd:setColor.bind(this,t),undo:setColor.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0});this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"colorChanged",page:this.pageIndex+1,editorType:this.constructor.name,value:t,previousValue:freetext_classPrivateFieldGet(va,this)})}function _extractText(){const t=[];this.editorDiv.normalize();for(const e of this.editorDiv.childNodes)t.push(_getNodeContent.call(na,e));return t.join("\n")}function _setEditorDimensions(){const[t,e]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:t,div:e}=this,s=e.style.display;e.style.display="hidden";t.div.append(this.div);i=e.getBoundingClientRect();e.remove();e.style.display=s}if(this.rotation%180==this.parentRotation%180){this.width=i.width/t;this.height=i.height/e}else{this.width=i.height/t;this.height=i.width/e}this.fixAndSetPosition()}function _getNodeContent(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(da,"")}function _setContent(){this.editorDiv.replaceChildren();if(freetext_classPrivateFieldGet(ma,this))for(const t of freetext_classPrivateFieldGet(ma,this).split("\n")){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br"));this.editorDiv.append(e)}}function _serializeContent(){return freetext_classPrivateFieldGet(ma,this).replaceAll(" "," ")}function _deserializeContent(t){return t.replaceAll(" "," ")}function _hasElementChanged(t){const{value:e,fontSize:i,color:s,rect:a,pageIndex:r}=freetext_classPrivateFieldGet(Fa,this);return t.value!==e||t.fontSize!==i||t.rect.some(((t,e)=>Math.abs(t-a[e])>=1))||t.color.some(((t,e)=>t!==s[e]))||t.pageIndex!==r}function _cheatInitialRect(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.annotationElementId)return;freetext_assertClassBrand(ba,this,_setEditorDimensions).call(this);if(!t&&(0===this.width||0===this.height)){setTimeout((()=>freetext_assertClassBrand(ba,this,_cheatInitialRect).call(this,!0)),0);return}const e=na._internalPadding*this.parentScale;freetext_classPrivateFieldGet(Fa,this).rect=this.getRect(e,e)}freetext_defineProperty(FreeTextEditor,"_freeTextDefaultContent","");freetext_defineProperty(FreeTextEditor,"_internalPadding",0);freetext_defineProperty(FreeTextEditor,"_defaultColor",null);freetext_defineProperty(FreeTextEditor,"_defaultFontSize",10);freetext_defineProperty(FreeTextEditor,"_type","freetext");freetext_defineProperty(FreeTextEditor,"_editorType",p.FREETEXT);function outliner_classPrivateMethodInitSpec(t,e){outliner_checkPrivateRedeclaration(t,e);e.add(t)}function outliner_classPrivateFieldInitSpec(t,e,i){outliner_checkPrivateRedeclaration(t,e);e.set(t,i)}function outliner_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function outliner_classPrivateFieldSet(t,e,i){return t.set(outliner_assertClassBrand(t,e),i),i}function outliner_classPrivateFieldGet(t,e){return t.get(outliner_assertClassBrand(t,e))}function outliner_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var wa=new WeakMap,Aa=new WeakMap,Sa=new WeakMap,xa=new WeakSet;class Outliner{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];outliner_classPrivateMethodInitSpec(this,xa);outliner_classPrivateFieldInitSpec(this,wa,void 0);outliner_classPrivateFieldInitSpec(this,Aa,[]);outliner_classPrivateFieldInitSpec(this,Sa,[]);let a=1/0,r=-1/0,n=1/0,o=-1/0;const l=10**-4;for(const{x:i,y:s,width:c,height:h}of t){const t=Math.floor((i-e)/l)*l,d=Math.ceil((i+c+e)/l)*l,u=Math.floor((s-e)/l)*l,p=Math.ceil((s+h+e)/l)*l,_=[t,u,p,!0],f=[d,u,p,!1];outliner_classPrivateFieldGet(Aa,this).push(_,f);a=Math.min(a,t);r=Math.max(r,d);n=Math.min(n,u);o=Math.max(o,p)}const c=r-a+2*i,h=o-n+2*i,d=a-i,u=n-i,p=outliner_classPrivateFieldGet(Aa,this).at(s?-1:-2),_=[p[0],p[2]];for(const t of outliner_classPrivateFieldGet(Aa,this)){const[e,i,s]=t;t[0]=(e-d)/c;t[1]=(i-u)/h;t[2]=(s-u)/h}outliner_classPrivateFieldSet(wa,this,{x:d,y:u,width:c,height:h,lastPoint:_})}getOutlines(){outliner_classPrivateFieldGet(Aa,this).sort(((t,e)=>t[0]-e[0]||t[1]-e[1]||t[2]-e[2]));const t=[];for(const e of outliner_classPrivateFieldGet(Aa,this))if(e[3]){t.push(...outliner_assertClassBrand(xa,this,_breakEdge).call(this,e));outliner_assertClassBrand(xa,this,_insert).call(this,e)}else{outliner_assertClassBrand(xa,this,_remove).call(this,e);t.push(...outliner_assertClassBrand(xa,this,_breakEdge).call(this,e))}return outliner_assertClassBrand(xa,this,_getOutlines).call(this,t)}}function _getOutlines(t){const e=[],i=new Set;for(const i of t){const[t,s,a]=i;e.push([t,s,i],[t,a,i])}e.sort(((t,e)=>t[1]-e[1]||t[0]-e[0]));for(let t=0,s=e.length;t<s;t+=2){const s=e[t][2],a=e[t+1][2];s.push(a);a.push(s);i.add(s);i.add(a)}const s=[];let a;for(;i.size>0;){const t=i.values().next().value;let[e,r,n,o,l]=t;i.delete(t);let c=e,h=r;a=[e,n];s.push(a);for(;;){let t;if(i.has(o))t=o;else{if(!i.has(l))break;t=l}i.delete(t);[e,r,n,o,l]=t;if(c!==e){a.push(c,h,e,h===r?r:n);c=e}h=h===r?n:r}a.push(c,h)}return new HighlightOutline(s,outliner_classPrivateFieldGet(wa,this))}function _binarySearch(t){const e=outliner_classPrivateFieldGet(Sa,this);let i=0,s=e.length-1;for(;i<=s;){const a=i+s>>1,r=e[a][0];if(r===t)return a;r<t?i=a+1:s=a-1}return s+1}function _insert(t){let[,e,i]=t;const s=outliner_assertClassBrand(xa,this,_binarySearch).call(this,e);outliner_classPrivateFieldGet(Sa,this).splice(s,0,[e,i])}function _remove(t){let[,e,i]=t;const s=outliner_assertClassBrand(xa,this,_binarySearch).call(this,e);for(let t=s;t<outliner_classPrivateFieldGet(Sa,this).length;t++){const[s,a]=outliner_classPrivateFieldGet(Sa,this)[t];if(s!==e)break;if(s===e&&a===i){outliner_classPrivateFieldGet(Sa,this).splice(t,1);return}}for(let t=s-1;t>=0;t--){const[s,a]=outliner_classPrivateFieldGet(Sa,this)[t];if(s!==e)break;if(s===e&&a===i){outliner_classPrivateFieldGet(Sa,this).splice(t,1);return}}}function _breakEdge(t){const[e,i,s]=t,a=[[e,i,s]],r=outliner_assertClassBrand(xa,this,_binarySearch).call(this,s);for(let t=0;t<r;t++){const[i,s]=outliner_classPrivateFieldGet(Sa,this)[t];for(let t=0,r=a.length;t<r;t++){const[,n,o]=a[t];if(!(s<=n||o<=i))if(n>=i)if(o>s)a[t][1]=s;else{if(1===r)return[];a.splice(t,1);t--;r--}else{a[t][2]=i;o>s&&a.push([e,s,o])}}}return a}class Outline{toSVGPath(){throw new Error("Abstract method `toSVGPath` must be implemented.")}get box(){throw new Error("Abstract getter `box` must be implemented.")}serialize(t,e){throw new Error("Abstract method `serialize` must be implemented.")}get free(){return this instanceof FreeHighlightOutline}}var Ca=new WeakMap,ka=new WeakMap;class HighlightOutline extends Outline{constructor(t,e){super();outliner_classPrivateFieldInitSpec(this,Ca,void 0);outliner_classPrivateFieldInitSpec(this,ka,void 0);outliner_classPrivateFieldSet(ka,this,t);outliner_classPrivateFieldSet(Ca,this,e)}toSVGPath(){const t=[];for(const e of outliner_classPrivateFieldGet(ka,this)){let[i,s]=e;t.push(`M${i} ${s}`);for(let a=2;a<e.length;a+=2){const r=e[a],n=e[a+1];if(r===i){t.push(`V${n}`);s=n}else if(n===s){t.push(`H${r}`);i=r}}t.push("Z")}return t.join(" ")}serialize(t,e){let[i,s,a,r]=t;const n=[],o=a-i,l=r-s;for(const t of outliner_classPrivateFieldGet(ka,this)){const e=new Array(t.length);for(let s=0;s<t.length;s+=2){e[s]=i+t[s]*o;e[s+1]=r-t[s+1]*l}n.push(e)}return n}get box(){return outliner_classPrivateFieldGet(Ca,this)}}var Ea=new WeakMap,Ma=new WeakMap,Ga=new WeakMap,Ia=new WeakMap,Ta=new WeakMap,Ra=new WeakMap,Da=new WeakMap,La=new WeakMap,Ba=new WeakMap,Oa=new WeakMap,Na=new WeakMap,Wa=new WeakMap,ja=new WeakMap,Ha=new WeakSet;class FreeOutliner{constructor(t,e,i,s,a){let{x:r,y:n}=t,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;outliner_classPrivateMethodInitSpec(this,Ha);outliner_classPrivateFieldInitSpec(this,Ea,void 0);outliner_classPrivateFieldInitSpec(this,Ma,[]);outliner_classPrivateFieldInitSpec(this,Ga,void 0);outliner_classPrivateFieldInitSpec(this,Ia,void 0);outliner_classPrivateFieldInitSpec(this,Ta,[]);outliner_classPrivateFieldInitSpec(this,Ra,new Float64Array(18));outliner_classPrivateFieldInitSpec(this,Da,void 0);outliner_classPrivateFieldInitSpec(this,La,void 0);outliner_classPrivateFieldInitSpec(this,Ba,void 0);outliner_classPrivateFieldInitSpec(this,Oa,void 0);outliner_classPrivateFieldInitSpec(this,Na,void 0);outliner_classPrivateFieldInitSpec(this,Wa,void 0);outliner_classPrivateFieldInitSpec(this,ja,[]);outliner_classPrivateFieldSet(Ea,this,e);outliner_classPrivateFieldSet(Wa,this,s*i);outliner_classPrivateFieldSet(Ia,this,a);outliner_classPrivateFieldGet(Ra,this).set([NaN,NaN,NaN,NaN,r,n],6);outliner_classPrivateFieldSet(Ga,this,o);outliner_classPrivateFieldSet(Oa,this,za._*i);outliner_classPrivateFieldSet(Ba,this,Va._*i);outliner_classPrivateFieldSet(Na,this,i);outliner_classPrivateFieldGet(ja,this).push(r,n)}get free(){return!0}isEmpty(){return isNaN(outliner_classPrivateFieldGet(Ra,this)[8])}add(t){let{x:e,y:i}=t;outliner_classPrivateFieldSet(Da,this,e);outliner_classPrivateFieldSet(La,this,i);const[s,a,r,n]=outliner_classPrivateFieldGet(Ea,this);let[o,l,c,h]=outliner_classPrivateFieldGet(Ra,this).subarray(8,12);const d=e-c,u=i-h,p=Math.hypot(d,u);if(p<outliner_classPrivateFieldGet(Ba,this))return!1;const _=p-outliner_classPrivateFieldGet(Oa,this),f=_/p,g=f*d,v=f*u;let m=o,P=l;o=c;l=h;c+=g;h+=v;outliner_classPrivateFieldGet(ja,this)?.push(e,i);const y=g/_,b=-v/_*outliner_classPrivateFieldGet(Wa,this),w=y*outliner_classPrivateFieldGet(Wa,this);outliner_classPrivateFieldGet(Ra,this).set(outliner_classPrivateFieldGet(Ra,this).subarray(2,8),0);outliner_classPrivateFieldGet(Ra,this).set([c+b,h+w],4);outliner_classPrivateFieldGet(Ra,this).set(outliner_classPrivateFieldGet(Ra,this).subarray(14,18),12);outliner_classPrivateFieldGet(Ra,this).set([c-b,h-w],16);if(isNaN(outliner_classPrivateFieldGet(Ra,this)[6])){if(0===outliner_classPrivateFieldGet(Ta,this).length){outliner_classPrivateFieldGet(Ra,this).set([o+b,l+w],2);outliner_classPrivateFieldGet(Ta,this).push(NaN,NaN,NaN,NaN,(o+b-s)/r,(l+w-a)/n);outliner_classPrivateFieldGet(Ra,this).set([o-b,l-w],14);outliner_classPrivateFieldGet(Ma,this).push(NaN,NaN,NaN,NaN,(o-b-s)/r,(l-w-a)/n)}outliner_classPrivateFieldGet(Ra,this).set([m,P,o,l,c,h],6);return!this.isEmpty()}outliner_classPrivateFieldGet(Ra,this).set([m,P,o,l,c,h],6);if(Math.abs(Math.atan2(P-l,m-o)-Math.atan2(v,g))<Math.PI/2){[o,l,c,h]=outliner_classPrivateFieldGet(Ra,this).subarray(2,6);outliner_classPrivateFieldGet(Ta,this).push(NaN,NaN,NaN,NaN,((o+c)/2-s)/r,((l+h)/2-a)/n);[o,l,m,P]=outliner_classPrivateFieldGet(Ra,this).subarray(14,18);outliner_classPrivateFieldGet(Ma,this).push(NaN,NaN,NaN,NaN,((m+o)/2-s)/r,((P+l)/2-a)/n);return!0}[m,P,o,l,c,h]=outliner_classPrivateFieldGet(Ra,this).subarray(0,6);outliner_classPrivateFieldGet(Ta,this).push(((m+5*o)/6-s)/r,((P+5*l)/6-a)/n,((5*o+c)/6-s)/r,((5*l+h)/6-a)/n,((o+c)/2-s)/r,((l+h)/2-a)/n);[c,h,o,l,m,P]=outliner_classPrivateFieldGet(Ra,this).subarray(12,18);outliner_classPrivateFieldGet(Ma,this).push(((m+5*o)/6-s)/r,((P+5*l)/6-a)/n,((5*o+c)/6-s)/r,((5*l+h)/6-a)/n,((o+c)/2-s)/r,((l+h)/2-a)/n);return!0}toSVGPath(){if(this.isEmpty())return"";const t=outliner_classPrivateFieldGet(Ta,this),e=outliner_classPrivateFieldGet(Ma,this),i=outliner_classPrivateFieldGet(Ra,this).subarray(4,6),s=outliner_classPrivateFieldGet(Ra,this).subarray(16,18),[a,r,n,o]=outliner_classPrivateFieldGet(Ea,this),[l,c,h,d]=outliner_assertClassBrand(Ha,this,_getLastCoords).call(this);if(isNaN(outliner_classPrivateFieldGet(Ra,this)[6])&&!this.isEmpty())return`M${(outliner_classPrivateFieldGet(Ra,this)[2]-a)/n} ${(outliner_classPrivateFieldGet(Ra,this)[3]-r)/o} L${(outliner_classPrivateFieldGet(Ra,this)[4]-a)/n} ${(outliner_classPrivateFieldGet(Ra,this)[5]-r)/o} L${l} ${c} L${h} ${d} L${(outliner_classPrivateFieldGet(Ra,this)[16]-a)/n} ${(outliner_classPrivateFieldGet(Ra,this)[17]-r)/o} L${(outliner_classPrivateFieldGet(Ra,this)[14]-a)/n} ${(outliner_classPrivateFieldGet(Ra,this)[15]-r)/o} Z`;const u=[];u.push(`M${t[4]} ${t[5]}`);for(let e=6;e<t.length;e+=6)isNaN(t[e])?u.push(`L${t[e+4]} ${t[e+5]}`):u.push(`C${t[e]} ${t[e+1]} ${t[e+2]} ${t[e+3]} ${t[e+4]} ${t[e+5]}`);u.push(`L${(i[0]-a)/n} ${(i[1]-r)/o} L${l} ${c} L${h} ${d} L${(s[0]-a)/n} ${(s[1]-r)/o}`);for(let t=e.length-6;t>=6;t-=6)isNaN(e[t])?u.push(`L${e[t+4]} ${e[t+5]}`):u.push(`C${e[t]} ${e[t+1]} ${e[t+2]} ${e[t+3]} ${e[t+4]} ${e[t+5]}`);u.push(`L${e[4]} ${e[5]} Z`);return u.join(" ")}getOutlines(){const t=outliner_classPrivateFieldGet(Ta,this),e=outliner_classPrivateFieldGet(Ma,this),i=outliner_classPrivateFieldGet(Ra,this),s=i.subarray(4,6),a=i.subarray(16,18),[r,n,o,l]=outliner_classPrivateFieldGet(Ea,this),c=new Float64Array((outliner_classPrivateFieldGet(ja,this)?.length??0)+2);for(let t=0,e=c.length-2;t<e;t+=2){c[t]=(outliner_classPrivateFieldGet(ja,this)[t]-r)/o;c[t+1]=(outliner_classPrivateFieldGet(ja,this)[t+1]-n)/l}c[c.length-2]=(outliner_classPrivateFieldGet(Da,this)-r)/o;c[c.length-1]=(outliner_classPrivateFieldGet(La,this)-n)/l;const[h,d,u,p]=outliner_assertClassBrand(Ha,this,_getLastCoords).call(this);if(isNaN(i[6])&&!this.isEmpty()){const t=new Float64Array(36);t.set([NaN,NaN,NaN,NaN,(i[2]-r)/o,(i[3]-n)/l,NaN,NaN,NaN,NaN,(i[4]-r)/o,(i[5]-n)/l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(i[16]-r)/o,(i[17]-n)/l,NaN,NaN,NaN,NaN,(i[14]-r)/o,(i[15]-n)/l],0);return new FreeHighlightOutline(t,c,outliner_classPrivateFieldGet(Ea,this),outliner_classPrivateFieldGet(Na,this),outliner_classPrivateFieldGet(Ga,this),outliner_classPrivateFieldGet(Ia,this))}const _=new Float64Array(outliner_classPrivateFieldGet(Ta,this).length+24+outliner_classPrivateFieldGet(Ma,this).length);let f=t.length;for(let e=0;e<f;e+=2)if(isNaN(t[e]))_[e]=_[e+1]=NaN;else{_[e]=t[e];_[e+1]=t[e+1]}_.set([NaN,NaN,NaN,NaN,(s[0]-r)/o,(s[1]-n)/l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(a[0]-r)/o,(a[1]-n)/l],f);f+=24;for(let t=e.length-6;t>=6;t-=6)for(let i=0;i<6;i+=2)if(isNaN(e[t+i])){_[f]=_[f+1]=NaN;f+=2}else{_[f]=e[t+i];_[f+1]=e[t+i+1];f+=2}_.set([NaN,NaN,NaN,NaN,e[4],e[5]],f);return new FreeHighlightOutline(_,c,outliner_classPrivateFieldGet(Ea,this),outliner_classPrivateFieldGet(Na,this),outliner_classPrivateFieldGet(Ga,this),outliner_classPrivateFieldGet(Ia,this))}}function _getLastCoords(){const t=outliner_classPrivateFieldGet(Ra,this).subarray(4,6),e=outliner_classPrivateFieldGet(Ra,this).subarray(16,18),[i,s,a,r]=outliner_classPrivateFieldGet(Ea,this);return[(outliner_classPrivateFieldGet(Da,this)+(t[0]-e[0])/2-i)/a,(outliner_classPrivateFieldGet(La,this)+(t[1]-e[1])/2-s)/r,(outliner_classPrivateFieldGet(Da,this)+(e[0]-t[0])/2-i)/a,(outliner_classPrivateFieldGet(La,this)+(e[1]-t[1])/2-s)/r]}var Ua,za={_:8},Va={_:za._+2},qa=new WeakMap,$a=new WeakMap,Xa=new WeakMap,Ka=new WeakMap,Ya=new WeakMap,Qa=new WeakMap,Ja=new WeakMap,Za=new WeakSet;class FreeHighlightOutline extends Outline{constructor(t,e,i,s,a,r){super();outliner_classPrivateMethodInitSpec(this,Za);outliner_classPrivateFieldInitSpec(this,qa,void 0);outliner_classPrivateFieldInitSpec(this,$a,null);outliner_classPrivateFieldInitSpec(this,Xa,void 0);outliner_classPrivateFieldInitSpec(this,Ka,void 0);outliner_classPrivateFieldInitSpec(this,Ya,void 0);outliner_classPrivateFieldInitSpec(this,Qa,void 0);outliner_classPrivateFieldInitSpec(this,Ja,void 0);outliner_classPrivateFieldSet(Ja,this,t);outliner_classPrivateFieldSet(Ya,this,e);outliner_classPrivateFieldSet(qa,this,i);outliner_classPrivateFieldSet(Qa,this,s);outliner_classPrivateFieldSet(Xa,this,a);outliner_classPrivateFieldSet(Ka,this,r);outliner_assertClassBrand(Za,this,_computeMinMax).call(this,r);const{x:n,y:o,width:l,height:c}=outliner_classPrivateFieldGet($a,this);for(let e=0,i=t.length;e<i;e+=2){t[e]=(t[e]-n)/l;t[e+1]=(t[e+1]-o)/c}for(let t=0,i=e.length;t<i;t+=2){e[t]=(e[t]-n)/l;e[t+1]=(e[t+1]-o)/c}}toSVGPath(){const t=[`M${outliner_classPrivateFieldGet(Ja,this)[4]} ${outliner_classPrivateFieldGet(Ja,this)[5]}`];for(let e=6,i=outliner_classPrivateFieldGet(Ja,this).length;e<i;e+=6)isNaN(outliner_classPrivateFieldGet(Ja,this)[e])?t.push(`L${outliner_classPrivateFieldGet(Ja,this)[e+4]} ${outliner_classPrivateFieldGet(Ja,this)[e+5]}`):t.push(`C${outliner_classPrivateFieldGet(Ja,this)[e]} ${outliner_classPrivateFieldGet(Ja,this)[e+1]} ${outliner_classPrivateFieldGet(Ja,this)[e+2]} ${outliner_classPrivateFieldGet(Ja,this)[e+3]} ${outliner_classPrivateFieldGet(Ja,this)[e+4]} ${outliner_classPrivateFieldGet(Ja,this)[e+5]}`);t.push("Z");return t.join(" ")}serialize(t,e){let[i,s,a,r]=t;const n=a-i,o=r-s;let l,c;switch(e){case 0:l=outliner_assertClassBrand(Za,this,_rescale).call(this,outliner_classPrivateFieldGet(Ja,this),i,r,n,-o);c=outliner_assertClassBrand(Za,this,_rescale).call(this,outliner_classPrivateFieldGet(Ya,this),i,r,n,-o);break;case 90:l=outliner_assertClassBrand(Za,this,_rescaleAndSwap).call(this,outliner_classPrivateFieldGet(Ja,this),i,s,n,o);c=outliner_assertClassBrand(Za,this,_rescaleAndSwap).call(this,outliner_classPrivateFieldGet(Ya,this),i,s,n,o);break;case 180:l=outliner_assertClassBrand(Za,this,_rescale).call(this,outliner_classPrivateFieldGet(Ja,this),a,s,-n,o);c=outliner_assertClassBrand(Za,this,_rescale).call(this,outliner_classPrivateFieldGet(Ya,this),a,s,-n,o);break;case 270:l=outliner_assertClassBrand(Za,this,_rescaleAndSwap).call(this,outliner_classPrivateFieldGet(Ja,this),a,r,-n,-o);c=outliner_assertClassBrand(Za,this,_rescaleAndSwap).call(this,outliner_classPrivateFieldGet(Ya,this),a,r,-n,-o)}return{outline:Array.from(l),points:[Array.from(c)]}}get box(){return outliner_classPrivateFieldGet($a,this)}getNewOutline(t,e){const{x:i,y:s,width:a,height:r}=outliner_classPrivateFieldGet($a,this),[n,o,l,c]=outliner_classPrivateFieldGet(qa,this),h=a*l,d=r*c,u=i*l+n,p=s*c+o,_=new FreeOutliner({x:outliner_classPrivateFieldGet(Ya,this)[0]*h+u,y:outliner_classPrivateFieldGet(Ya,this)[1]*d+p},outliner_classPrivateFieldGet(qa,this),outliner_classPrivateFieldGet(Qa,this),t,outliner_classPrivateFieldGet(Ka,this),e??outliner_classPrivateFieldGet(Xa,this));for(let t=2;t<outliner_classPrivateFieldGet(Ya,this).length;t+=2)_.add({x:outliner_classPrivateFieldGet(Ya,this)[t]*h+u,y:outliner_classPrivateFieldGet(Ya,this)[t+1]*d+p});return _.getOutlines()}}function _rescale(t,e,i,s,a){const r=new Float64Array(t.length);for(let n=0,o=t.length;n<o;n+=2){r[n]=e+t[n]*s;r[n+1]=i+t[n+1]*a}return r}function _rescaleAndSwap(t,e,i,s,a){const r=new Float64Array(t.length);for(let n=0,o=t.length;n<o;n+=2){r[n]=e+t[n+1]*s;r[n+1]=i+t[n]*a}return r}function _computeMinMax(t){const e=outliner_classPrivateFieldGet(Ja,this);let i=e[4],s=e[5],a=i,r=s,n=i,o=s,l=i,c=s;const h=t?Math.max:Math.min;for(let t=6,d=e.length;t<d;t+=6){if(isNaN(e[t])){a=Math.min(a,e[t+4]);r=Math.min(r,e[t+5]);n=Math.max(n,e[t+4]);o=Math.max(o,e[t+5]);if(c<e[t+5]){l=e[t+4];c=e[t+5]}else c===e[t+5]&&(l=h(l,e[t+4]))}else{const d=Util.bezierBoundingBox(i,s,...e.slice(t,t+6));a=Math.min(a,d[0]);r=Math.min(r,d[1]);n=Math.max(n,d[2]);o=Math.max(o,d[3]);if(c<d[3]){l=d[2];c=d[3]}else c===d[3]&&(l=h(l,d[2]))}i=e[t+4];s=e[t+5]}const d=a-outliner_classPrivateFieldGet(Xa,this),u=r-outliner_classPrivateFieldGet(Xa,this),p=n-a+2*outliner_classPrivateFieldGet(Xa,this),_=o-r+2*outliner_classPrivateFieldGet(Xa,this);outliner_classPrivateFieldSet($a,this,{x:d,y:u,width:p,height:_,lastPoint:[l,c]})}function color_picker_classPrivateFieldInitSpec(t,e,i){color_picker_checkPrivateRedeclaration(t,e);e.set(t,i)}function color_picker_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function color_picker_classPrivateGetter(t,e,i){return i(color_picker_assertClassBrand(t,e))}function color_picker_classPrivateFieldGet(t,e){return t.get(color_picker_assertClassBrand(t,e))}function color_picker_classPrivateFieldSet(t,e,i){return t.set(color_picker_assertClassBrand(t,e),i),i}function color_picker_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var tr,er=new WeakMap,ir=new WeakMap,sr=new WeakMap,ar=new WeakMap,rr=new WeakMap,nr=new WeakMap,or=new WeakMap,lr=new WeakMap,cr=new WeakMap,hr=new WeakMap,dr=new WeakMap,ur=new WeakMap,pr=new WeakSet;class ColorPicker{static get _keyboardManager(){return shadow(this,"_keyboardManager",new KeyboardManager([[["Escape","mac+Escape"],ColorPicker.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ColorPicker.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ColorPicker.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ColorPicker.prototype._moveToPrevious],[["Home","mac+Home"],ColorPicker.prototype._moveToBeginning],[["End","mac+End"],ColorPicker.prototype._moveToEnd]]))}constructor(t){let{editor:e=null,uiManager:i=null}=t;!function color_picker_classPrivateMethodInitSpec(t,e){color_picker_checkPrivateRedeclaration(t,e);e.add(t)}(this,pr);color_picker_classPrivateFieldInitSpec(this,er,color_picker_assertClassBrand(pr,this,color_picker_keyDown).bind(this));color_picker_classPrivateFieldInitSpec(this,ir,color_picker_assertClassBrand(pr,this,color_picker_pointerDown).bind(this));color_picker_classPrivateFieldInitSpec(this,sr,null);color_picker_classPrivateFieldInitSpec(this,ar,null);color_picker_classPrivateFieldInitSpec(this,rr,void 0);color_picker_classPrivateFieldInitSpec(this,nr,null);color_picker_classPrivateFieldInitSpec(this,or,!1);color_picker_classPrivateFieldInitSpec(this,lr,!1);color_picker_classPrivateFieldInitSpec(this,cr,null);color_picker_classPrivateFieldInitSpec(this,hr,void 0);color_picker_classPrivateFieldInitSpec(this,dr,null);color_picker_classPrivateFieldInitSpec(this,ur,void 0);if(e){color_picker_classPrivateFieldSet(lr,this,!1);color_picker_classPrivateFieldSet(ur,this,_.HIGHLIGHT_COLOR);color_picker_classPrivateFieldSet(cr,this,e)}else{color_picker_classPrivateFieldSet(lr,this,!0);color_picker_classPrivateFieldSet(ur,this,_.HIGHLIGHT_DEFAULT_COLOR)}color_picker_classPrivateFieldSet(dr,this,e?._uiManager||i);color_picker_classPrivateFieldSet(hr,this,color_picker_classPrivateFieldGet(dr,this)._eventBus);color_picker_classPrivateFieldSet(rr,this,e?.color||color_picker_classPrivateFieldGet(dr,this)?.highlightColors.values().next().value||"#FFFF98")}renderButton(){const t=color_picker_classPrivateFieldSet(sr,this,document.createElement("button"));t.className="colorPicker";t.tabIndex="0";t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button");t.setAttribute("aria-haspopup",!0);t.addEventListener("click",color_picker_assertClassBrand(pr,this,_openDropdown).bind(this));t.addEventListener("keydown",color_picker_classPrivateFieldGet(er,this));const e=color_picker_classPrivateFieldSet(ar,this,document.createElement("span"));e.className="swatch";e.setAttribute("aria-hidden",!0);e.style.backgroundColor=color_picker_classPrivateFieldGet(rr,this);t.append(e);return t}renderMainDropdown(){const t=color_picker_classPrivateFieldSet(nr,this,color_picker_assertClassBrand(pr,this,_getDropdownRoot).call(this));t.setAttribute("aria-orientation","horizontal");t.setAttribute("aria-labelledby","highlightColorPickerLabel");return t}_colorSelectFromKeyboard(t){if(t.target===color_picker_classPrivateFieldGet(sr,this)){color_picker_assertClassBrand(pr,this,_openDropdown).call(this,t);return}const e=t.target.getAttribute("data-color");e&&color_picker_assertClassBrand(pr,this,_colorSelect).call(this,e,t)}_moveToNext(t){color_picker_classPrivateGetter(pr,this,_get_isDropdownVisible)?t.target!==color_picker_classPrivateFieldGet(sr,this)?t.target.nextSibling?.focus():color_picker_classPrivateFieldGet(nr,this).firstChild?.focus():color_picker_assertClassBrand(pr,this,_openDropdown).call(this,t)}_moveToPrevious(t){if(t.target!==color_picker_classPrivateFieldGet(nr,this)?.firstChild&&t.target!==color_picker_classPrivateFieldGet(sr,this)){color_picker_classPrivateGetter(pr,this,_get_isDropdownVisible)||color_picker_assertClassBrand(pr,this,_openDropdown).call(this,t);t.target.previousSibling?.focus()}else color_picker_classPrivateGetter(pr,this,_get_isDropdownVisible)&&this._hideDropdownFromKeyboard()}_moveToBeginning(t){color_picker_classPrivateGetter(pr,this,_get_isDropdownVisible)?color_picker_classPrivateFieldGet(nr,this).firstChild?.focus():color_picker_assertClassBrand(pr,this,_openDropdown).call(this,t)}_moveToEnd(t){color_picker_classPrivateGetter(pr,this,_get_isDropdownVisible)?color_picker_classPrivateFieldGet(nr,this).lastChild?.focus():color_picker_assertClassBrand(pr,this,_openDropdown).call(this,t)}hideDropdown(){color_picker_classPrivateFieldGet(nr,this)?.classList.add("hidden");window.removeEventListener("pointerdown",color_picker_classPrivateFieldGet(ir,this))}_hideDropdownFromKeyboard(){if(!color_picker_classPrivateFieldGet(lr,this))if(color_picker_classPrivateGetter(pr,this,_get_isDropdownVisible)){this.hideDropdown();color_picker_classPrivateFieldGet(sr,this).focus({preventScroll:!0,focusVisible:color_picker_classPrivateFieldGet(or,this)})}else color_picker_classPrivateFieldGet(cr,this)?.unselect()}updateColor(t){color_picker_classPrivateFieldGet(ar,this)&&(color_picker_classPrivateFieldGet(ar,this).style.backgroundColor=t);if(!color_picker_classPrivateFieldGet(nr,this))return;const e=color_picker_classPrivateFieldGet(dr,this).highlightColors.values();for(const i of color_picker_classPrivateFieldGet(nr,this).children)i.setAttribute("aria-selected",e.next().value===t)}destroy(){color_picker_classPrivateFieldGet(sr,this)?.remove();color_picker_classPrivateFieldSet(sr,this,null);color_picker_classPrivateFieldSet(ar,this,null);color_picker_classPrivateFieldGet(nr,this)?.remove();color_picker_classPrivateFieldSet(nr,this,null)}}Ua=ColorPicker;function _getDropdownRoot(){const t=document.createElement("div");t.addEventListener("contextmenu",noContextMenu);t.className="dropdown";t.role="listbox";t.setAttribute("aria-multiselectable",!1);t.setAttribute("aria-orientation","vertical");t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[e,i]of color_picker_classPrivateFieldGet(dr,this).highlightColors){const s=document.createElement("button");s.tabIndex="0";s.role="option";s.setAttribute("data-color",i);s.title=e;s.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${e}`);const a=document.createElement("span");s.append(a);a.className="swatch";a.style.backgroundColor=i;s.setAttribute("aria-selected",i===color_picker_classPrivateFieldGet(rr,this));s.addEventListener("click",color_picker_assertClassBrand(pr,this,_colorSelect).bind(this,i));t.append(s)}t.addEventListener("keydown",color_picker_classPrivateFieldGet(er,this));return t}function _colorSelect(t,e){e.stopPropagation();color_picker_classPrivateFieldGet(hr,this).dispatch("switchannotationeditorparams",{source:this,type:color_picker_classPrivateFieldGet(ur,this),value:t})}function color_picker_keyDown(t){Ua._keyboardManager.exec(this,t)}function _openDropdown(t){if(color_picker_classPrivateGetter(pr,this,_get_isDropdownVisible)){this.hideDropdown();return}color_picker_classPrivateFieldSet(or,this,0===t.detail);window.addEventListener("pointerdown",color_picker_classPrivateFieldGet(ir,this));if(color_picker_classPrivateFieldGet(nr,this)){color_picker_classPrivateFieldGet(nr,this).classList.remove("hidden");return}const e=color_picker_classPrivateFieldSet(nr,this,color_picker_assertClassBrand(pr,this,_getDropdownRoot).call(this));color_picker_classPrivateFieldGet(sr,this).append(e)}function color_picker_pointerDown(t){color_picker_classPrivateFieldGet(nr,this)?.contains(t.target)||this.hideDropdown()}function _get_isDropdownVisible(t){return color_picker_classPrivateFieldGet(nr,t)&&!color_picker_classPrivateFieldGet(nr,t).classList.contains("hidden")}function highlight_defineProperty(t,e,i){(e=function highlight_toPropertyKey(t){var e=function highlight_toPrimitive(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i;return t}function highlight_classPrivateFieldInitSpec(t,e,i){highlight_checkPrivateRedeclaration(t,e);e.set(t,i)}function highlight_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _toSetter(t,e,i){e||(e=[]);var s=e.length++;return Object.defineProperty({},"_",{set:function(a){e[s]=a,t.apply(i,e)}})}function highlight_classPrivateFieldGet(t,e){return t.get(highlight_assertClassBrand(t,e))}function highlight_classPrivateFieldSet(t,e,i){return t.set(highlight_assertClassBrand(t,e),i),i}function highlight_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var _r,fr=new WeakMap,gr=new WeakMap,vr=new WeakMap,mr=new WeakMap,Pr=new WeakMap,yr=new WeakMap,Fr=new WeakMap,br=new WeakMap,wr=new WeakMap,Ar=new WeakMap,Sr=new WeakMap,xr=new WeakMap,Cr=new WeakMap,kr=new WeakMap,Er=new WeakMap,Mr=new WeakMap,Gr=new WeakMap,Ir=new WeakMap,Tr=new WeakMap,Rr=new WeakSet;class HighlightEditor extends AnnotationEditor{static get _keyboardManager(){const t=HighlightEditor.prototype;return shadow(this,"_keyboardManager",new KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"});!function highlight_classPrivateMethodInitSpec(t,e){highlight_checkPrivateRedeclaration(t,e);e.add(t)}(this,Rr);highlight_classPrivateFieldInitSpec(this,fr,null);highlight_classPrivateFieldInitSpec(this,gr,0);highlight_classPrivateFieldInitSpec(this,vr,void 0);highlight_classPrivateFieldInitSpec(this,mr,null);highlight_classPrivateFieldInitSpec(this,Pr,null);highlight_classPrivateFieldInitSpec(this,yr,null);highlight_classPrivateFieldInitSpec(this,Fr,null);highlight_classPrivateFieldInitSpec(this,br,0);highlight_classPrivateFieldInitSpec(this,wr,null);highlight_classPrivateFieldInitSpec(this,Ar,null);highlight_classPrivateFieldInitSpec(this,Sr,null);highlight_classPrivateFieldInitSpec(this,xr,!1);highlight_classPrivateFieldInitSpec(this,Cr,highlight_assertClassBrand(Rr,this,_keydown).bind(this));highlight_classPrivateFieldInitSpec(this,kr,null);highlight_classPrivateFieldInitSpec(this,Er,void 0);highlight_classPrivateFieldInitSpec(this,Mr,null);highlight_classPrivateFieldInitSpec(this,Gr,"");highlight_classPrivateFieldInitSpec(this,Ir,void 0);highlight_classPrivateFieldInitSpec(this,Tr,"");this.color=t.color||HighlightEditor._defaultColor;highlight_classPrivateFieldSet(Ir,this,t.thickness||HighlightEditor._defaultThickness);highlight_classPrivateFieldSet(Er,this,t.opacity||HighlightEditor._defaultOpacity);highlight_classPrivateFieldSet(vr,this,t.boxes||null);highlight_classPrivateFieldSet(Tr,this,t.methodOfCreation||"");highlight_classPrivateFieldSet(Gr,this,t.text||"");this._isDraggable=!1;if(t.highlightId>-1){highlight_classPrivateFieldSet(xr,this,!0);highlight_assertClassBrand(Rr,this,_createFreeOutlines).call(this,t);highlight_assertClassBrand(Rr,this,_addToDrawLayer).call(this)}else{highlight_classPrivateFieldSet(fr,this,t.anchorNode);highlight_classPrivateFieldSet(gr,this,t.anchorOffset);highlight_classPrivateFieldSet(Fr,this,t.focusNode);highlight_classPrivateFieldSet(br,this,t.focusOffset);highlight_assertClassBrand(Rr,this,_createOutlines).call(this);highlight_assertClassBrand(Rr,this,_addToDrawLayer).call(this);this.rotate(this.rotation)}}get telemetryInitialData(){return{action:"added",type:highlight_classPrivateFieldGet(xr,this)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:highlight_classPrivateFieldGet(Ir,this),methodOfCreation:highlight_classPrivateFieldGet(Tr,this)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,e){AnnotationEditor.initialize(t,e);HighlightEditor._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case _.HIGHLIGHT_DEFAULT_COLOR:HighlightEditor._defaultColor=e;break;case _.HIGHLIGHT_THICKNESS:HighlightEditor._defaultThickness=e}}translateInPage(t,e){}get toolbarPosition(){return highlight_classPrivateFieldGet(kr,this)}updateParams(t,e){switch(t){case _.HIGHLIGHT_COLOR:highlight_assertClassBrand(Rr,this,highlight_updateColor).call(this,e);break;case _.HIGHLIGHT_THICKNESS:highlight_assertClassBrand(Rr,this,_updateThickness).call(this,e)}}static get defaultPropertiesToUpdate(){return[[_.HIGHLIGHT_DEFAULT_COLOR,HighlightEditor._defaultColor],[_.HIGHLIGHT_THICKNESS,HighlightEditor._defaultThickness]]}get propertiesToUpdate(){return[[_.HIGHLIGHT_COLOR,this.color||HighlightEditor._defaultColor],[_.HIGHLIGHT_THICKNESS,highlight_classPrivateFieldGet(Ir,this)||HighlightEditor._defaultThickness],[_.HIGHLIGHT_FREE,highlight_classPrivateFieldGet(xr,this)]]}async addEditToolbar(){const t=await super.addEditToolbar();if(!t)return null;if(this._uiManager.highlightColors){highlight_classPrivateFieldSet(Pr,this,new ColorPicker({editor:this}));t.addColorPicker(highlight_classPrivateFieldGet(Pr,this))}return t}disableEditing(){super.disableEditing();this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing();this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(highlight_assertClassBrand(Rr,this,_getRotation).call(this))}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,highlight_assertClassBrand(Rr,this,_getRotation).call(this))}onceAdded(){this.parent.addUndoableEditor(this);this.div.focus()}remove(){highlight_assertClassBrand(Rr,this,_cleanDrawLayer).call(this);this._reportTelemetry({action:"deleted"});super.remove()}rebuild(){if(this.parent){super.rebuild();if(null!==this.div){highlight_assertClassBrand(Rr,this,_addToDrawLayer).call(this);this.isAttachedToDOM||this.parent.add(this)}}}setParent(t){let e=!1;if(this.parent&&!t)highlight_assertClassBrand(Rr,this,_cleanDrawLayer).call(this);else if(t){highlight_assertClassBrand(Rr,this,_addToDrawLayer).call(this,t);e=!this.parent&&this.div?.classList.contains("selectedEditor")}super.setParent(t);this.show(this._isVisible);e&&this.select()}rotate(t){const{drawLayer:e}=this.parent;let i;if(highlight_classPrivateFieldGet(xr,this)){t=(t-this.rotation+360)%360;i=_rotateBbox.call(HighlightEditor,highlight_classPrivateFieldGet(Ar,this).box,t)}else i=_rotateBbox.call(HighlightEditor,this,t);e.rotate(highlight_classPrivateFieldGet(Sr,this),t);e.rotate(highlight_classPrivateFieldGet(Mr,this),t);e.updateBox(highlight_classPrivateFieldGet(Sr,this),i);e.updateBox(highlight_classPrivateFieldGet(Mr,this),_rotateBbox.call(HighlightEditor,highlight_classPrivateFieldGet(yr,this).box,t))}render(){if(this.div)return this.div;const t=super.render();if(highlight_classPrivateFieldGet(Gr,this)){const e=document.createElement("mark");t.append(e);e.append(document.createTextNode(highlight_classPrivateFieldGet(Gr,this)));e.className="visuallyHidden"}highlight_classPrivateFieldGet(xr,this)?t.classList.add("free"):this.div.addEventListener("keydown",highlight_classPrivateFieldGet(Cr,this));const e=highlight_classPrivateFieldSet(wr,this,document.createElement("div"));t.append(e);e.setAttribute("aria-hidden","true");e.className="internal";e.style.clipPath=highlight_classPrivateFieldGet(mr,this);const[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s);bindEvents(this,highlight_classPrivateFieldGet(wr,this),["pointerover","pointerleave"]);this.enableEditing();return t}pointerover(){this.parent.drawLayer.addClass(highlight_classPrivateFieldGet(Mr,this),"hovered")}pointerleave(){this.parent.drawLayer.removeClass(highlight_classPrivateFieldGet(Mr,this),"hovered")}_moveCaret(t){this.parent.unselect(this);switch(t){case 0:case 2:highlight_assertClassBrand(Rr,this,_setCaret).call(this,!0);break;case 1:case 3:highlight_assertClassBrand(Rr,this,_setCaret).call(this,!1)}}select(){super.select();if(highlight_classPrivateFieldGet(Mr,this)){this.parent?.drawLayer.removeClass(highlight_classPrivateFieldGet(Mr,this),"hovered");this.parent?.drawLayer.addClass(highlight_classPrivateFieldGet(Mr,this),"selected")}}unselect(){super.unselect();if(highlight_classPrivateFieldGet(Mr,this)){this.parent?.drawLayer.removeClass(highlight_classPrivateFieldGet(Mr,this),"selected");highlight_classPrivateFieldGet(xr,this)||highlight_assertClassBrand(Rr,this,_setCaret).call(this,!1)}}get _mustFixPosition(){return!highlight_classPrivateFieldGet(xr,this)}show(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;super.show(t);if(this.parent){this.parent.drawLayer.show(highlight_classPrivateFieldGet(Sr,this),t);this.parent.drawLayer.show(highlight_classPrivateFieldGet(Mr,this),t)}}static startHighlighting(t,e,i){let{target:s,x:a,y:r}=i;const{x:n,y:o,width:l,height:c}=s.getBoundingClientRect(),pointerMove=e=>{highlight_assertClassBrand(HighlightEditor,this,_highlightMove).call(this,t,e)},h={capture:!0,passive:!1},pointerDown=t=>{t.preventDefault();t.stopPropagation()},pointerUpCallback=e=>{s.removeEventListener("pointermove",pointerMove);window.removeEventListener("blur",pointerUpCallback);window.removeEventListener("pointerup",pointerUpCallback);window.removeEventListener("pointerdown",pointerDown,h);window.removeEventListener("contextmenu",noContextMenu);highlight_assertClassBrand(HighlightEditor,this,_endHighlight).call(this,t,e)};window.addEventListener("blur",pointerUpCallback);window.addEventListener("pointerup",pointerUpCallback);window.addEventListener("pointerdown",pointerDown,h);window.addEventListener("contextmenu",noContextMenu);s.addEventListener("pointermove",pointerMove);this._freeHighlight=new FreeOutliner({x:a,y:r},[n,o,l,c],t.scale,this._defaultThickness/2,e,.001);({id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0))}static deserialize(t,e,i){const s=super.deserialize(t,e,i),{rect:[a,r,n,o],color:l,quadPoints:c}=t;s.color=Util.makeHexColor(...l);highlight_classPrivateFieldSet(Er,s,t.opacity);const[h,d]=s.pageDimensions;s.width=(n-a)/h;s.height=(o-r)/d;const u=highlight_classPrivateFieldSet(vr,s,[]);for(let t=0;t<c.length;t+=8)u.push({x:(c[4]-n)/h,y:(o-(1-c[t+5]))/d,width:(c[t+2]-c[t])/h,height:(c[t+5]-c[t+1])/d});highlight_assertClassBrand(Rr,s,_createOutlines).call(s);return s}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty()||t)return null;const e=this.getRect(0,0),i=AnnotationEditor._colorManager.convert(this.color);return{annotationType:p.HIGHLIGHT,color:i,opacity:highlight_classPrivateFieldGet(Er,this),thickness:highlight_classPrivateFieldGet(Ir,this),quadPoints:highlight_assertClassBrand(Rr,this,_serializeBoxes).call(this),outlines:highlight_assertClassBrand(Rr,this,_serializeOutlines).call(this,e),pageIndex:this.pageIndex,rect:e,rotation:highlight_assertClassBrand(Rr,this,_getRotation).call(this),structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}}tr=HighlightEditor;function _createOutlines(){const t=new Outliner(highlight_classPrivateFieldGet(vr,this),.001);highlight_classPrivateFieldSet(Ar,this,t.getOutlines());({x:this.x,y:this.y,width:this.width,height:this.height}=highlight_classPrivateFieldGet(Ar,this).box);const e=new Outliner(highlight_classPrivateFieldGet(vr,this),.0025,.001,"ltr"===this._uiManager.direction);highlight_classPrivateFieldSet(yr,this,e.getOutlines());const{lastPoint:i}=highlight_classPrivateFieldGet(yr,this).box;highlight_classPrivateFieldSet(kr,this,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])}function _createFreeOutlines(t){let{highlightOutlines:e,highlightId:i,clipPathId:s}=t;highlight_classPrivateFieldSet(Ar,this,e);highlight_classPrivateFieldSet(yr,this,e.getNewOutline(highlight_classPrivateFieldGet(Ir,this)/2+1.5,.0025));if(i>=0){highlight_classPrivateFieldSet(Sr,this,i);highlight_classPrivateFieldSet(mr,this,s);this.parent.drawLayer.finalizeLine(i,e);highlight_classPrivateFieldSet(Mr,this,this.parent.drawLayer.highlightOutline(highlight_classPrivateFieldGet(yr,this)))}else if(this.parent){const t=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(highlight_classPrivateFieldGet(Sr,this),e);this.parent.drawLayer.updateBox(highlight_classPrivateFieldGet(Sr,this),_rotateBbox.call(tr,highlight_classPrivateFieldGet(Ar,this).box,(t-this.rotation+360)%360));this.parent.drawLayer.updateLine(highlight_classPrivateFieldGet(Mr,this),highlight_classPrivateFieldGet(yr,this));this.parent.drawLayer.updateBox(highlight_classPrivateFieldGet(Mr,this),_rotateBbox.call(tr,highlight_classPrivateFieldGet(yr,this).box,t))}const{x:a,y:r,width:n,height:o}=e.box;switch(this.rotation){case 0:this.x=a;this.y=r;this.width=n;this.height=o;break;case 90:{const[t,e]=this.parentDimensions;this.x=r;this.y=1-a;this.width=n*e/t;this.height=o*t/e;break}case 180:this.x=1-a;this.y=1-r;this.width=n;this.height=o;break;case 270:{const[t,e]=this.parentDimensions;this.x=1-r;this.y=a;this.width=n*e/t;this.height=o*t/e;break}}const{lastPoint:l}=highlight_classPrivateFieldGet(yr,this).box;highlight_classPrivateFieldSet(kr,this,[(l[0]-a)/n,(l[1]-r)/o])}function highlight_updateColor(t){const setColor=t=>{this.color=t;this.parent?.drawLayer.changeColor(highlight_classPrivateFieldGet(Sr,this),t);highlight_classPrivateFieldGet(Pr,this)?.updateColor(t)},e=this.color;this.addCommands({cmd:setColor.bind(this,t),undo:setColor.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0});this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0);this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"colorChanged",page:this.pageIndex+1,editorType:this.constructor.name,value:t,previousValue:e})}function _updateThickness(t){const e=highlight_classPrivateFieldGet(Ir,this),setThickness=t=>{highlight_classPrivateFieldSet(Ir,this,t);highlight_assertClassBrand(Rr,this,_changeThickness).call(this,t)};this.addCommands({cmd:setThickness.bind(this,t),undo:setThickness.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0});this._reportTelemetry({action:"thickness_changed",thickness:t},!0);this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"thicknessChanged",page:this.pageIndex+1,editorType:this.constructor.name,value:t,previousValue:e})}function _changeThickness(t){if(!highlight_classPrivateFieldGet(xr,this))return;highlight_assertClassBrand(Rr,this,_createFreeOutlines).call(this,{highlightOutlines:highlight_classPrivateFieldGet(Ar,this).getNewOutline(t/2)});this.fixAndSetPosition();const[e,i]=this.parentDimensions;this.setDims(this.width*e,this.height*i)}function _cleanDrawLayer(){if(null!==highlight_classPrivateFieldGet(Sr,this)&&this.parent){this.parent.drawLayer.remove(highlight_classPrivateFieldGet(Sr,this));highlight_classPrivateFieldSet(Sr,this,null);this.parent.drawLayer.remove(highlight_classPrivateFieldGet(Mr,this));highlight_classPrivateFieldSet(Mr,this,null)}}function _addToDrawLayer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;if(null===highlight_classPrivateFieldGet(Sr,this)){({id:_toSetter(highlight_classPrivateFieldSet,[Sr,this])._,clipPathId:_toSetter(highlight_classPrivateFieldSet,[mr,this])._}=t.drawLayer.highlight(highlight_classPrivateFieldGet(Ar,this),this.color,highlight_classPrivateFieldGet(Er,this)));highlight_classPrivateFieldSet(Mr,this,t.drawLayer.highlightOutline(highlight_classPrivateFieldGet(yr,this)));highlight_classPrivateFieldGet(wr,this)&&(highlight_classPrivateFieldGet(wr,this).style.clipPath=highlight_classPrivateFieldGet(mr,this))}}function _rotateBbox(t,e){let{x:i,y:s,width:a,height:r}=t;switch(e){case 90:return{x:1-s-r,y:i,width:r,height:a};case 180:return{x:1-i-a,y:1-s-r,width:a,height:r};case 270:return{x:s,y:1-i-a,width:r,height:a}}return{x:i,y:s,width:a,height:r}}function _keydown(t){tr._keyboardManager.exec(this,t)}function _setCaret(t){if(!highlight_classPrivateFieldGet(fr,this))return;const e=window.getSelection();t?e.setPosition(highlight_classPrivateFieldGet(fr,this),highlight_classPrivateFieldGet(gr,this)):e.setPosition(highlight_classPrivateFieldGet(Fr,this),highlight_classPrivateFieldGet(br,this))}function _getRotation(){return highlight_classPrivateFieldGet(xr,this)?this.rotation:0}function _serializeBoxes(){if(highlight_classPrivateFieldGet(xr,this))return null;const[t,e]=this.pageDimensions,i=highlight_classPrivateFieldGet(vr,this),s=new Array(8*i.length);let a=0;for(const{x:r,y:n,width:o,height:l}of i){const i=r*t,c=(1-n-l)*e;s[a]=s[a+4]=i;s[a+1]=s[a+3]=c;s[a+2]=s[a+6]=i+o*t;s[a+5]=s[a+7]=c+l*e;a+=8}return s}function _serializeOutlines(t){return highlight_classPrivateFieldGet(Ar,this).serialize(t,highlight_assertClassBrand(Rr,this,_getRotation).call(this))}function _highlightMove(t,e){this._freeHighlight.add(e)&&t.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}function _endHighlight(t,e){this._freeHighlight.isEmpty()?t.drawLayer.removeFreeHighlight(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"});this._freeHighlightId=-1;this._freeHighlight=null;this._freeHighlightClipId=""}highlight_defineProperty(HighlightEditor,"_defaultColor",null);highlight_defineProperty(HighlightEditor,"_defaultOpacity",1);highlight_defineProperty(HighlightEditor,"_defaultThickness",12);highlight_defineProperty(HighlightEditor,"_l10nPromise",void 0);highlight_defineProperty(HighlightEditor,"_type","highlight");highlight_defineProperty(HighlightEditor,"_editorType",p.HIGHLIGHT);highlight_defineProperty(HighlightEditor,"_freeHighlightId",-1);highlight_defineProperty(HighlightEditor,"_freeHighlight",null);highlight_defineProperty(HighlightEditor,"_freeHighlightClipId","");function ink_defineProperty(t,e,i){(e=function ink_toPropertyKey(t){var e=function ink_toPrimitive(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i;return t}function ink_classPrivateFieldInitSpec(t,e,i){ink_checkPrivateRedeclaration(t,e);e.set(t,i)}function ink_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ink_classPrivateFieldSet(t,e,i){return t.set(ink_assertClassBrand(t,e),i),i}function ink_classPrivateFieldGet(t,e){return t.get(ink_assertClassBrand(t,e))}function ink_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var Dr,Lr=new WeakMap,Br=new WeakMap,Or=new WeakMap,Nr=new WeakMap,Wr=new WeakMap,jr=new WeakMap,Hr=new WeakMap,Ur=new WeakMap,zr=new WeakMap,Vr=new WeakMap,qr=new WeakMap,$r=new WeakMap,Xr=new WeakMap,Kr=new WeakMap,Yr=new WeakMap,Qr=new WeakSet;class InkEditor extends AnnotationEditor{constructor(t){super({...t,name:"inkEditor"});!function ink_classPrivateMethodInitSpec(t,e){ink_checkPrivateRedeclaration(t,e);e.add(t)}(this,Qr);ink_classPrivateFieldInitSpec(this,Lr,0);ink_classPrivateFieldInitSpec(this,Br,0);ink_classPrivateFieldInitSpec(this,Or,this.canvasPointermove.bind(this));ink_classPrivateFieldInitSpec(this,Nr,this.canvasPointerleave.bind(this));ink_classPrivateFieldInitSpec(this,Wr,this.canvasPointerup.bind(this));ink_classPrivateFieldInitSpec(this,jr,this.canvasPointerdown.bind(this));ink_classPrivateFieldInitSpec(this,Hr,null);ink_classPrivateFieldInitSpec(this,Ur,new Path2D);ink_classPrivateFieldInitSpec(this,zr,!1);ink_classPrivateFieldInitSpec(this,Vr,!1);ink_classPrivateFieldInitSpec(this,qr,!1);ink_classPrivateFieldInitSpec(this,$r,null);ink_classPrivateFieldInitSpec(this,Xr,0);ink_classPrivateFieldInitSpec(this,Kr,0);ink_classPrivateFieldInitSpec(this,Yr,null);this.color=t.color||null;this.thickness=t.thickness||null;this.opacity=t.opacity||null;this.paths=[];this.bezierPath2D=[];this.allRawPaths=[];this.currentPath=[];this.scaleFactor=1;this.translationX=this.translationY=0;this.x=0;this.y=0;this._willKeepAspectRatio=!0}static initialize(t,e){AnnotationEditor.initialize(t,e)}static updateDefaultParams(t,e){switch(t){case _.INK_THICKNESS:InkEditor._defaultThickness=e;break;case _.INK_COLOR:InkEditor._defaultColor=e;break;case _.INK_OPACITY:InkEditor._defaultOpacity=e/100}}updateParams(t,e){switch(t){case _.INK_THICKNESS:ink_assertClassBrand(Qr,this,ink_updateThickness).call(this,e);break;case _.INK_COLOR:ink_assertClassBrand(Qr,this,ink_updateColor).call(this,e);break;case _.INK_OPACITY:ink_assertClassBrand(Qr,this,_updateOpacity).call(this,e)}}static get defaultPropertiesToUpdate(){return[[_.INK_THICKNESS,InkEditor._defaultThickness],[_.INK_COLOR,InkEditor._defaultColor||AnnotationEditor._defaultLineColor],[_.INK_OPACITY,Math.round(100*InkEditor._defaultOpacity)]]}get propertiesToUpdate(){return[[_.INK_THICKNESS,this.thickness||InkEditor._defaultThickness],[_.INK_COLOR,this.color||InkEditor._defaultColor||AnnotationEditor._defaultLineColor],[_.INK_OPACITY,Math.round(100*(this.opacity??InkEditor._defaultOpacity))]]}rebuild(){if(this.parent){super.rebuild();if(null!==this.div){if(!this.canvas){ink_assertClassBrand(Qr,this,_createCanvas).call(this);ink_assertClassBrand(Qr,this,_createObserver).call(this)}if(!this.isAttachedToDOM){this.parent.add(this);ink_assertClassBrand(Qr,this,_setCanvasDims).call(this)}ink_assertClassBrand(Qr,this,_fitToContent).call(this)}}}remove(){if(null!==this.canvas){this.isEmpty()||this.commit();this.canvas.width=this.canvas.height=0;this.canvas.remove();this.canvas=null;if(ink_classPrivateFieldGet(Hr,this)){clearTimeout(ink_classPrivateFieldGet(Hr,this));ink_classPrivateFieldSet(Hr,this,null)}ink_classPrivateFieldGet($r,this).disconnect();ink_classPrivateFieldSet($r,this,null);super.remove()}}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&null===t&&this._uiManager.addShouldRescale(this);super.setParent(t)}onScaleChanging(){const[t,e]=this.parentDimensions,i=this.width*t,s=this.height*e;this.setDimensions(i,s)}enableEditMode(){if(!ink_classPrivateFieldGet(zr,this)&&null!==this.canvas){super.enableEditMode();this._isDraggable=!1;this.canvas.addEventListener("pointerdown",ink_classPrivateFieldGet(jr,this))}}disableEditMode(){if(this.isInEditMode()&&null!==this.canvas){super.disableEditMode();this._isDraggable=!this.isEmpty();this.div.classList.remove("editing");this.canvas.removeEventListener("pointerdown",ink_classPrivateFieldGet(jr,this))}}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}commit(){if(!ink_classPrivateFieldGet(zr,this)){super.commit();this.isEditing=!1;this.disableEditMode();this.setInForeground();ink_classPrivateFieldSet(zr,this,!0);this.div.classList.add("disabled");ink_assertClassBrand(Qr,this,_fitToContent).call(this,!0);this.select();this.parent.addInkEditorIfNeeded(!0);this.moveInDOM();this.div.focus({preventScroll:!0})}}focusin(t){if(this._focusEventsAllowed){super.focusin(t);this.enableEditMode()}}canvasPointerdown(t){if(0===t.button&&this.isInEditMode()&&!ink_classPrivateFieldGet(zr,this)){this.setInForeground();t.preventDefault();this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0});ink_assertClassBrand(Qr,this,_startDrawing).call(this,t.offsetX,t.offsetY)}}canvasPointermove(t){t.preventDefault();ink_assertClassBrand(Qr,this,_draw).call(this,t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault();ink_assertClassBrand(Qr,this,_endDrawing).call(this,t)}canvasPointerleave(t){ink_assertClassBrand(Qr,this,_endDrawing).call(this,t)}get isResizable(){return!this.isEmpty()&&ink_classPrivateFieldGet(zr,this)}render(){if(this.div)return this.div;let t,e;if(this.width){t=this.x;e=this.y}super.render();this.div.setAttribute("data-l10n-id","pdfjs-ink");const[i,s,a,r]=ink_assertClassBrand(Qr,this,_getInitialBBox).call(this);this.setAt(i,s,0,0);this.setDims(a,r);ink_assertClassBrand(Qr,this,_createCanvas).call(this);if(this.width){const[i,s]=this.parentDimensions;this.setAspectRatio(this.width*i,this.height*s);this.setAt(t*i,e*s,this.width*i,this.height*s);ink_classPrivateFieldSet(qr,this,!0);ink_assertClassBrand(Qr,this,_setCanvasDims).call(this);this.setDims(this.width*i,this.height*s);ink_assertClassBrand(Qr,this,_redraw).call(this);this.div.classList.add("disabled")}else{this.div.classList.add("editing");this.enableEditMode()}ink_assertClassBrand(Qr,this,_createObserver).call(this);return this.div}setDimensions(t,e){const i=Math.round(t),s=Math.round(e);if(ink_classPrivateFieldGet(Xr,this)===i&&ink_classPrivateFieldGet(Kr,this)===s)return;ink_classPrivateFieldSet(Xr,this,i);ink_classPrivateFieldSet(Kr,this,s);this.canvas.style.visibility="hidden";const[a,r]=this.parentDimensions;this.width=t/a;this.height=e/r;this.fixAndSetPosition();ink_classPrivateFieldGet(zr,this)&&ink_assertClassBrand(Qr,this,_setScaleFactor).call(this,t,e);ink_assertClassBrand(Qr,this,_setCanvasDims).call(this);ink_assertClassBrand(Qr,this,_redraw).call(this);this.canvas.style.visibility="visible";this.fixDims()}static deserialize(t,e,i){if(t instanceof InkAnnotationElement)return null;const s=super.deserialize(t,e,i);s.thickness=t.thickness;s.color=Util.makeHexColor(...t.color);s.opacity=t.opacity;const[a,r]=s.pageDimensions,n=s.width*a,o=s.height*r,l=s.parentScale,c=t.thickness/2;ink_classPrivateFieldSet(zr,s,!0);ink_classPrivateFieldSet(Xr,s,Math.round(n));ink_classPrivateFieldSet(Kr,s,Math.round(o));const{paths:h,rect:d,rotation:u}=t;for(let{bezier:t}of h){t=_fromPDFCoordinates.call(InkEditor,t,d,u);const e=[];s.paths.push(e);let i=l*(t[0]-c),a=l*(t[1]-c);for(let s=2,r=t.length;s<r;s+=6){const r=l*(t[s]-c),n=l*(t[s+1]-c),o=l*(t[s+2]-c),h=l*(t[s+3]-c),d=l*(t[s+4]-c),u=l*(t[s+5]-c);e.push([[i,a],[r,n],[o,h],[d,u]]);i=d;a=u}const r=ink_assertClassBrand(InkEditor,this,_buildPath2D).call(this,e);s.bezierPath2D.push(r)}const p=ink_assertClassBrand(Qr,s,_getBbox).call(s);ink_classPrivateFieldSet(Br,s,Math.max(AnnotationEditor.MIN_SIZE,p[2]-p[0]));ink_classPrivateFieldSet(Lr,s,Math.max(AnnotationEditor.MIN_SIZE,p[3]-p[1]));ink_assertClassBrand(Qr,s,_setScaleFactor).call(s,n,o);return s}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),e=AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:p.INK,color:e,thickness:this.thickness,opacity:this.opacity,paths:ink_assertClassBrand(Qr,this,_serializePaths).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}_r=InkEditor;function ink_updateThickness(t){const setThickness=t=>{this.thickness=t;ink_assertClassBrand(Qr,this,_fitToContent).call(this)},e=this.thickness;this.addCommands({cmd:setThickness.bind(this,t),undo:setThickness.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0});this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"thicknessChanged",page:this.pageIndex+1,editorType:this.constructor.name,value:t,previousValue:e})}function ink_updateColor(t){const setColor=t=>{this.color=t;ink_assertClassBrand(Qr,this,_redraw).call(this)},e=this.color;this.addCommands({cmd:setColor.bind(this,t),undo:setColor.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0});this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"colorChanged",page:this.pageIndex+1,editorType:this.constructor.name,value:t,previousValue:e})}function _updateOpacity(t){const setOpacity=t=>{this.opacity=t;ink_assertClassBrand(Qr,this,_redraw).call(this)};t/=100;const e=this.opacity;this.addCommands({cmd:setOpacity.bind(this,t),undo:setOpacity.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0});this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"opacityChanged",page:this.pageIndex+1,editorType:this.constructor.name,value:t,previousValue:e})}function _getInitialBBox(){const{parentRotation:t,parentDimensions:[e,i]}=this;switch(t){case 90:return[0,i,i,e];case 180:return[e,i,e,i];case 270:return[e,0,i,e];default:return[0,0,e,i]}}function _setStroke(){const{ctx:t,color:e,opacity:i,thickness:s,parentScale:a,scaleFactor:r}=this;t.lineWidth=s*a/r;t.lineCap="round";t.lineJoin="round";t.miterLimit=10;t.strokeStyle=`${e}${function opacityToHex(t){return Math.round(Math.min(255,Math.max(1,255*t))).toString(16).padStart(2,"0")}(i)}`}function _startDrawing(t,e){this.canvas.addEventListener("contextmenu",noContextMenu);this.canvas.addEventListener("pointerleave",ink_classPrivateFieldGet(Nr,this));this.canvas.addEventListener("pointermove",ink_classPrivateFieldGet(Or,this));this.canvas.addEventListener("pointerup",ink_classPrivateFieldGet(Wr,this));this.canvas.removeEventListener("pointerdown",ink_classPrivateFieldGet(jr,this));this.isEditing=!0;if(!ink_classPrivateFieldGet(qr,this)){ink_classPrivateFieldSet(qr,this,!0);ink_assertClassBrand(Qr,this,_setCanvasDims).call(this);this.thickness||=_r._defaultThickness;this.color||=_r._defaultColor||AnnotationEditor._defaultLineColor;this.opacity??=_r._defaultOpacity}this.currentPath.push([t,e]);ink_classPrivateFieldSet(Vr,this,!1);ink_assertClassBrand(Qr,this,_setStroke).call(this);ink_classPrivateFieldSet(Yr,this,(()=>{ink_assertClassBrand(Qr,this,_drawPoints).call(this);ink_classPrivateFieldGet(Yr,this)&&window.requestAnimationFrame(ink_classPrivateFieldGet(Yr,this))}));window.requestAnimationFrame(ink_classPrivateFieldGet(Yr,this))}function _draw(t,e){const[i,s]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===i&&e===s)return;const a=this.currentPath;let r=ink_classPrivateFieldGet(Ur,this);a.push([t,e]);ink_classPrivateFieldSet(Vr,this,!0);if(a.length<=2){r.moveTo(...a[0]);r.lineTo(t,e)}else{if(3===a.length){ink_classPrivateFieldSet(Ur,this,r=new Path2D);r.moveTo(...a[0])}ink_assertClassBrand(Qr,this,_makeBezierCurve).call(this,r,...a.at(-3),...a.at(-2),t,e)}}function _endPath(){if(0===this.currentPath.length)return;const t=this.currentPath.at(-1);ink_classPrivateFieldGet(Ur,this).lineTo(...t)}function _stopDrawing(t,e){ink_classPrivateFieldSet(Yr,this,null);t=Math.min(Math.max(t,0),this.canvas.width);e=Math.min(Math.max(e,0),this.canvas.height);ink_assertClassBrand(Qr,this,_draw).call(this,t,e);ink_assertClassBrand(Qr,this,_endPath).call(this);let i;if(1!==this.currentPath.length)i=ink_assertClassBrand(Qr,this,_generateBezierPoints).call(this);else{const s=[t,e];i=[[s,s.slice(),s.slice(),s]]}const s=ink_classPrivateFieldGet(Ur,this),a=this.currentPath;this.currentPath=[];ink_classPrivateFieldSet(Ur,this,new Path2D);this.addCommands({cmd:()=>{this.allRawPaths.push(a);this.paths.push(i);this.bezierPath2D.push(s);this._uiManager.rebuild(this)},undo:()=>{this.allRawPaths.pop();this.paths.pop();this.bezierPath2D.pop();if(0===this.paths.length)this.remove();else{if(!this.canvas){ink_assertClassBrand(Qr,this,_createCanvas).call(this);ink_assertClassBrand(Qr,this,_createObserver).call(this)}ink_assertClassBrand(Qr,this,_fitToContent).call(this)}},mustExec:!0});this.eventBus?.dispatch("annotation-editor-event",{source:this,type:"bezierPathChanged",page:this.pageIndex+1,editorType:this.constructor.name,value:i,previousValue:a})}function _drawPoints(){if(!ink_classPrivateFieldGet(Vr,this))return;ink_classPrivateFieldSet(Vr,this,!1);const t=Math.ceil(this.thickness*this.parentScale),e=this.currentPath.slice(-3),i=e.map((t=>t[0])),s=e.map((t=>t[1])),{ctx:a}=(Math.min(...i),Math.max(...i),Math.min(...s),Math.max(...s),this);a.save();a.clearRect(0,0,this.canvas.width,this.canvas.height);for(const t of this.bezierPath2D)a.stroke(t);a.stroke(ink_classPrivateFieldGet(Ur,this));a.restore()}function _makeBezierCurve(t,e,i,s,a,r,n){const o=(e+s)/2,l=(i+a)/2,c=(s+r)/2,h=(a+n)/2;t.bezierCurveTo(o+2*(s-o)/3,l+2*(a-l)/3,c+2*(s-c)/3,h+2*(a-h)/3,c,h)}function _generateBezierPoints(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const e=[];let i,[s,a]=t[0];for(i=1;i<t.length-2;i++){const[r,n]=t[i],[o,l]=t[i+1],c=(r+o)/2,h=(n+l)/2,d=[s+2*(r-s)/3,a+2*(n-a)/3],u=[c+2*(r-c)/3,h+2*(n-h)/3];e.push([[s,a],d,u,[c,h]]);[s,a]=[c,h]}const[r,n]=t[i],[o,l]=t[i+1],c=[s+2*(r-s)/3,a+2*(n-a)/3],h=[o+2*(r-o)/3,l+2*(n-l)/3];e.push([[s,a],c,h,[o,l]]);return e}function _redraw(){if(this.isEmpty()){ink_assertClassBrand(Qr,this,_updateTransform).call(this);return}ink_assertClassBrand(Qr,this,_setStroke).call(this);const{canvas:t,ctx:e}=this;e.setTransform(1,0,0,1,0,0);e.clearRect(0,0,t.width,t.height);ink_assertClassBrand(Qr,this,_updateTransform).call(this);for(const t of this.bezierPath2D)e.stroke(t)}function _endDrawing(t){this.canvas.removeEventListener("pointerleave",ink_classPrivateFieldGet(Nr,this));this.canvas.removeEventListener("pointermove",ink_classPrivateFieldGet(Or,this));this.canvas.removeEventListener("pointerup",ink_classPrivateFieldGet(Wr,this));this.canvas.addEventListener("pointerdown",ink_classPrivateFieldGet(jr,this));ink_classPrivateFieldGet(Hr,this)&&clearTimeout(ink_classPrivateFieldGet(Hr,this));ink_classPrivateFieldSet(Hr,this,setTimeout((()=>{ink_classPrivateFieldSet(Hr,this,null);this.canvas.removeEventListener("contextmenu",noContextMenu)}),10));ink_assertClassBrand(Qr,this,_stopDrawing).call(this,t.offsetX,t.offsetY);this.addToAnnotationStorage();this.setInBackground()}function _createCanvas(){this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=0;this.canvas.className="inkEditorCanvas";this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas");this.div.append(this.canvas);const t=window.pdfDefaultOptions.activateWillReadFrequentlyFlag?{willReadFrequently:!0}:void 0;this.ctx=this.canvas.getContext("2d",t)}function _createObserver(){ink_classPrivateFieldSet($r,this,new ResizeObserver((t=>{const e=t[0].contentRect;e.width&&e.height&&this.setDimensions(e.width,e.height)})));ink_classPrivateFieldGet($r,this).observe(this.div)}function _setCanvasDims(){if(!ink_classPrivateFieldGet(qr,this))return;const[t,e]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t);this.canvas.height=Math.ceil(this.height*e);ink_assertClassBrand(Qr,this,_updateTransform).call(this)}function _setScaleFactor(t,e){const i=ink_assertClassBrand(Qr,this,_getPadding).call(this),s=(t-i)/ink_classPrivateFieldGet(Br,this),a=(e-i)/ink_classPrivateFieldGet(Lr,this);this.scaleFactor=Math.min(s,a)}function _updateTransform(){const t=ink_assertClassBrand(Qr,this,_getPadding).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}function _buildPath2D(t){const e=new Path2D;for(let i=0,s=t.length;i<s;i++){const[s,a,r,n]=t[i];0===i&&e.moveTo(...s);e.bezierCurveTo(a[0],a[1],r[0],r[1],n[0],n[1])}return e}function _toPDFCoordinates(t,e,i){const[s,a,r,n]=e;switch(i){case 0:for(let e=0,i=t.length;e<i;e+=2){t[e]+=s;t[e+1]=n-t[e+1]}break;case 90:for(let e=0,i=t.length;e<i;e+=2){const i=t[e];t[e]=t[e+1]+s;t[e+1]=i+a}break;case 180:for(let e=0,i=t.length;e<i;e+=2){t[e]=r-t[e];t[e+1]+=a}break;case 270:for(let e=0,i=t.length;e<i;e+=2){const i=t[e];t[e]=r-t[e+1];t[e+1]=n-i}break;default:throw new Error("Invalid rotation")}return t}function _fromPDFCoordinates(t,e,i){const[s,a,r,n]=e;switch(i){case 0:for(let e=0,i=t.length;e<i;e+=2){t[e]-=s;t[e+1]=n-t[e+1]}break;case 90:for(let e=0,i=t.length;e<i;e+=2){const i=t[e];t[e]=t[e+1]-a;t[e+1]=i-s}break;case 180:for(let e=0,i=t.length;e<i;e+=2){t[e]=r-t[e];t[e+1]-=a}break;case 270:for(let e=0,i=t.length;e<i;e+=2){const i=t[e];t[e]=n-t[e+1];t[e+1]=r-i}break;default:throw new Error("Invalid rotation")}return t}function _serializePaths(t,e,i,s){const a=[],r=this.thickness/2,n=t*e+r,o=t*i+r;for(const e of this.paths){const i=[],r=[];for(let s=0,a=e.length;s<a;s++){const[l,c,h,d]=e[s];if(l[0]===d[0]&&l[1]===d[1]&&1===a){const e=t*l[0]+n,s=t*l[1]+o;i.push(e,s);r.push(e,s);break}const u=t*l[0]+n,p=t*l[1]+o,_=t*c[0]+n,f=t*c[1]+o,g=t*h[0]+n,v=t*h[1]+o,m=t*d[0]+n,P=t*d[1]+o;if(0===s){i.push(u,p);r.push(u,p)}i.push(_,f,g,v,m,P);r.push(_,f);s===a-1&&r.push(m,P)}a.push({bezier:_toPDFCoordinates.call(_r,i,s,this.rotation),points:_toPDFCoordinates.call(_r,r,s,this.rotation)})}return a}function _getBbox(){let t=1/0,e=-1/0,i=1/0,s=-1/0;for(const a of this.paths)for(const[r,n,o,l]of a){const a=Util.bezierBoundingBox(...r,...n,...o,...l);t=Math.min(t,a[0]);i=Math.min(i,a[1]);e=Math.max(e,a[2]);s=Math.max(s,a[3])}return[t,i,e,s]}function _getPadding(){return ink_classPrivateFieldGet(zr,this)?Math.ceil(this.thickness*this.parentScale):0}function _fitToContent(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return;if(!ink_classPrivateFieldGet(zr,this)){ink_assertClassBrand(Qr,this,_redraw).call(this);return}const e=ink_assertClassBrand(Qr,this,_getBbox).call(this),i=ink_assertClassBrand(Qr,this,_getPadding).call(this);ink_classPrivateFieldSet(Br,this,Math.max(AnnotationEditor.MIN_SIZE,e[2]-e[0]));ink_classPrivateFieldSet(Lr,this,Math.max(AnnotationEditor.MIN_SIZE,e[3]-e[1]));const s=Math.ceil(i+ink_classPrivateFieldGet(Br,this)*this.scaleFactor),a=Math.ceil(i+ink_classPrivateFieldGet(Lr,this)*this.scaleFactor),[r,n]=this.parentDimensions;this.width=s/r;this.height=a/n;this.setAspectRatio(s,a);const o=this.translationX,l=this.translationY;this.translationX=-e[0];this.translationY=-e[1];ink_assertClassBrand(Qr,this,_setCanvasDims).call(this);ink_assertClassBrand(Qr,this,_redraw).call(this);ink_classPrivateFieldSet(Xr,this,s);ink_classPrivateFieldSet(Kr,this,a);this.setDims(s,a);const c=t?i/this.scaleFactor/2:0;this.translate(o-this.translationX-c,l-this.translationY-c)}ink_defineProperty(InkEditor,"_defaultColor",null);ink_defineProperty(InkEditor,"_defaultOpacity",1);ink_defineProperty(InkEditor,"_defaultThickness",1);ink_defineProperty(InkEditor,"_type","ink");ink_defineProperty(InkEditor,"_editorType",p.INK);function stamp_defineProperty(t,e,i){(e=function stamp_toPropertyKey(t){var e=function stamp_toPrimitive(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i;return t}function stamp_classPrivateFieldInitSpec(t,e,i){stamp_checkPrivateRedeclaration(t,e);e.set(t,i)}function stamp_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function stamp_classPrivateFieldGet(t,e){return t.get(stamp_assertClassBrand(t,e))}function stamp_classPrivateFieldSet(t,e,i){return t.set(stamp_assertClassBrand(t,e),i),i}function stamp_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var Jr=new WeakMap,Zr=new WeakMap,tn=new WeakMap,en=new WeakMap,sn=new WeakMap,an=new WeakMap,rn=new WeakMap,nn=new WeakMap,on=new WeakMap,ln=new WeakMap,cn=new WeakMap,hn=new WeakSet;class StampEditor extends AnnotationEditor{constructor(t){super({...t,name:"stampEditor"});!function stamp_classPrivateMethodInitSpec(t,e){stamp_checkPrivateRedeclaration(t,e);e.add(t)}(this,hn);stamp_classPrivateFieldInitSpec(this,Jr,null);stamp_classPrivateFieldInitSpec(this,Zr,null);stamp_classPrivateFieldInitSpec(this,tn,null);stamp_classPrivateFieldInitSpec(this,en,null);stamp_classPrivateFieldInitSpec(this,sn,null);stamp_classPrivateFieldInitSpec(this,an,"");stamp_classPrivateFieldInitSpec(this,rn,null);stamp_classPrivateFieldInitSpec(this,nn,null);stamp_classPrivateFieldInitSpec(this,on,null);stamp_classPrivateFieldInitSpec(this,ln,!1);stamp_classPrivateFieldInitSpec(this,cn,!1);stamp_classPrivateFieldSet(en,this,t.bitmapUrl);stamp_classPrivateFieldSet(sn,this,t.bitmapFile)}static initialize(t,e){AnnotationEditor.initialize(t,e)}static get supportedTypes(){return shadow(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map((t=>`image/${t}`)))}static get supportedTypesStr(){return shadow(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,e){e.pasteEditor(p.STAMP,{bitmapFile:t.getAsFile()})}remove(){if(stamp_classPrivateFieldGet(Zr,this)){stamp_classPrivateFieldSet(Jr,this,null);this._uiManager.imageManager.deleteId(stamp_classPrivateFieldGet(Zr,this));stamp_classPrivateFieldGet(rn,this)?.remove();stamp_classPrivateFieldSet(rn,this,null);stamp_classPrivateFieldGet(nn,this)?.disconnect();stamp_classPrivateFieldSet(nn,this,null);if(stamp_classPrivateFieldGet(on,this)){clearTimeout(stamp_classPrivateFieldGet(on,this));stamp_classPrivateFieldSet(on,this,null)}}super.remove()}rebuild(){if(this.parent){super.rebuild();if(null!==this.div){stamp_classPrivateFieldGet(Zr,this)&&null===stamp_classPrivateFieldGet(rn,this)&&stamp_assertClassBrand(hn,this,_getBitmap).call(this);this.isAttachedToDOM||this.parent.add(this)}}else stamp_classPrivateFieldGet(Zr,this)&&stamp_assertClassBrand(hn,this,_getBitmap).call(this)}onceAdded(){this._isDraggable=!0;this.div.focus()}isEmpty(){return!(stamp_classPrivateFieldGet(tn,this)||stamp_classPrivateFieldGet(Jr,this)||stamp_classPrivateFieldGet(en,this)||stamp_classPrivateFieldGet(sn,this)||stamp_classPrivateFieldGet(Zr,this))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;if(this.width){t=this.x;e=this.y}super.render();this.div.hidden=!0;this.addAltTextButton();stamp_classPrivateFieldGet(Jr,this)?stamp_assertClassBrand(hn,this,stamp_createCanvas).call(this):stamp_assertClassBrand(hn,this,_getBitmap).call(this);if(this.width){const[i,s]=this.parentDimensions;this.setAt(t*i,e*s,this.width*i,this.height*s)}return this.div}getImageForAltText(){return stamp_classPrivateFieldGet(rn,this)}static deserialize(t,e,i){if(t instanceof StampAnnotationElement)return null;const s=super.deserialize(t,e,i),{rect:a,bitmapUrl:r,bitmapId:n,isSvg:o,accessibilityData:l}=t;n&&i.imageManager.isValidId(n)?stamp_classPrivateFieldSet(Zr,s,n):stamp_classPrivateFieldSet(en,s,r);stamp_classPrivateFieldSet(ln,s,o);const[c,h]=s.pageDimensions;s.width=(a[2]-a[0])/c;s.height=(a[3]-a[1])/h;l&&(s.altTextData=l);return s}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isEmpty())return null;const i={annotationType:p.STAMP,bitmapId:stamp_classPrivateFieldGet(Zr,this),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:stamp_classPrivateFieldGet(ln,this),structTreeParentId:this._structTreeParentId};if(t){i.bitmapUrl=stamp_assertClassBrand(hn,this,_serializeBitmap).call(this,!0);i.accessibilityData=this.altTextData;return i}const{decorative:s,altText:a}=this.altTextData;!s&&a&&(i.accessibilityData={type:"Figure",alt:a});if(null===e)return i;e.stamps||=new Map;const r=stamp_classPrivateFieldGet(ln,this)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(e.stamps.has(stamp_classPrivateFieldGet(Zr,this))){if(stamp_classPrivateFieldGet(ln,this)){const t=e.stamps.get(stamp_classPrivateFieldGet(Zr,this));if(r>t.area){t.area=r;t.serialized.bitmap.close();t.serialized.bitmap=stamp_assertClassBrand(hn,this,_serializeBitmap).call(this,!1)}}}else{e.stamps.set(stamp_classPrivateFieldGet(Zr,this),{area:r,serialized:i});i.bitmap=stamp_assertClassBrand(hn,this,_serializeBitmap).call(this,!1)}return i}}Dr=StampEditor;function _getBitmapFetched(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){stamp_classPrivateFieldSet(Jr,this,t.bitmap);if(!e){stamp_classPrivateFieldSet(Zr,this,t.id);stamp_classPrivateFieldSet(ln,this,t.isSvg)}t.file&&stamp_classPrivateFieldSet(an,this,t.file.name);stamp_assertClassBrand(hn,this,stamp_createCanvas).call(this)}else this.remove()}function _getBitmapDone(){stamp_classPrivateFieldSet(tn,this,null);this._uiManager.enableWaiting(!1);stamp_classPrivateFieldGet(rn,this)&&this.div.focus()}function _getBitmap(){if(stamp_classPrivateFieldGet(Zr,this)){this._uiManager.enableWaiting(!0);this._uiManager.imageManager.getFromId(stamp_classPrivateFieldGet(Zr,this)).then((t=>stamp_assertClassBrand(hn,this,_getBitmapFetched).call(this,t,!0))).finally((()=>stamp_assertClassBrand(hn,this,_getBitmapDone).call(this)));return}if(stamp_classPrivateFieldGet(en,this)){const t=stamp_classPrivateFieldGet(en,this);stamp_classPrivateFieldSet(en,this,null);this._uiManager.enableWaiting(!0);stamp_classPrivateFieldSet(tn,this,this._uiManager.imageManager.getFromUrl(t).then((t=>stamp_assertClassBrand(hn,this,_getBitmapFetched).call(this,t))).finally((()=>stamp_assertClassBrand(hn,this,_getBitmapDone).call(this))));return}if(stamp_classPrivateFieldGet(sn,this)){const t=stamp_classPrivateFieldGet(sn,this);stamp_classPrivateFieldSet(sn,this,null);this._uiManager.enableWaiting(!0);stamp_classPrivateFieldSet(tn,this,this._uiManager.imageManager.getFromFile(t).then((t=>stamp_assertClassBrand(hn,this,_getBitmapFetched).call(this,t))).finally((()=>stamp_assertClassBrand(hn,this,_getBitmapDone).call(this))));return}const t=document.createElement("input");t.type="file";t.accept=Dr.supportedTypesStr;stamp_classPrivateFieldSet(tn,this,new Promise((e=>{t.addEventListener("change",(async()=>{if(t.files&&0!==t.files.length){this._uiManager.enableWaiting(!0);const e=await this._uiManager.imageManager.getFromFile(t.files[0]);stamp_assertClassBrand(hn,this,_getBitmapFetched).call(this,e)}else this.remove();e()}));t.addEventListener("cancel",(()=>{this.remove();e()}))})).finally((()=>stamp_assertClassBrand(hn,this,_getBitmapDone).call(this))));t.click()}function stamp_createCanvas(){const{div:t}=this;let{width:e,height:i}=stamp_classPrivateFieldGet(Jr,this);const[s,a]=this.pageDimensions,r=.75;if(this.width){e=this.width*s;i=this.height*a}else if(e>r*s||i>r*a){const t=Math.min(r*s/e,r*a/i);e*=t;i*=t}const[n,o]=this.parentDimensions;this.setDims(e*n/s,i*o/a);this._uiManager.enableWaiting(!1);const l=stamp_classPrivateFieldSet(rn,this,document.createElement("canvas"));t.append(l);t.hidden=!1;stamp_assertClassBrand(hn,this,_drawBitmap).call(this,e,i);stamp_assertClassBrand(hn,this,stamp_createObserver).call(this);if(!stamp_classPrivateFieldGet(cn,this)){this.parent.addUndoableEditor(this);stamp_classPrivateFieldSet(cn,this,!0)}this._reportTelemetry({action:"inserted_image"});stamp_classPrivateFieldGet(an,this)&&l.setAttribute("aria-label",stamp_classPrivateFieldGet(an,this))}function _setDimensions(t,e){const[i,s]=this.parentDimensions;this.width=t/i;this.height=e/s;this.setDims(t,e);this._initialOptions?.isCentered?this.center():this.fixAndSetPosition();this._initialOptions=null;null!==stamp_classPrivateFieldGet(on,this)&&clearTimeout(stamp_classPrivateFieldGet(on,this));stamp_classPrivateFieldSet(on,this,setTimeout((()=>{stamp_classPrivateFieldSet(on,this,null);stamp_assertClassBrand(hn,this,_drawBitmap).call(this,t,e)}),200))}function _scaleBitmap(t,e){const{width:i,height:s}=stamp_classPrivateFieldGet(Jr,this);let a=i,r=s,n=stamp_classPrivateFieldGet(Jr,this);for(;a>2*t||r>2*e;){const i=a,s=r;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const o=new OffscreenCanvas(a,r);o.getContext("2d").drawImage(n,0,0,i,s,0,0,a,r);n=o.transferToImageBitmap()}return n}function _drawBitmap(t,e){t=Math.ceil(t);e=Math.ceil(e);const i=stamp_classPrivateFieldGet(rn,this);if(!i||i.width===t&&i.height===e)return;i.width=t;i.height=e;const s=stamp_classPrivateFieldGet(ln,this)?stamp_classPrivateFieldGet(Jr,this):stamp_assertClassBrand(hn,this,_scaleBitmap).call(this,t,e);if(this._uiManager.hasMLManager&&!this.hasAltText()){const i=new OffscreenCanvas(t,e);i.getContext("2d").drawImage(s,0,0,s.width,s.height,0,0,t,e);i.convertToBlob().then((t=>{const e=new FileReader;e.onload=()=>{const t=e.result;this._uiManager.mlGuess({service:"image-to-text",request:{imageData:t}}).then((t=>{const e=t?.output||"";this.parent&&e&&!this.hasAltText()&&(this.altTextData={altText:e,decorative:!1})}))};e.readAsDataURL(t)}))}const a=i.getContext("2d");a.filter=this._uiManager.hcmFilter;a.drawImage(s,0,0,s.width,s.height,0,0,t,e)}function _serializeBitmap(t){if(t){if(stamp_classPrivateFieldGet(ln,this)){const t=this._uiManager.imageManager.getSvgUrl(stamp_classPrivateFieldGet(Zr,this));if(t)return t}const t=document.createElement("canvas");({width:t.width,height:t.height}=stamp_classPrivateFieldGet(Jr,this));t.getContext("2d").drawImage(stamp_classPrivateFieldGet(Jr,this),0,0);return t.toDataURL()}if(stamp_classPrivateFieldGet(ln,this)){const[t,e]=this.pageDimensions,i=Math.round(this.width*t*PixelsPerInch.PDF_TO_CSS_UNITS),s=Math.round(this.height*e*PixelsPerInch.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(i,s);a.getContext("2d").drawImage(stamp_classPrivateFieldGet(Jr,this),0,0,stamp_classPrivateFieldGet(Jr,this).width,stamp_classPrivateFieldGet(Jr,this).height,0,0,i,s);return a.transferToImageBitmap()}return structuredClone(stamp_classPrivateFieldGet(Jr,this))}function stamp_createObserver(){stamp_classPrivateFieldSet(nn,this,new ResizeObserver((t=>{const e=t[0].contentRect;e.width&&e.height&&stamp_assertClassBrand(hn,this,_setDimensions).call(this,e.width,e.height)})));stamp_classPrivateFieldGet(nn,this).observe(this.div)}stamp_defineProperty(StampEditor,"_type","stamp");stamp_defineProperty(StampEditor,"_editorType",p.STAMP);function annotation_editor_layer_classPrivateFieldInitSpec(t,e,i){annotation_editor_layer_checkPrivateRedeclaration(t,e);e.set(t,i)}function annotation_editor_layer_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function annotation_editor_layer_classPrivateGetter(t,e,i){return i(annotation_editor_layer_assertClassBrand(t,e))}function annotation_editor_layer_classPrivateFieldGet(t,e){return t.get(annotation_editor_layer_assertClassBrand(t,e))}function annotation_editor_layer_classPrivateFieldSet(t,e,i){return t.set(annotation_editor_layer_assertClassBrand(t,e),i),i}function annotation_editor_layer_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var dn=new WeakMap,un=new WeakMap,pn=new WeakMap,_n=new WeakMap,fn=new WeakMap,gn=new WeakMap,vn=new WeakMap,mn=new WeakMap,Pn=new WeakMap,yn=new WeakMap,Fn=new WeakMap,bn=new WeakMap,wn=new WeakMap,An=new WeakSet;class AnnotationEditorLayer{constructor(t){let{uiManager:e,pageIndex:i,div:s,accessibilityManager:a,annotationLayer:r,drawLayer:n,textLayer:o,viewport:l,l10n:c,eventBus:h}=t;!function annotation_editor_layer_classPrivateMethodInitSpec(t,e){annotation_editor_layer_checkPrivateRedeclaration(t,e);e.add(t)}(this,An);annotation_editor_layer_classPrivateFieldInitSpec(this,dn,void 0);annotation_editor_layer_classPrivateFieldInitSpec(this,un,!1);annotation_editor_layer_classPrivateFieldInitSpec(this,pn,null);annotation_editor_layer_classPrivateFieldInitSpec(this,_n,null);annotation_editor_layer_classPrivateFieldInitSpec(this,fn,null);annotation_editor_layer_classPrivateFieldInitSpec(this,gn,null);annotation_editor_layer_classPrivateFieldInitSpec(this,vn,null);annotation_editor_layer_classPrivateFieldInitSpec(this,mn,new Map);annotation_editor_layer_classPrivateFieldInitSpec(this,Pn,!1);annotation_editor_layer_classPrivateFieldInitSpec(this,yn,!1);annotation_editor_layer_classPrivateFieldInitSpec(this,Fn,!1);annotation_editor_layer_classPrivateFieldInitSpec(this,bn,null);annotation_editor_layer_classPrivateFieldInitSpec(this,wn,void 0);const d=[...xn._.values()];if(!AnnotationEditorLayer._initialized){AnnotationEditorLayer._initialized=!0;for(const t of d)t.initialize(c,e)}e.registerEditorTypes(d);annotation_editor_layer_classPrivateFieldSet(wn,this,e);this.pageIndex=i;this.div=s;annotation_editor_layer_classPrivateFieldSet(dn,this,a);annotation_editor_layer_classPrivateFieldSet(pn,this,r);this.viewport=l;annotation_editor_layer_classPrivateFieldSet(bn,this,o);this.drawLayer=n;annotation_editor_layer_classPrivateFieldGet(wn,this).addLayer(this);this.eventBus=h}get isEmpty(){return 0===annotation_editor_layer_classPrivateFieldGet(mn,this).size}get isInvisible(){return this.isEmpty&&annotation_editor_layer_classPrivateFieldGet(wn,this).getMode()===p.NONE}updateToolbar(t){annotation_editor_layer_classPrivateFieldGet(wn,this).updateToolbar(t)}updateMode(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:annotation_editor_layer_classPrivateFieldGet(wn,this).getMode();annotation_editor_layer_assertClassBrand(An,this,_cleanup).call(this);switch(t){case p.NONE:this.disableTextSelection();this.togglePointerEvents(!1);this.toggleAnnotationLayerPointerEvents(!0);this.disableClick();return;case p.INK:this.addInkEditorIfNeeded(!1);this.disableTextSelection();this.togglePointerEvents(!0);this.disableClick();break;case p.HIGHLIGHT:this.enableTextSelection();this.togglePointerEvents(!1);this.disableClick();break;default:this.disableTextSelection();this.togglePointerEvents(!0);this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const i of xn._.values())e.toggle(`${i._type}Editing`,t===i._editorType);this.div.hidden=!1}hasTextLayer(t){return t===annotation_editor_layer_classPrivateFieldGet(bn,this)?.div}addInkEditorIfNeeded(t){if(annotation_editor_layer_classPrivateFieldGet(wn,this).getMode()!==p.INK)return;if(!t)for(const t of annotation_editor_layer_classPrivateFieldGet(mn,this).values())if(t.isEmpty()){t.setInBackground();return}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(t){annotation_editor_layer_classPrivateFieldGet(wn,this).setEditingState(t)}addCommands(t){annotation_editor_layer_classPrivateFieldGet(wn,this).addCommands(t)}togglePointerEvents(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];annotation_editor_layer_classPrivateFieldGet(pn,this)?.div.classList.toggle("disabled",!t)}enable(){this.div.tabIndex=0;this.togglePointerEvents(!0);const t=new Set;for(const e of annotation_editor_layer_classPrivateFieldGet(mn,this).values()){e.enableEditing();e.annotationElementId&&t.add(e.annotationElementId)}if(!annotation_editor_layer_classPrivateFieldGet(pn,this))return;const e=annotation_editor_layer_classPrivateFieldGet(pn,this).getEditableAnnotations();for(const i of e){i.hide();if(annotation_editor_layer_classPrivateFieldGet(wn,this).isDeletedAnnotationElement(i.data.id))continue;if(t.has(i.data.id))continue;const e=this.deserialize(i);if(e){this.addOrRebuild(e);e.enableEditing()}}}disable(){annotation_editor_layer_classPrivateFieldSet(Fn,this,!0);this.div.tabIndex=-1;this.togglePointerEvents(!1);const t=new Set;for(const e of annotation_editor_layer_classPrivateFieldGet(mn,this).values()){e.disableEditing();if(e.annotationElementId&&null===e.serialize()){this.getEditableAnnotation(e.annotationElementId)?.show();e.remove()}else t.add(e.annotationElementId)}if(annotation_editor_layer_classPrivateFieldGet(pn,this)){const e=annotation_editor_layer_classPrivateFieldGet(pn,this).getEditableAnnotations();for(const i of e){const{id:e}=i.data;t.has(e)||annotation_editor_layer_classPrivateFieldGet(wn,this).isDeletedAnnotationElement(e)||i.show()}}annotation_editor_layer_assertClassBrand(An,this,_cleanup).call(this);this.isEmpty&&(this.div.hidden=!0);const{classList:e}=this.div;for(const t of xn._.values())e.remove(`${t._type}Editing`);this.disableTextSelection();this.toggleAnnotationLayerPointerEvents(!0);annotation_editor_layer_classPrivateFieldSet(Fn,this,!1)}getEditableAnnotation(t){return annotation_editor_layer_classPrivateFieldGet(pn,this)?.getEditableAnnotation(t)||null}setActiveEditor(t){annotation_editor_layer_classPrivateFieldGet(wn,this).getActive()!==t&&annotation_editor_layer_classPrivateFieldGet(wn,this).setActiveEditor(t)}enableTextSelection(){this.div.tabIndex=-1;if(annotation_editor_layer_classPrivateFieldGet(bn,this)?.div&&!annotation_editor_layer_classPrivateFieldGet(gn,this)){annotation_editor_layer_classPrivateFieldSet(gn,this,annotation_editor_layer_assertClassBrand(An,this,_textLayerPointerDown).bind(this));annotation_editor_layer_classPrivateFieldGet(bn,this).div.addEventListener("pointerdown",annotation_editor_layer_classPrivateFieldGet(gn,this));annotation_editor_layer_classPrivateFieldGet(bn,this).div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0;if(annotation_editor_layer_classPrivateFieldGet(bn,this)?.div&&annotation_editor_layer_classPrivateFieldGet(gn,this)){annotation_editor_layer_classPrivateFieldGet(bn,this).div.removeEventListener("pointerdown",annotation_editor_layer_classPrivateFieldGet(gn,this));annotation_editor_layer_classPrivateFieldSet(gn,this,null);annotation_editor_layer_classPrivateFieldGet(bn,this).div.classList.remove("highlighting")}}enableClick(){if(!annotation_editor_layer_classPrivateFieldGet(fn,this)){annotation_editor_layer_classPrivateFieldSet(fn,this,this.pointerdown.bind(this));annotation_editor_layer_classPrivateFieldSet(_n,this,this.pointerup.bind(this));this.div.addEventListener("pointerdown",annotation_editor_layer_classPrivateFieldGet(fn,this));this.div.addEventListener("pointerup",annotation_editor_layer_classPrivateFieldGet(_n,this))}}disableClick(){if(annotation_editor_layer_classPrivateFieldGet(fn,this)){this.div.removeEventListener("pointerdown",annotation_editor_layer_classPrivateFieldGet(fn,this));this.div.removeEventListener("pointerup",annotation_editor_layer_classPrivateFieldGet(_n,this));annotation_editor_layer_classPrivateFieldSet(fn,this,null);annotation_editor_layer_classPrivateFieldSet(_n,this,null)}}attach(t){annotation_editor_layer_classPrivateFieldGet(mn,this).set(t.id,t);const{annotationElementId:e}=t;e&&annotation_editor_layer_classPrivateFieldGet(wn,this).isDeletedAnnotationElement(e)&&annotation_editor_layer_classPrivateFieldGet(wn,this).removeDeletedAnnotationElement(t)}detach(t){annotation_editor_layer_classPrivateFieldGet(mn,this).delete(t.id);annotation_editor_layer_classPrivateFieldGet(dn,this)?.removePointerInTextLayer(t.contentDiv);!annotation_editor_layer_classPrivateFieldGet(Fn,this)&&t.annotationElementId&&annotation_editor_layer_classPrivateFieldGet(wn,this).addDeletedAnnotationElement(t)}remove(t){this.detach(t);annotation_editor_layer_classPrivateFieldGet(wn,this).removeEditor(t);t.div.remove();t.isAttachedToDOM=!1;annotation_editor_layer_classPrivateFieldGet(yn,this)||this.addInkEditorIfNeeded(!1)}changeParent(t){if(t.parent!==this){if(t.annotationElementId){annotation_editor_layer_classPrivateFieldGet(wn,this).addDeletedAnnotationElement(t.annotationElementId);AnnotationEditor.deleteAnnotationElement(t);t.annotationElementId=null}this.attach(t);t.parent?.detach(t);t.setParent(this);if(t.div&&t.isAttachedToDOM){t.div.remove();this.div.append(t.div)}}}add(t){this.changeParent(t);annotation_editor_layer_classPrivateFieldGet(wn,this).addEditor(t);this.attach(t);if(!t.isAttachedToDOM){const e=t.render();this.div.append(e);t.isAttachedToDOM=!0}t.fixAndSetPosition();t.onceAdded();annotation_editor_layer_classPrivateFieldGet(wn,this).addToAnnotationStorage(t);t._reportTelemetry(t.telemetryInitialData)}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;if(t.div.contains(e)&&!annotation_editor_layer_classPrivateFieldGet(vn,this)){t._focusEventsAllowed=!1;annotation_editor_layer_classPrivateFieldSet(vn,this,setTimeout((()=>{annotation_editor_layer_classPrivateFieldSet(vn,this,null);if(t.div.contains(document.activeElement))t._focusEventsAllowed=!0;else{t.div.addEventListener("focusin",(()=>{t._focusEventsAllowed=!0}),{once:!0});e.focus()}}),0))}t._structTreeParentId=annotation_editor_layer_classPrivateFieldGet(dn,this)?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){if(t.needsToBeRebuilt()){t.parent||=this;t.rebuild();t.show()}else this.add(t)}addUndoableEditor(t){this.addCommands({cmd:()=>t._uiManager.rebuild(t),undo:()=>{t.remove()},mustExec:!1})}getNextId(){return annotation_editor_layer_classPrivateFieldGet(wn,this).getId()}canCreateNewEmptyEditor(){return annotation_editor_layer_classPrivateGetter(An,this,_get_currentEditorType)?.canCreateNewEmptyEditor()}pasteEditor(t,e){annotation_editor_layer_classPrivateFieldGet(wn,this).updateToolbar(t);annotation_editor_layer_classPrivateFieldGet(wn,this).updateMode(t);const{offsetX:i,offsetY:s}=annotation_editor_layer_assertClassBrand(An,this,_getCenterPoint).call(this),a=this.getNextId(),r=annotation_editor_layer_assertClassBrand(An,this,_createNewEditor).call(this,{parent:this,id:a,x:i,y:s,uiManager:annotation_editor_layer_classPrivateFieldGet(wn,this),isCentered:!0,...e});r&&this.add(r)}deserialize(t){return xn._.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,annotation_editor_layer_classPrivateFieldGet(wn,this))||null}createAndAddNewEditor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=this.getNextId(),a=annotation_editor_layer_assertClassBrand(An,this,_createNewEditor).call(this,{parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:annotation_editor_layer_classPrivateFieldGet(wn,this),isCentered:e,eventBus:this.eventBus,...i});a&&this.add(a);return a}addNewEditor(){this.createAndAddNewEditor(annotation_editor_layer_assertClassBrand(An,this,_getCenterPoint).call(this),!0)}setSelected(t){annotation_editor_layer_classPrivateFieldGet(wn,this).setSelected(t)}toggleSelected(t){annotation_editor_layer_classPrivateFieldGet(wn,this).toggleSelected(t)}isSelected(t){return annotation_editor_layer_classPrivateFieldGet(wn,this).isSelected(t)}unselect(t){annotation_editor_layer_classPrivateFieldGet(wn,this).unselect(t)}pointerup(t){const{isMac:e}=util_FeatureTest.platform;if(!(0!==t.button||t.ctrlKey&&e)&&t.target===this.div&&annotation_editor_layer_classPrivateFieldGet(Pn,this)){annotation_editor_layer_classPrivateFieldSet(Pn,this,!1);annotation_editor_layer_classPrivateFieldGet(un,this)?annotation_editor_layer_classPrivateFieldGet(wn,this).getMode()!==p.STAMP?this.createAndAddNewEditor(t,!1):annotation_editor_layer_classPrivateFieldGet(wn,this).unselectAll():annotation_editor_layer_classPrivateFieldSet(un,this,!0)}}pointerdown(t){annotation_editor_layer_classPrivateFieldGet(wn,this).getMode()===p.HIGHLIGHT&&this.enableTextSelection();if(annotation_editor_layer_classPrivateFieldGet(Pn,this)){annotation_editor_layer_classPrivateFieldSet(Pn,this,!1);return}const{isMac:e}=util_FeatureTest.platform;if(0!==t.button||t.ctrlKey&&e)return;if(t.target!==this.div)return;annotation_editor_layer_classPrivateFieldSet(Pn,this,!0);const i=annotation_editor_layer_classPrivateFieldGet(wn,this).getActive();annotation_editor_layer_classPrivateFieldSet(un,this,!i||i.isEmpty())}findNewParent(t,e,i){const s=annotation_editor_layer_classPrivateFieldGet(wn,this).findParent(e,i);if(null===s||s===this)return!1;s.changeParent(t);return!0}destroy(){if(annotation_editor_layer_classPrivateFieldGet(wn,this).getActive()?.parent===this){annotation_editor_layer_classPrivateFieldGet(wn,this).commitOrRemove();annotation_editor_layer_classPrivateFieldGet(wn,this).setActiveEditor(null)}if(annotation_editor_layer_classPrivateFieldGet(vn,this)){clearTimeout(annotation_editor_layer_classPrivateFieldGet(vn,this));annotation_editor_layer_classPrivateFieldSet(vn,this,null)}for(const t of annotation_editor_layer_classPrivateFieldGet(mn,this).values()){annotation_editor_layer_classPrivateFieldGet(dn,this)?.removePointerInTextLayer(t.contentDiv);t.setParent(null);t.isAttachedToDOM=!1;t.div.remove()}this.div=null;annotation_editor_layer_classPrivateFieldGet(mn,this).clear();annotation_editor_layer_classPrivateFieldGet(wn,this).removeLayer(this)}render(t){let{viewport:e}=t;this.viewport=e;setLayerDimensions(this.div,e);for(const t of annotation_editor_layer_classPrivateFieldGet(wn,this).getEditors(this.pageIndex)){this.add(t);t.rebuild()}this.updateMode()}update(t){let{viewport:e}=t;annotation_editor_layer_classPrivateFieldGet(wn,this).commitOrRemove();annotation_editor_layer_assertClassBrand(An,this,_cleanup).call(this);const i=this.viewport.rotation,s=e.rotation;this.viewport=e;setLayerDimensions(this.div,{rotation:s});if(i!==s)for(const t of annotation_editor_layer_classPrivateFieldGet(mn,this).values())t.rotate(s);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return annotation_editor_layer_classPrivateFieldGet(wn,this).viewParameters.realScale}setCleaningUp(t){annotation_editor_layer_classPrivateFieldSet(yn,this,t)}}function _textLayerPointerDown(t){annotation_editor_layer_classPrivateFieldGet(wn,this).unselectAll();if(t.target===annotation_editor_layer_classPrivateFieldGet(bn,this).div){const{isMac:e}=util_FeatureTest.platform;if(0!==t.button||t.ctrlKey&&e)return;annotation_editor_layer_classPrivateFieldGet(wn,this).showAllEditors("highlight",!0,!0);annotation_editor_layer_classPrivateFieldGet(bn,this).div.classList.add("free");HighlightEditor.startHighlighting(this,"ltr"===annotation_editor_layer_classPrivateFieldGet(wn,this).direction,t);annotation_editor_layer_classPrivateFieldGet(bn,this).div.addEventListener("pointerup",(()=>{annotation_editor_layer_classPrivateFieldGet(bn,this).div.classList.remove("free")}),{once:!0});t.preventDefault()}}function _get_currentEditorType(t){return xn._.get(annotation_editor_layer_classPrivateFieldGet(wn,t).getMode())}function _createNewEditor(t){const e=annotation_editor_layer_classPrivateGetter(An,this,_get_currentEditorType);return e?new e.prototype.constructor(t):null}function _getCenterPoint(){const{x:t,y:e,width:i,height:s}=this.div.getBoundingClientRect(),a=Math.max(0,t),r=Math.max(0,e),n=(a+Math.min(window.innerWidth,t+i))/2-t,o=(r+Math.min(window.innerHeight,e+s))/2-e,[l,c]=this.viewport.rotation%180==0?[n,o]:[o,n];return{offsetX:l,offsetY:c}}function _cleanup(){annotation_editor_layer_classPrivateFieldSet(yn,this,!0);for(const t of annotation_editor_layer_classPrivateFieldGet(mn,this).values())t.isEmpty()&&t.remove();annotation_editor_layer_classPrivateFieldSet(yn,this,!1)}!function annotation_editor_layer_defineProperty(t,e,i){(e=function annotation_editor_layer_toPropertyKey(t){var e=function annotation_editor_layer_toPrimitive(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i;return t}(AnnotationEditorLayer,"_initialized",!1);var Sn,xn={_:new Map([FreeTextEditor,InkEditor,StampEditor,HighlightEditor].map((t=>[t._editorType,t])))};function draw_layer_classPrivateFieldInitSpec(t,e,i){draw_layer_checkPrivateRedeclaration(t,e);e.set(t,i)}function draw_layer_checkPrivateRedeclaration(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function draw_layer_classPrivateFieldSet(t,e,i){return t.set(draw_layer_assertClassBrand(t,e),i),i}function draw_layer_classPrivateFieldGet(t,e){return t.get(draw_layer_assertClassBrand(t,e))}function draw_layer_assertClassBrand(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}var Cn=new WeakMap,kn=new WeakMap,En=new WeakMap,Mn=new WeakMap,Gn=new WeakSet;class DrawLayer{constructor(t){let{pageIndex:e}=t;!function draw_layer_classPrivateMethodInitSpec(t,e){draw_layer_checkPrivateRedeclaration(t,e);e.add(t)}(this,Gn);draw_layer_classPrivateFieldInitSpec(this,Cn,null);draw_layer_classPrivateFieldInitSpec(this,kn,0);draw_layer_classPrivateFieldInitSpec(this,En,new Map);draw_layer_classPrivateFieldInitSpec(this,Mn,new Map);this.pageIndex=e}setParent(t){if(draw_layer_classPrivateFieldGet(Cn,this)){if(draw_layer_classPrivateFieldGet(Cn,this)!==t){if(draw_layer_classPrivateFieldGet(En,this).size>0)for(const e of draw_layer_classPrivateFieldGet(En,this).values()){e.remove();t.append(e)}draw_layer_classPrivateFieldSet(Cn,this,t)}}else draw_layer_classPrivateFieldSet(Cn,this,t)}static get _svgFactory(){return shadow(this,"_svgFactory",new DOMSVGFactory)}highlight(t,e,i){var s,a;let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=(draw_layer_classPrivateFieldSet(kn,this,(s=draw_layer_classPrivateFieldGet(kn,this),a=s++,s)),a),o=draw_layer_assertClassBrand(Gn,this,_createSVG).call(this,t.box);o.classList.add("highlight");t.free&&o.classList.add("free");const l=DrawLayer._svgFactory.createElement("defs");o.append(l);const c=DrawLayer._svgFactory.createElement("path");l.append(c);const h=`path_p${this.pageIndex}_${n}`;c.setAttribute("id",h);c.setAttribute("d",t.toSVGPath());r&&draw_layer_classPrivateFieldGet(Mn,this).set(n,c);const d=draw_layer_assertClassBrand(Gn,this,_createClipPath).call(this,l,h),u=DrawLayer._svgFactory.createElement("use");o.append(u);o.setAttribute("fill",e);o.setAttribute("fill-opacity",i);u.setAttribute("href",`#${h}`);draw_layer_classPrivateFieldGet(En,this).set(n,o);return{id:n,clipPathId:`url(#${d})`}}highlightOutline(t){var e,i;const s=(draw_layer_classPrivateFieldSet(kn,this,(e=draw_layer_classPrivateFieldGet(kn,this),i=e++,e)),i),a=draw_layer_assertClassBrand(Gn,this,_createSVG).call(this,t.box);a.classList.add("highlightOutline");const r=DrawLayer._svgFactory.createElement("defs");a.append(r);const n=DrawLayer._svgFactory.createElement("path");r.append(n);const o=`path_p${this.pageIndex}_${s}`;n.setAttribute("id",o);n.setAttribute("d",t.toSVGPath());n.setAttribute("vector-effect","non-scaling-stroke");let l;if(t.free){a.classList.add("free");const t=DrawLayer._svgFactory.createElement("mask");r.append(t);l=`mask_p${this.pageIndex}_${s}`;t.setAttribute("id",l);t.setAttribute("maskUnits","objectBoundingBox");const e=DrawLayer._svgFactory.createElement("rect");t.append(e);e.setAttribute("width","1");e.setAttribute("height","1");e.setAttribute("fill","white");const i=DrawLayer._svgFactory.createElement("use");t.append(i);i.setAttribute("href",`#${o}`);i.setAttribute("stroke","none");i.setAttribute("fill","black");i.setAttribute("fill-rule","nonzero");i.classList.add("mask")}const c=DrawLayer._svgFactory.createElement("use");a.append(c);c.setAttribute("href",`#${o}`);l&&c.setAttribute("mask",`url(#${l})`);const h=c.cloneNode();a.append(h);c.classList.add("mainOutline");h.classList.add("secondaryOutline");draw_layer_classPrivateFieldGet(En,this).set(s,a);return s}finalizeLine(t,e){const i=draw_layer_classPrivateFieldGet(Mn,this).get(t);draw_layer_classPrivateFieldGet(Mn,this).delete(t);this.updateBox(t,e.box);i.setAttribute("d",e.toSVGPath())}updateLine(t,e){draw_layer_classPrivateFieldGet(En,this).get(t).firstChild.firstChild.setAttribute("d",e.toSVGPath())}removeFreeHighlight(t){this.remove(t);draw_layer_classPrivateFieldGet(Mn,this).delete(t)}updatePath(t,e){draw_layer_classPrivateFieldGet(Mn,this).get(t).setAttribute("d",e.toSVGPath())}updateBox(t,e){_setBox.call(DrawLayer,draw_layer_classPrivateFieldGet(En,this).get(t),e)}show(t,e){draw_layer_classPrivateFieldGet(En,this).get(t).classList.toggle("hidden",!e)}rotate(t,e){draw_layer_classPrivateFieldGet(En,this).get(t).setAttribute("data-main-rotation",e)}changeColor(t,e){draw_layer_classPrivateFieldGet(En,this).get(t).setAttribute("fill",e)}changeOpacity(t,e){draw_layer_classPrivateFieldGet(En,this).get(t).setAttribute("fill-opacity",e)}addClass(t,e){draw_layer_classPrivateFieldGet(En,this).get(t).classList.add(e)}removeClass(t,e){draw_layer_classPrivateFieldGet(En,this).get(t).classList.remove(e)}remove(t){if(null!==draw_layer_classPrivateFieldGet(Cn,this)){draw_layer_classPrivateFieldGet(En,this).get(t).remove();draw_layer_classPrivateFieldGet(En,this).delete(t)}}destroy(){draw_layer_classPrivateFieldSet(Cn,this,null);for(const t of draw_layer_classPrivateFieldGet(En,this).values())t.remove();draw_layer_classPrivateFieldGet(En,this).clear()}}Sn=DrawLayer;function _setBox(t){let{x:e=0,y:i=0,width:s=1,height:a=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{style:r}=t;r.top=100*i+"%";r.left=100*e+"%";r.width=100*s+"%";r.height=100*a+"%"}function _createSVG(t){const e=Sn._svgFactory.create(1,1,!0);draw_layer_classPrivateFieldGet(Cn,this).append(e);e.setAttribute("aria-hidden",!0);_setBox.call(Sn,e,t);return e}function _createClipPath(t,e){const i=Sn._svgFactory.createElement("clipPath");t.append(i);const s=`clip_${e}`;i.setAttribute("id",s);i.setAttribute("clipPathUnits","objectBoundingBox");const a=Sn._svgFactory.createElement("use");i.append(a);a.setAttribute("href",`#${e}`);a.classList.add("clip");return s}})();var i=__webpack_exports__.AbortException,s=__webpack_exports__.AnnotationEditorLayer,a=__webpack_exports__.AnnotationEditorParamsType,r=__webpack_exports__.AnnotationEditorType,n=__webpack_exports__.AnnotationEditorUIManager,o=__webpack_exports__.AnnotationLayer,l=__webpack_exports__.AnnotationMode,c=__webpack_exports__.CMapCompressionType,h=__webpack_exports__.ColorPicker,d=__webpack_exports__.DOMSVGFactory,u=__webpack_exports__.DrawLayer,p=__webpack_exports__.FeatureTest,_=__webpack_exports__.GlobalWorkerOptions,f=__webpack_exports__.ImageKind,g=__webpack_exports__.InvalidPDFException,v=__webpack_exports__.MissingPDFException,m=__webpack_exports__.OPS,P=__webpack_exports__.Outliner,y=__webpack_exports__.PDFDataRangeTransport,b=__webpack_exports__.PDFDateString,w=__webpack_exports__.PDFWorker,A=__webpack_exports__.PasswordResponses,S=__webpack_exports__.PermissionFlag,x=__webpack_exports__.PixelsPerInch,C=__webpack_exports__.PromiseCapability,k=__webpack_exports__.RenderingCancelledException,E=__webpack_exports__.UnexpectedResponseException,M=__webpack_exports__.Util,G=__webpack_exports__.VerbosityLevel,I=__webpack_exports__.XfaLayer,T=__webpack_exports__.build,R=__webpack_exports__.createValidAbsoluteUrl,D=__webpack_exports__.fetchData,L=__webpack_exports__.getDocument,B=__webpack_exports__.getFilenameFromUrl,O=__webpack_exports__.getPdfFilenameFromUrl,N=__webpack_exports__.getXfaPageViewport,W=__webpack_exports__.isDataScheme,j=__webpack_exports__.isPdfFile,H=__webpack_exports__.noContextMenu,U=__webpack_exports__.normalizeUnicode,z=__webpack_exports__.renderTextLayer,V=__webpack_exports__.setLayerDimensions,q=__webpack_exports__.shadow,$=__webpack_exports__.updateTextLayer,X=__webpack_exports__.version;export{i as AbortException,s as AnnotationEditorLayer,a as AnnotationEditorParamsType,r as AnnotationEditorType,n as AnnotationEditorUIManager,o as AnnotationLayer,l as AnnotationMode,c as CMapCompressionType,h as ColorPicker,d as DOMSVGFactory,u as DrawLayer,p as FeatureTest,_ as GlobalWorkerOptions,f as ImageKind,g as InvalidPDFException,v as MissingPDFException,m as OPS,P as Outliner,y as PDFDataRangeTransport,b as PDFDateString,w as PDFWorker,A as PasswordResponses,S as PermissionFlag,x as PixelsPerInch,C as PromiseCapability,k as RenderingCancelledException,E as UnexpectedResponseException,M as Util,G as VerbosityLevel,I as XfaLayer,T as build,R as createValidAbsoluteUrl,D as fetchData,L as getDocument,B as getFilenameFromUrl,O as getPdfFilenameFromUrl,N as getXfaPageViewport,W as isDataScheme,j as isPdfFile,H as noContextMenu,U as normalizeUnicode,z as renderTextLayer,V as setLayerDimensions,q as shadow,$ as updateTextLayer,X as version};